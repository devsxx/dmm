/*!
 * jQuery i18n plugin
 * @requires jQuery v1.1 or later
 *
 * See https://github.com/recurser/jquery-i18n
 *
 * Licensed under the MIT license.
 *
 * Version: 1.1.1 (Sun, 05 Jan 2014 05:26:50 GMT)
 */

//! moment.js
//! version : 2.5.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */

//  Underscore.string
//  (c) 2010 Esa-Matti Suuronen <esa-matti aet suuronen dot org>
//  Underscore.string is freely distributable under the terms of the MIT license.
//  Documentation: https://github.com/epeli/underscore.string
//  Some code is borrowed from MooTools and Alexandru Marasteanu.
//  Version '2.3.2'

// Copyright (c) Alexandru Marasteanu <alexaholic [at) gmail (dot] com>

/**
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 0.6.12
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */

/*===================================================================================================================
 * @name: bPopup
 * @type: jQuery
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.9.4
 * @requires jQuery 1.4.3
 *==================================================================================================================*/

/*
 * swiper 2.4.3
 * Mobile touch slider and framework with hardware accelerated transitions
 *
 * http://www.idangero.us/sliders/swiper/
 *
 * Copyright 2010-2014, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under GPL & MIT
 *
 * Released on: January 29, 2014
*/

/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */

/*!
 * jQuery Color Animations v2.0pre
 * http://jquery.org/
 *
 * Copyright 2011 John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */

/*!
* MediaElement.js
* HTML5 <video> and <audio> shim and player
* http://mediaelementjs.com/
*
* Creates a JavaScript object that mimics HTML5 MediaElement API
* for browsers that don't understand HTML5 or can't play the provided codec
* Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
*
* Copyright 2010-2013, John Dyer (http://j.hn)
* License: MIT
*
*/

/*!
 * Adds Internationalization and localization to objects.
 *
 * What is the concept beyond i18n?
 *   http://en.wikipedia.org/wiki/Internationalization_and_localization
 *
 *
 * This file both i18n methods and locale which is used to translate
 * strings into other languages.
 *
 * Default translations are not available, you have to add them
 * through locale objects which are named exactly as the langcode
 * they stand for. The default language is always english (en).
 *
 *
 * Wrapper built to be able to attach the i18n object to
 * other objects without changing more than one line.
 *
 *
 * LICENSE:
 *
 *   The i18n file uses methods from the Drupal project (drupal.js):
 *     - i18n.methods.t() (modified)
 *     - i18n.methods.checkPlain() (full copy)
 *     - i18n.methods.formatString() (full copy)
 *
 *   The Drupal project is (like mediaelementjs) licensed under GPLv2.
 *    - http://drupal.org/licensing/faq/#q1
 *    - https://github.com/johndyer/mediaelement
 *    - http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 *
 * @author
 *   Tim Latz (latz.tim@gmail.com)
 *
 * @see
 *   me-i18n-locale.js
 *
 * @params
 *  - context - document, iframe ..
 *  - exports - CommonJS, window ..
 *
 */

/*!
 * This is a i18n.locale language object.
 *
 *<de> German translation by Tim Latz, latz.tim@gmail.com
 *
 * @author
 *   Tim Latz (latz.tim@gmail.com)
 *
 * @see
 *   me-i18n.js
 *
 * @params
 *  - exports - CommonJS, window ..
 */

/*!
 * This is a i18n.locale language object.
 *
 *<de> Traditional chinese translation by Tim Latz, latz.tim@gmail.com
 *
 * @author
 *   Tim Latz (latz.tim@gmail.com)
 *
 * @see
 *   me-i18n.js
 *
 * @params
 *  - exports - CommonJS, window ..
 */

/*!
 * MediaElementPlayer
 * http://mediaelementjs.com/
 *
 * Creates a controller bar for HTML5 <video> add <audio> tags
 * using jQuery and MediaElement.js (HTML5 Flash/Silverlight wrapper)
 *
 * Copyright 2010-2013, John Dyer (http://j.hn/)
 * License: MIT
 *
 */

function FastClick(e){var t,n=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e;if(!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)};if(FastClick.notNeeded(e))return;this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;t==="click"?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;t==="click"?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),typeof e.onclick=="function"&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null)}function onYouTubePlayerAPIReady(){mejs.YouTubeApi.iFrameReady()}function onYouTubePlayerReady(e){mejs.YouTubeApi.flashReady(e)}(function(e){var t=Array.prototype.slice,n={dict:null,load:function(t){this.dict!==null?e.extend(this.dict,t):this.dict=t},_:function(e){return dict=this.dict,dict&&dict.hasOwnProperty(e)&&(e=dict[e]),args=t.call(arguments),args[0]=e,this.printf.apply(this,args)},printf:function(n,r){return arguments.length<2?n:(r=e.isArray(r)?r:t.call(arguments,1),n.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(e,t,n){return n?t+r[parseInt(n)-1]:t+r.shift()}).replace(/%%s/g,"%s"))}};e.fn._t=function(t,r){return e(this).html(n._.apply(n,arguments))},e.i18n=n})(jQuery),define("jquery.i18n",function(){}),define("utils/plugin/i18n",["jquery.i18n"],function(){return $.i18n.setLanguage=function(e){var t="app/build/language/",n=$.ajax(t+e+".json",{cache:!1,dataType:"json",type:"POST",timeout:3e4,data:{}}),r=$.ajax(t+e+".json",{cache:!1,dataType:"json",type:"POST",timeout:3e4,data:{}});$.when(n,r).done().fail()},$.i18n}),function(e){function Q(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function G(e,t){return function(n){return st(e.call(this,n),t)}}function Y(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function Z(){}function et(e){gt(e),nt(this,e)}function tt(e){var t=ct(e),n=t.year||0,r=t.month||0,i=t.week||0,s=t.day||0,o=t.hour||0,u=t.minute||0,a=t.second||0,f=t.millisecond||0;this._milliseconds=+f+a*1e3+u*6e4+o*36e5,this._days=+s+i*7,this._months=+r+n*12,this._data={},this._bubble()}function nt(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function rt(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&d.hasOwnProperty(n)&&(t[n]=e[n]);return t}function it(e){return e<0?Math.ceil(e):Math.floor(e)}function st(e,t,n){var r=""+Math.abs(e),i=e>=0;while(r.length<t)r="0"+r;return(i?n?"+":"":"-")+r}function ot(e,n,r,i){var s=n._milliseconds,o=n._days,u=n._months,a,f;s&&e._d.setTime(+e._d+s*r);if(o||u)a=e.minute(),f=e.hour();o&&e.date(e.date()+o*r),u&&e.month(e.month()+u*r),s&&!i&&t.updateOffset(e);if(o||u)e.minute(a),e.hour(f)}function ut(e){return Object.prototype.toString.call(e)==="[object Array]"}function at(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function ft(e,t,n){var r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),s=0,o;for(o=0;o<r;o++)(n&&e[o]!==t[o]||!n&&pt(e[o])!==pt(t[o]))&&s++;return s+i}function lt(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=z[e]||W[t]||t}return e}function ct(e){var t={},n,r;for(r in e)e.hasOwnProperty(r)&&(n=lt(r),n&&(t[n]=e[r]));return t}function ht(n){var r,i;if(n.indexOf("week")===0)r=7,i="day";else{if(n.indexOf("month")!==0)return;r=12,i="month"}t[n]=function(s,o){var u,a,f=t.fn._lang[n],l=[];typeof s=="number"&&(o=s,s=e),a=function(e){var n=t().utc().set(i,e);return f.call(t.fn._lang,n,s||"")};if(o!=null)return a(o);for(u=0;u<r;u++)l.push(a(u));return l}}function pt(e){var t=+e,n=0;return t!==0&&isFinite(t)&&(t>=0?n=Math.floor(t):n=Math.ceil(t)),n}function dt(e,t){return(new Date(Date.UTC(e,t+1,0))).getUTCDate()}function vt(e){return mt(e)?366:365}function mt(e){return e%4===0&&e%100!==0||e%400===0}function gt(e){var t;e._a&&e._pf.overflow===-2&&(t=e._a[u]<0||e._a[u]>11?u:e._a[a]<1||e._a[a]>dt(e._a[o],e._a[u])?a:e._a[f]<0||e._a[f]>23?f:e._a[l]<0||e._a[l]>59?l:e._a[c]<0||e._a[c]>59?c:e._a[h]<0||e._a[h]>999?h:-1,e._pf._overflowDayOfYear&&(t<o||t>a)&&(t=a),e._pf.overflow=t)}function yt(e){return e._isValid==null&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&e._pf.charsLeftOver===0&&e._pf.unusedTokens.length===0)),e._isValid}function bt(e){return e?e.toLowerCase().replace("_","-"):e}function wt(e,n){return n._isUTC?t(e).zone(n._offset||0):t(e).local()}function Et(e,t){return t.abbr=e,p[e]||(p[e]=new Z),p[e].set(t),p[e]}function St(e){delete p[e]}function xt(e){var n=0,r,i,s,o,u=function(e){if(!p[e]&&v)try{require("./lang/"+e)}catch(t){}return p[e]};if(!e)return t.fn._lang;if(!ut(e)){i=u(e);if(i)return i;e=[e]}while(n<e.length){o=bt(e[n]).split("-"),r=o.length,s=bt(e[n+1]),s=s?s.split("-"):null;while(r>0){i=u(o.slice(0,r).join("-"));if(i)return i;if(s&&s.length>=r&&ft(o,s,!0)>=r-1)break;r--}n++}return t.fn._lang}function Tt(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function Nt(e){var t=e.match(b),n,r;for(n=0,r=t.length;n<r;n++)J[t[n]]?t[n]=J[t[n]]:t[n]=Tt(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=t[n]instanceof Function?t[n].call(i,e):t[n];return s}}function Ct(e,t){return e.isValid()?(t=kt(t,e.lang()),X[t]||(X[t]=Nt(t)),X[t](e)):e.lang().invalidDate()}function kt(e,t){function r(e){return t.longDateFormat(e)||e}var n=5;w.lastIndex=0;while(n>=0&&w.test(e))e=e.replace(w,r),w.lastIndex=0,n-=1;return e}function Lt(e,t){var n,r=t._strict;switch(e){case"DDDD":return _;case"YYYY":case"GGGG":case"gggg":return r?D:x;case"Y":case"G":case"g":return H;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return r?P:T;case"S":if(r)return O;case"SS":if(r)return M;case"SSS":if(r)return _;case"DDD":return S;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return C;case"a":case"A":return xt(t._l)._meridiemParse;case"X":return A;case"Z":case"ZZ":return k;case"T":return L;case"SSSS":return N;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return r?M:E;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return E;default:return n=new RegExp(Bt(Ht(e.replace("\\","")),"i")),n}}function At(e){e=e||"";var t=e.match(k)||[],n=t[t.length-1]||[],r=(n+"").match(q)||["-",0,0],i=+(r[1]*60)+pt(r[2]);return r[0]==="+"?-i:i}function Ot(e,t,n){var r,i=n._a;switch(e){case"M":case"MM":t!=null&&(i[u]=pt(t)-1);break;case"MMM":case"MMMM":r=xt(n._l).monthsParse(t),r!=null?i[u]=r:n._pf.invalidMonth=t;break;case"D":case"DD":t!=null&&(i[a]=pt(t));break;case"DDD":case"DDDD":t!=null&&(n._dayOfYear=pt(t));break;case"YY":i[o]=pt(t)+(pt(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":i[o]=pt(t);break;case"a":case"A":n._isPm=xt(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":i[f]=pt(t);break;case"m":case"mm":i[l]=pt(t);break;case"s":case"ss":i[c]=pt(t);break;case"S":case"SS":case"SSS":case"SSSS":i[h]=pt(("0."+t)*1e3);break;case"X":n._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=At(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=t)}}function Mt(e){var n,r,i=[],s,c,h,p,d,v,m,g;if(e._d)return;s=Dt(e),e._w&&e._a[a]==null&&e._a[u]==null&&(h=function(n){var r=parseInt(n,10);return n?n.length<3?r>68?1900+r:2e3+r:r:e._a[o]==null?t().weekYear():e._a[o]},p=e._w,p.GG!=null||p.W!=null||p.E!=null?d=Vt(h(p.GG),p.W||1,p.E,4,1):(v=xt(e._l),m=p.d!=null?Ut(p.d,v):p.e!=null?parseInt(p.e,10)+v._week.dow:0,g=parseInt(p.w,10)||1,p.d!=null&&m<v._week.dow&&g++,d=Vt(h(p.gg),g,m,v._week.doy,v._week.dow)),e._a[o]=d.year,e._dayOfYear=d.dayOfYear),e._dayOfYear&&(c=e._a[o]==null?s[o]:e._a[o],e._dayOfYear>vt(c)&&(e._pf._overflowDayOfYear=!0),r=Rt(c,0,e._dayOfYear),e._a[u]=r.getUTCMonth(),e._a[a]=r.getUTCDate());for(n=0;n<3&&e._a[n]==null;++n)e._a[n]=i[n]=s[n];for(;n<7;n++)e._a[n]=i[n]=e._a[n]==null?n===2?1:0:e._a[n];i[f]+=pt((e._tzm||0)/60),i[l]+=pt((e._tzm||0)%60),e._d=(e._useUTC?Rt:qt).apply(null,i)}function _t(e){var t;if(e._d)return;t=ct(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],Mt(e)}function Dt(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function Pt(e){e._a=[],e._pf.empty=!0;var t=xt(e._l),n=""+e._i,r,i,s,o,u,a=n.length,l=0;s=kt(e._f,t).match(b)||[];for(r=0;r<s.length;r++)o=s[r],i=(n.match(Lt(o,e))||[])[0],i&&(u=n.substr(0,n.indexOf(i)),u.length>0&&e._pf.unusedInput.push(u),n=n.slice(n.indexOf(i)+i.length),l+=i.length),J[o]?(i?e._pf.empty=!1:e._pf.unusedTokens.push(o),Ot(o,i,e)):e._strict&&!i&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=a-l,n.length>0&&e._pf.unusedInput.push(n),e._isPm&&e._a[f]<12&&(e._a[f]+=12),e._isPm===!1&&e._a[f]===12&&(e._a[f]=0),Mt(e),gt(e)}function Ht(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i})}function Bt(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function jt(e){var t,n,r,i,s;if(e._f.length===0){e._pf.invalidFormat=!0,e._d=new Date(NaN);return}for(i=0;i<e._f.length;i++){s=0,t=nt({},e),t._pf=Q(),t._f=e._f[i],Pt(t);if(!yt(t))continue;s+=t._pf.charsLeftOver,s+=t._pf.unusedTokens.length*10,t._pf.score=s;if(r==null||s<r)r=s,n=t}nt(e,n||t)}function Ft(e){var t,n,r=e._i,i=B.exec(r);if(i){e._pf.iso=!0;for(t=0,n=F.length;t<n;t++)if(F[t][1].exec(r)){e._f=F[t][0]+(i[6]||" ");break}for(t=0,n=I.length;t<n;t++)if(I[t][1].exec(r)){e._f+=I[t][0];break}r.match(k)&&(e._f+="Z"),Pt(e)}else e._d=new Date(r)}function It(t){var n=t._i,r=m.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):typeof n=="string"?Ft(t):ut(n)?(t._a=n.slice(0),Mt(t)):at(n)?t._d=new Date(+n):typeof n=="object"?_t(t):t._d=new Date(n)}function qt(e,t,n,r,i,s,o){var u=new Date(e,t,n,r,i,s,o);return e<1970&&u.setFullYear(e),u}function Rt(e){var t=new Date(Date.UTC.apply(null,arguments));return e<1970&&t.setUTCFullYear(e),t}function Ut(e,t){if(typeof e=="string")if(!isNaN(e))e=parseInt(e,10);else{e=t.weekdaysParse(e);if(typeof e!="number")return null}return e}function zt(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function Wt(e,t,n){var r=i(Math.abs(e)/1e3),s=i(r/60),o=i(s/60),u=i(o/24),a=i(u/365),f=r<45&&["s",r]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",i(u/30)]||a===1&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,zt.apply({},f)}function Xt(e,n,r){var i=r-n,s=r-e.day(),o;return s>i&&(s-=7),s<i-7&&(s+=7),o=t(e).add("d",s),{week:Math.ceil(o.dayOfYear()/7),year:o.year()}}function Vt(e,t,n,r,i){var s=Rt(e,0,1).getUTCDay(),o,u;return n=n!=null?n:i,o=i-s+(s>r?7:0)-(s<i?7:0),u=7*(t-1)+(n-i)+o+1,{year:u>0?e:e-1,dayOfYear:u>0?u:vt(e-1)+u}}function $t(e){var n=e._i,r=e._f;return n===null?t.invalid({nullInput:!0}):(typeof n=="string"&&(e._i=n=xt().preparse(n)),t.isMoment(n)?(e=rt(n),e._d=new Date(+n._d)):r?ut(r)?jt(e):Pt(e):It(e),new et(e))}function Jt(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var r=this._isUTC?"UTC":"";return e!=null?(this._d["set"+r+n](e),t.updateOffset(this),this):this._d["get"+r+n]()}}function Kt(e){t.duration.fn[e]=function(){return this._data[e]}}function Qt(e,n){t.duration.fn["as"+e]=function(){return+this/n}}function Gt(e){var n=!1,i=t;if(typeof ender!="undefined")return;e?(r.moment=function(){return!n&&console&&console.warn&&(n=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),i.apply(null,arguments)},nt(r.moment,i)):r.moment=t}var t,n="2.5.1",r=this,i=Math.round,s,o=0,u=1,a=2,f=3,l=4,c=5,h=6,p={},d={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},v=typeof module!="undefined"&&module.exports&&typeof require!="undefined",m=/^\/?Date\((\-?\d+)/i,g=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,y=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,b=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,w=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,E=/\d\d?/,S=/\d{1,3}/,x=/\d{1,4}/,T=/[+\-]?\d{1,6}/,N=/\d+/,C=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,k=/Z|[\+\-]\d\d:?\d\d/gi,L=/T/i,A=/[\+\-]?\d+(\.\d{1,3})?/,O=/\d/,M=/\d\d/,_=/\d{3}/,D=/\d{4}/,P=/[+-]?\d{6}/,H=/[+-]?\d+/,B=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,j="YYYY-MM-DDTHH:mm:ssZ",F=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],I=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],q=/([\+\-]|\d\d)/gi,R="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),U={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},z={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},W={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},X={},V="DDD w W M D d".split(" "),$="M D H h m s w W".split(" "),J={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return st(this.year()%100,2)},YYYY:function(){return st(this.year(),4)},YYYYY:function(){return st(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+st(Math.abs(e),6)},gg:function(){return st(this.weekYear()%100,2)},gggg:function(){return st(this.weekYear(),4)},ggggg:function(){return st(this.weekYear(),5)},GG:function(){return st(this.isoWeekYear()%100,2)},GGGG:function(){return st(this.isoWeekYear(),4)},GGGGG:function(){return st(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return pt(this.milliseconds()/100)},SS:function(){return st(pt(this.milliseconds()/10),2)},SSS:function(){return st(this.milliseconds(),3)},SSSS:function(){return st(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+st(pt(e/60),2)+":"+st(pt(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+st(pt(e/60),2)+st(pt(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},K=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];while(V.length)s=V.pop(),J[s+"o"]=Y(J[s],s);while($.length)s=$.pop(),J[s+s]=G(J[s],2);J.DDDD=G(J.DDD,3),nt(Z.prototype,{set:function(e){var t,n;for(n in e)t=e[n],typeof t=="function"?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,r,i;this._monthsParse||(this._monthsParse=[]);for(n=0;n<12;n++){this._monthsParse[n]||(r=t.utc([2e3,n]),i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i"));if(this._monthsParse[n].test(e))return n}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var n,r,i;this._weekdaysParse||(this._weekdaysParse=[]);for(n=0;n<7;n++){this._weekdaysParse[n]||(r=t([2e3,1]).day(n),i="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[n]=new RegExp(i.replace(".",""),"i"));if(this._weekdaysParse[n].test(e))return n}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return(e+"").toLowerCase().charAt(0)==="p"},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return typeof n=="function"?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return typeof i=="function"?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n=="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return Xt(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),t=function(t,n,r,i){var s;return typeof r=="boolean"&&(i=r,r=e),s={},s._isAMomentObject=!0,s._i=t,s._f=n,s._l=r,s._strict=i,s._isUTC=!1,s._pf=Q(),$t(s)},t.utc=function(t,n,r,i){var s;return typeof r=="boolean"&&(i=r,r=e),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=r,s._i=t,s._f=n,s._strict=i,s._pf=Q(),$t(s).utc()},t.unix=function(e){return t(e*1e3)},t.duration=function(e,n){var r=e,i=null,s,o,u;return t.isDuration(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:typeof e=="number"?(r={},n?r[n]=e:r.milliseconds=e):(i=g.exec(e))?(s=i[1]==="-"?-1:1,r={y:0,d:pt(i[a])*s,h:pt(i[f])*s,m:pt(i[l])*s,s:pt(i[c])*s,ms:pt(i[h])*s}):!(i=y.exec(e))||(s=i[1]==="-"?-1:1,u=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*s},r={y:u(i[2]),M:u(i[3]),d:u(i[4]),h:u(i[5]),m:u(i[6]),s:u(i[7]),w:u(i[8])}),o=new tt(r),t.isDuration(e)&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},t.version=n,t.defaultFormat=j,t.updateOffset=function(){},t.lang=function(e,n){var r;return e?(n?Et(bt(e),n):n===null?(St(e),e="en"):p[e]||xt(e),r=t.duration.fn._lang=t.fn._lang=xt(e),r._abbr):t.fn._lang._abbr},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),xt(e)},t.isMoment=function(e){return e instanceof et||e!=null&&e.hasOwnProperty("_isAMomentObject")},t.isDuration=function(e){return e instanceof tt};for(s=K.length-1;s>=0;--s)ht(K[s]);t.normalizeUnits=function(e){return lt(e)},t.invalid=function(e){var n=t.utc(NaN);return e!=null?nt(n._pf,e):n._pf.userInvalidated=!0,n},t.parseZone=function(e){return t(e).parseZone()},nt(t.fn=et.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d+(this._offset||0)*6e4},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=t(this).utc();return 0<e.year()&&e.year()<=9999?Ct(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):Ct(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return yt(this)},isDSTShifted:function(){return this._a?this.isValid()&&ft(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0:!1},parsingFlags:function(){return nt({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var n=Ct(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),ot(this,r,1),this},subtract:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),ot(this,r,-1),this},diff:function(e,n,r){var i=wt(e,this),s=(this.zone()-i.zone())*6e4,o,u;return n=lt(n),n==="year"||n==="month"?(o=(this.daysInMonth()+i.daysInMonth())*432e5,u=(this.year()-i.year())*12+(this.month()-i.month()),u+=(this-t(this).startOf("month")-(i-t(i).startOf("month")))/o,u-=(this.zone()-t(this).startOf("month").zone()-(i.zone()-t(i).startOf("month").zone()))*6e4/o,n==="year"&&(u/=12)):(o=this-i,u=n==="second"?o/1e3:n==="minute"?o/6e4:n==="hour"?o/36e5:n==="day"?(o-s)/864e5:n==="week"?(o-s)/6048e5:o),r?u:it(u)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=wt(t(),this).startOf("day"),n=this.diff(e,"days",!0),r=n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(r,this))},isLeapYear:function(){return mt(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e!=null?(e=Ut(e,this.lang()),this.add({d:e-t})):t},month:function(e){var n=this._isUTC?"UTC":"",r;if(e!=null){if(typeof e=="string"){e=this.lang().monthsParse(e);if(typeof e!="number")return this}return r=this.date(),this.date(1),this._d["set"+n+"Month"](e),this.date(Math.min(r,this.daysInMonth())),t.updateOffset(this),this}return this._d["get"+n+"Month"]()},startOf:function(e){e=lt(e);switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return e==="week"?this.weekday(0):e==="isoWeek"&&this.isoWeekday(1),this},endOf:function(e){return e=lt(e),this.startOf(e).add(e==="isoWeek"?"week":e,1).subtract("ms",1)},isAfter:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)===+wt(e,this).startOf(t)},min:function(e){return e=t.apply(null,arguments),e<this?this:e},max:function(e){return e=t.apply(null,arguments),e>this?this:e},zone:function(e){var n=this._offset||0;return e==null?this._isUTC?n:this._d.getTimezoneOffset():(typeof e=="string"&&(e=At(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,n!==e&&ot(this,t.duration(n-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):typeof this._i=="string"&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e?e=t(e).zone():e=0,(this.zone()-e)%60===0},daysInMonth:function(){return dt(this.year(),this.month())},dayOfYear:function(e){var n=i((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?n:this.add("d",e-n)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(e){var t=Xt(this,this.lang()._week.dow,this.lang()._week.doy).year;return e==null?t:this.add("y",e-t)},isoWeekYear:function(e){var t=Xt(this,1,4).year;return e==null?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},isoWeek:function(e){var t=Xt(this,1,4).week;return e==null?t:this.add("d",(e-t)*7)},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return e==null?t:this.add("d",e-t)},isoWeekday:function(e){return e==null?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return e=lt(e),this[e]()},set:function(e,t){return e=lt(e),typeof this[e]=="function"&&this[e](t),this},lang:function(t){return t===e?this._lang:(this._lang=xt(t),this)}});for(s=0;s<R.length;s++)Jt(R[s].toLowerCase().replace(/s$/,""),R[s]);Jt("year","FullYear"),t.fn.days=t.fn.day,t.fn.months=t.fn.month,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.fn.toJSON=t.fn.toISOString,nt(t.duration.fn=tt.prototype,{_bubble:function(){var e=this._milliseconds,t=this._days,n=this._months,r=this._data,i,s,o,u;r.milliseconds=e%1e3,i=it(e/1e3),r.seconds=i%60,s=it(i/60),r.minutes=s%60,o=it(s/60),r.hours=o%24,t+=it(o/24),r.days=t%30,n+=it(t/30),r.months=n%12,u=it(n/12),r.years=u},weeks:function(){return it(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+pt(this._months/12)*31536e6},humanize:function(e){var t=+this,n=Wt(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,n){var r=t.duration(e,n);return this._milliseconds+=r._milliseconds,this._days+=r._days,this._months+=r._months,this._bubble(),this},subtract:function(e,n){var r=t.duration(e,n);return this._milliseconds-=r._milliseconds,this._days-=r._days,this._months-=r._months,this._bubble(),this},get:function(e){return e=lt(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=lt(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:t.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),r=Math.abs(this.hours()),i=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(r||i||s?"T":"")+(r?r+"H":"")+(i?i+"M":"")+(s?s+"S":""):"P0D"}});for(s in U)U.hasOwnProperty(s)&&(Qt(s,U[s]),Kt(s.toLowerCase()));Qt("Weeks",6048e5),t.duration.fn.asMonths=function(){return(+this-this.years()*31536e6)/2592e6+this.years()*12},t.lang("en",{ordinal:function(e){var t=e%10,n=pt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),v?(module.exports=t,Gt(!0)):typeof define=="function"&&define.amd?define("moment",["require","exports","module"],function(n,r,i){return i.config&&i.config()&&i.config().noGlobal!==!0&&Gt(i.config().noGlobal===e),t}):Gt()}.call(this),function(){function u(e){this._value=e}function a(e,t,n,r){var i=Math.pow(10,t),s,o;return o=(n(e*i)/i).toFixed(t),r&&(s=new RegExp("0{1,"+r+"}$"),o=o.replace(s,"")),o}function f(e,t,n){var r;return t.indexOf("$")>-1?r=c(e,t,n):t.indexOf("%")>-1?r=h(e,t,n):t.indexOf(":")>-1?r=p(e,t):r=v(e._value,t,n),r}function l(e,t){var s=t,o,u,a,f,l=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=!1,h;if(t.indexOf(":")>-1)e._value=d(t);else if(t===i)e._value=0;else{n[r].delimiters.decimal!=="."&&(t=t.replace(/\./g,"").replace(n[r].delimiters.decimal,".")),o=new RegExp("[^a-zA-Z]"+n[r].abbreviations.thousand+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),u=new RegExp("[^a-zA-Z]"+n[r].abbreviations.million+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+n[r].abbreviations.billion+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+n[r].abbreviations.trillion+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$");for(h=0;h<=l.length;h++){c=t.indexOf(l[h])>-1?Math.pow(1024,h+1):!1;if(c)break}e._value=(c?c:1)*(s.match(o)?Math.pow(10,3):1)*(s.match(u)?Math.pow(10,6):1)*(s.match(a)?Math.pow(10,9):1)*(s.match(f)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),e._value=c?Math.ceil(e._value):e._value}return e._value}function c(e,t,i){var s=t.indexOf("$"),o=t.indexOf("("),u=t.indexOf("-"),a="",f,l;t.indexOf(" $")>-1?(a=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(a=" ",t=t.replace("$ ","")):t=t.replace("$",""),l=v(e._value,t,i);if(s<=1)if(l.indexOf("(")>-1||l.indexOf("-")>-1){l=l.split(""),f=1;if(s<o||s<u)f=0;l.splice(f,0,n[r].currency.symbol+a),l=l.join("")}else l=n[r].currency.symbol+a+l;else l.indexOf(")")>-1?(l=l.split(""),l.splice(-1,0,a+n[r].currency.symbol),l=l.join("")):l=l+a+n[r].currency.symbol;return l}function h(e,t,n){var r="",i,s=e._value*100;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),i=v(s,t,n),i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,r+"%"),i=i.join("")):i=i+r+"%",i}function p(e){var t=Math.floor(e._value/60/60),n=Math.floor((e._value-t*60*60)/60),r=Math.round(e._value-t*60*60-n*60);return t+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)}function d(e){var t=e.split(":"),n=0;return t.length===3?(n+=Number(t[0])*60*60,n+=Number(t[1])*60,n+=Number(t[2])):t.length===2&&(n+=Number(t[0])*60,n+=Number(t[1])),Number(n)}function v(e,t,s){var o=!1,u=!1,f=!1,l="",c=!1,h=!1,p=!1,d=!1,v=!1,m="",g="",y=Math.abs(e),b=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],w,E,S,x,T,N,C="",k=!1;if(e===0&&i!==null)return i;t.indexOf("(")>-1?(o=!0,t=t.slice(1,-1)):t.indexOf("+")>-1&&(u=!0,t=t.replace(/\+/g,""));if(t.indexOf("a")>-1){c=t.indexOf("aK")>=0,h=t.indexOf("aM")>=0,p=t.indexOf("aB")>=0,d=t.indexOf("aT")>=0,v=c||h||p||d,t.indexOf(" a")>-1?(l=" ",t=t.replace(" a","")):t=t.replace("a","");if(y>=Math.pow(10,12)&&!v||d)l+=n[r].abbreviations.trillion,e/=Math.pow(10,12);else if(y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!v||p)l+=n[r].abbreviations.billion,e/=Math.pow(10,9);else if(y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!v||h)l+=n[r].abbreviations.million,e/=Math.pow(10,6);else if(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!v||c)l+=n[r].abbreviations.thousand,e/=Math.pow(10,3)}if(t.indexOf("b")>-1){t.indexOf(" b")>-1?(m=" ",t=t.replace(" b","")):t=t.replace("b","");for(S=0;S<=b.length;S++){w=Math.pow(1024,S),E=Math.pow(1024,S+1);if(e>=w&&e<E){m+=b[S],w>0&&(e/=w);break}}}return t.indexOf("o")>-1&&(t.indexOf(" o")>-1?(g=" ",t=t.replace(" o","")):t=t.replace("o",""),g+=n[r].ordinal(e)),t.indexOf("[.]")>-1&&(f=!0,t=t.replace("[.]",".")),x=e.toString().split(".")[0],T=t.split(".")[1],N=t.indexOf(","),T?(T.indexOf("[")>-1?(T=T.replace("]",""),T=T.split("["),C=a(e,T[0].length+T[1].length,s,T[1].length)):C=a(e,T.length,s),x=C.split(".")[0],C.split(".")[1].length?C=n[r].delimiters.decimal+C.split(".")[1]:C="",f&&Number(C.slice(1))===0&&(C="")):x=a(e,null,s),x.indexOf("-")>-1&&(x=x.slice(1),k=!0),N>-1&&(x=x.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n[r].delimiters.thousands)),t.indexOf(".")===0&&(x=""),(o&&k?"(":"")+(!o&&k?"-":"")+(!k&&u?"+":"")+x+C+(g?g:"")+(l?l:"")+(m?m:"")+(o&&k?")":"")}function m(e,t){n[e]=t}function g(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function y(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var n=g(e),r=g(t);return n>r?n:r},-Infinity)}var e,t="1.5.3",n={},r="en",i=null,s="0,0",o=typeof module!="undefined"&&module.exports;e=function(t){return e.isNumeral(t)?t=t.value():t===0||typeof t=="undefined"?t=0:Number(t)||(t=e.fn.unformat(t)),new u(Number(t))},e.version=t,e.isNumeral=function(e){return e instanceof u},e.language=function(t,i){if(!t)return r;if(t&&!i){if(!n[t])throw new Error("Unknown language : "+t);r=t}return(i||!n[t])&&m(t,i),e},e.languageData=function(e){if(!e)return n[r];if(!n[e])throw new Error("Unknown language : "+e);return n[e]},e.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:"$"}}),e.zeroFormat=function(e){i=typeof e=="string"?e:null},e.defaultFormat=function(e){s=typeof e=="string"?e:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,r,i=this.length>>>0,s=!1;1<arguments.length&&(r=t,s=!0);for(n=0;i>n;++n)this.hasOwnProperty(n)&&(s?r=e(r,this[n],n,this):(r=this[n],s=!0));if(!s)throw new TypeError("Reduce of empty array with no initial value");return r}),e.fn=u.prototype={clone:function(){return e(this)},format:function(e,t){return f(this,e?e:s,t!==undefined?t:Math.round)},unformat:function(e){return Object.prototype.toString.call(e)==="[object Number]"?e:l(this,e?e:s)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function n(e,n,r,i){return e+t*n}var t=y.call(null,this._value,e);return this._value=[this._value,e].reduce(n,0)/t,this},subtract:function(e){function n(e,n,r,i){return e-t*n}var t=y.call(null,this._value,e);return this._value=[e].reduce(n,this._value*t)/t,this},multiply:function(e){function t(e,t,n,r){var i=y(e,t);return e*i*t*i/(i*i)}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t,n,r){var i=y(e,t);return e*i/(t*i)}return this._value=[this._value,e].reduce(t),this},difference:function(t){return Math.abs(e(this._value).subtract(t).value())}},o&&(module.exports=e),typeof ender=="undefined"&&(this.numeral=e),typeof define=="function"&&define.amd&&define("numeral",[],function(){return e})}.call(this),!function(e,t){function f(e,t){var n,r,i=e.toLowerCase();t=[].concat(t);for(n=0;n<t.length;n+=1){r=t[n];if(!r)continue;if(r.test&&r.test(e))return!0;if(r.toLowerCase()===i)return!0}}var n=t.prototype.trim,r=t.prototype.trimRight,i=t.prototype.trimLeft,s=function(e){return e*1||0},o=function(e,t){if(t<1)return"";var n="";while(t>0)t&1&&(n+=e),t>>=1,e+=e;return n},u=[].slice,a=function(e){return e==null?"\\s":e.source?e.source:"["+d.escapeRegExp(e)+"]"},l={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},c={};for(var h in l)c[l[h]]=h;c["'"]="#39";var p=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=o,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s=1,o=r.length,u="",a,f=[],l,c,h,d,v,m;for(l=0;l<o;l++){u=e(r[l]);if(u==="string")f.push(r[l]);else if(u==="array"){h=r[l];if(h[2]){a=i[s];for(c=0;c<h[2].length;c++){if(!a.hasOwnProperty(h[2][c]))throw new Error(p('[_.sprintf] property "%s" does not exist',h[2][c]));a=a[h[2][c]]}}else h[1]?a=i[h[1]]:a=i[s++];if(/[^s]/.test(h[8])&&e(a)!="number")throw new Error(p("[_.sprintf] expecting number but found %s",e(a)));switch(h[8]){case"b":a=a.toString(2);break;case"c":a=t.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=h[7]?a.toExponential(h[7]):a.toExponential();break;case"f":a=h[7]?parseFloat(a).toFixed(h[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=t(a))&&h[7]?a.substring(0,h[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(h[8])&&h[3]&&a>=0?"+"+a:a,v=h[4]?h[4]=="0"?"0":h[4].charAt(1):" ",m=h[6]-t(a).length,d=h[6]?n(v,m):"",f.push(h[5]?a+d:d+a)}}return f.join("")},r.cache={},r.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},r}(),d={VERSION:"2.3.0",isBlank:function(e){return e==null&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return e==null?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=e==null?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){return e==null?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},clean:function(e){return d.strip(e).replace(/\s+/g," ")},count:function(e,n){if(e==null||n==null)return 0;e=t(e),n=t(n);var r=0,i=0,s=n.length;for(;;){i=e.indexOf(n,i);if(i===-1)break;r++,i+=s}return r},chars:function(e){return e==null?[]:t(e).split("")},swapCase:function(e){return e==null?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return e==null?"":t(e).replace(/[&<>"']/g,function(e){return"&"+c[e]+";"})},unescapeHTML:function(e){return e==null?"":t(e).replace(/\&([^;]+);/g,function(e,n){var r;return n in l?l[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?t.fromCharCode(~~r[1]):e})},escapeRegExp:function(e){return e==null?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,r){var i=d.chars(e);return i.splice(~~t,~~n,r),i.join("")},insert:function(e,t,n){return d.splice(e,t,0,n)},include:function(e,n){return n===""?!0:e==null?!1:t(e).indexOf(n)!==-1},join:function(){var e=u.call(arguments),t=e.shift();return t==null&&(t=""),e.join(t)},lines:function(e){return e==null?[]:t(e).split("\n")},reverse:function(e){return d.chars(e).reverse().join("")},startsWith:function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},endsWith:function(e,n){return n===""?!0:e==null||n==null?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},succ:function(e){return e==null?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return e==null?"":(e=t(e).toLowerCase(),e.replace(/(?:^|\s|-)\S/g,function(e){return e.toUpperCase()}))},camelize:function(e){return d.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""})},underscored:function(e){return d.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return d.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return d.titleize(t(e).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(e){return d.capitalize(d.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,r){return e==null?"":!r&&n?n.call(e):(r=a(r),t(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),""))},ltrim:function(e,n){return e==null?"":!n&&i?i.call(e):(n=a(n),t(e).replace(new RegExp("^"+n+"+"),""))},rtrim:function(e,n){return e==null?"":!n&&r?r.call(e):(n=a(n),t(e).replace(new RegExp(n+"+$"),""))},truncate:function(e,n,r){return e==null?"":(e=t(e),r=r||"...",n=~~n,e.length>n?e.slice(0,n)+r:e)},prune:function(e,n,r){if(e==null)return"";e=t(e),n=~~n,r=r!=null?t(r):"...";if(e.length<=n)return e;var i=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);return s.slice(s.length-2).match(/\w\w/)?s=s.replace(/\s*\S+$/,""):s=d.rtrim(s.slice(0,s.length-1)),(s+r).length>e.length?e:e.slice(0,s.length)+r},words:function(e,t){return d.isBlank(e)?[]:d.trim(e,t).split(t||/\s+/)},pad:function(e,n,r,i){e=e==null?"":t(e),n=~~n;var s=0;r?r.length>1&&(r=r.charAt(0)):r=" ";switch(i){case"right":return s=n-e.length,e+o(r,s);case"both":return s=n-e.length,o(r,Math.ceil(s/2))+e+o(r,Math.floor(s/2));default:return s=n-e.length,o(r,s)+e}},lpad:function(e,t,n){return d.pad(e,t,n)},rpad:function(e,t,n){return d.pad(e,t,n,"right")},lrpad:function(e,t,n){return d.pad(e,t,n,"both")},sprintf:p,vsprintf:function(e,t){return t.unshift(e),p.apply(null,t)},toNumber:function(e,t){return e?(e=d.trim(e),e.match(/^-?\d+(?:\.\d+)?$/)?s(s(e).toFixed(~~t)):NaN):0},numberFormat:function(e,t,n,r){if(isNaN(e)||e==null)return"";e=e.toFixed(~~t),r=typeof r=="string"?r:",";var i=e.split("."),s=i[0],o=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},strRight:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strRightBack:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.lastIndexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strLeft:function(e,n){if(e==null)return"";e=t(e),n=n!=null?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(0,r):e},strLeftBack:function(e,t){if(e==null)return"";e+="",t=t!=null?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,r){t=t||", ",n=n||" and ";var i=e.slice(),s=i.pop();return e.length>2&&r&&(n=d.rtrim(t)+n),i.length?i.join(t)+n+s:s},toSentenceSerial:function(){var e=u.call(arguments);return e[3]=!0,d.toSentence.apply(d,e)},slugify:function(e){if(e==null)return"";var n="ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",r="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",i=new RegExp(a(n),"g");return e=t(e).toLowerCase().replace(i,function(e){var t=n.indexOf(e);return r.charAt(t)||"-"}),d.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e,t){return d.surround(e,t||'"')},unquote:function(e,t){return t=t||'"',e[0]===t&&e[e.length-1]===t?e.slice(1,e.length-1):e},exports:function(){var e={};for(var t in this){if(!this.hasOwnProperty(t)||t.match(/^(?:include|contains|reverse)$/))continue;e[t]=this[t]}return e},repeat:function(e,n,r){if(e==null)return"";n=~~n;if(r==null)return o(t(e),n);for(var i=[];n>0;i[--n]=e);return i.join(r)},naturalCmp:function(e,n){if(e==n)return 0;if(!e)return-1;if(!n)return 1;var r=/(\.\d+)|(\d+)|(\D+)/g,i=t(e).toLowerCase().match(r),s=t(n).toLowerCase().match(r),o=Math.min(i.length,s.length);for(var u=0;u<o;u++){var a=i[u],f=s[u];if(a!==f){var l=parseInt(a,10);if(!isNaN(l)){var c=parseInt(f,10);if(!isNaN(c)&&l-c)return l-c}return a<f?-1:1}}return i.length===s.length?i.length-s.length:e<n?-1:1},levenshtein:function(e,n){if(e==null&&n==null)return 0;if(e==null)return t(n).length;if(n==null)return t(e).length;e=t(e),n=t(n);var r=[],i,s;for(var o=0;o<=n.length;o++)for(var u=0;u<=e.length;u++)o&&u?e.charAt(u-1)===n.charAt(o-1)?s=i:s=Math.min(r[u],r[u-1],i)+1:s=o+u,i=r[u],r[u]=s;return r.pop()},toBoolean:function(e,t,n){typeof e=="number"&&(e=""+e);if(typeof e!="string")return!!e;e=d.trim(e);if(f(e,t||["true","1"]))return!0;if(f(e,n||["false","0"]))return!1}};d.strip=d.trim,d.lstrip=d.ltrim,d.rstrip=d.rtrim,d.center=d.lrpad,d.rjust=d.lpad,d.ljust=d.rpad,d.contains=d.include,d.q=d.quote,d.toBool=d.toBoolean,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(module.exports=d),exports._s=d),typeof define=="function"&&define.amd&&define("underscore.string",[],function(){return d}),e._=e._||{},e._.string=e._.str=d}(this,String),define("cutstring",[],function(){function e(e,t){this.tempDiv=document.createElement("div"),this.tempDiv.id="TempNodeForTest",this.tempDiv.innerHTML=e,this.charCount=0,this.limit=t}function t(t,n){return(new e(t,n)).cut()}return e.prototype.cut=function(){var e=document.createElement("div");return this.searchEnd(this.tempDiv,e),e.innerHTML},e.prototype.searchEnd=function(e,t){var n,r;for(var i=0;i<e.childNodes.length;i++){n=e.childNodes[i];if(n.nodeType!=3){r=n.cloneNode(!0),t.appendChild(r);if(n.childNodes.length===0)continue;r.innerHTML="";var s=this.searchEnd(n,r);if(s)return s;continue}if(n.nodeValue.length+this.charCount>=this.limit)return r=n.cloneNode(!0),r.nodeValue=n.nodeValue.substr(0,this.limit-this.charCount),t.appendChild(r),!0;r=n.cloneNode(!0),t.appendChild(r),this.charCount+=n.nodeValue.length}return!1},t}),define("utils/plugin/str",["underscore.string","cutstring"],function(e){return e.cutHtml=require("cutstring"),e.shorten=function(t,n,r){t=e.stripTags(t);var i=t.length;if(i<=n)return t;if(!r)return e.truncate(t,n,"...");var s=t.substring(0,n),o='<span class="shorten-text-less">'+t.substring(0,n)+" ...</span>"+'<a class="shorten-link-more" rel="shorten"> '+_t("More")+" </a>"+'<span class="shorten-text-more hide">'+t+"</span>"+'<a class="shorten-link-less hide" rel="shorten"> '+_t("Less")+" </a>";return o},e.shortenHtml=function(t,n,r){var i=e.stripTags(t).length;if(i<=n)return t;if(!r)return e.cutHtml(t,n);var s=t.substring(0,n),o=t.substring(n),u='<span class="shorten-text-less">'+e.cutHtml(t,n)+" ...</span>"+'<a class="shorten-link-more" rel="shorten"> '+_t("More")+" </a>"+'<span class="shorten-text-more hide">'+t+"</span>"+'<a class="shorten-link-less hide" rel="shorten"> '+_t("Less")+" </a>";return u},e}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&e.type==="file"||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){return this.deviceIsAndroid&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},FastClick.prototype.focus=function(e){var t;this.deviceIsIOS&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){var t,n,r;if(e.targetTouches.length>1)return!0;if($(e.target).closest(".needsclick").length>0)return!0;if($(e.target).is("select"))return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(this.deviceIsIOS){r=window.getSelection();if(r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},FastClick.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},FastClick.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){var t,n,r,i,s,o=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(s=e.changedTouches[0],o=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)||o,o.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=o.tagName.toLowerCase();if(r==="label"){t=this.findControl(o);if(t){this.focus(o);if(this.deviceIsAndroid)return!1;o=t}}else if(this.needsFocus(o)){if(e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&r==="input")return this.targetElement=null,!1;this.focus(o),this.sendClick(o,e);if(!this.deviceIsIOS4||r!=="select")this.targetElement=null,e.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){i=o.fastClickScrollParent;if(i&&i.fastClickLastScrollTop!==i.scrollTop)return!0}return this.needsClick(o)||(e.preventDefault(),this.sendClick(o,e)),!1},FastClick.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){var t,n;if(typeof window.ontouchstart=="undefined")return!0;n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(n){if(!FastClick.prototype.deviceIsAndroid)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(n>31&&window.innerWidth<=window.screen.width)return!0}}return e.style.msTouchAction==="none"?!0:!1},FastClick.attach=function(e){return new FastClick(e)},typeof define!="undefined"&&define.amd?define("fastclick",[],function(){return FastClick}):typeof module!="undefined"&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,define("utils/plugin/observer",["fastclick"],function(e){var t={};return _.extend(t,Backbone.Events),"ontouchstart"in window&&FastClick.attach(document.body),$(document.body).on("click",'[clickable="true"]',function(e){var n=$(this),r="click",i=n.data(r);if(!i)return;t.trigger(i,n,e),e.preventDefault()}),$(document).on("click",'[rel="delegate"]',function(e){if(!e)return!1;e.preventDefault(),$el=$(e.currentTarget);var t=$el.attr("id")||"";if(!t)return!1;var n=t.split("-"),r=n.shift(),i=n.join("-"),s=$el.data();s.id=t,$("#"+i).trigger(r,s)}).on("click",'[rel="link"]',function(e){if(!e)return!1;var t=$(e.target),n=t.attr("rel")||"link";if(n!="link")return!1;if(t.closest(".prevent").length||t.hasClass("prevent"))return!1;if(t.get(0).tagName=="A"){var r=t.attr("href");return r&&(window.location.href=r),!1}var i=$(e.currentTarget),r=i.data("url");r&&(window.location.href=r)}).on("click",'[rel="shorten"]',function(e){if(!e)return!1;var t=$(e.currentTarget),n=t.parent();n.find(".shorten-link-less").toggleClass("hide"),n.find(".shorten-link-more").toggleClass("hide"),n.find(".shorten-text-less").toggleClass("hide"),n.find(".shorten-text-more").toggleClass("hide"),n.closest(".content").trigger("refresh"),e.preventDefault()}),t}),define("utils/plugin/blockui",["utils/plugin/observer"],function(e){function t(){this.isShown=!1,this.$el=$("#blockui"),this.$stage=$("#blockui-stage"),this.$content=$("#blockui-content"),this.show=function(e){return 1==this.isShown?this.isShown=!0:(e||(e=""),this.$stage[e?"removeClass":"addClass"]("hide"),this.$content.html(e),this.isShown=!0,$(document.body).addClass("blockui-open"),this.$el.addClass("open"),this)},this.content=function(e){return this.$stage[e?"removeClass":"addClass"]("hide"),this.$content.html(e),this},this.hide=function(){if(0==this.isShown)return this.isShown=!1;this.isShown=!1,this.$el.removeClass("open"),this.$content.html(" "),$(document.body).removeClass("blockui-open")}}var n=new t;return e.on("blockui",function(){n.show()}).on("releaseui",function(){n.hide()}),n}),define("utils/plugin/api",[],function(){var e={cache:!1,dataType:"json",type:"POST",timeout:3e4,data:{},beforeSend:function(){}};return{setup:function(e){var t=$.extend({token:null},e);$.ajaxSetup({headers:t})},post:function(t,n,r){return r=$.extend({},e,{type:"POST",data:n},r),utils.debug.log("POST: "+t+" DATA: ",n),$.ajax(constants.apiUrl+t,r).fail(this._handleFail).done(!Debug||this._printResponse)},get:function(t,n,r){var i=constants.apiUrl+t;return r=$.extend({},e,{type:"GET",data:n},r),utils.debug.log("GET: "+t+" \nDATA: ",n),$.ajax.apply(null,[constants.apiUrl+t,r]).fail(this._handleFail).done(!Debug||this._printResponse)},test:function(t,n,r){var i=constants.testUrl+t;return r=$.extend({},e,{type:"GET",data:n},r),$.ajax.apply(null,[constants.apiUrl+t,r]).fail(this._handleFail).done(!Debug||this._printResponse)},uploadVideo:function(e,t,n){var r=this,i=$.Deferred(),s=t,o=s.split("/").pop(),u="video/quicktime",a=new FileUploadOptions,f=new FileTransfer;constants.platform=="android"&&(o=s.match(/\/([^\/]+)$/)[1]+".mp4",u="video/mp4");var n=$.extend({token:constants.token,sTitle:o,search:1},n);a.fileKey="video",a.fileName=o,a.mimeType=u,a.chunkedMode=!1,a.params=n,a.headers={token:constants.token},utils.observer.trigger("blockui"),utils.blockui.content(_t("Uploading 0%, please wait ...")),f.upload(s,encodeURI(constants.apiUrl+e),function(e){utils.observer.trigger("releaseui");var t=$.parseJSON(e.response);i.resolve(t)},function(e){utils.observer.trigger("releaseui"),utils.modal.alert(_t("Can not upload file(s). Please try again later.")),i.reject(e)},a);var l=0;return f.onprogress=function(e){e.lengthComputable&&(l=e.loaded*100/e.total,utils.blockui.content(_t("Uploading %s%, please wait",parseInt(l,10)))),i.progress(e)},i.promise()},uploadImage:function(e,t,n){var r=this,i=$.Deferred(),s=t,o="",u=new FileUploadOptions,a=new FileTransfer;s.match(/[^\/]+.jpg$/g)?o=s.match(/[^\/]+.jpg$/ig)[0]:s.match(/id=(\w|\-)+/)&&(o=s.match(/id=(\w|\-)+/)[0].replace("id=","")+".jpg"),o==""&&constants.platform=="android"&&(o=s.match(/\/([^\/]+)$/)[1]+".jpg");var n=$.extend({token:constants.token,iAlbumId:0,sTitle:o},n);u.fileKey="image",u.fileName=o,u.mimeType="image/jpeg",u.chunkedMode=!1,u.params=n,utils.observer.trigger("blockui"),utils.blockui.content(_t("Uploading 0%, please wait ...")),utils.debug.log("uploading image to URL: "+e+" \n Params: ",n),a.upload(s,encodeURI(constants.apiUrl+e),function(e){utils.observer.trigger("releaseui");var t=$.parseJSON(e.response);i.resolve(t)},function(e){utils.observer.trigger("releaseui"),utils.modal.alert(_t("Can not upload file(s). Please try again later.")),console.log("Error upload file :"+JSON.stringify(e)),i.reject(e)},u);var f=0;return a.onprogress=function(e){e.lengthComputable&&(f=e.loaded*100/e.total,utils.blockui.content(_t("Uploading %s%, please wait",parseInt(f,10)))),i.progress(e)},i.promise()},_handleFail:function(e,t,n){if(t&&t=="abort")return;utils.modal.toast(_t("Can not get data from server")),utils.debug.log("FAILED: ",t,n)},_printResponse:function(e,t,n){utils.debug.log("RESPONSE: ",e)}}}),define("utils/plugin/setting",["utils/plugin/api","utils/plugin/observer"],function(e,t){var n=Backbone.Model.extend({defaults:{like_allow_dislike:!0,mfox_limit_photo_to_scroll:3,user_date_of_birth_start:1900,user_date_of_birth_end:1997},fetchData:function(){e.get("core/settings",{},{context:this,async:!1}).done(this.fetchDataComplete).fail(this.fetchDataFail)},fetchDataComplete:function(e){e.error_code||(this.set(e),localStorage.setItem("settings",JSON.stringify(e)))},fetchDataFail:function(){},initialize:function(){var e=localStorage.getItem("settings");e&&(e=JSON.parse(e),this.set(e))}}),r=new n({});return t.on("app:init",function(){r.fetchData()}),r}),define("utils/plugin/debug",[],function(){if(Debug)return{log:function(){console.log.apply(console,arguments)},info:function(){console.info.apply(console,arguments)},error:function(){console.error.apply(console,arguments)},warn:function(){console.warn.apply(console,arguments)}};var e=function(){};return{log:e,info:e,error:e}}),define("utils/plugin/support",[],function(){return{nativeScroll:!1}}),define("utils/plugin/livetime",[],function(){return{translate:function(e){if(e<60)return"Seconds ago";if(e<3600){var t=parseInt(e/60,10);return t+" minute ago"}if(e<86400){var t=parseInt(e/3600,10);return t+" hours ago"}if(e<2592e3){var t=parseInt(e/86400,10);return t+" days ago"}if(e<94608e4){var t=parseInt(e/2592e3,10);return t+" months ago"}var t=parseInt(e/94608e4,10);return t+" year ago"},update:function(){var e=parseInt((new Date).getTime()/1e3);$(".livetimestamp").each(function(t,n){var r=parseInt($(this).data("utime"),10),i=e-r;if(isNaN(i)||i<0)return;$(this).html($Livetime.translate(i))})},convert:function(e){var t=parseInt((new Date).getTime()/1e3),n=parseInt(e,10),r=t-n;return isNaN(r)?"":this.translate(r)}}}),define("utils/plugin/router",[],function(){var e=Backbone.Router.extend({});return new e}),define("utils/plugin/helper",[],function(){return{checkToAddHttpIntoLinkIfNeccessary:function(e){return e.match(/^[a-zA-Z]{1,5}:\/\//)||(e="http://"+e),e},shorten:function(e,t,n){return e?(e.length>t&&(e=e.substr(0,t)+n),e):""}}}),define("utils/plugin/attachment",[],function(){function e(){this.proxy={}}return e.prototype.add=function(e,t){if(typeof e=="string")this.proxy[e]=t;else if(typeof e=="object")for(var n=0;n<e.length;++n)this.proxy[e[n]]=t},e.prototype.translate=function(e){return this.proxy.hasOwnProperty(e)?this.proxy[e]:!1},new e}),define("utils/plugin/headline",[],function(){var e=function(){this.proxy={}};return e.prototype.add=function(e,t){if(typeof e=="string")this.proxy[e]=t;else if(typeof e=="object")for(var n=0;n<e.length;++n)this.proxy[e[n]]=t},e.prototype.translate=function(e){var t=e.getActionType();return this.proxy.hasOwnProperty(t)?this.proxy[t](e):this._default(e)},e.prototype._default=function(e){return""},new e}),define("utils/plugin/request-proxy",[],function(){function e(){this.proxy={}}return e.prototype.add=function(e,t){if(typeof e=="string")this.proxy[e]=t;else if(typeof e=="object")for(var n=0;n<e.length;++n)this.proxy[e[n]]=t},e.prototype.get=function(e){var t=e.getRequestType();return this.proxy.hasOwnProperty(t)?this.proxy[t]:!1},new e}),define("utils/plugin/modal",[],function(){var e=function(){this.toast=function(){console.info.apply(console,arguments)},this.alert=function(){window.alert.apply(window,arguments)},this.confirm=function(e,t,n,r){t(window.confirm(e)?1:2)},this.promt=function(){return window.promt.apply(window,promt)}},t=new e;return document.addEventListener("deviceready",function(){t.alert=function(){return navigator.notification.alert.apply(navigator.notification,arguments)},t.confirm=function(){return navigator.notification.confirm.apply(navigator.notitication,arguments)},t.promt=function(){return navigator.notification.promt.apply(navigator.notification,arguments)},t.toast=function(){return window.plugins.toast.showShortBottom.apply(window.plugins.toast,arguments)}}),t}),define("utils/plugin/layout",["utils/plugin/observer"],function(e){var t=$(document.body),n="",r=!1,i=!1;return e.on("sidebar:open",function(){t.addClass("sidebar-open"),r=!0}).on("sidebar:close",function(){t.removeClass("sidebar-open"),r=!1}).on("sidebar:pre_show",function(){n&&(n.close(),n=!1)}).on("beeber:after_close",function(){n=!1}).on("beeber:before_open",function(e){n&&n.close(),n=e}).on("router:changed",function(){n&&(n.close(),n=!1),r&&($(document.body).removeClass("sidebar-open"),r=!1),i&&($(document.body).removeClass("bottom-open"),i=!1)}).on("bottom:open",function(){i=!0,$(document.body).addClass("bottom-open")}).on("bottom:close",function(){i=!1,$(document.body).removeClass("bottom-open")}),{bottomIsShown:function(){return i}}}),define("utils/plugin/validator",[],function(){return{isUrl:function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i;return t.test(e)},isEmail:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},isEmpty:function(e){return e==undefined||e.trim()==""},isNotEmpty:function(e){return e!=undefined&&e.trim()!=""},isVimeoVideoUrl:function(e){var t=/\/\/(www\.)?vimeo.com\/(\d+)($|\/)/i;return t.test(e)},isYoutubeVideoUrl:function(e){var t=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/i;return t.test(e)}}}),function(e){e.fn.bPopup=function(t,n){function T(){H(r.onOpen),p=(u.data("bPopup")||0)+1,d=l+p+"__",m=r.position[1]!=="auto",g=r.position[0]!=="auto",y=r.positionStyle==="fixed",E=i.outerHeight(!0),S=i.outerWidth(!0),r.loadUrl?N():C()}function N(){r.contentContainer=e(r.contentContainer||i);switch(r.content){case"iframe":var t=e('<iframe class="b-iframe" '+r.iframeAttr+"></iframe>");t.appendTo(r.contentContainer),E=i.outerHeight(!0),S=i.outerWidth(!0),C(),t.attr("src",r.loadUrl),H(r.loadCallback);break;case"image":C(),e("<img />").load(function(){H(r.loadCallback),L(e(this))}).attr("src",r.loadUrl).hide().appendTo(r.contentContainer);break;default:C(),e('<div class="b-ajax-wrapper"></div>').load(r.loadUrl,r.loadData,function(){H(r.loadCallback),L(e(this))}).hide().appendTo(r.contentContainer)}}function C(){r.modal&&e('<div class="b-modal '+d+'"></div>').css({backgroundColor:r.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:r.zIndex+p}).appendTo(r.appendTo).fadeTo(r.speed,r.opacity,"linear"),B(),i.data("bPopup",r).data("id",d).css({left:r.transition=="slideIn"||r.transition=="slideBack"?r.transition=="slideBack"?s.scrollLeft()+f:(w+S)*-1:D(!(!r.follow[0]&&g||y)),position:r.positionStyle||"absolute",top:r.transition=="slideDown"||r.transition=="slideUp"?r.transition=="slideUp"?s.scrollTop()+a:b+E*-1:P(!(!r.follow[1]&&m||y)),"z-index":r.zIndex+p+1}).each(function(){r.appending&&e(this).appendTo(r.appendTo)}),M(!0)}function k(){if(!r)return;return r.modal&&e(".b-modal."+i.data("id")).fadeTo(r.speed,0,function(){e(this).remove()}),O(),M(),!1}function L(e){var t=e.width(),n=e.height(),s={};r.contentContainer.css({height:n,width:t}),n>=i.height()&&(s.height=i.height()),t>=i.width()&&(s.width=i.width()),E=i.outerHeight(!0),S=i.outerWidth(!0),B(),r.contentContainer.css({height:"auto",width:"auto"}),s.left=D(!(!r.follow[0]&&g||y)),s.top=P(!(!r.follow[1]&&m||y)),i.animate(s,250,function(){e.show(),v=j()})}function A(){u.data("bPopup",p),i.delegate(".bClose, ."+r.closeClass,"click."+d,k),r.modalClose&&e(".b-modal."+d).css("cursor","pointer").bind("click",k),!c&&(r.follow[0]||r.follow[1])&&u.bind("scroll."+d,function(){v&&i.dequeue().animate({left:r.follow[0]?D(!y):"auto",top:r.follow[1]?P(!y):"auto"},r.followSpeed,r.followEasing)}).bind("resize."+d,function(){a=F(),f=I(),v=j(),v&&(clearTimeout(x),x=setTimeout(function(){B(),i.dequeue().each(function(){y?e(this).css({left:w,top:b}):e(this).animate({left:r.follow[0]?D(!0):"auto",top:r.follow[1]?P(!0):"auto"},r.followSpeed,r.followEasing)})},50))}),r.escClose&&s.bind("keydown."+d,function(e){e.which==27&&k()})}function O(){if(!r)return;r.scrollBar||e("html").css("overflow","auto"),e(".b-modal."+d).unbind("click"),s.unbind("keydown."+d),u.unbind("."+d).data("bPopup",u.data("bPopup")-1>0?u.data("bPopup")-1:null),i.undelegate(".bClose, ."+r.closeClass,"click."+d,k).data("bPopup",null)}function M(e){function t(t){i.css({display:"block",opacity:1}).animate(t,r.speed,r.easing,function(){_(e)})}switch(e?r.transition:r.transitionClose||r.transition){case"slideIn":t({left:e?D(!(!r.follow[0]&&g||y)):s.scrollLeft()-(S||i.outerWidth(!0))-h});break;case"slideBack":t({left:e?D(!(!r.follow[0]&&g||y)):s.scrollLeft()+f+h});break;case"slideDown":t({top:e?P(!(!r.follow[1]&&m||y)):s.scrollTop()-(E||i.outerHeight(!0))-h});break;case"slideUp":t({top:e?P(!(!r.follow[1]&&m||y)):s.scrollTop()+a+h});break;default:i.stop().fadeTo(r.speed,e?1:0,function(){_(e)})}}function _(e){e?(A(),H(n),r.autoClose&&setTimeout(k,r.autoClose)):(i.hide(),H(r.onClose),r.loadUrl&&(r.contentContainer.empty(),i.css({height:"auto",width:"auto"})))}function D(e){return e?w+s.scrollLeft():w}function P(e){return e?b+s.scrollTop():b}function H(t){e.isFunction(t)&&t.call(i)}function B(){b=m?r.position[1]:Math.max(0,(a-i.outerHeight(!0))/2-r.amsl),w=g?r.position[0]:(f-i.outerWidth(!0))/2,v=j()}function j(){return a>i.outerHeight(!0)&&f>i.outerWidth(!0)}function F(){return o.innerHeight||u.height()}function I(){return o.innerWidth||u.width()}e.isFunction(t)&&(n=t,t=null);var r=e.extend({},e.fn.bPopup.defaults,t);r.scrollBar||e("html").css("overflow","hidden");var i=this,s=e(document),o=window,u=e(o),a=F(),f=I(),l="__b-popup",c=/OS 6(_\d)+/i.test(navigator.userAgent),h=200,p=0,d,v,m,g,y,b,w,E,S,x;return i.close=function(){r=this.data("bPopup"),d=l+u.data("bPopup")+"__",k()},i.each(function(){if(e(this).data("bPopup"))return;T()})},e.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:1030}}(jQuery),define("bpopup",function(){}),define("utils/plugin/history",[],function(){var e=function(){this._data=new Array,this._maxLength=3,this._rootUrl=constants.home,this._lastUrl=null,this._popupIsShown=!1,this._bottomIsShown=!1,this.setPopupIsShown=function(e){this._popupIsShown=e},this.setBottomIsShown=function(e){this._bottomIsShown=e},this.clear=function(){return this._data=new Array,this._lastUrl=null,this},this.getCurrentUrl=function(){var e=url=window.location.href.match(/(#.*)$/i);return e?e.pop():this._data.pop()},this.rebuild=function(e){return arguments.length?(e.push(this.getCurrentUrl()),this._data=e):this._data=new Array(this.getCurrentUrl()),this},this.back=function(){this._lastUrl="";var e=this._data.pop();return e==this.getCurrentUrl()&&(e=this._data.pop()),e?window.location.href=e:window.location.href=this._rootUrl,this},this.go=function(e){var t=history._data.length,n=t-1+e;if(n<0||n>=t)return;window.location.href=this._data[n]},this.goRoot=function(){window.location.href=this._rootUrl},this.push=function(e,t){e=e||!1,t=t||this.getCurrentUrl();if(e){utils.debug.log("change history root: ",t),this._rootUrl=t,this._data=[];return}return this._lastUrl!=t&&(this._data.length==this._maxLength&&this._data.shift(),utils.debug.log("push to history: ",t),this._data.push(this._lastUrl=t)),this}},t=new e;return $(document).on("click",'[rel="back"]',function(){t.back()}),document.addEventListener("backbutton",function(){if(utils.blockui.isShown)return;if(utils.layout.bottomIsShown()){utils.observer.trigger("bottom:close");return}if(utils.popup.isShown()){utils.popup.close();return}t.back()},!1),t}),define("utils/plugin/popup",["bpopup","utils/plugin/observer","utils/plugin/history"],function(e,t){function n(){var e=!1,t=$("#simple-popup"),n={},r=!1;n.onClose=function(){e=!1,$(document.body).removeClass("popup-open")},n.onOpen=function(){e=!0,$(document.body).addClass("popup-open")},this.close=function(){return $(document.body).removeClass("popup-open"),0==e?e=!1:(e=!1,t.close(),this)},this.open=function(r,i){return this.isShown&&t.close&&t.close(),t.html(r).bPopup.call(t,n,i),e=!0,this},this.isShown=function(){return e}}var r=new n;return t.on("router:changed",function(){r.isShown()&&r.close()}),r}),define("utils/plugin/topmenu",["utils/plugin/popup"],function(){function e(){this._topMenuView=!1,this.toggle=function(e,t){constants.isTablet||!e.topMenuIsShown()?(e.topMenuIsShown(!0),this._topMenuView=(new e.topMenuView({model:t})).render().inject()):(e.topMenuIsShown(!1),this._topMenuView&&(this._topMenuView.hide(),this._topMenuView=!1))}}return Backbone.TopMenuView=Backbone.View.extend({region:{holder:"#top_menu_holder"},template:null,render:function(){return this.$holder=$(this.region.holder),this.$el.html(this.template({item:this.model})),this},inject:function(){return constants.isTablet?utils.popup.open(this.$el):(this.$holder.html(this.$el),this.$holder.removeClass("hide")),this},hide:function(){return constants.isTablet?utils.popup.close():(this.$holder.addClass("hide"),this.$el.remove()),this}}),new e}),define("utils/extend/jquery",[],function(){var e=+(new Date);$.fn.id=function(){var t=$(this.get(0)),n=t.prop("id");return n||(n=++e,t.attr("id","eid_"+n)),"#"+n},$.newElenentId=function(){return"_"+ ++e},$.fn.isDisabled=function(){if(!arguments.length)return this.hasClass("disabled");arguments[0]?this.addClass("disabled"):this.removeClass("disabled")},$.fn.isProcessing=function(){if(!arguments.length)return this.hasClass("processing");arguments[0]?this.addClass("processing"):this.removeClass("processing")}}),define("utils/extend/model",["utils/plugin/livetime"],function(e){Backbone.Model.prototype.getId=function(){return this.id},Backbone.Model.prototype.getType=function(){return this.get("sModelType")},Backbone.Model.prototype.getGID=function(){return this.getType()+"@"+this.getId()},Backbone.Model.prototype.getTimestamp=function(){return this.get("iTimeStamp")||this.get("iTimestamp")||0},Backbone.Model.prototype.getLivetime=function(){return utils.moment(this.getTimestamp()*1e3).fromNow()},Backbone.Model.prototype.getTimeConverted=function(){return this.get("sTimeConverted")},Backbone.Model.prototype.canView=function(){return this.get("bCanView")?1:0},Backbone.Model.prototype.canLike=function(){return this.get("bCanLike")?1:0},Backbone.Model.prototype.canDislike=function(){return utils.setting.get("like_allow_dislike")&&this.get("bCanDislike")||!1},Backbone.Model.prototype.canShare=function(){return this.get("bCanShare")==void 0?1:this.get("bCanShare")?1:0},Backbone.Model.prototype.canRate=function(){return this.get("bCanRate")},Backbone.Model.prototype.canComment=function(){return this.get("bCanComment")||this.get("bCanPostComment")?1:0},Backbone.Model.prototype.isLiked=function(){return this.get("bIsLiked")?1:0},Backbone.Model.prototype.isDisliked=function(){return this.get("bIsDisliked")||!1},Backbone.Model.prototype.isRated=function(){return this.get("bIsRating")?1:0},Backbone.Model.prototype.getCategory=function(){return this.get("iCategoryId")||this.get("iCategory")},Backbone.Model.prototype.getTitle=function(){return this.get("sTitle")||""},Backbone.Model.prototype.getDescription=function(){return this.get("sDescription")||""},Backbone.Model.prototype.getRateCount=function(){return this.get("iRatingCount")||0},Backbone.Model.prototype.getRateValue=function(){return(Math.round((this.get("fRating")||0)*10)/10).toString().replace(".0","")},Backbone.Model.prototype.getRateFloatValue=function(){return this.get("fRating")||0},Backbone.Model.prototype.getLikeCount=function(){return parseInt(this.get("iTotalLike")||0,10)},Backbone.Model.prototype.getDislikeCount=function(){return parseInt(this.get("iTotalDislike")||0,10)},Backbone.Model.prototype.getLikeCountLabel=function(){var e=this.getLikeCount();return e==1?_t("%s Like",e):_t("%s Likes",e)},Backbone.Model.prototype.getDislikeCountLabel=function(){var e=this.getDislikeCount();return e==1?_t("%s Dislike",e):_t("%s Dislikes",e)},Backbone.Model.prototype.getCommentCountLabel=function(){var e=this.getCommentCount();return e==1?_t("%s Comment",e):_t("%s Comments",e)},Backbone.Model.prototype.getShareCountLabel=function(){return _t("Share")},Backbone.Model.prototype.getRateValueLabel=function(){return _t("%s Rating",this.getRateValue())},Backbone.Model.prototype.getDataId=function(e){return arguments.length?[e,this.getType(),this.getId()].join("-"):[this.getType(),this.getId()].join("-")},Backbone.Model.prototype.getDataLike=function(){return[this.getType(),this.getId(),this.getLikeCount(),this.canLike()?1:0,this.isLiked()?1:0].join(";")},Backbone.Model.prototype.getDataDislike=function(){return[this.getType(),this.getId(),this.getDislikeCount(),this.canDislike()?1:0,this.isDisliked()?1:0].join(";")},Backbone.Model.prototype.getIdLike=function(){return["like",this.getType(),this.getId()].join("_")},Backbone.Model.prototype.getIdDislike=function(){return["dislike",this.getType(),this.getId()].join("_")},Backbone.Model.prototype.getIdShare=function(){return["share",this.getType(),this.getId()].join("_")},Backbone.Model.prototype.getIdComment=function(){return["comment",this.getType(),this.getId()].join("_")},Backbone.Model.prototype.getIdRate=function(){return["rate",this.getType(),this.getId()].join("_")},Backbone.Model.prototype.getDataRate=function(){return[this.getType(),this.getId(),this.getRateCount(),this.getRateFloatValue(),this.getRateValue(),this.canRate()?1:0,this.isRated()?1:0].join(";")},Backbone.Model.prototype.getDataComment=function(){return[this.getType(),this.getId(),this.getCommentCount(),this.canComment()?1:0].join(";")},Backbone.Model.prototype.getDataShare=function(){return[this.getType(),this.getId(),this.getShareCount(),this.canShare()?1:0].join(";")},Backbone.Model.prototype.getDataReport=function(){return[this.getType(),this.getId()].join(";")},Backbone.Model.prototype.getViewCount=function(){return this.get("iTotalView")||0},Backbone.Model.prototype.getUrl=function(){return"#"+this.getType()+"/"+this.getId()},Backbone.Model.prototype.getCommentUrl=function(){var e=this.get("aAttachments");return e&&e.length>0&&(e[0].sModule=="event"||e[0].sModule=="fevent")?"#event-detail/"+e[0].sModule+"/"+e[0].iId+"/activity":this.getUrl()+"/comment"+(this.getParentModuleId()?"/"+this.getParentModuleId():"")},Backbone.Model.prototype.getCommentCount=function(){return parseInt(this.get("iTotalComment")||0,10)},Backbone.Model.prototype.getShareCount=function(){return this.get("iTotalShare")||0},Backbone.Model.prototype.getShareCountLabel=function(){return _t("Share")},Backbone.Model.prototype.getRateValueLabel=function(){return _t("%s Rating",this.getRateValue())},Backbone.Model.prototype.getPosterId=function(){return this.get("iUserId")||this.get("iSenderId")},Backbone.Model.prototype.getPosterType=function(){return"user"},Backbone.Model.prototype.getPosterUrl=function(){return"#"+this.getPosterType()+"/"+this.getPosterId()},Backbone.Model.prototype.getPosterTitle=function(e){return this.get("sFullName")||this.get("sFullname")||this.get("sUserName")},Backbone.Model.prototype.getPosterImageSrc=function(){return this.get("sUserImage")||this.get("sImage")},Backbone.Model.prototype.isOwner=function(){return this.getPosterId()==Backbone.iUserId},Backbone.Model.prototype.getItemId=function(){return this.get("iItemId")},Backbone.Model.prototype.getItemType=function(){return this.get("sItemType")},Backbone.Model.prototype.getObjectId=function(){return this.get("iObjectId")||0},Backbone.Model.prototype.getObjectType=function(){return this.get("sObjectType")||""},Backbone.Model.prototype.getObjectTitle=function(){return this.get("sObjectTitle")||""},Backbone.Model.prototype.getObjectUrl=function(){return"#"+this.getObjectType()+"/"+this.getObjectId()},Backbone.Model.prototype.getObjectLink=function(){return'<a href="'+this.getObjectUrl()+'">'+this.getObjectTitle()+"</a>"},Backbone.Model.prototype.isNeedScroll=function(){return this.get("bNeedToScroll")||!1},Backbone.Model.prototype.getParentType=function(){return this.get("sParentType")||""},Backbone.Model.prototype.getUserDislike=function(){return this.get("aUserDislike")||this.get("aDislikes")},Backbone.Model.prototype.getParentModuleId=function(){return this.get("parentModuleId")||""},Backbone.Model.prototype.getSharedUserName=function(){return this.get("sSharedUserName")||""},Backbone.Model.prototype.getSharedUserId=function(){return this.get("iSharedUserId")||0},Backbone.Model.prototype.getSharedUserUrl=function(){return"#user/"+this.getSharedUserId()},Backbone.Model.prototype.getSharedUserLink=function(){return'<a href="'+this.getSharedUserUrl()+'">'+this.getSharedUserName()+"</a>"}}),define("utils/extend/view-polyplatform",[],function(){Backbone.PolyplatformView=Backbone.View.extend({}),Backbone.PolyplatformView.extend=function(){if(arguments[0].moduleId){var e=arguments[0].moduleId.replace("/","/"+constants.template+"/");require.defined(e)&&_.extend(arguments[0],require(e)),console.log("enhanced",arguments[0])}else console.log("No module Id in polyplatform view -> cannot extend its parent");var t=Backbone.View.extend.apply(this,arguments);return t}}),define("utils/extend/view-list",["utils/extend/view-polyplatform"],function(){Backbone.ListView=Backbone.PolyplatformView.extend({defaults:{},api:"",phraseNotFound:"No item found",phraseNotMore:"No item more",template:null,itemView:null,followById:!1,itemModel:null,query:{},settings:{},initialize:function(e,t,n,r){this.$scroller=n,this.$holder=t,this.settings=$.extend({loadnew:!1,loadmore:!0},r);var i=this;this.settings.loadnew&&this.$scroller.on("loadnew:load",function(){i.loadNew()}),this.settings.loadmore&&this.$scroller.on("loadmore:load",function(){i.loadMore()}),this.$ajaxMore=this.$ajaxNew=!1,this.init.apply(this,arguments)},init:function(){},className:"item-list",render:function(e){return this.query=$.extend({},this.defaults,e),this.$el.html(this.template()),this.isFirst=!0,this},inject:function(){return this.$holder.html(this.$el),this.loadMore(),this.isFirst=!0,this},parseData:function(e,t){return e.map(function(e){return new t(e)})},loadNew:function(){var e=this.query;this.followById&&(e.sAction="new"),this.$ajaxMore=utils.api.get(this.api,e,{context:this}).done(function(e){if(e.error_code&&e.error_code>0)return this.loadNewFail(e);this.loadNewSuccess(e)}).fail(this.loadNewFail)},loadMore:function(){var e=this.query;this.followById&&(e.sAction="more"),this.$ajaxMore=utils.api.get(this.api,e,{context:this}).done(function(e){e.error_code&&e.error_code>0?this.loadMoreFail(e):this.loadMoreSuccess(e)}).fail(this.loadMoreFail)},resetQuery:function(e){this.$ajaxMore&&this.$ajaxMore.abort(),this.ajaxNew&&this.$ajaxNew.abort(),this.query=$.extend({},this.defaults,e),this.$el.html(this.template(this.query)),this.isFirst=!0,this.loadMore()},loadMoreFail:function(e,t){if(t=="abort")return;utils.debug.error("loadmore:fail"),this.$scroller.trigger("loadmore:unlock").trigger("loadmore:end"),utils.modal.toast(e.error_message||_t("Can not load data from server"))},loadNewFail:function(e,t){if(t=="abort")return;utils.debug.error("loadnew:fail"),this.$scroller.trigger("loadnew:end"),utils.modal.toast(e.error_message||_t("Can not load data from server"))},handleInjectItem:function(e,t){(new this.itemView({model:e})).render(this.query).inject(t)},loadNewSuccess:function(e){var t=this.parseData(e,this.itemModel),n=t.length,r=this.$el,i=this,s=function(e){r.prepend(e)};_.each(t,function(e){i.handleInjectItem(e,s)});if(n&&this.followById){var o=t[n-1].getId(),u=t[0].getId();this.query.iMinId=Math.max(o,u,this.query.iMinId),this.query.iMaxId=this.query.iMaxId>0?Math.min(o,u,this.query.iMaxId):Math.min(o,u)}else this.query.iMinPage=(this.query.iMinPage||0)-1;this.$scroller.trigger("refresh").trigger("query:changed",this.query),this.$scroller.trigger("loadnew:end")},loadMoreSuccess:function(e){var t=this.parseData(e,this.itemModel),n=t.length,r=this.$el,i=this;this.isFirst&&(n?r.html(""):r.html(utils.helper.notfound(_t(this.phraseNotFound)))),this.isFirst=!1;var s=function(e){r.append(e).trigger("injected")};_.each(t,function(e){i.handleInjectItem(e,s)});if(n&&this.followById){var o=t[n-1].getId(),u=t[0].getId();this.query.iMinId=Math.max(o,u,this.query.iMinId),this.query.iMaxId=this.query.iMaxId>0?Math.min(o,u,this.query.iMaxId):Math.min(o,u)}else this.query.iPage=(this.query.iPage||0)+1;n?(this.settings.loadmore&&this.$scroller.trigger("loadmore:unlock"),this.settings.loadnew&&this.followById&&this.$scroller.trigger("loadnew:unlock")):this.isFirst||(this.settings.loadmore&&this.$scroller.trigger("loadmore:lock"),utils.modal.toast(_t(this.phraseNotMore))),this.$scroller.trigger("refresh").trigger("query:changed",this.query),this.$scroller.trigger("loadmore:end")}})}),define("utils/extend/view-list-collection",["utils/extend/view-list"],function(){Backbone.ListViewCollection=Backbone.ListView.extend({Collection:null,collection:null,init:function(){this.settings.collection?this.collection=this.settings.collection:this.collection=new this.Collection,this.collection.off(),this.collection.on("add",this.attachNewItem,this),this.collection.on("all",this.onCollectionChange,this),this.collection.on("reset",this.handleCollectionReset,this)},onCollectionChange:function(){this.updateQuery()},handleCollectionReset:function(){this.rerenderView()},updateQuery:function(){this.collection.length&&this.followById?this.query.iMaxId=this.collection.last().getId():this.query.iPage=(this.query.iPage||0)+1},handleInjectItem:function(e,t){(new this.itemView({model:e})).render().inject(t)},attachNewItem:function(e){this.collection.length==1&&this.$el.html("");var t,n,r;return t=(new this.itemView({model:e})).render().el,e.isNew()?this.$el.append(t):(r=this.collection.indexOf(e),n=this.collection.at(r-1),n?($prev=$("#"+n.getDataId()),$prev.after(t)):this.$el.prepend(t)),e.isNeedScroll()&&this.$el.parents(".content").scrollTop(9999999),this.$scroller.trigger("refresh"),this},parseData:function(e){return e},loadMoreSuccess:function(e){var e=this.parseData(e);this.isFirst?(this.collection.reset(e),this.trigger("view:load-complete")):this.collection.add(e),this.$scroller.trigger("loadnew:unlock"),this.$scroller.trigger("loadmore:end")},rerenderView:function(){return this.collection.length==0?this.$el.html(utils.helper.notfound(_t(this.phraseNotFound))):this.$el.html(""),_.each(this.collection.models,function(e){this.attachNewItem(e)},this),this.trigger("view:rerender"),this}})}),define("utils/extend/view",[],function(){Backbone.View.prototype.region={},Backbone.View.prototype.context={},Backbone.View.prototype.inject=function(){},Backbone.View.prototype.setRegion=function(e){return this.region=$.extend({},this.region,e),this},Backbone.View.prototype.topMenuIsShown=function(e){if(!arguments.length)return this._topMenuIsShown||!1;this._topMenuIsShown=e}});var Swiper=function(e,t){function r(e,t){return document.querySelectorAll?(t||document).querySelectorAll(e):jQuery(e,t)}function b(e){return Object.prototype.toString.apply(e)==="[object Array]"?!0:!1}function x(){var e=u-l;return t.freeMode&&(e=u-l),t.slidesPerView>i.slides.length&&(e=0),e<0&&(e=0),e}function T(){var e=0;return e}function N(){function u(e){var n=new Image;n.onload=function(){i.imagesLoaded++,i.imagesLoaded==i.imagesToLoad.length&&(i.reInit(),t.onImagesReady&&i.fireCallback(t.onImagesReady,i))},n.src=e}var e=i.h.addEventListener,n=t.eventTarget=="wrapper"?i.wrapper:i.container;!i.browser.ie10&&!i.browser.ie11?(i.support.touch&&(e(n,"touchstart",q),e(n,"touchmove",z),e(n,"touchend",W)),t.simulateTouch&&(e(n,"mousedown",q),e(document,"mousemove",z),e(document,"mouseup",W))):(e(n,i.touchEvents.touchStart,q),e(document,i.touchEvents.touchMove,z),e(document,i.touchEvents.touchEnd,W)),t.autoResize&&e(window,"resize",i.resizeFix),C(),i._wheelEvent=!1;if(t.mousewheelControl){document.onmousewheel!==undefined&&(i._wheelEvent="mousewheel");try{WheelEvent("wheel"),i._wheelEvent="wheel"}catch(s){}i._wheelEvent||(i._wheelEvent="DOMMouseScroll"),i._wheelEvent&&e(i.container,i._wheelEvent,O)}t.keyboardControl&&e(document,"keydown",L);if(t.updateOnImagesReady){i.imagesToLoad=r("img",i.container);for(var o=0;o<i.imagesToLoad.length;o++)u(i.imagesToLoad[o].getAttribute("src"))}}function C(){var e=i.h.addEventListener,n;if(t.preventLinks){var s=r("a",i.container);for(n=0;n<s.length;n++)e(s[n],"click",H)}if(t.releaseFormElements){var o=r("input, textarea, select",i.container);for(n=0;n<o.length;n++)e(o[n],i.touchEvents.touchStart,B,!0)}if(t.onSlideClick)for(n=0;n<i.slides.length;n++)e(i.slides[n],"click",_);if(t.onSlideTouch)for(n=0;n<i.slides.length;n++)e(i.slides[n],i.touchEvents.touchStart,D)}function k(){var e=i.h.removeEventListener,n;if(t.onSlideClick)for(n=0;n<i.slides.length;n++)e(i.slides[n],"click",_);if(t.onSlideTouch)for(n=0;n<i.slides.length;n++)e(i.slides[n],i.touchEvents.touchStart,D);if(t.releaseFormElements){var s=r("input, textarea, select",i.container);for(n=0;n<s.length;n++)e(s[n],i.touchEvents.touchStart,B,!0)}if(t.preventLinks){var o=r("a",i.container);for(n=0;n<o.length;n++)e(o[n],"click",H)}}function L(e){var t=e.keyCode||e.charCode;if(t==37||t==39||t==38||t==40){var n=!1,r=i.h.getOffset(i.container),s=i.h.windowScroll().left,o=i.h.windowScroll().top,u=i.h.windowWidth(),a=i.h.windowHeight(),f=[[r.left,r.top],[r.left+i.width,r.top],[r.left,r.top+i.height],[r.left+i.width,r.top+i.height]];for(var l=0;l<f.length;l++){var c=f[l];c[0]>=s&&c[0]<=s+u&&c[1]>=o&&c[1]<=o+a&&(n=!0)}if(!n)return}if(d){if(t==37||t==39)e.preventDefault?e.preventDefault():e.returnValue=!1;t==39&&i.swipeNext(),t==37&&i.swipePrev()}else{if(t==38||t==40)e.preventDefault?e.preventDefault():e.returnValue=!1;t==40&&i.swipeNext(),t==38&&i.swipePrev()}}function O(e){var n=i._wheelEvent,r=0;if(e.detail)r=-e.detail;else if(n=="mousewheel")if(t.mousewheelControlForceToAxis)if(d){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;r=e.wheelDeltaX}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;r=e.wheelDeltaY}else r=e.wheelDelta;else if(n=="DOMMouseScroll")r=-e.detail;else if(n=="wheel")if(t.mousewheelControlForceToAxis)if(d){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;r=-e.deltaX}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;r=-e.deltaY}else r=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(!t.freeMode)(new Date).getTime()-A>60&&(r<0?i.swipeNext():i.swipePrev()),A=(new Date).getTime();else{var s=i.getWrapperTranslate()+r;s>0&&(s=0),s<-x()&&(s=-x()),i.setWrapperTransition(0),i.setWrapperTranslate(s),i.updateActiveSlide(s);if(s==0||s==-x())return}return t.autoplay&&i.stopAutoplay(!0),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function _(e){i.allowSlideClick&&(P(e),i.fireCallback(t.onSlideClick,i,e))}function D(e){P(e),i.fireCallback(t.onSlideTouch,i,e)}function P(e){if(!e.currentTarget){var n=e.srcElement;do if(n.className.indexOf(t.slideClass)>-1)break;while(n=n.parentNode);i.clickedSlide=n}else i.clickedSlide=e.currentTarget;i.clickedSlideIndex=i.slides.indexOf(i.clickedSlide),i.clickedSlideLoopIndex=i.clickedSlideIndex-(i.loopedSlides||0)}function H(e){if(!i.allowLinks)return e.preventDefault?e.preventDefault():e.returnValue=!1,t.preventLinksPropagation&&"stopPropagation"in e&&e.stopPropagation(),!1}function B(e){return e.stopPropagation?e.stopPropagation():e.returnValue=!1,!1}function q(e){t.preventLinks&&(i.allowLinks=!0);if(i.isTouched||t.onlyExternal)return!1;if(t.noSwiping&&(e.target||e.srcElement)&&X(e.target||e.srcElement))return!1;I=!1,thresholdFirstMove=!1,i.isTouched=!0,j=e.type=="touchstart";if(!j||e.targetTouches.length==1){i.callPlugins("onTouchStartBegin"),!j&&!i.isAndroid&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var n=j?e.targetTouches[0].pageX:e.pageX||e.clientX,r=j?e.targetTouches[0].pageY:e.pageY||e.clientY;i.touches.startX=i.touches.currentX=n,i.touches.startY=i.touches.currentY=r,i.touches.start=i.touches.current=d?n:r,i.setWrapperTransition(0),i.positions.start=i.positions.current=i.getWrapperTranslate(),i.setWrapperTranslate(i.positions.start),i.times.start=(new Date).getTime(),f=undefined,t.moveStartThreshold>0&&(F=!1),t.onTouchStart&&i.fireCallback(t.onTouchStart,i),i.callPlugins("onTouchStartEnd")}}function z(e){if(!i.isTouched||t.onlyExternal)return;if(j&&e.type=="mousemove")return;var n=j?e.targetTouches[0].pageX:e.pageX||e.clientX,r=j?e.targetTouches[0].pageY:e.pageY||e.clientY;typeof f=="undefined"&&d&&(f=!!(f||Math.abs(r-i.touches.startY)>Math.abs(n-i.touches.startX))),typeof f=="undefined"&&!d&&(f=!!(f||Math.abs(r-i.touches.startY)<Math.abs(n-i.touches.startX)));if(f){i.isTouched=!1;return}if(e.assignedToSwiper){i.isTouched=!1;return}e.assignedToSwiper=!0,t.preventLinks&&(i.allowLinks=!1),t.onSlideClick&&(i.allowSlideClick=!1),t.autoplay&&i.stopAutoplay(!0);if(!j||e.touches.length==1){i.isMoved||(i.callPlugins("onTouchMoveStart"),t.loop&&(i.fixLoop(),i.positions.start=i.getWrapperTranslate()),t.onTouchMoveStart&&i.fireCallback(t.onTouchMoveStart,i)),i.isMoved=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,i.touches.current=d?n:r,i.positions.current=(i.touches.current-i.touches.start)*t.touchRatio+i.positions.start,i.positions.current>0&&t.onResistanceBefore&&i.fireCallback(t.onResistanceBefore,i,i.positions.current),i.positions.current<-x()&&t.onResistanceAfter&&i.fireCallback(t.onResistanceAfter,i,Math.abs(i.positions.current+x()));if(t.resistance&&t.resistance!="100%"){if(i.positions.current>0){var s=1-i.positions.current/l/2;s<.5?i.positions.current=l/2:i.positions.current=i.positions.current*s}if(i.positions.current<-x()){var o=(i.touches.current-i.touches.start)*t.touchRatio+(x()+i.positions.start),s=(l+o)/l,u=i.positions.current-o*(1-s)/2,a=-x()-l/2;u<a||s<=0?i.positions.current=a:i.positions.current=u}}t.resistance&&t.resistance=="100%"&&(i.positions.current>0&&(!t.freeMode||!!t.freeModeFluid)&&(i.positions.current=0),i.positions.current<-x()&&(!t.freeMode||!!t.freeModeFluid)&&(i.positions.current=-x()));if(!t.followFinger)return;if(!t.moveStartThreshold)i.setWrapperTranslate(i.positions.current);else if(Math.abs(i.touches.current-i.touches.start)>t.moveStartThreshold||F){if(!F){F=!0,i.touches.start=i.touches.current;return}i.setWrapperTranslate(i.positions.current)}else i.positions.current=i.positions.start;return(t.freeMode||t.watchActiveIndex)&&i.updateActiveSlide(i.positions.current),t.grabCursor&&(i.container.style.cursor="move",i.container.style.cursor="grabbing",i.container.style.cursor="-moz-grabbin",i.container.style.cursor="-webkit-grabbing"),R||(R=i.touches.current),U||(U=(new Date).getTime()),i.velocity=(i.touches.current-R)/((new Date).getTime()-U)/2,Math.abs(i.touches.current-R)<2&&(i.velocity=0),R=i.touches.current,U=(new Date).getTime(),i.callPlugins("onTouchMoveEnd"),t.onTouchMove&&i.fireCallback(t.onTouchMove,i),!1}}function W(e){f&&i.swipeReset();if(t.onlyExternal||!i.isTouched)return;i.isTouched=!1,t.grabCursor&&(i.container.style.cursor="move",i.container.style.cursor="grab",i.container.style.cursor="-moz-grab",i.container.style.cursor="-webkit-grab"),!i.positions.current&&i.positions.current!==0&&(i.positions.current=i.positions.start),t.followFinger&&i.setWrapperTranslate(i.positions.current),i.times.end=(new Date).getTime(),i.touches.diff=i.touches.current-i.touches.start,i.touches.abs=Math.abs(i.touches.diff),i.positions.diff=i.positions.current-i.positions.start,i.positions.abs=Math.abs(i.positions.diff);var n=i.positions.diff,r=i.positions.abs,s=i.times.end-i.times.start;r<5&&s<300&&i.allowLinks==0&&(!t.freeMode&&r!=0&&i.swipeReset(),t.preventLinks&&(i.allowLinks=!0),t.onSlideClick&&(i.allowSlideClick=!0)),setTimeout(function(){t.preventLinks&&(i.allowLinks=!0),t.onSlideClick&&(i.allowSlideClick=!0)},100);var u=x();if(!i.isMoved&&t.freeMode){i.isMoved=!1,t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i),i.callPlugins("onTouchEnd");return}if(!i.isMoved||i.positions.current>0||i.positions.current<-u){i.swipeReset(),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i),i.callPlugins("onTouchEnd");return}i.isMoved=!1;if(t.freeMode){if(t.freeModeFluid){var c=1e3*t.momentumRatio,h=i.velocity*c,p=i.positions.current+h,v=!1,m,g=Math.abs(i.velocity)*20*t.momentumBounceRatio;p<-u&&(t.momentumBounce&&i.support.transitions?(p+u<-g&&(p=-u-g),m=-u,v=!0,I=!0):p=-u),p>0&&(t.momentumBounce&&i.support.transitions?(p>g&&(p=g),m=0,v=!0,I=!0):p=0),i.velocity!=0&&(c=Math.abs((p-i.positions.current)/i.velocity)),i.setWrapperTranslate(p),i.setWrapperTransition(c),t.momentumBounce&&v&&i.wrapperTransitionEnd(function(){if(!I)return;t.onMomentumBounce&&i.fireCallback(t.onMomentumBounce,i),i.callPlugins("onMomentumBounce"),i.setWrapperTranslate(m),i.setWrapperTransition(300)}),i.updateActiveSlide(p)}(!t.freeModeFluid||s>=300)&&i.updateActiveSlide(i.positions.current),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i),i.callPlugins("onTouchEnd");return}a=n<0?"toNext":"toPrev",a=="toNext"&&s<=300&&(r<30||!t.shortSwipes?i.swipeReset():i.swipeNext(!0)),a=="toPrev"&&s<=300&&(r<30||!t.shortSwipes?i.swipeReset():i.swipePrev(!0));var y=0;if(t.slidesPerView=="auto"){var b=Math.abs(i.getWrapperTranslate()),w=0,E;for(var S=0;S<i.slides.length;S++){E=d?i.slides[S].getWidth(!0):i.slides[S].getHeight(!0),w+=E;if(w>b){y=E;break}}y>l&&(y=l)}else y=o*t.slidesPerView;a=="toNext"&&s>300&&(r>=y*t.longSwipesRatio?i.swipeNext(!0):i.swipeReset()),a=="toPrev"&&s>300&&(r>=y*t.longSwipesRatio?i.swipePrev(!0):i.swipeReset()),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i),i.callPlugins("onTouchEnd")}function X(e){var n=!1;do e.className.indexOf(t.noSwipingClass)>-1&&(n=!0),e=e.parentElement;while(!n&&e.parentElement&&e.className.indexOf(t.wrapperClass)==-1);return!n&&e.className.indexOf(t.wrapperClass)>-1&&e.className.indexOf(t.noSwipingClass)>-1&&(n=!0),n}function V(e,t){var n=document.createElement("div"),r;return n.innerHTML=t,r=n.firstChild,r.className+=" "+e,r.outerHTML}function $(e,n,r){function c(){var n=+(new Date),r=n-o;u+=a*r/(1e3/60),l=f=="toNext"?u>e:u<e,l?(i.setWrapperTranslate(Math.round(u)),i._DOMAnimating=!0,window.setTimeout(function(){c()},1e3/60)):(t.onSlideChangeEnd&&i.fireCallback(t.onSlideChangeEnd,i),i.setWrapperTranslate(e),i._DOMAnimating=!1)}var s=n=="to"&&r.speed>=0?r.speed:t.speed,o=+(new Date);if(i.support.transitions||!t.DOMAnimation)i.setWrapperTranslate(e),i.setWrapperTransition(s);else{var u=i.getWrapperTranslate(),a=Math.ceil((e-u)/s*(1e3/60)),f=u>e?"toNext":"toPrev",l=f=="toNext"?u>e:u<e;if(i._DOMAnimating)return;c()}i.updateActiveSlide(e),t.onSlideNext&&n=="next"&&i.fireCallback(t.onSlideNext,i,e),t.onSlidePrev&&n=="prev"&&i.fireCallback(t.onSlidePrev,i,e),t.onSlideReset&&n=="reset"&&i.fireCallback(t.onSlideReset,i,e),(n=="next"||n=="prev"||n=="to"&&r.runCallbacks==1)&&J(n)}function J(e){i.callPlugins("onSlideChangeStart");if(t.onSlideChangeStart)if(t.queueStartCallbacks&&i.support.transitions){if(i._queueStartCallbacks)return;i._queueStartCallbacks=!0,i.fireCallback(t.onSlideChangeStart,i,e),i.wrapperTransitionEnd(function(){i._queueStartCallbacks=!1})}else i.fireCallback(t.onSlideChangeStart,i,e);if(t.onSlideChangeEnd)if(i.support.transitions)if(t.queueEndCallbacks){if(i._queueEndCallbacks)return;i._queueEndCallbacks=!0,i.wrapperTransitionEnd(function(n){i.fireCallback(t.onSlideChangeEnd,n,e)})}else i.wrapperTransitionEnd(function(n){i.fireCallback(t.onSlideChangeEnd,n,e)});else t.DOMAnimation||setTimeout(function(){i.fireCallback(t.onSlideChangeEnd,i,e)},10)}function K(){var e=i.paginationButtons;for(var t=0;t<e.length;t++)i.h.removeEventListener(e[t],"click",G)}function Q(){var e=i.paginationButtons;for(var t=0;t<e.length;t++)i.h.addEventListener(e[t],"click",G)}function G(e){var t,n=e.target||e.srcElement,r=i.paginationButtons;for(var s=0;s<r.length;s++)n===r[s]&&(t=s);i.swipeTo(t)}function et(){Y=setTimeout(function(){t.loop?(i.fixLoop(),i.swipeNext(!0)):i.swipeNext(!0)||(t.autoplayStopOnLast?(clearTimeout(Y),Y=undefined):i.swipeTo(0)),i.wrapperTransitionEnd(function(){typeof Y!="undefined"&&et()})},t.autoplay)}function tt(){i.calcSlides(),t.loader.slides.length>0&&i.slides.length==0&&i.loadSlides(),t.loop&&i.createLoop(),i.init(),N(),t.pagination&&i.createPagination(!0),t.loop||t.initialSlide>0?i.swipeTo(t.initialSlide,0,!1):i.updateActiveSlide(0),t.autoplay&&i.startAutoplay(),i.centerIndex=i.activeIndex,t.onSwiperCreated&&i.fireCallback(t.onSwiperCreated,i),i.callPlugins("onSwiperCreated")}if(document.body.__defineGetter__&&HTMLElement){var n=HTMLElement.prototype;n.__defineGetter__&&n.__defineGetter__("outerHTML",function(){return(new XMLSerializer).serializeToString(this)})}window.getComputedStyle||(window.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t==="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1});if(!document.querySelectorAll&&!window.jQuery)return;if(typeof e=="undefined")return;if(!e.nodeType&&r(e).length===0)return;var i=this;i.touches={start:0,startX:0,startY:0,current:0,currentX:0,currentY:0,diff:0,abs:0},i.positions={start:0,abs:0,diff:0,current:0},i.times={start:0,end:0},i.id=(new Date).getTime(),i.container=e.nodeType?e:r(e)[0],i.isTouched=!1,i.isMoved=!1,i.activeIndex=0,i.centerIndex=0,i.activeLoaderIndex=0,i.activeLoopIndex=0,i.previousIndex=null,i.velocity=0,i.snapGrid=[],i.slidesGrid=[],i.imagesToLoad=[],i.imagesLoaded=0,i.wrapperLeft=0,i.wrapperRight=0,i.wrapperTop=0,i.wrapperBottom=0,i.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>=0;var s,o,u,a,f,l,c={eventTarget:"wrapper",mode:"horizontal",touchRatio:1,speed:300,freeMode:!1,freeModeFluid:!1,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,slidesPerView:1,slidesPerGroup:1,simulateTouch:!0,followFinger:!0,shortSwipes:!0,longSwipesRatio:.5,moveStartThreshold:!1,onlyExternal:!1,createPagination:!0,pagination:!1,paginationElement:"span",paginationClickable:!1,paginationAsRange:!0,resistance:!0,scrollContainer:!1,preventLinks:!0,preventLinksPropagation:!1,noSwiping:!1,noSwipingClass:"swiper-no-swiping",initialSlide:0,keyboardControl:!1,mousewheelControl:!1,mousewheelControlForceToAxis:!1,useCSS3Transforms:!0,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,loop:!1,loopAdditionalSlides:0,calculateHeight:!1,cssWidthAndHeight:!1,updateOnImagesReady:!0,releaseFormElements:!0,watchActiveIndex:!1,visibilityFullFit:!1,offsetPxBefore:0,offsetPxAfter:0,offsetSlidesBefore:0,offsetSlidesAfter:0,centeredSlides:!1,queueStartCallbacks:!1,queueEndCallbacks:!1,autoResize:!0,resizeReInit:!1,DOMAnimation:!0,loader:{slides:[],slidesHTMLType:"inner",surroundGroups:1,logic:"reload",loadAllSlides:!1},slideElement:"div",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",wrapperClass:"swiper-wrapper",paginationElementClass:"swiper-pagination-switch",paginationActiveClass:"swiper-active-switch",paginationVisibleClass:"swiper-visible-switch"};t=t||{};for(var h in c)if(h in t&&typeof t[h]=="object")for(var p in c[h])p in t[h]||(t[h][p]=c[h][p]);else h in t||(t[h]=c[h]);i.params=t,t.scrollContainer&&(t.freeMode=!0,t.freeModeFluid=!0),t.loop&&(t.resistance="100%");var d=t.mode==="horizontal",v=["mousedown","mousemove","mouseup"];i.browser.ie10&&(v=["MSPointerDown","MSPointerMove","MSPointerUp"]),i.browser.ie11&&(v=["pointerdown","pointermove","pointerup"]),i.touchEvents={touchStart:i.support.touch||!t.simulateTouch?"touchstart":v[0],touchMove:i.support.touch||!t.simulateTouch?"touchmove":v[1],touchEnd:i.support.touch||!t.simulateTouch?"touchend":v[2]};for(var m=i.container.childNodes.length-1;m>=0;m--)if(i.container.childNodes[m].className){var g=i.container.childNodes[m].className.split(" ");for(var y=0;y<g.length;y++)g[y]===t.wrapperClass&&(s=i.container.childNodes[m])}i.wrapper=s,i._extendSwiperSlide=function(e){return e.append=function(){return t.loop?e.insertAfter(i.slides.length-i.loopedSlides):(i.wrapper.appendChild(e),i.reInit()),e},e.prepend=function(){return t.loop?(i.wrapper.insertBefore(e,i.slides[i.loopedSlides]),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):i.wrapper.insertBefore(e,i.wrapper.firstChild),i.reInit(),e},e.insertAfter=function(n){if(typeof n=="undefined")return!1;var r;return t.loop?(r=i.slides[n+1+i.loopedSlides],r?i.wrapper.insertBefore(e,r):i.wrapper.appendChild(e),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):(r=i.slides[n+1],i.wrapper.insertBefore(e,r)),i.reInit(),e},e.clone=function(){return i._extendSwiperSlide(e.cloneNode(!0))},e.remove=function(){i.wrapper.removeChild(e),i.reInit()},e.html=function(t){return typeof t=="undefined"?e.innerHTML:(e.innerHTML=t,e)},e.index=function(){var t;for(var n=i.slides.length-1;n>=0;n--)e===i.slides[n]&&(t=n);return t},e.isActive=function(){return e.index()===i.activeIndex?!0:!1},e.swiperSlideDataStorage||(e.swiperSlideDataStorage={}),e.getData=function(t){return e.swiperSlideDataStorage[t]},e.setData=function(t,n){return e.swiperSlideDataStorage[t]=n,e},e.data=function(t,n){return n?(e.setAttribute("data-"+t,n),e):e.getAttribute("data-"+t)},e.getWidth=function(t){return i.h.getWidth(e,t)},e.getHeight=function(t){return i.h.getHeight(e,t)},e.getOffset=function(){return i.h.getOffset(e)},e},i.calcSlides=function(e){var n=i.slides?i.slides.length:!1;i.slides=[],i.displaySlides=[];for(var r=0;r<i.wrapper.childNodes.length;r++)if(i.wrapper.childNodes[r].className){var s=i.wrapper.childNodes[r].className,o=s.split(" ");for(var u=0;u<o.length;u++)o[u]===t.slideClass&&i.slides.push(i.wrapper.childNodes[r])}for(r=i.slides.length-1;r>=0;r--)i._extendSwiperSlide(i.slides[r]);if(n===!1)return;if(n!==i.slides.length||e)k(),C(),i.updateActiveSlide(),i.params.pagination&&i.createPagination(),i.callPlugins("numberOfSlidesChanged")},i.createSlide=function(e,n,r){var n=n||i.params.slideClass,r=r||t.slideElement,s=document.createElement(r);return s.innerHTML=e||"",s.className=n,i._extendSwiperSlide(s)},i.appendSlide=function(e,t,n){if(!e)return;return e.nodeType?i._extendSwiperSlide(e).append():i.createSlide(e,t,n).append()},i.prependSlide=function(e,t,n){if(!e)return;return e.nodeType?i._extendSwiperSlide(e).prepend():i.createSlide(e,t,n).prepend()},i.insertSlideAfter=function(e,t,n,r){return typeof e=="undefined"?!1:t.nodeType?i._extendSwiperSlide(t).insertAfter(e):i.createSlide(t,n,r).insertAfter(e)},i.removeSlide=function(e){if(i.slides[e]){if(t.loop){if(!i.slides[e+i.loopedSlides])return!1;i.slides[e+i.loopedSlides].remove(),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()}else i.slides[e].remove();return!0}return!1},i.removeLastSlide=function(){return i.slides.length>0?(t.loop?(i.slides[i.slides.length-1-i.loopedSlides].remove(),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):i.slides[i.slides.length-1].remove(),!0):!1},i.removeAllSlides=function(){for(var e=i.slides.length-1;e>=0;e--)i.slides[e].remove()},i.getSlide=function(e){return i.slides[e]},i.getLastSlide=function(){return i.slides[i.slides.length-1]},i.getFirstSlide=function(){return i.slides[0]},i.activeSlide=function(){return i.slides[i.activeIndex]},i.fireCallback=function(){var e=arguments[0];if(Object.prototype.toString.call(e)==="[object Array]")for(var n=0;n<e.length;n++)typeof e[n]=="function"&&e[n](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);else Object.prototype.toString.call(e)==="[object String]"?t["on"+e]&&i.fireCallback(t["on"+e]):e(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},i.addCallback=function(e,t){var n=this,r;if(!n.params["on"+e])return this.params["on"+e]=[],this.params["on"+e].push(t);if(b(this.params["on"+e]))return this.params["on"+e].push(t);if(typeof this.params["on"+e]=="function")return r=this.params["on"+e],this.params["on"+e]=[],this.params["on"+e].push(r),this.params["on"+e].push(t)},i.removeCallbacks=function(e){if(i.params["on"+e])return i.params["on"+e]=null};var w=[];for(var E in i.plugins)if(t[E]){var S=i.plugins[E](i,t[E]);S&&w.push(S)}i.callPlugins=function(e,t){t||(t={});for(var n=0;n<w.length;n++)e in w[n]&&w[n][e](t)},(i.browser.ie10||i.browser.ie11)&&!t.onlyExternal&&i.wrapper.classList.add("swiper-wp8-"+(d?"horizontal":"vertical")),t.freeMode&&(i.container.className+=" swiper-free-mode"),i.initialized=!1,i.init=function(e,n){var r=i.h.getWidth(i.container),s=i.h.getHeight(i.container);if(r===i.width&&s===i.height&&!e)return;i.width=r,i.height=s,l=d?r:s;var a=i.wrapper;e&&i.calcSlides(n);if(t.slidesPerView==="auto"){var f=0,c=0;t.slidesOffset>0&&(a.style.paddingLeft="",a.style.paddingRight="",a.style.paddingTop="",a.style.paddingBottom=""),a.style.width="",a.style.height="",t.offsetPxBefore>0&&(d?i.wrapperLeft=t.offsetPxBefore:i.wrapperTop=t.offsetPxBefore),t.offsetPxAfter>0&&(d?i.wrapperRight=t.offsetPxAfter:i.wrapperBottom=t.offsetPxAfter),t.centeredSlides&&(d?(i.wrapperLeft=(l-this.slides[0].getWidth(!0))/2,i.wrapperRight=(l-i.slides[i.slides.length-1].getWidth(!0))/2):(i.wrapperTop=(l-i.slides[0].getHeight(!0))/2,i.wrapperBottom=(l-i.slides[i.slides.length-1].getHeight(!0))/2)),d?(i.wrapperLeft>=0&&(a.style.paddingLeft=i.wrapperLeft+"px"),i.wrapperRight>=0&&(a.style.paddingRight=i.wrapperRight+"px")):(i.wrapperTop>=0&&(a.style.paddingTop=i.wrapperTop+"px"),i.wrapperBottom>=0&&(a.style.paddingBottom=i.wrapperBottom+"px"));var h=0,p=0;i.snapGrid=[],i.slidesGrid=[];var v=0;for(var m=0;m<i.slides.length;m++){var g=i.slides[m].getWidth(!0),y=i.slides[m].getHeight(!0);t.calculateHeight&&(v=Math.max(v,y));var b=d?g:y;if(t.centeredSlides){var w=m===i.slides.length-1?0:i.slides[m+1].getWidth(!0),E=m===i.slides.length-1?0:i.slides[m+1].getHeight(!0),S=d?w:E;if(b>l){for(var x=0;x<=Math.floor(b/(l+i.wrapperLeft));x++)x===0?i.snapGrid.push(h+i.wrapperLeft):i.snapGrid.push(h+i.wrapperLeft+l*x);i.slidesGrid.push(h+i.wrapperLeft)}else i.snapGrid.push(p),i.slidesGrid.push(p);p+=b/2+S/2}else{if(b>l)for(var x=0;x<=Math.floor(b/l);x++)i.snapGrid.push(h+l*x);else i.snapGrid.push(h);i.slidesGrid.push(h)}h+=b,f+=g,c+=y}t.calculateHeight&&(i.height=v),d?(u=f+i.wrapperRight+i.wrapperLeft,a.style.width=f+"px",a.style.height=i.height+"px"):(u=c+i.wrapperTop+i.wrapperBottom,a.style.width=i.width+"px",a.style.height=c+"px")}else if(t.scrollContainer){a.style.width="",a.style.height="";var T=i.slides[0].getWidth(!0),N=i.slides[0].getHeight(!0);u=d?T:N,a.style.width=T+"px",a.style.height=N+"px",o=d?T:N}else{if(t.calculateHeight){var v=0,N=0;d||(i.container.style.height=""),a.style.height="";for(var m=0;m<i.slides.length;m++)i.slides[m].style.height="",v=Math.max(i.slides[m].getHeight(!0),v),d||(N+=i.slides[m].getHeight(!0));var y=v;i.height=y,d?N=y:(l=y,i.container.style.height=l+"px")}else var y=d?i.height:i.height/t.slidesPerView,N=d?i.height:i.slides.length*y;var g=d?i.width/t.slidesPerView:i.width,T=d?i.slides.length*g:i.width;o=d?g:y,t.offsetSlidesBefore>0&&(d?i.wrapperLeft=o*t.offsetSlidesBefore:i.wrapperTop=o*t.offsetSlidesBefore),t.offsetSlidesAfter>0&&(d?i.wrapperRight=o*t.offsetSlidesAfter:i.wrapperBottom=o*t.offsetSlidesAfter),t.offsetPxBefore>0&&(d?i.wrapperLeft=t.offsetPxBefore:i.wrapperTop=t.offsetPxBefore),t.offsetPxAfter>0&&(d?i.wrapperRight=t.offsetPxAfter:i.wrapperBottom=t.offsetPxAfter),t.centeredSlides&&(d?(i.wrapperLeft=(l-o)/2,i.wrapperRight=(l-o)/2):(i.wrapperTop=(l-o)/2,i.wrapperBottom=(l-o)/2)),d?(i.wrapperLeft>0&&(a.style.paddingLeft=i.wrapperLeft+"px"),i.wrapperRight>0&&(a.style.paddingRight=i.wrapperRight+"px")):(i.wrapperTop>0&&(a.style.paddingTop=i.wrapperTop+"px"),i.wrapperBottom>0&&(a.style.paddingBottom=i.wrapperBottom+"px")),u=d?T+i.wrapperRight+i.wrapperLeft:N+i.wrapperTop+i.wrapperBottom,t.cssWidthAndHeight||(parseFloat(T)>0&&(a.style.width=T+"px"),parseFloat(N)>0&&(a.style.height=N+"px"));var h=0;i.snapGrid=[],i.slidesGrid=[];for(var m=0;m<i.slides.length;m++)i.snapGrid.push(h),i.slidesGrid.push(h),h+=o,t.cssWidthAndHeight||(parseFloat(g)>0&&(i.slides[m].style.width=g+"px"),parseFloat(y)>0&&(i.slides[m].style.height=y+"px"))}i.initialized?(i.callPlugins("onInit"),t.onInit&&i.fireCallback(t.onInit,i)):(i.callPlugins("onFirstInit"),t.onFirstInit&&i.fireCallback(t.onFirstInit,i)),i.initialized=!0},i.reInit=function(e){i.init(!0,e)},i.resizeFix=function(e){i.callPlugins("beforeResizeFix"),i.init(t.resizeReInit||e),t.freeMode?i.getWrapperTranslate()<-x()&&(i.setWrapperTransition(0),i.setWrapperTranslate(-x())):(i.swipeTo(t.loop?i.activeLoopIndex:i.activeIndex,0,!1),t.autoplay&&(i.support.transitions&&typeof Y!="undefined"?typeof Y!="undefined"&&(clearTimeout(Y),Y=undefined,i.startAutoplay()):typeof Z!="undefined"&&(clearInterval(Z),Z=undefined,i.startAutoplay()))),i.callPlugins("afterResizeFix")},i.destroy=function(){var e=i.h.removeEventListener,n=t.eventTarget=="wrapper"?i.wrapper:i.container;!i.browser.ie10&&!i.browser.ie11?(i.support.touch&&(e(n,"touchstart",q),e(n,"touchmove",z),e(n,"touchend",W)),t.simulateTouch&&(e(n,"mousedown",q),e(document,"mousemove",z),e(document,"mouseup",W))):(e(n,i.touchEvents.touchStart,q),e(document,i.touchEvents.touchMove,z),e(document,i.touchEvents.touchEnd,W)),t.autoResize&&e(window,"resize",i.resizeFix),k(),t.paginationClickable&&K(),t.mousewheelControl&&i._wheelEvent&&e(i.container,i._wheelEvent,O),t.keyboardControl&&e(document,"keydown",L),t.autoplay&&i.stopAutoplay(),i.callPlugins("onDestroy"),i=null};var A=(new Date).getTime();if(t.grabCursor){var M=i.container.style;M.cursor="move",M.cursor="grab",M.cursor="-moz-grab",M.cursor="-webkit-grab"}i.allowSlideClick=!0,i.allowLinks=!0;var j=!1,F,I=!0,R,U;i.swipeNext=function(e){!e&&t.loop&&i.fixLoop(),!e&&t.autoplay&&i.stopAutoplay(!0),i.callPlugins("onSwipeNext");var n=i.getWrapperTranslate(),r=n;if(t.slidesPerView=="auto"){for(var s=0;s<i.snapGrid.length;s++)if(-n>=i.snapGrid[s]&&-n<i.snapGrid[s+1]){r=-i.snapGrid[s+1];break}}else{var u=o*t.slidesPerGroup;r=-(Math.floor(Math.abs(n)/Math.floor(u))*u+u)}return r<-x()&&(r=-x()),r==n?!1:($(r,"next"),!0)},i.swipePrev=function(e){!e&&t.loop&&i.fixLoop(),!e&&t.autoplay&&i.stopAutoplay(!0),i.callPlugins("onSwipePrev");var n=Math.ceil(i.getWrapperTranslate()),r;if(t.slidesPerView=="auto"){r=0;for(var s=1;s<i.snapGrid.length;s++){if(-n==i.snapGrid[s]){r=-i.snapGrid[s-1];break}if(-n>i.snapGrid[s]&&-n<i.snapGrid[s+1]){r=-i.snapGrid[s];break}}}else{var u=o*t.slidesPerGroup;r=-(Math.ceil(-n/u)-1)*u}return r>0&&(r=0),r==n?!1:($(r,"prev"),!0)},i.swipeReset=function(){i.callPlugins("onSwipeReset");var e=i.getWrapperTranslate(),n=o*t.slidesPerGroup,r,s=-x();if(t.slidesPerView=="auto"){r=0;for(var u=0;u<i.snapGrid.length;u++){if(-e===i.snapGrid[u])return;if(-e>=i.snapGrid[u]&&-e<i.snapGrid[u+1]){i.positions.diff>0?r=-i.snapGrid[u+1]:r=-i.snapGrid[u];break}}-e>=i.snapGrid[i.snapGrid.length-1]&&(r=-i.snapGrid[i.snapGrid.length-1]),e<=-x()&&(r=-x())}else r=e<0?Math.round(e/n)*n:0;return t.scrollContainer&&(r=e<0?e:0),r<-x()&&(r=-x()),t.scrollContainer&&l>o&&(r=0),r==e?!1:($(r,"reset"),!0)},i.swipeTo=function(e,n,r){e=parseInt(e,10),i.callPlugins("onSwipeTo",{index:e,speed:n}),t.loop&&(e+=i.loopedSlides);var s=i.getWrapperTranslate();if(e>i.slides.length-1||e<0)return;var u;return t.slidesPerView=="auto"?u=-i.slidesGrid[e]:u=-e*o,u<-x()&&(u=-x()),u==s?!1:(r=r===!1?!1:!0,$(u,"to",{index:e,speed:n,runCallbacks:r}),!0)},i._queueStartCallbacks=!1,i._queueEndCallbacks=!1,i.updateActiveSlide=function(e){if(!i.initialized)return;if(i.slides.length==0)return;i.previousIndex=i.activeIndex,typeof e=="undefined"&&(e=i.getWrapperTranslate()),e>0&&(e=0);if(t.slidesPerView=="auto"){var n=0;i.activeIndex=i.slidesGrid.indexOf(-e);if(i.activeIndex<0){for(var r=0;r<i.slidesGrid.length-1;r++)if(-e>i.slidesGrid[r]&&-e<i.slidesGrid[r+1])break;var s=Math.abs(i.slidesGrid[r]+e),u=Math.abs(i.slidesGrid[r+1]+e);s<=u?i.activeIndex=r:i.activeIndex=r+1}}else i.activeIndex=Math[t.visibilityFullFit?"ceil":"round"](-e/o);i.activeIndex==i.slides.length&&(i.activeIndex=i.slides.length-1),i.activeIndex<0&&(i.activeIndex=0);if(!i.slides[i.activeIndex])return;i.calcVisibleSlides(e);var a=new RegExp("\\s*"+t.slideActiveClass),f=new RegExp("\\s*"+t.slideVisibleClass);for(var r=0;r<i.slides.length;r++)i.slides[r].className=i.slides[r].className.replace(a,"").replace(f,""),i.visibleSlides.indexOf(i.slides[r])>=0&&(i.slides[r].className+=" "+t.slideVisibleClass);i.slides[i.activeIndex].className+=" "+t.slideActiveClass;if(t.loop){var l=i.loopedSlides;i.activeLoopIndex=i.activeIndex-l,i.activeLoopIndex>=i.slides.length-l*2&&(i.activeLoopIndex=i.slides.length-l*2-i.activeLoopIndex),i.activeLoopIndex<0&&(i.activeLoopIndex=i.slides.length-l*2+i.activeLoopIndex),i.activeLoopIndex<0&&(i.activeLoopIndex=0)}else i.activeLoopIndex=i.activeIndex;t.pagination&&i.updatePagination(e)},i.createPagination=function(e){t.paginationClickable&&i.paginationButtons&&K(),i.paginationContainer=t.pagination.nodeType?t.pagination:r(t.pagination)[0];if(t.createPagination){var n="",s=i.slides.length,o=s;t.loop&&(o-=i.loopedSlides*2);for(var u=0;u<o;u++)n+="<"+t.paginationElement+' class="'+t.paginationElementClass+'"></'+t.paginationElement+">";i.paginationContainer.innerHTML=n}i.paginationButtons=r("."+t.paginationElementClass,i.paginationContainer),e||i.updatePagination(),i.callPlugins("onCreatePagination"),t.paginationClickable&&Q()},i.updatePagination=function(e){if(!t.pagination)return;if(i.slides.length<1)return;var n=r("."+t.paginationActiveClass,i.paginationContainer);if(!n)return;var s=i.paginationButtons;if(s.length==0)return;for(var o=0;o<s.length;o++)s[o].className=t.paginationElementClass;var u=t.loop?i.loopedSlides:0;if(t.paginationAsRange){i.visibleSlides||i.calcVisibleSlides(e);var a=[];for(var o=0;o<i.visibleSlides.length;o++){var f=i.slides.indexOf(i.visibleSlides[o])-u;t.loop&&f<0&&(f=i.slides.length-i.loopedSlides*2+f),t.loop&&f>=i.slides.length-i.loopedSlides*2&&(f=i.slides.length-i.loopedSlides*2-f,f=Math.abs(f)),a.push(f)}for(o=0;o<a.length;o++)s[a[o]]&&(s[a[o]].className+=" "+t.paginationVisibleClass);t.loop?s[i.activeLoopIndex].className+=" "+t.paginationActiveClass:s[i.activeIndex].className+=" "+t.paginationActiveClass}else t.loop?s[i.activeLoopIndex]&&(s[i.activeLoopIndex].className+=" "+t.paginationActiveClass+" "+t.paginationVisibleClass):s[i.activeIndex].className+=" "+t.paginationActiveClass+" "+t.paginationVisibleClass},i.calcVisibleSlides=function(e){var n=[],r=0,s=0,u=0;d&&i.wrapperLeft>0&&(e+=i.wrapperLeft),!d&&i.wrapperTop>0&&(e+=i.wrapperTop);for(var a=0;a<i.slides.length;a++){r+=s,t.slidesPerView=="auto"?s=d?i.h.getWidth(i.slides[a],!0):i.h.getHeight(i.slides[a],!0):s=o,u=r+s;var f=!1;t.visibilityFullFit?(r>=-e&&u<=-e+l&&(f=!0),r<=-e&&u>=-e+l&&(f=!0)):(u>-e&&u<=-e+l&&(f=!0),r>=-e&&r<-e+l&&(f=!0),r<-e&&u>-e+l&&(f=!0)),f&&n.push(i.slides[a])}n.length==0&&(n=[i.slides[i.activeIndex]]),i.visibleSlides=n};var Y=undefined,Z=undefined;i.startAutoplay=function(){if(i.support.transitions){if(typeof Y!="undefined")return!1;if(!t.autoplay)return;i.callPlugins("onAutoplayStart"),et()}else{if(typeof Z!="undefined")return!1;if(!t.autoplay)return;i.callPlugins("onAutoplayStart"),Z=setInterval(function(){t.loop?(i.fixLoop(),i.swipeNext(!0)):i.swipeNext(!0)||(t.autoplayStopOnLast?(clearInterval(Z),Z=undefined):i.swipeTo(0))},t.autoplay)}},i.stopAutoplay=function(e){if(i.support.transitions){if(!Y)return;Y&&clearTimeout(Y),Y=undefined,e&&!t.autoplayDisableOnInteraction&&i.wrapperTransitionEnd(function(){et()}),i.callPlugins("onAutoplayStop")}else Z&&clearInterval(Z),Z=undefined,i.callPlugins("onAutoplayStop")},i.loopCreated=!1,i.removeLoopedSlides=function(){if(i.loopCreated)for(var e=0;e<i.slides.length;e++)i.slides[e].getData("looped")===!0&&i.wrapper.removeChild(i.slides[e])},i.createLoop=function(){if(i.slides.length==0)return;t.slidesPerView=="auto"?i.loopedSlides=t.loopedSlides||1:i.loopedSlides=t.slidesPerView+t.loopAdditionalSlides,i.loopedSlides>i.slides.length&&(i.loopedSlides=i.slides.length);var e="",n="",r,o="",u=i.slides.length,a=Math.floor(i.loopedSlides/u),f=i.loopedSlides%u;for(r=0;r<a*u;r++){var l=r;if(r>=u){var c=Math.floor(r/u);l=r-u*c}o+=i.slides[l].outerHTML}for(r=0;r<f;r++)n+=V(t.slideDuplicateClass,i.slides[r].outerHTML);for(r=u-f;r<u;r++)e+=V(t.slideDuplicateClass,i.slides[r].outerHTML);var h=e+o+s.innerHTML+o+n;s.innerHTML=h,i.loopCreated=!0,i.calcSlides();for(r=0;r<i.slides.length;r++)(r<i.loopedSlides||r>=i.slides.length-i.loopedSlides)&&i.slides[r].setData("looped",!0);i.callPlugins("onCreateLoop")},i.fixLoop=function(){var e;if(i.activeIndex<i.loopedSlides)e=i.slides.length-i.loopedSlides*3+i.activeIndex,i.swipeTo(e,0,!1);else if(t.slidesPerView=="auto"&&i.activeIndex>=i.loopedSlides*2||i.activeIndex>i.slides.length-t.slidesPerView*2)e=-i.slides.length+i.activeIndex+i.loopedSlides,i.swipeTo(e,0,!1)},i.loadSlides=function(){var e="";i.activeLoaderIndex=0;var n=t.loader.slides,r=t.loader.loadAllSlides?n.length:t.slidesPerView*(1+t.loader.surroundGroups);for(var s=0;s<r;s++)t.loader.slidesHTMLType=="outer"?e+=n[s]:e+="<"+t.slideElement+' class="'+t.slideClass+'" data-swiperindex="'+s+'">'+n[s]+"</"+t.slideElement+">";i.wrapper.innerHTML=e,i.calcSlides(!0),t.loader.loadAllSlides||i.wrapperTransitionEnd(i.reloadSlides,!0)},i.reloadSlides=function(){var e=t.loader.slides,n=parseInt(i.activeSlide().data("swiperindex"),10);if(n<0||n>e.length-1)return;i.activeLoaderIndex=n;var r=Math.max(0,n-t.slidesPerView*t.loader.surroundGroups),s=Math.min(n+t.slidesPerView*(1+t.loader.surroundGroups)-1,e.length-1);if(n>0){var u=-o*(n-r);i.setWrapperTranslate(u),i.setWrapperTransition(0)}if(t.loader.logic==="reload"){i.wrapper.innerHTML="";var a="";for(var f=r;f<=s;f++)a+=t.loader.slidesHTMLType=="outer"?e[f]:"<"+t.slideElement+' class="'+t.slideClass+'" data-swiperindex="'+f+'">'+e[f]+"</"+t.slideElement+">";i.wrapper.innerHTML=a}else{var l=1e3,c=0;for(var f=0;f<i.slides.length;f++){var h=i.slides[f].data("swiperindex");h<r||h>s?i.wrapper.removeChild(i.slides[f]):(l=Math.min(h,l),c=Math.max(h,c))}for(var f=r;f<=s;f++){if(f<l){var p=document.createElement(t.slideElement);p.className=t.slideClass,p.setAttribute("data-swiperindex",f),p.innerHTML=e[f],i.wrapper.insertBefore(p,i.wrapper.firstChild)}if(f>c){var p=document.createElement(t.slideElement);p.className=t.slideClass,p.setAttribute("data-swiperindex",f),p.innerHTML=e[f],i.wrapper.appendChild(p)}}}i.reInit(!0)},tt()};Swiper.prototype={plugins:{},wrapperTransitionEnd:function(e,t){function o(){e(n),n.params.queueEndCallbacks&&(n._queueEndCallbacks=!1);if(!t)for(s=0;s<i.length;s++)n.h.removeEventListener(r,i[s],o)}var n=this,r=n.wrapper,i=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s;if(e)for(s=0;s<i.length;s++)n.h.addEventListener(r,i[s],o)},getWrapperTranslate:function(e){var t=this.wrapper,n,r,i,s;return typeof e=="undefined"&&(e=this.params.mode=="horizontal"?"x":"y"),this.support.transforms&&this.params.useCSS3Transforms?(i=window.getComputedStyle(t,null),window.WebKitCSSMatrix?s=new WebKitCSSMatrix(i.webkitTransform):(s=i.MozTransform||i.OTransform||i.MsTransform||i.msTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=s.toString().split(",")),e=="x"&&(window.WebKitCSSMatrix?r=s.m41:n.length==16?r=parseFloat(n[12]):r=parseFloat(n[4])),e=="y"&&(window.WebKitCSSMatrix?r=s.m42:n.length==16?r=parseFloat(n[13]):r=parseFloat(n[5]))):(e=="x"&&(r=parseFloat(t.style.left,10)||0),e=="y"&&(r=parseFloat(t.style.top,10)||0)),r||0},setWrapperTranslate:function(e,t,n){var r=this.wrapper.style,i={x:0,y:0,z:0},s;arguments.length==3?(i.x=e,i.y=t,i.z=n):(typeof t=="undefined"&&(t=this.params.mode=="horizontal"?"x":"y"),i[t]=e),this.support.transforms&&this.params.useCSS3Transforms?(s=this.support.transforms3d?"translate3d("+i.x+"px, "+i.y+"px, "+i.z+"px)":"translate("+i.x+"px, "+i.y+"px)",r.webkitTransform=r.MsTransform=r.msTransform=r.MozTransform=r.OTransform=r.transform=s):(r.left=i.x+"px",r.top=i.y+"px"),this.callPlugins("onSetWrapperTransform",i),this.params.onSetWrapperTransform&&this.fireCallback(this.params.onSetWrapperTransform,this,i)},setWrapperTransition:function(e){var t=this.wrapper.style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e/1e3+"s",this.callPlugins("onSetWrapperTransition",{duration:e}),this.params.onSetWrapperTransition&&this.fireCallback(this.params.onSetWrapperTransition,this,e)},h:{getWidth:function(e,t){var n=window.getComputedStyle(e,null).getPropertyValue("width"),r=parseFloat(n);if(isNaN(r)||n.indexOf("%")>0)r=e.offsetWidth-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"));return t&&(r+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))),r},getHeight:function(e,t){if(t)return e.offsetHeight;var n=window.getComputedStyle(e,null).getPropertyValue("height"),r=parseFloat(n);if(isNaN(r)||n.indexOf("%")>0)r=e.offsetHeight-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"));return t&&(r+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))),r},getOffset:function(e){var t=e.getBoundingClientRect(),n=document.body,r=e.clientTop||n.clientTop||0,i=e.clientLeft||n.clientLeft||0,s=window.pageYOffset||e.scrollTop,o=window.pageXOffset||e.scrollLeft;return document.documentElement&&!window.pageYOffset&&(s=document.documentElement.scrollTop,o=document.documentElement.scrollLeft),{top:t.top+s-r,left:t.left+o-i}},windowWidth:function(){if(window.innerWidth)return window.innerWidth;if(document.documentElement&&document.documentElement.clientWidth)return document.documentElement.clientWidth},windowHeight:function(){if(window.innerHeight)return window.innerHeight;if(document.documentElement&&document.documentElement.clientHeight)return document.documentElement.clientHeight},windowScroll:function(){var e=0,t=0;if(typeof pageYOffset!="undefined")return{left:window.pageXOffset,top:window.pageYOffset};if(document.documentElement)return{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}},addEventListener:function(e,t,n,r){typeof r=="undefined"&&(r=!1),e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n)},removeEventListener:function(e,t,n,r){typeof r=="undefined"&&(r=!1),e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n)}},setTransform:function(e,t){var n=e.style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=t},setTranslate:function(e,t){var n=e.style,r={x:t.x||0,y:t.y||0,z:t.z||0},i=this.support.transforms3d?"translate3d("+r.x+"px,"+r.y+"px,"+r.z+"px)":"translate("+r.x+"px,"+r.y+"px)";n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=i,this.support.transforms||(n.left=r.x+"px",n.top=r.y+"px")},setTransition:function(e,t){var n=e.style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=t+"ms"},support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),transforms:window.Modernizr&&Modernizr.csstransforms===!0||function(){var e=document.createElement("div").style;return"transform"in e||"WebkitTransform"in e||"MozTransform"in e||"msTransform"in e||"MsTransform"in e||"OTransform"in e}(),transitions:window.Modernizr&&Modernizr.csstransitions===!0||function(){var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"MsTransition"in e||"OTransition"in e}()},browser:{ie8:function(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}return e!=-1&&e<9}(),ie10:window.navigator.msPointerEnabled,ie11:window.navigator.pointerEnabled}},(window.jQuery||window.Zepto)&&function(e){e.fn.swiper=function(t){var n=new Swiper(e(this)[0],t);return e(this).data("swiper",n),n}}(window.jQuery||window.Zepto),typeof module!="undefined"&&(module.exports=Swiper),define("swiper",function(){}),define("utils/extend/swiper.android",["swiper","utils/plugin/debug","utils/plugin/support"],function(e,t,n){function r(e){var t=e.find(".swiper-wrapper"),n=15,r=30,i=0,s=e.height(),o=0,u=0,a=0,f=0,l=e.find(".swiper-slide").first(),c=e.find(".loadnew-indicator").first(),h=e.find(".loadmore-indicator").first(),p=c.length,d=h.length,v=_t("Release to update"),m=_t("Pull down to update"),g=_t("Loading"),y=_t("Updating"),b=_t("Release to load more"),w=_t("Pull up to load more");l.data("url")||l.css({minHeight:s+1}),t.on("touchstart",function(n){e.scrollTop()===0&&e.scrollTop(1),check_height=t.height()-s,a=e.data("loadnew_state")||!1,f=e.data("loadmore_state")||!1,o=u=0}).on("touchmove",function(t){var i=e.scrollTop();a||(-i>r?3!=o&&(o=3,utils.debug.log("release to update"),p&&(c.removeClass("invisible").find("span").text(v),c.addClass("flip"))):-i>n?2!=o&&(o=2,utils.debug.log("pull down to update"),p&&(c.removeClass("invisible").removeClass("flip").removeClass("loading"),c.find("span").text(m))):-i>0&&1!=o&&(o=1,p&&(c.addClass("invisible"),c.find("span").text(""))))}).on("touchend",function(t){console.log("touch end"),console.log(document.body.offsetHeight-window.pageYOffset-window.innerHeight),o==3&&(console.debug("nativer scroll fire loadnew:load"),e.data("loadnew_state",!0).trigger("loadnew:load"),p&&(c.removeClass("flip").addClass("loading"),c.find("span").text(g)))}).on("touchleave",function(){console.log("touch leave")}).on("touchcancel",function(){console.log("touch cancel")}).on("touchenter",function(){console.log("touch enter")}),p;var E=0,S=0,x=0;$(document).on("scroll",function(){f=e.data("loadmore_state")||!1,a=e.data("loadnew_state")||!1,S=window.pageYOffset,E=window.pageYOffset,!a,f||document.body.offsetHeight-window.pageYOffset-window.innerHeight<10&&(e.trigger("loadmore:start").trigger("loadmore:load"),e.data("loadmore_state",!0),d&&h.removeClass("hide").removeClass("invisible"))})}function i(e){$new=e.find(".loadnew-indicator").first(),$more=e.find(".loadmore-indicator").first(),has_new=$new.length,has_more=$more.length,e.on("loadnew:end",function(){utils.debug.log("loadnew:end"),"lock"!=(e.data("loadnew_state")||false)&&e.data("loadnew_state",!1),has_new&&($new.addClass("invisible"),e.scrollTop(30))}).on("loadnew:lock",function(){utils.debug.log("loadnew:lock"),e.data("loadnew_state","lock")}).on("loadnew:unlock",function(){utils.debug.log("loadnew:unlock"),e.data("loadnew_state",!1)}).on("loadmore:end",function(){utils.debug.log("loadmore:end"),"lock"!=(e.data("loadmore_state")||false)&&e.data("loadmore_state",!1),has_more&&$more.addClass("invisible")}).on("loadmore:lock",function(){utils.debug.log("loadmore:lock"),e.data("loadmore_state","lock")}).on("loadmore:unlock",function(){utils.debug.log("loadmore:unlock"),e.data("loadmore_state",!1)}),e.data("loadmore_state","lock").data("loadnew_state","lock")}function s(e,t){function y(t){n=e.data("loadnew_state"),r=e.data("loadmore_state")||!1,i=s=0}function b(e,t){r||(t>u?s!=3&&(s=3,c&&(f.removeClass("invisible").addClass("flip"),f.find("span").text(m))):t>o?s!=2&&(s=2,c&&(f.removeClass("invisible").removeClass("flip").removeClass("loading"),f.find("span").text(g))):s!=1&&(s=1,l&&(a.addClass("invisible"),a.find("span").text(""))))}function w(e,t){t>u?i!=3&&(i=3,l&&(a.find("span").text(h),a.addClass("flip"))):t>o?i!=2&&(i=2,l&&(a.removeClass("invisible").removeClass("flip").removeClass("loading"),a.find("span").text(p))):i!=1&&(i=1,l&&(a.addClass("invisible").removeClass("flip").removeClass("loading"),a.find("span").text(p)))}function E(t){s==3?(console.log('swiper fire "loadmore:load" #'+e.attr("id")),e.trigger("loadmore:load"),e.data("loadmore_state",!0),c&&(f.removeClass("flip").addClass("loading"),f.find("span").text(d))):i==3&&(console.log('swiper fire "loadnew:load"'),e.trigger("loadnew:load"),e.data("loadnew_state",!0),l&&(a.removeClass("flip").addClass("loading"),a.find("span").text(d)))}var n=0,r=0,i=0,s=0,o=15,u=30,a=e.find(".loadnew-indicator").first(),f=e.find(".loadmore-indicator").first(),l=a.length,c=f.length,h=_t("Release to update"),p=_t("Pull down to update"),d=_t("Loading"),v=_t("Updating"),m=_t("Release to load more"),g=_t("Pull up to load more");t.onTouchEnd=E,t.onTouchStart=y,t.onResistanceAfter=b,t.onResistanceBefore=w;var S=new Swiper(e.get(0),t);return e.on("refresh",function(){var t=e.data("swiper");t&&t&&t.reInit()}),e.data("swiper",S),S}function o(e){function v(){l.addClass("invisible"),l.find("span").text(""),l.addClass("hide")}function m(){l.removeClass("hide").removeClass("invisible").addClass("loading"),l.find("span").text(i)}function g(){l.find("span").text(t),l.addClass("flip")}function y(){l.removeClass("invisible").removeClass("flip").removeClass("loading"),l.find("span").text(n)}function b(e){return e=e.originalEvent,e.changedTouches?e.changedTouches[0].clientY:e.clientY}function w(e){return e.changedTouches[0]?e.changedTouches[0].clientX:e.clientX}function E(){utils.debug.log('refresher fire "loadnew:load"'),$(e).trigger("loadnew:load"),m()}function x(e){var t=e.getBoundingClientRect();return t.top>=S&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}if(!e)return;var t=_t("Release to update"),n=_t("Pull down to update"),r=_t("Loading"),i=_t("Updating"),s=_t("Release to load more"),o=_t("Pull up to load more"),u=$(e),a="loadnew-anchor-"+_.random(1,4e4);u.prepend('<div id="'+a+'"> </div>');var f=$("#"+a),l=$(e).find(".loadnew-indicator").first(),c=!1,h=!1;u.on("mousedown touchstart",function(e){if(!x(f.get(0)))return;c=!0,prevY=b(e)});var p=30,d=200;u.on("mousemove touchmove",function(e){if(c&&b(e)>prevY){var t=b(e)-prevY;h=!0,c=!1,E()}}),$(e).on("loadnew:end loadmore:end",function(){v()});var S=40;l.addClass("hide")}function u(e){function w(){a.css({"-webkit-transform":"translate3d(0px, -15px, 0px)","-webkit-transition":"-webkit-transform 0ms",transition:"-webkit-transform 0ms"})}function E(){c.removeClass("invisible").removeClass("flip").removeClass("loading"),c.find("span").text(n),f.animate({scrollTop:u},"500","swing")}function S(){c.removeClass("flip").addClass("loading"),c.find("span").text(i),f.animate({scrollTop:u-16},"500","swing")}function x(){c.find("span").text(t),c.addClass("flip")}function T(){c.removeClass("invisible").removeClass("flip").removeClass("loading"),c.find("span").text(n)}function N(){utils.debug.log('refresher fire "loadnew:load"'),$(e).trigger("loadnew:load"),S()}function k(e){var t=e.getBoundingClientRect();return t.top>=C&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}if(!e)return;var t=_t("Release to update"),n=_t("Pull down to update"),r=_t("Loading"),i=_t("Updating"),s=_t("Release to load more"),o=_t("Pull up to load more"),u=150,a=$(e);a.prepend('<div id="loadnew-anchor"> </div>');var f=$("body"),l=$("#loadnew-anchor"),c=$(e).find(".loadnew-indicator").first(),h=!1,p=!1,d=parseInt(e.offsetTop),v,m=25,g=-100,y=0;a.on("mousedown touchstart",function(e){if(!k(l.get(0)))return;h=!0,d=f.scrollTop(),window.clearInterval(v),v=setInterval(function(){var e=d-f.scrollTop();utils.debug.log("change abc: "+e);if(e==g){if(y>=5){b(),y=0;return}y++}e<m?(T(),p=!1):(console.log("start ----- release"),x(),console.log("end ----- release"),p=!0),g=e},30)});var b=function(){if(!k(l.get(0)))return;h=!1,window.clearInterval(v),p?(utils.debug.log('refresher fire "loadnew:load"'),$(e).trigger("loadnew:load"),S()):E(),p=!1};$(e).on("loadmore:end loadnew:end",function(){E()});var C=70-u}$.fn.ensureSwiper=function(){var e=$(this.get(0)),t=e.height();e.find(".swiper-slide").css({minHeight:t}),s(e,{mode:"vertical",scrollContainer:!0})},$.fn.ensureVerticalScroll=$.fn.vscroll=function(e){arguments.length||(e=!1);var t="ontouchstart"in window,n=$(this.get(0)),u=parseInt(Math.max(window.innerHeight,window.screen.height/window.devicePixelRatio)+1);return n.id()=="#content"&&($(document.body).scrollTop(0),n.css({"min-height":u})),n.id()=="#content-bottom"&&n.css({"min-height":u}),i(n),e?(n.css({height:350}),s(n,{scrollContainer:!0,mousewheelControl:!0,mode:"vertical"})):(r(n),o(this.get(0))),n},$.fn.swiper=function(e){var t=$(this.get(0)),n="swiper",r=t.data(n);if(!r){var i=t.id();r=new Swiper(t.get(0),e),t.data(n,r),t.on("refresh",function(){r&&r.reInit&&r.reInit()})}return r}}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t=d.template;e=e.replace(/(\w+)\/tpl\/([^\.]+)\.(html)/,"template/:template/$1/$2.html"),e=e.replace(":template",t);var n,r,i,s=!1,o=e.indexOf("."),u=e.indexOf("./")===0||e.indexOf("../")===0;return o!==-1&&(!u||o>1)?(n=e.substring(0,o),r=e.substring(o+1,e.length)):n=e,i=r||n,o=i.indexOf("!"),o!==-1&&(s=i.substring(o+1)==="strip",i=i.substring(0,o),r?r=i:n=i),{moduleName:n,ext:r,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i==404?n("base view is not found."):i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!report/tpl/report-this.html",[],function(){return'<div class="form-group">\n	<select id="report_reason_select" class="control-full">\n		<option value="" disabled="true" selected="true"><%= _t(\'Type\') %></option>          \n		<option value="spam"><%= _t(\'Spam\') %></option>\n		<option value="abuse"><%= _t(\'Abuse\') %></option>\n		<option value="inappropriate"><%= _t(\'Inappropriate Content\') %></option>\n		<option value="licensed"><%= _t(\'Licensed Material\') %></option>\n		<option value="other"><%= _t(\'Other\') %></option>\n    </select>\n</div>\n<div class="form-group">\n	<textarea class="control-full textarea" id="report_reason_comment" placeholder="<%= _t(\'Description\') %>"><%= message %></textarea>\n</div>\n<div class="">\n	<button class="btn btn-primary btn-large-fluid" id="submit_report_btn"><%= _t(\'Report\') %></button>\n</div>'}),define("report/view/report-this",["text!report/tpl/report-this.html"],function(e){return Backbone.View.extend({className:"reporter-popup",template:_.template(e),render:function(){return this.$el.html(this.template({message:""})),this.$submitBtn=this.$el.find("#submit_report_btn"),this.$reasonSelect=this.$el.find("#report_reason_select"),this.$reasonMsg=this.$el.find("#report_reason_comment"),this},inject:function(){return utils.popup.open(this.$el),this},events:{"click #submit_report_btn":"submitReport"},submitReport:function(){this.$reasonSelect.removeClass("error");if(this.$submitBtn.hasClass("processing"))return!1;if(utils.validator.isEmpty(this.$reasonSelect.val()))return this.$reasonSelect.addClass("error"),utils.modal.alert("Report type can not be empty"),!1;if(utils.validator.isEmpty(this.$reasonMsg.val()))return utils.modal.alert("Message can not be empty"),!1;var e=this,t={iItemId:this.model.getId(),sItemType:this.model.getType(),sCategory:this.$reasonSelect.val(),sDescription:this.$reasonMsg.val()},n={context:this};e.$submitBtn.addClass("processing"),utils.api.post("report/add",t,n).done(function(e){e.error_code>0?utils.modal.alert(e.error_message):(utils.modal.toast(e.message),utils.popup.close())}).fail(function(e,t,n){}).always(function(){e.$submitBtn.removeClass("processing")})}})}),define("text!share/tpl/share-this.html",[],function(){return'<div class="form-group prevent-video-overlay">\n	<textarea id="share_message" class="control-full textarea" placeholder="<%= _t(\'Write something about this post\') %>"></textarea>\n</div>\n<div class="prevent-video-overlay">\n	<button type="button" id="submit" class="btn btn-primary btn-large-fluid"><%= _t(\'Share\') %></button>\n</div>\n'}),define("share/view/share-this",["text!share/tpl/share-this.html"],function(e){return Backbone.View.extend({events:{"click #submit":"submit"},className:"sharer-modal",template:_.template(e),hide:function(){utils.popup.close()},submit:function(){var e=this.$el,t=e.find("#submit");if(t.data("disabled"))return!1;var n=e.find("#share_message").val(),r=e.find("#share_id").val(),i=e.find("#share_type").val();if(!n)return utils.modal.alert(_t("Add some text to share."));t.data("disabled",!0),t.text("Sharing...");var s={iItemId:this.model.getId(),sItemType:this.model.getType(),sContent:n},o=this;utils.api.post("feed/share",s,{context:this}).done(function(e){utils.modal.toast("Shared successful!"),utils.popup.close()}).fail(function(e){utils.modal.alert(e.error_message)}).always(function(){t.data("disabled",!1).text("Share")})},render:function(e){return this.context=$.extend({fixtop:!1},e),this.$el.html(this.template(this.context)),this},inject:function(){var e=function(){};return this.context.fixtop&&(e=function(){$("#simple-popup").css({top:180})}),utils.popup.open(this.$el,e),this}})}),define("text!rate/tpl/rate-this.html",[],function(){return'<div class="rate-bar prevent-video-overlay">\n	<div class="rate-item" data-point="1"></div>\n	<div class="rate-item" data-point="2"></div>\n	<div class="rate-item" data-point="3"></div>\n	<div class="rate-item" data-point="4"></div>\n	<div class="rate-item" data-point="5"></div>\n</div>\n'}),define("rate/view/rate-this",["text!rate/tpl/rate-this.html"],function(e){return Backbone.View.extend({events:{"click .rate-item":"submit"},className:"rater-modal",template:_.template(e),submit:function(e){if(!e)return!1;if(0==this.model.canRate())return utils.modal.alert("You have no permission to rate this item!"),!1;if(this.model.isRated())return utils.modal.alert("You have rated this item!"),!1;var t=$(e.currentTarget),n=t.closest(".rate-bar"),r=this.context.dataRate,i=this.context.$relate;if(n.data("disabled"))return!1;n.data("disabled",!0);var s=n.find(".rate-item"),o=parseInt(t.data("point"),10);for(var u=0;u<o&&u<s.length;++u)$(s.get(u)).addClass("rated");var a=parseInt(this.model.getRateCount(),10),f=this.model.getRateFloatValue(),l=(a*f+o)/(a+1);console.log(a,f,l,o),this.model.set({fRating:l,bIsRating:!0,fRatingPrevious:f,iRatingCount:a+1});var c={sItemType:this.model.getType(),iItemId:this.model.getId(),iRating:o};utils.api.post("core/rate",c,{context:this}).done(function(e){if(e.error_code&&parseInt(e.error_code,10)>0){var t="";_.isArray(e.error_message)?t=e.error_message[0]:t=e.error_message,utils.modal.alert(t),this.postRateFail()}else utils.modal.toast(e.message||"You have rated successful!")}).fail(function(e){this.postRateFail(),utils.modal.alert(e.error_message)}).always(function(){utils.popup.close()})},postRateFail:function(){var e=this.model.getRateCount(),t=this.model.get("iRating"),n=this.model.getRateFloatValue(),r=(e*n-t)/(e-1);this.model.set({fRating:this.model.get("fRatingPrevious"),bIsRating:!1,iRatingCount:e-1})},render:function(e){return this.context=$.extend({$relate:null,fixtop:!1},e),this.$el.html(this.template(this.context)),this},inject:function(){var e=function(){};return this.context.fixtop&&(e=function(){$("#simple-popup").css({top:250})}),utils.popup.open(this.$el,e),this}})}),define("text!comment/tpl/comment-page.html",[],function(){return'<div class="header">\r\n	<div class="header-left">\r\n		<div class="btn-top btn-back" id="btn_back">\r\n		</div>\r\n	</div>\r\n	<div class="header-center">\r\n        <div class="title" id="page_title"><%= _t(\'Comment\') %></div>		\r\n	</div>\r\n</div>\r\n\r\n<!-- swiper -->\r\n<div class="content content-background with-header swiper-container" id="content-bottom">\r\n	<div class="swiper-wrapper">\r\n    	<div class="swiper-slide">\r\n    		<div class="pvm"></div>\r\n			<div id="activity_extra_holder">\r\n				<!-- loading activity extra -->\r\n			</div>	\r\n			<%= utils.helper.loadmore() %>\r\n    	</div>\r\n	</div>\r\n</div>'}),define("comment/view/comment-page",["text!comment/tpl/comment-page.html"],function(e){return Backbone.View.extend({region:{wrapper:"#main-bottom",scroller:"#content-bottom",listViewHolder:"#comment-list",activityExtraHolder:"#activity_extra_holder"},events:{"click #btn_back":"closeComment"},template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this.$listViewHolder=$(this.region.listViewHolder),this.$scroller=this.$el.find(this.region.scroller),this.$activityExtraHolder=this.$el.find(this.region.activityExtraHolder),this},inject:function(){$(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),utils.helper.addActivityExtraBlock(this.model,this.$activityExtraHolder,this.$scroller),utils.observer.trigger("bottom:open")},closeComment:function(){utils.observer.trigger("bottom:close")}})}),define("utils/extend/view-item",["utils/extend/view-polyplatform","report/view/report-this","share/view/share-this","rate/view/rate-this","comment/view/comment-page"],function(){Backbone.ItemView=Backbone.PolyplatformView.extend({className:"list-item",initialize:function(e,t){this.events=_.extend(this.events||{},{detail:"onViewDetailClick",comment:"onCommentClick",rate:"onRateClick",like:"onLikeClick",dislike:"onDislikeClick",report:"onReportClick",setting:"onSettingClick",share:"onShareClick","delete":"onDeleteClick"});var n=this;this.model.on("change:iTotalComment",function(){n.doUpdateCommentCount()}).on("change:bIsLiked",function(){n.doUpdateLike()}).on("change:bIsDisliked",function(){n.doUpdateDislike()}).on("change:iRatingCount",function(){n.doUpdateRateValue()})},detailView:null,settingView:null,reportView:require("report/view/report-this"),shareView:require("share/view/share-this"),rateView:require("rate/view/rate-this"),commentView:require("comment/view/comment-page"),topMenuView:null,render:function(e){return this.$el.html(this.template(e)),this},inject:function(e){return e(this.$el),this},getReportView:function(e){return new this.reportView({model:this.model})},getShareView:function(e){return new this.shareView({model:this.model})},getRateView:function(e){return new this.rateView({model:this.model})},getSettingView:function(e){return new this.settingView({model:this.model})},getCommentView:function(e){return new this.commentView({model:this.model})},getDetailView:function(e){return new this.detailView({model:this.model})},onLikeClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("like"))return!1;e.preventDefault(),this.doPostLike()},onDislikeClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("dislike"))return!1;e.preventDefault(),this.doPostDislike()},onReportClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("report"))return!1;e.preventDefault(),(new this.reportView({model:this.model})).render().inject()},onCommentClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("comment"))return!1;e.preventDefault();var n=t.display||!1,r=this.model.getCommentUrl();if(n=="page")return this.getCommentView({model:this.model}).render().inject();n=="focus"?this.$el.find("#comment-content").focus():window.location.href=r},onViewDetailClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("detail"))return!1;e.preventDefault();var n=t.display||!1,r=this.model.getDetailUrl();if(n=="page")return this.getDetailView({model:this.model}).render().inject();n=="page"&&(window.location.href=r)},onShareClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("share"))return!1;e.preventDefault(),this.getShareView().render().inject()},onRateClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("rate"))return!1;e.preventDefault();if(this.model.isRated())return utils.modal.alert(_t("You have rated!")),!1;this.getRateView().render().inject()},onSettingClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("setting"))return!1;e.preventDefault(),this.getSettingView().render().inject()},onDeleteClick:function(e,t){if(!t.id||t.id!=this.model.getDataId("delete"))return!1;e.preventDefault(),this.doDeleteConfirm(e,t)},doDeleteConfirm:function(){},doPostLike:function(){var e=$(this.model.getDataId("#like"));if(e.isProcessing())return;if(!this.model.canLike())return utils.modal.toast(_t("You don't have permission to like this item"));e.isProcessing(!0);var t=this.model.isLiked(),n=this.model.getLikeCount(),r=t?"like/unlike":"like/like",i={iItemId:this.model.getId(),sItemType:this.model.getType(),sParentId:this.model.getParentModuleId()},s={context:this};this.model.set({bIsLiked:!t,iTotalLike:t?n-1:n+1}),this.doUpdateLike(),utils.api.post(r,i,s).done(this.doLikeComplete).fail(this.doLikeFail).always(function(){e.isProcessing(!1)})},doLikeComplete:function(e){e.error_code&&e.error_code>0?(this.revertLikeStatus(),utils.modal.toast(e.error_message)):this.model.set({bIsLiked:e.bIsLiked,iTotalLike:e.iTotalLike}),this.doUpdateLike()},doLikeFail:function(){this.revertLikeStatus(),this.doUpdateLike()},revertLikeStatus:function(){var e=this.model.isLiked(),t=this.model.getLikeCount();this.model.set({bIsLiked:!e,iTotalLike:e?t-1:t+1})},doUpdateLike:function(){var e=this.model.getDataId("#like"),t=this.$el.find(e),n=t.find("span"),r=n.data("suffix")||!1,i=this.model.isLiked();t.toggleClass("liked",Boolean(i)),n.text(r?this.model.getLikeCountLabel():this.model.getLikeCount())},doPostDislike:function(){var e=$(this.model.getDataId("#dislike"));if(e.isProcessing())return;if(!this.model.canDislike())return utils.modal.toast(_t("You don't have permission to dislike this item"));e.isProcessing(!0);var t=this.model.isDisliked(),n=this.model.getDislikeCount(),r=t?"like/removedislike":"like/dislike",i={iItemId:this.model.getId(),sItemType:this.model.getType()},s={context:this};this.model.set({bIsDisliked:!t,iTotalDislike:t?n-1:n+1}),this.doUpdateDislike(),utils.api.post(r,i,s).done(this.doDislikeComplete).fail(this.doDislikeFail).always(function(){e.isProcessing(!1)})},doDislikeComplete:function(e){e.error_code&&e.error_code>0?(this.revertDislikeStatus(),utils.modal.toast(e.error_message)):this.model.set({bIsDisliked:e.bIsDisliked,iTotalDislike:e.iTotalDislike}),this.doUpdateDislike()},doDislikeFail:function(){this.revertDislikeStatus(),this.doUpdateDislike()},revertDislikeStatus:function(){var e=this.model.isDisliked(),t=this.model.getDislikeCount();this.model.set({bIsDisliked:!e,iTotalDislike:e?t-1:t+1})},doUpdateDislike:function(){var e=this.model.getDataId("#dislike"),t=this.$el.find(e),n=t.find("span"),r=n.data("suffix")||!1,i=this.model.isDisliked();t.toggleClass("disliked",Boolean(i)),n.text(r?this.model.getDislikeCountLabel():this.model.getDislikeCount())},doUpdateCommentCount:function(){var e=this.model.getDataId("#comment"),t=this.$el.find(e),n=t.find("span"),r=n.data("suffix")||!1;r?n.text(this.model.getCommentCountLabel()):n.text(this.model.getCommentCount())},doUpdateRateValue:function(){var e=this.model.getDataId("#rate"),t=this.$el.find(e),n=t.find("span"),r=n.data("suffix")||!1;this.model.isRated()?t.addClass("rated"):t.removeClass("rated"),r?n.text(this.model.getRateValueLabel()):n.text(this.model.getRateValue())}}),Backbone.InlineView=Backbone.View.extend({template:null,initialize:function(e,t){this.$wrapper=t},render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(){return this.$wrapper.html(this.$el),this.$wrapper.removeClass("hide"),this}}),Backbone.DetailView=Backbone.ItemView.extend({className:"detail-page"})}),define("utils/extend/view-popup",[],function(){Backbone.PopupView=Backbone.View.extend({template:null,render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(){return utils.popup.open(this.$el),this}})}),define("utils/main",["utils/plugin/i18n","moment","numeral","utils/plugin/str","utils/plugin/blockui","utils/plugin/setting","utils/plugin/debug","utils/plugin/support","utils/plugin/api","utils/plugin/livetime","utils/plugin/observer","utils/plugin/router","utils/plugin/helper","utils/plugin/attachment","utils/plugin/headline","utils/plugin/request-proxy","utils/plugin/modal","utils/plugin/layout","utils/plugin/validator","utils/plugin/popup","utils/plugin/history","utils/plugin/topmenu","utils/extend/jquery","utils/extend/model","utils/extend/view-polyplatform","utils/extend/view-list-collection","utils/extend/view","utils/extend/swiper.android","utils/extend/view-item","utils/extend/view-list","utils/extend/view-popup"],function(){var e={},t={i18n:$.i18n,setting:require("utils/plugin/setting"),moment:require("moment"),str:require("utils/plugin/str"),numeral:require("numeral"),debug:require("utils/plugin/debug"),support:require("utils/plugin/support"),api:require("utils/plugin/api"),livetime:require("utils/plugin/livetime"),headline:require("utils/plugin/headline"),attachment:require("utils/plugin/attachment"),observer:require("utils/plugin/observer"),router:require("utils/plugin/router"),helper:require("utils/plugin/helper"),modal:require("utils/plugin/modal"),requestProxy:require("utils/plugin/request-proxy"),layout:require("utils/plugin/layout"),validator:require("utils/plugin/validator"),popup:require("utils/plugin/popup"),history:require("utils/plugin/history"),blockui:require("utils/plugin/blockui"),topMenu:require("utils/plugin/topmenu")};return t.addModule=function(t,n){e[t]=$.extend({name:t,label:t,href:"#"+t},n)},t.hasModule=function(t){return e.hasOwnProperty(t)},window._t=function(){return $.i18n._.apply($.i18n,arguments)},window.utils=t,t}),define("utils",["utils/main"],function(e){return e}),define("text!core/tpl/partial-loadmore.html",[],function(){return'<div class="loadmore-indicator invisible">\n	<i class="icon"></i>\n	<span class="text"></span>\n	<div class="pvs"></div>\n</div>'}),define("text!core/tpl/partial-loadnew.html",[],function(){return'<div class="loadnew-indicator invisible">\n	<div class="pvs"></div>\n	<i class="icon"><!-- icon indicator  --></i>\n	<span class="text"></span>\n</div>'}),define("text!core/tpl/partial-not-found.html",[],function(){return'<div class="not-found"><%= msg %></div>\n'}),define("text!core/tpl/partial-not-more.html",[],function(){return'<div class="not-found"><%= msg %></div>\n'}),define("text!core/tpl/partial-private-page.html",[],function(){return'<!-- core/tpl/private-page.html -->\r\n<div class="header">\r\n	<div class="header-left">\r\n		<div class="btn-top btn-back" rel="back">\r\n		</div>\r\n	</div>\r\n	<div class="header-center">\r\n		<div class="title" id="page_title">\r\n			<%= _t(\'Private Page\') %>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n<div class="content content-background with-header swiper-container" id="content">\r\n	<div class="swiper-wrapper">\r\n		<div class="swiper-slide">\r\n			<div class="permission-deny">\r\n				<%= _t(\'You do not have permission to view this private page.\') %>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!core/tpl/partial-permission-deny.html",[],function(){return"<div class=\"permission-deny\">\n	<%= _t('You do not have permission to view this private page.') %>\n</div>"}),define("text!chat/tpl/chat-header-btn.html",[],function(){return'<div class="header-right">\n    <a href="#chat"> <div class="btn-top btn-chat"></div> </a>\n</div>'}),define("core/plugin/helper",["text!core/tpl/partial-loadmore.html","text!core/tpl/partial-loadnew.html","text!core/tpl/partial-not-found.html","text!core/tpl/partial-not-more.html","text!core/tpl/partial-private-page.html","text!core/tpl/partial-permission-deny.html","text!chat/tpl/chat-header-btn.html"],function(e,t){var n=_.template(require("text!core/tpl/partial-loadmore.html")),r=_.template(require("text!core/tpl/partial-loadnew.html")),i=_.template(require("text!core/tpl/partial-not-more.html")),s=_.template(require("text!core/tpl/partial-not-found.html")),o=_.template(require("text!core/tpl/partial-private-page.html")),u=_.template(require("text!core/tpl/partial-permission-deny.html")),a=_.template(require("text!chat/tpl/chat-header-btn.html"));utils.helper.loadmore=function(e){return n(e)},utils.helper.loadnew=function(e){return r(e)},utils.helper.notfound=function(e){return s({msg:e})},utils.helper.notmore=function(e){return i({msg:e})},utils.helper.privatepage=function(e){return o($.extend({phrase:"You do not have permission to view this private page."},e))},utils.helper.permission_deny=function(e){return u($.extend({phrase:"You do not have permission to view this private page."},e))},utils.helper.chat_header_btn=function(){return utils.setting.get("chat_enabled")?a():""}}),define("text!core/tpl/partial-updater.html",[],function(){return'<div class="header-notification">\n	<div class="beeber-item" id="beeber-request-indicator">\n		<i class="icon icon-beeber-request"></i>\n		<i class="beeber-arrow"></i>\n		<span class="beeber-counter <%= iRequest > 0 ? \'\': \'hide\' %>" id="beeber-request-counter"><%= iRequest %></span>\n	</div>\n	<div class="beeber-item" id="beeber-message-indicator">\n		<i class="icon icon-beeber-message"></i>\n		<i class="beeber-arrow"></i>\n		<span class="beeber-counter <%= iMessage>0 ? \'\': \'hide\' %>" id="beeber-message-counter"><%= iMessage %></span>\n	</div>\n	<div class="beeber-item" id="beeber-notification-indicator">\n		<i class="icon icon-beeber-notification"></i>\n		<i class="beeber-arrow"></i>\n		<span class="beeber-counter <%= iNotification > 0 ? \'\': \'hide\' %>" id="beeber-notification-counter"><%= iNotification %></span>\n	</div>\n</div>\n\n'}),define("core/plugin/updater",["text!core/tpl/partial-updater.html"],function(e){var t=Backbone.Model.extend({defaults:{iNumberNotification:0,iNumberOfMessage:0,iNumberOfFriendRequest:0,iLastUpdate:0,iSidebarCounter:0,iSettingCounter:0},getNumberNotification:function(){return this.get("iNumberNotification")||0},getNumberMessage:function(){return this.get("iNumberOfMessage")||0},getNumberRequest:function(){return this.get("iNumberOfFriendRequest")||0},fetchData:function(){utils.api.get("notification/update",{},{context:this}).done(this.fetchDataComplete).fail(this.fetchDataFail)},fetchDataComplete:function(e){if(e.error_code&&e.error_code)return;this.set(e),this.updateView()},fetchDataFail:function(){},setNumberNewNotification:function(e){this.set("iNumberNotification",e)},setNumberNewMessage:function(e){this.set("iNumberOfMessage",e)},setNumberNewRequest:function(e){this.set("iNumberOfFriendRequest",e)},clearCache:function(){localStorage.setItem("core.updater","")}});t.prototype.updateView=function(){var e=$("#beeber-request-counter"),t=$("#beeber-message-counter"),n=$("#beeber-notification-counter"),r=this.getNumberNotification(),i=this.getNumberRequest(),s=this.getNumberMessage();e.length&&(i>0?e.html(i).removeClass("hide"):e.addClass("hide")),t.length&&(s>0?t.html(s).removeClass("hide"):t.addClass("hide")),n.length&&(r>0?n.html(r).removeClass("hide"):n.addClass("hide"))},t.prototype.doRegistrationWithAPNs=function(){var e={badge:"true",sound:"true",alert:"true",ecb:"onAPNsReceiver"};if(constants.token)try{var t=window.plugins.pushNotification;t.register(function(e){utils.debug.log(e),utils.api.post("device/register",{sDeviceId:e,sPlatform:"ios"}).done(function(){utils.debug.log("PUSH-NOTIFICATION: Has registed device id with server.")}).fail(function(){utils.debug.log("PUSH-NOTIFICATION: Register device id is failed.")})},function(e){utils.debug.log("PUSH-NOTIFICATION: Cannot register device with APPLE."),utils.debug.log(e)},e)}catch(n){}},t.prototype.doRegistrationWithGCM=function(){var e={senderID:"561554585734",ecb:"onGCMReceiver"};if(constants.token)try{var t=window.plugins.pushNotification;t.register(function(e){utils.debug.log(e)},function(e){utils.debug.log("PUSH-NOTIFICATION: Cannot register device with GOOGLE.")},e)}catch(n){}},t.prototype.onAPNsReceiver=function(e){utils.debug.log("RECEIVER PAYLOAD WITH DATA PAYLOAD"),1==e.foreground?n.fetchData(e):n.gotoDetailPage(e)},t.prototype.onGCMReceiver=function(e){switch(e.event){case"registered":utils.debug.log("GCM RECEIVER - registered"),e.regid.length>0&&utils.api.post("device/register",{sDeviceId:e.regid,sPlatform:"android"}).done(function(){utils.debug.log("GCM RECEIVER - Has registed device id with server.")}).fail(function(){utils.debug.log("GCM RECEIVER - Register device id is failed.")});break;case"message":utils.debug.log("GCM RECEIVER - message"),e.foreground?n.fetchData(e.payload):e.coldstart?(utils.debug.log("GCM RECEIVER - COLDSTART NOTIFICATION"),n.fetchData(e.payload)):n.gotoDetailPage(e.payload);break;case"error":utils.debug.log("GCM RECEIVER - ERROR:"+e.msg);break;default:utils.debug.log("GCM RECEIVER - Unknown, an event was received and we do not know what it is")}},t.prototype.gotoDetailPage=function(e){e.sType=="notification"&&utils.api.post("notification/detail",{iNotificationId:e.iId}).done(function(e){e.sType=="commented"?e.sItemType=="music_playlist"?window.location.href="#music_playlist/"+e.iItemId:e.sItemType=="activity_action"?window.location.href="#activity_action/"+e.iItemId:e.sItemType!="album_photo"&&(e.sItemType=="album"?window.location.href="#albums-of/"+e.iItemId:e.sItemType=="video"&&(window.location.href="#video/"+e.iItemId)):e.sType=="liked_commented"?e.sItemType=="activity_action"&&(window.location.href="#activity_action/"+e.iItemId):e.sType=="liked"?e.sItemType=="music_playlist"?window.location.href="#music_playlist/"+e.iItemId:e.sItemType!="album_photo"&&(e.sItemType=="album"?window.location.href="#albums-of/"+e.iItemId:e.sItemType=="activity_action"?window.location.href="#activity_action/"+e.iItemId:e.sItemType=="video"?window.location.href="#video/"+e.iItemId:e.sItemType=="activity_comment"&&(window.location.href="#activity_action/"+e.iItemId)):e.sType=="post_user"?e.sItemType=="user"&&(window.location.href="#user/"+e.iItemId):e.sType=="friend_accepted"?window.location.href="#user/"+e.iOwnerUserId:e.sType=="event_invite"&&(window.location.href="#event/"+e.iItemId)}).fail(function(){return})},utils.observer.on("user:login",function(){n.fetchData()}),utils.observer.on("user:logout",function(){n.clearCache()}),utils.observer.on("user:login",function(){constants.platform=="android"?n.doRegistrationWithGCM():n.doRegistrationWithAPNs()});var n=new t,r=_.template(e);return utils.helper.updater=function(){return r({iRequest:n.getNumberRequest(),iMessage:n.getNumberMessage(),iNotification:n.getNumberNotification()})},window.onAPNsReceiver=function(){n.onAPNsReceiver.apply(n,arguments)},window.onGCMReceiver=function(){n.onGCMReceiver.apply(n,arguments)},window.setInterval(function(){n.fetchData()},6e4),n}),define("user/model/user",[],function(){var e=Backbone.Model.extend({idAttribute:"iUserId",defaults:{sModelType:"user"}});return e.prototype.getId=function(){return this.get("iUserId")||this.get("user_id")||this.get("id")},e.prototype.getUserName=function(){return this.get("user_name")||this.get("username")},e.prototype.getEmail=function(){return this.get("email")||this.get("sEmail")},e.prototype.getTitle=function(){return this.get("sFullName")||this.get("full_name")||this.get("Display_Name")||""},e.prototype.getAboutUrl=function(){return"#user-about/"+this.getId()},e.prototype.getPhotoUrl=function(){return"#user-photo/"+this.getId()},e.prototype.getFriendUrl=function(){return"#friends/"+this.getId()},e.prototype.canComment=function(){return this.get("bCanPostComment")},e.prototype.getImageSrc=function(){return this.get("UserProfileImg_Url")||this.get("profileimage")||this.get("Profile_Image")||this.get("sUserImage")},e.prototype.getBigImageSrc=function(){return this.get("BigUserProfileImg_Url")||this.get("Profile_Image_Big")||this.get("sBigUserImage")},e.prototype.isFriend=function(){return this.get("isFriend")?1:0},e.prototype.isBlocked=function(){return this.get("isBlocked")},e.prototype.isBlockedBy=function(){return this.get("isBlockedBy")},e.prototype.isSentRequestBy=function(){return this.get("isSentRequestBy")?1:0},e.prototype.isSentRequest=function(){return this.get("isSentRequest")?1:0},e.prototype.getBirthDate=function(){return this.get("sDayOfBirth")||this.get("Date_Of_Birth")},e.prototype.getGender=function(){return this.get("sGender")||this.get("Gender")||""},e.prototype.getFriendCount=function(){return this.get("iTotalOfFriends")},e.prototype.getPhotoCount=function(){return this.get("iTotalOfPhotos")},e.prototype.getFirstName=function(){return this.get("First_Name")||this.get("first_name")||""},e.prototype.getLastName=function(){return this.get("Last_Name")||this.get("last_name")||""},e.prototype.getBirthdayToParseYMD=function(){return this.get("Date_Of_Birth_YMD")},e.prototype.getWebsiteContact=function(){return this.get("aContacts")?this.get("aContacts").website:""},e.prototype.getFacebookContact=function(){return this.get("aContacts")?this.get("aContacts").facebook:""},e.prototype.getTwitterContact=function(){return this.get("aContacts")?this.get("aContacts").twitter:""},e.prototype.getAIMContact=function(){return this.get("aContacts")?this.get("aContacts").aim:""},e.prototype.getAboutMe=function(){return this.get("sAboutMe")},e.prototype.getDataFriend=function(){return[this.getId(),this.isFriend(),this.isSentRequest(),this.isSentRequestBy()].join(";")},e.prototype.canView=function(){return this.get("bCanView")===void 0?!0:this.get("bCanView")},e.prototype.getTotalPhotos=function(){return this.get("iTotalOfPhotos")||0},e.prototype.getTotalFriends=function(){return this.get("iTotalOfFriends")||0},e.prototype.isMuteChatNotification=function(){return this.get("bIsMuteChatNotification")==null?!0:this.get("bIsMuteChatNotification")},e.prototype.isOnline=function(){return this.getChatStatus()=="online"?!0:!1},e.prototype.getChatStatus=function(){return this.get("sStatus")||this.get("sChatStatus")||""},e.prototype.getCity=function(){return this.get("City")||""},e.prototype.getZipPostalCode=function(){return this.get("Zip_Code")||this.get("sZipPostalCode")||""},e.prototype.getCountryISO=function(){return this.get("Country_ISO")||""},e.prototype.getCoverPhotoUrl=function(){return this.get("sCoverPhotoUrl")||""},e.prototype.getRelationshipStatus=function(){return this.get("sRelationshipStatus")||""},e.prototype.getLocation=function(){return this.get("sLocation")||""},e}),define("core/plugin/viewer",["user/model/user"],function(){var e=require("user/model/user"),t=localStorage.getItem("viewer");t&&(t=JSON.parse(t));var n=new e(t||{});return n.on("change",function(){localStorage.setItem("viewer",JSON.stringify(this.toJSON()))}),utils.observer.on("app:init",function(){var e=localStorage.getItem("token");e?utils.api.get("user/verify_account",{token:e},{context:this,async:!1}).done(function(t){t.error_code&&t.error_code>0?window.location.href="#logout":(utils.api.setup({token:e}),n.set(t),utils.observer.trigger("user:login",t),constants.token=e,window.location.href=constants.home)}).fail(function(){window.location.href="#logout"}):window.location.href="#logout"}).on("user:logout",function(){Backbone.iUserId=0,localStorage.setItem("viewer","")}).on("user:login",function(){Backbone.iUserId=n.getId()}).on("user:update",function(){utils.api.get("user/verify_account",{iUserId:n.getId()}).done(function(e){localStorage.setItem("viewer",JSON.stringify(e)),n.set(e),utils.debug.log("user updated",e),utils.observer.trigger("viewer:update")}).fail(function(){utils.debug.log(arguments)})}),n}),define("core/model/sidebar",[],function(){return Backbone.Model.extend({idAttribute:"sName",defaults:{},getLabel:function(){return this.get("sLabel")},getModuleId:function(){return this.get("sLayout")},toHtml:function(e,t){if(!t)return"";var n=this.getModuleId(),r=n==e?"active":"";return'<div class="item '+r+'" data-href="'+t.url+'" data-id="'+n+'"><i class="sidebar-icon '+t.icon+'"></i> <span>'+_t(this.getLabel())+"</span></div>"}})}),define("core/collection/sidebar",["core/model/sidebar"],function(e){return Backbone.Collection.extend({model:e})}),define("text!core/tpl/sidebar.html",[],function(){return'<div class="swiper-wrapper">\n	<div class="swiper-slide" id="sidebar_list_holder">\n		\n	</div>\n</div>\n'}),define("text!core/tpl/sidebar-list.html",[],function(){return'<div class="item user-info" data-href="#user/<%= viewer.getId() %>">\n	<img src="<%= viewer.get(\'profileimage\') %>" class="sidebar-profile-photo" />\n	<%= utils.str.shorten(viewer.getTitle(),22,false) %>\n</div>\n\n<% menu_items.each(function(item){ %>\n	<%= item.toHtml(module, configs.get(item.getModuleId())) %>\n<% },this)%>\n<div class="item" data-href="#logout" id="link_logout">\n	<i class="sidebar-icon icon-sidebar-logout"></i>\n	<span><%= _t(\'Sign Out\') %></span>\n</div>'}),define("core/view/sidebar",["core/plugin/viewer","core/collection/sidebar","text!core/tpl/sidebar.html","text!core/tpl/sidebar-list.html"],function(e,t,n,r){var i=Backbone.Model.extend({});return Backbone.View.extend({region:{outer:"#container",wrapper:"#sidebar",scroller:"#sidebar-content",listViewHolder:"#sidebar_list_holder"},id:"sidebar-content",className:"sidebar-content swiper-container",events:{"click .item":"navigate",click:"hide"},initialize:function(n){this.menu_items=new t,this.viewer=e,this.configs=new i({});var r=this;this.menu_items.on("change",function(){r.updateView()}),this.viewer.on("change",function(){r.fetchData()}),this.isShown=!1,utils.observer.on("sidebar:toggle",function(){r.toggle()}).on("beeber:pre_show",function(){r.isShown&&r.hide()}).on("router:changed",function(){r.isShown&&r.hide()})},template:_.template(n),listTpl:_.template(r),show:function(){utils.observer.trigger("sidebar:pre_show"),this.$outer.addClass("sidebar-open"),this.isShown=!0},hide:function(){this.isShown=!1,this.$outer.removeClass("sidebar-open")},toggle:function(){this.isShown?this.hide():this.show()},fetchData:function(){utils.api.get("core/sidebar",{},{context:this}).done(this.fetchDataComplete).fail(this.fetchDataFail)},fetchDataComplete:function(e){this.menu_items.reset(),this.menu_items.add(e),this.menu_items.trigger("change")},fetchDataFail:function(){},navigate:function(e){if(!e)return!1;e.preventDefault();var t=$(e.currentTarget),n=t.data("href"),r=t.data("id");if(n=="#logout")return utils.modal.confirm(_t("Do you want to log out of application?"),function(e){e==1&&(window.location.href="#logout")},_t("Confirm"),[_t("Ok"),_t("Cancel")]),!1;if(!n)return!1;this.$el.find(".active").removeClass("active"),r&&(t.addClass("active"),localStorage.getItem("sidebar.active")),this.hide(),window.location.href=n},render:function(e){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$listView=this.$el.find(this.region.listViewHolder),this.$outer=$(this.region.outer),this},inject:function(){$(this.region.wrapper).html(this.$el),this.swiperObj=new Swiper("#sidebar-content",{scrollContainer:!0,mode:"vertical"}),this.$scroller.on("click",function(){utils.observer.trigger("sidebar:close")});var e=this;return $("#backdrop").on("click",function(){e.isShown&&e.hide()}),this},updateView:function(){this.$listView.html(this.listTpl({menu_items:this.menu_items,module:"new_feed",configs:this.configs,viewer:this.viewer})),this.swiperObj.reInit()}})}),define("core/plugin/sidebar",["core/view/sidebar"],function(e){var t=(new e).render().inject();return utils.observer.on("app:run",function(){t.fetchData()}),t}),define("text!core/tpl/lost-connection.html",[],function(){return'<div class="connection-lost">\n	<div class="image-connection-lost">\n		<div class="head"><%= _t(\'Connection Lost\') %></div>\n		<div class="refresh">\n			<i class="icon icon-tap-retry"></i>\n			<span><%= _t(\'Tap to Retry\') %></span>\n		</div>\n	</div>	\n</div>\n'}),define("core/view/lost-connection",["text!core/tpl/lost-connection.html"],function(e){return Backbone.View.extend({region:{main:"#main",content:"#content"},events:{"click .refresh":"retry"},template:_.template(e),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this.$refresh=$(".refresh",this.$el),this.$refreshIcon=$(".refresh i",this.$el),this},inject:function(){return $(this.region.main).html(this.$el),this},retry:function(){if(this.isProcessing)return;var e=this,t={},n={context:this,beforeSend:this.beforeSend};utils.api.post("core/ping",t,n).done(this.postDone).always(this.postComplete)},postComplete:function(){var e=this;setTimeout(function(){e.$refreshIcon.removeClass("processing"),e.isProcessing=!1},1e3)},beforeSend:function(){this.$refreshIcon.addClass("processing"),this.isProcessing=!0},postDone:function(e,t,n){window.location="#home"}})}),define("core/controller/index",["core/view/lost-connection"],function(e){function t(){var e=constants.token;e?window.location.href="#newsfeed":window.location.href="#login"}function n(){(new e).render().inject()}utils.router.route("lost-connection",n),utils.router.route("home",t),setTimeout(function(){if(!navigator.connection)return!1;navigator.connection.type==Connection.NONE&&(window.location.href="#lost-connection"),document.addEventListener("offline",function(){window.location.href="#lost-connection"},!1),document.addEventListener("online",function(){t()},!1)},2e3)}),define("core/main",["core/plugin/helper","core/plugin/updater","core/plugin/sidebar","core/plugin/viewer","core/controller/index"],function(){return utils.observer.on("navigate:back",function(){window.history.go(-1)}),utils.observer.on("navigate:next",function(){window.history.go(1)}),utils.observer.on("navigate:to",function(e){var t=e.data("href");window.location.href=t}),{enable:!0,sidebar:require("core/plugin/sidebar"),updater:require("core/plugin/updater"),viewer:require("core/plugin/viewer")}}),define("core",["core/main"],function(e){return e}),define("like/main",[],function(){return{enable:!0}}),define("like",["like/main"],function(e){return e}),define("dislike/main",[],function(){return{enable:!0}}),define("dislike",["dislike/main"],function(e){return e}),define("comment/main",[],function(){return{enable:!0}}),define("comment",["comment/main"],function(e){return e}),define("share/plugin/activity",[],function(){utils.headline.add("share",function(e,t){var n=e.getParam(),r=(n.type||"").replace(/(<a [^>]+>)([^<]+)+(<\/a>)+/ig,"$2")||"post";return _t("shared %s's %s",e.getSharedUserLink(),r)})}),define("share/main",["share/plugin/activity"],function(){return{enable:!0}}),define("share",["share/main"],function(e){return e}),define("rate/main",[],function(){return{enable:!0}}),define("rate",["rate/main"],function(e){return e}),define("report/main",[],function(){return{enable:!0}}),define("report",["report/main"],function(e){return e}),define("user/plugin/connect",["utils"],function(e){function i(){$.getJSON("https://graph.facebook.com/me",{access_token:r},function(e){alert(JSON.stringify(e))})}function s(){var e=window.open(encodeURI(t),"_blank","location=no,status=no");e.addEventListener("loadstop",function(t){var n=t.url,s=/\?access_token=(.+)$/.exec(n),o=/\?error=(.+)$/.exec(n);s&&(r=s.pop(),e.close(),i()),o&&(e.close(),o=o.pop(),alert(o))})}function o(){var e=window.open(encodeURI(connect_twitter_url),"_blank","location=no");e.addEventListener("loadstart",function(t){e.close()}),e.addEventListener("loadstop",function(t){e.close()})}var t="http://product-dev.younetco.com/mobile/se460/?m=lite&name=facebook&module=ynmobile",n="http://namnv.local/connect/twitter.php",r="";e.observer.on("connect:facebook",s),e.observer.on("connect:twitter",o)}),define("user/plugin/activity",[],function(){utils.headline.add(["post","feed_comment"],function(e,t){return e.getPosterLink()+'<i class="activity-post-via"> &rarr; </i> '+e.getParentLink()}),utils.headline.add("signup",function(e){return _t("%s has just signed up. Say hello!",e.getPosterLink())}),utils.headline.add("profile_photo_update",function(e){return _t("%s has added a new profile photo.",e.getPosterLink())}),utils.headline.add("post_self",function(e){return e.getPosterLink()}),utils.headline.add("status",function(e){return e.getPosterLink()}),utils.headline.add(["user_status","custom","user_photo"],function(e){return""})}),define("user/plugin/block-this",[],function(e,t){utils.observer.on("user:block-this",function(e,t){var n=e.data("id"),r=e.data("is-blocked"),i=r?"Do you want to un-block this member":"Do you want to block this member",s=function(){e.isProcessing(!1)},o=function(){e.isProcessing(!0)},u=function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;a(e)},a=function(e){utils.popup.close(),utils.observer.trigger("user:block-done",{iItemId:n,isBlocked:r?!1:!0}),utils.modal.toast(r?"Un-block successfully":"Block successfully")};e.isProcessing()?utils.modal.info("Item is processing"):utils.modal.confirm(i,function(e){if(e===1){var t={iUserId:n},i={beforeSend:o},a=r?"user/unblock":"user/block";utils.api.post(a,t,i).done(u).always(s)}},_t("Confirm"),[_t("Ok"),_t("Cancel")])})}),define("text!user/tpl/user-detail-info.html",[],function(){return'<!-- user/tpl/profile/activity.html -->\n<div class="header">\n	<% if(bIsRoot) {%>\n        <div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n            <i class="icon icon-sidebar"></i>\n        </div>\n    <% } else { %>\n        <div class="header-left">\n            <div class="btn-top btn-back" rel="back"></div>\n        </div>\n    <% } %>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Profile\') %>\n        </div>\n	</div>\n\n    <div class="header-right">\n		<div class="btn-top btn-more hide" id="menu_toggle">\n		</div>\n	</div>\n</div>\n\n<div id="top_menu" class="top-menu hide"></div>\n<div id="content" class="content content-background with-header swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="user-profile-info">\n				<div class="loading-initiator"></div>\n			</div>\n			<div class="swiper-list vertical">\n			<div id="activity_minibar_holder"></div>\n			<div class="pvm"></div>\n			<div id="activity-list" class="hide">\n				\n			</div>\n			</div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n'}),define("text!user/tpl/user-detail-info-update.html",[],function(){return'<div class="user-profile-info">\n    <div id="basic-info-holder">\n    </div>\n</div>\n'}),define("activity/model/privacy",[],function(){var e=Backbone.Model.extend({idAttribute:"sValue",defaults:{isChosen:!1}});return e.prototype.getClass=function(){var e="icon-privacy-",t="";switch(this.getValue()){case 0:t="everyone";break;case 1:t="friends";break;case 2:t="friends-of-friends";break;case 3:t="only-me";break;case 4:t="custom"}return e+t},e.prototype.getValue=function(){return parseInt(this.get("sValue"),10)||0},e.prototype.getPhrase=function(){return this.get("sPhrase")||""},e.prototype.isChosen=function(){return this.get("isChosen")||!1},e}),define("activity/model/feed",["activity/model/privacy"],function(){var e=require("activity/model/privacy"),t=Backbone.Model.extend({urlRoot:constants.apiURL+"feed/get",idAttribute:"iActionId",defaults:{sModelType:"feed",bCanLike:!0,bCanShare:!0,bCanComment:!0,sSubjectType:null,sSubjectId:null,sSubjectTitle:null}});return t.prototype.getHeadline=function(){return utils.headline.translate(this)},t.prototype.getPosterLink=function(e){return arguments.length||(e=22),'<a class="poster-link" href="'+this.getPosterUrl()+'">'+utils.str.truncate(this.getPosterTitle(),e,!1)+"</a>"},t.prototype.getObjectLink=function(e){return arguments.length||(e=22),'<a class="object-link" href="'+this.getObjectUrl()+'">'+utils.str.truncate(this.getObjectTitle(),e,!1)+"</a>"},t.prototype.getItemLink=function(e){return arguments.length||(e=22),'<a class="item-link" href="'+this.getItemUrl()+'">'+utils.str.truncate(this.getItemTitle(),e,!1)+"</a>"},t.prototype.getParam=function(){return this.get("sParams")||{}},t.prototype.getItemId=function(){return this.get("iItemId")},t.prototype.getTimestamp=function(){return this.get("iTimestamp")},t.prototype.getItemType=function(){return this.get("sItemType")},t.prototype.getItemTitle=function(){return this.get("sItemTitle")},t.prototype.getItemUrl=function(){return"#"+this.getItemType()+"/"+this.getItemId()},t.prototype.getActionType=function(){return this.get("sActionType")},t.prototype.getActionId=function(){return this.get("iActionId")},t.prototype.getPosterId=function(){return this.get("iUserId")},t.prototype.getPosterType=function(){return"user"},t.prototype.getPosterTitle=function(){return this.get("sFullName")},t.prototype.getPosterImageSrc=function(){return this.get("UserProfileImg_Url")},t.prototype.getPosterUrl=function(){return"#"+this.getPosterType()+"/"+this.getPosterId()},t.prototype.getParentId=function(){return this.get("iObjectParentId")},t.prototype.getParentType=function(){return this.get("sObjectParentType")},t.prototype.getParentTitle=function(){return this.get("sObjectParentTitle")},t.prototype.getParentUrl=function(){return"#"+this.getParentType()+"/"+this.getParentId()},t.prototype.getParentLink=function(e){return arguments.length||(e=22),'<a class="item-link" href="'+this.getParentUrl()+'">'+utils.str.truncate(this.getParentTitle(),e,!1)+"</a>"},t.prototype.getOwnerId=function(){return this.get("iObjectOwnerId")},t.prototype.getOwnerType=function(){return this.get("sObjectOwnerType")},t.prototype.getOwnerTitle=function(){return this.get("sObjectOwnerTitle")},t.prototype.getOwnerUrl=function(){return"#"+this.getOwnerType()+"/"+this.getOwnerId()},t.prototype.getOwnerLink=function(e){return arguments.length||(e=22),'<a class="item-link" href="'+this.getOwnerUrl()+'">'+utils.str.truncate(this.getOwnerTitle(),e,!1)+"</a>"},t.prototype.hasStory=function(){return this.get("sContent")||this.get("sParams").body},t.prototype.getStory=function(){return this.get("sFullContent")||this.get("sContent")||this.get("sParams").body},t.prototype.getAttachments=function(){return this.get("aAttachments")},t.prototype.getAttachmentType=function(){return this.hasAttachment()?this.get("aAttachments")[0].sType:!1},t.prototype.hasAttachment=function(){return this.get("aAttachments")?this.get("aAttachments").length?!0:!1:!1},t.prototype.getAttachmentCount=function(){return this.get("aAttachments")?0:this.get("aAttachments").length},t.prototype.canDelete=function(){return this.get("bCanDelete")||this.isOwner()||this.get("sItemType")=="user"&&this.get("iItemId")==Backbone.iUserId||this.get("sItemType")=="feed_comment"&&this.get("iObjectParentId")==Backbone.iUserId},t.prototype.getTimezoneOffset=function(){return parseFloat(this.get("sUserTimezone"))||0},t.prototype.getPrivacyValue=function(){return parseInt(this.get("iPrivacy"),10)||0},t.prototype.getPrivacyClass=function(){var t=new e({sValue:this.getPrivacyValue()});return t.getClass()},t.prototype.getParentModuleId=function(){return this.get("parentModuleId")},t}),define("text!activity/tpl/activity-item.html",[],function(){return'<div class="item-wrapper">\n	<a class="item-image" href="<%= item.getPosterUrl() %>">\n		<img src="<%= item.getPosterImageSrc() %>" />\n	</a>\n	<div class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n		<i class="icon icon-setting"></i>\n	</div>\n	<div class="item-headline">\n		<% if (item.getActionType()==\'post\' || item.getActionType()==\'feed_comment\') { %>\n			<%= item.getHeadline() %>\n			<span class="feed-icon-privacy-status icon-privacy-everyone gray"></span>\n		<% } else { %>\n			<a href="<%=item.getPosterUrl()%>"><%= item.getPosterTitle() %></a>\n            <span class="feed-icon-privacy-status <%= item.getPrivacyClass() %> gray"></span>\n			<!-- <span class="feed-icon-privacy-status icon-privacy-friends gray"></span>\n			<span class="feed-icon-privacy-status icon-privacy-friends-of-friends active"></span>\n			<span class="feed-icon-privacy-status icon-privacy-only-me"></span>\n			<span class="feed-icon-privacy-status icon-privacy-custom gray"></span> -->\n			<% if(item.getHeadline()) { %>\n				<p><%= item.getHeadline() %></p> \n			<% } %>	\n		<% } %>\n	</div>\n	<div class="item-subline">\n		<i class="icon icon-time"></i>\n		<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n	</div>\n	<% if(item.hasStory()){ %>\n	<div class="clearfix item-story">\n		<%= utils.str.shorten(item.getStory(), 200, true) %>\n	</div>\n	<% } %>\n	<% if(item.hasAttachment()){ %>\n	<div class="clear item-attachment">\n		\n	</div>\n	<% } %>\n	<div class="pvm"></div>\n	<div class="actions-justify gray">\n		<%if(item.canLike()) {%>\n		<div class="action-item <%= item.isLiked()?\' liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<i class="icon icon-activity-like"></i>\n			<span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>			\n		</div>\n        <%}%>\n		<% if(item.canComment()){%>\n		<div class="action-item"id="<%= item.getDataId(\'comment\') %>" rel="delegate">			\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>			\n		</div>\n		<%} %>\n		<% if(item.canShare()) { %>\n		<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n			<i class="icon icon-activity-share"></i>\n			<span class="text-label"><%= item.getShareCountLabel() %></span>\n		</div>\n		<%} %>\n	</div>\n</div>\n<div class="pvl"></div>\n'}),define("text!activity/tpl/activity-setting.html",[],function(){return'<div class="setting-list">\n	<div class="setting-item dislike-content">\n		<span class="you-like hide">You and </span>\n		<a href="#user/3">An Nguyen</a> and <a id="other-likes">2 others </a> disliked this\n	</div>\n	<a class="setting-item"><%= _t(\'Dislike\') %></a>\n<% if(item.canDelete()){ %>\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n		<%= _t(\'Delete this post\') %>\n	</a>\n<% } %>\n<% if (!item.isOwner()) { %>\n	<a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n		<%= _t(\'Report this post\') %>\n	</a>\n<% } %>\n</div>'}),define("activity/view/activity-setting",["text!activity/tpl/activity-setting.html"],function(e){return Backbone.PopupView.extend({template:_.template(e)})}),define("activity/view/activity-item",["text!activity/tpl/activity-item.html","activity/view/activity-setting"],function(e,t){return Backbone.ItemView.extend({className:"clearfix activity-item",template:_.template(e),attView:!1,settingView:t,events:{},render:function(){return this.$el.html(this.template({item:this.model,hasAttachment:this.model.hasAttachment()})),this.$el.attr("id",this.model.getDataId()),this},inject:function(e){e(this.$el);var t=this.model.hasAttachment();if(t){var n=utils.attachment.translate(this.model.getAttachmentType());n&&(this.attView=new n({model:this.model}),this.attView.render().inject(this.$el.find(".item-attachment")))}return this},doDeleteConfirm:function(e){var t=this;utils.popup.close(),utils.modal.confirm("Delete this post?",function(e){e==1&&t.doDelete()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},doDelete:function(){this.$el.addClass("hide"),utils.api.post("feed/delete",{iActionId:this.model.getId(),sParentId:this.model.getParentModuleId()},{context:this}).done(function(e){e.error_code>0?this.doDeleteFail():this.doDeleteSuccess()}).fail(function(){this.doDeleteFail()})},doDeleteFail:function(){this.$el.removeClass("hide")},doDeleteSuccess:function(){this.$el.remove()}})}),define("text!activity/tpl/activity-list.html",[],function(){return'<div class="loading-initiator">\n<!-- loading data...  -->\n</div>'}),define("activity/view/activity-list",["activity/model/feed","activity/view/activity-item","text!activity/tpl/activity-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:0,iAmountOfFeed:5,iMinId:0,iMaxId:0},followById:!0,api:"feed/fetch",phraseNotFound:_t("No activities found."),phraseNotMore:_t("No more activities."),className:"activity-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!activity/tpl/activity-minibar.html",[],function(){return'<div class="clearfix actions-justify gray large">\n    <%if(exclude.indexOf(\'status\') === -1) {%>\n    <a class="action-item" href="#activity/compose-status/<%=sItemType%>/<%=iItemId%>">\n		<i class="icon icon-post-status"></i> <%= _t(\'Status\') %>\n	</a>\n	<%}%>\n	\n	<%if(exclude.indexOf(\'photo\') === -1) {%>\n    <a class="action-item" href="#activity/compose-status-photo/<%=sItemType%>/<%=iItemId%>">\n		<i class="icon icon-post-photo"></i> <%= _t(\'Photo\') %>\n	</a>\n	<%}%>\n	\n	<%if(exclude.indexOf(\'checkin\') === -1) {%>\n    <a class="action-item" href="#activity/compose-status-checkin/<%=sItemType%>/<%=iItemId%>">\n		<i class="icon icon-post-checkin"></i><%= _t(\'Check In\') %>\n	</a>\n	<%}%>\n</div>'}),define("activity/view/activity-minibar",["text!activity/tpl/activity-minibar.html","core"],function(e){var t=require("core");return Backbone.View.extend({region:{main:"#activity_minibar_holder",content:"#content"},className:"activity-minibar",template:_.template(e),render:function(e){return this.context=$.extend({sItemType:"user",iItemId:t.viewer.getId(),exclude:[]},e),this.$el.html(this.template(this.context)),this},inject:function(){var e=$(this.region.main);e.html(this.el)}})}),define("text!user/tpl/user-basic-info.html",[],function(){return'<div class="user-profile-cover-image" style="background-image:url(<%= item.getCoverPhotoUrl() %>);">\n    <div class="clearfix jumptop"></div>\n    <div class="avatar">\n        <div class="img" style="background-image:url(<%= item.getBigImageSrc() %>);"></div>\n        <div id="friend-action-holder"> </div>\n    </div>\n    <div class="ipad-user-basic-info">\n        <div class="ipad-user-basic-info-mask">        	\n            <div class="name">\n        	    <span class="fullname">\n        	        <%= item.getTitle() %> 	        \n        	    </span>\n        	    <i class="<%= item.getGender().toLowerCase() %>"></i>\n        	</div>            \n            <div class="basic-contact-holder">\n                <div class="clearfix actions-justify fobos">\n                   <a class="action-item link" href="<%= item.getPhotoUrl() %>">\n                    <%= _t(\'PHOTO\') %> (<%= item.getTotalPhotos() %>)\n                   </a>\n                   <a class="action-item link" href="<%= item.getFriendUrl() %>">\n                    <%= _t(\'FRIEND\') %> (<%= item.getTotalFriends()%>)\n                   </a>\n                </div>\n            </div>\n        </div>\n    	<div class="user-information">\n            <% if(item.getBirthDate()) { %>\n                <span class="birthday">\n                    <i class="icon icon-gift"></i><%= item.getBirthDate() %>\n                </span>\n            <% } %>\n                \n            <% if(item.getFacebookContact()) { %>\n                <span class="facebook">\n                    <i class="icon icon-facebook-sign"></i><%= item.getFacebookContact() %>\n                </span>\n            <% } %>\n                \n            <% if(item.getWebsiteContact()) { %>\n                <span class="homepage">\n                    <i class="icon icon-globe"></i><%= item.getWebsiteContact() %>\n                </span>	    \n            <% } %>\n\n            <% if(item.getTwitterContact()) { %>\n                <span class="twitter">\n                    <i class="icon icon-twitter-sign"></i><%= item.getTwitterContact() %>	    \n                </span>\n            <% } %>\n    	</div>	\n        <% if(item.getAboutMe()) { %>\n            <div class="about-information">\n                <i class="icon icon-user-gray"></i><%= item.getAboutMe() %>\n            </div>	\n        <% } %>            \n    </div>\n</div>'}),define("text!user/tpl/friend-action-on-profile.html",[],function(){return'<div id="friend-action" class="<%=friendClass %>" clickable="true" data-click="friend:friend-action" data-friend="<%= item.getDataFriend() %>" ></div>\n'}),define("user/view/friend-action-on-profile",["text!user/tpl/friend-action-on-profile.html"],function(){var e=require("text!user/tpl/friend-action-on-profile.html"),t=Backbone.View.extend({initialize:function(){utils.observer.on("friend:action-done",this.handleFriendActionDone,this)},template:_.template(e),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template({item:this.context.item,friendClass:this.getFriendClass(this.context.item)})),this},getFriendClass:function(e){var t=e.isFriend(),n=e.isSentRequest(),r=e.isSentRequestBy(),i=e.get("isBlocked")||!1;return i?"add-friend":t?"remove-friend":n?"cancel-friend-request":r?"confirm-friend-request":"add-friend"},handleFriendActionDone:function(e){e.iItemId==this.context.item.getId()&&(this.context.item.set("isFriend",e.isFriend),this.context.item.set("isSentRequest",e.isSentRequest),this.context.item.set("isSentRequestBy",e.isSentRequestBy),this.render(this.context))}});return t}),define("user/view/user-basic-info",["text!user/tpl/user-basic-info.html","user/view/friend-action-on-profile"],function(e,t){return Backbone.View.extend({template:_.template(e),region:{wrapper:"#basic-info-holder"},initialize:function(){var e=this;this.model.on("change",function(){e.updateView()})},render:function(){return this.$el.html(this.template({item:this.model})),this.$friendAction=$("#friend-action-holder",this.$el),this.model.isOwner()||this.$friendAction.html((new t).render({item:this.model}).el),this},inject:function(){return $(this.region.wrapper).html(this.$el),this},updateView:function(){this.model.isOwner()||this.$friendAction.html((new t).render({item:this.model}).el)}})}),define("text!user/tpl/private-page.html",[],function(){return"<div class=\"private-page-message\">\n    <%= _t('You do not have permission to view this private page') %>\n</div>\n"}),define("user/view/private-page",["text!user/tpl/private-page.html"],function(e){return Backbone.View.extend({template:_.template(e),region:{main:"#user-profile-info"},render:function(){return this.$holder=$(this.region.holder),this},inject:function(){return this.$holder.html(this.$el),this}})}),define("text!user/tpl/user-topmenu.html",[],function(){return'<div class="setting-list">\n    <% if(item.isOwner()){%>\n    <a class="setting-item" href="#user-edit/<%= item.getId() %>">\n    	<%= _t(\'Edit Personal Info\') %>\n    </a>\n	<a class="menu-item" href="#user-edit-photo/<%= item.getId() %>"  ><%= _t(\'Edit Avatar\') %></a>\n	<a class="menu-item" href="#user-edit-cover/<%= item.getId() %>"  ><%= _t(\'Edit Cover\') %></a>\n    <% } else{ %>\n    <% if(item.isFriend()) { %>\n    <a class="setting-item" id="menu-friend" clickable="true" data-click="friend:friend-action" data-friend="<%= item.getDataFriend() %>" >\n    	<%= _t(\'Un-friend\') %>\n    </a>\n    <% } %>\n    <a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n    	<%= _t(\'Report\') %>\n    </a>\n    <a class="setting-item" id="<%= item.getDataId(\'block\') %>" rel="delegate">\n    	<%= _t(item.isBlocked()?\'Un-block\':\'Block\') %>\n    </a>	\n    <% }%>\n</div>\n'}),define("user/view/user-topmenu",["text!user/tpl/user-topmenu.html"],function(e){return Backbone.TopMenuView.extend({template:_.template(e)})}),define("user/view/user-detail-info",["text!user/tpl/user-detail-info.html","text!user/tpl/user-detail-info-update.html","activity/view/activity-list","activity/view/activity-minibar","user/view/user-basic-info","user/view/private-page","user/view/user-topmenu"],function(e,t){var n=require("activity/view/activity-list"),r=require("activity/view/activity-minibar"),i=require("user/view/user-basic-info"),s=require("user/view/private-page");return Backbone.ItemView.extend({region:{wrapper:"#main",scroller:"#content",infoHolder:"#user-profile-info",activityHolder:"#activity-list"},initialize:function(){this.model.on("change",this.updateMenu,this),Backbone.ItemView.prototype.initialize.apply(this,arguments)},events:{"click #menu_toggle":"toggleMenu",block:"onBlockClick"},moduleId:"user/view/user-detail-info",className:"user-profile-page",template:_.template(e),templateUpdate:_.template(t),topMenuView:require("user/view/user-topmenu"),render:function(e){return this.$el.html(this.template(e)),this.$scroller=this.$el.find(this.region.scroller),this.$infoHolder=this.$el.find(this.region.infoHolder),this.$activityHolder=this.$el.find(this.region.activityHolder),this.$menuBtn=this.$el.find("#menu_toggle"),this.$el.attr({id:this.model.getDataId()}),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},toggleMenu:function(e){utils.topMenu.toggle(this,this.model)},updateMenu:function(){},onBlockClick:function(e){var t=this,n=$(e.currentTarget);if(n.hasClass("processing"))return;var r=this.model.isBlocked(),i=r?_t("Do you want to un-block this member"):_t("Do you want to block this member"),s=r?"user/unblock":"user/block",o={iUserId:this.model.getId()};utils.modal.confirm(i,function(e){e===1&&(n.addClass("processing"),utils.api.post(s,o).done(function(e){utils.popup.close();if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));t.blockSuccess(e)}).always(function(){n.removeClass("processing")}))},_t("Confirm"),[_t("Ok"),_t("Cancel")])},blockSuccess:function(e){var t=!this.model.isBlocked();this.model.set({isBlocked:t,isFriend:!1,isSentRequest:!1,isSentRequestBy:!1}),this.toggleMenu(),utils.modal.toast(t?_t("Block successfully"):_t("Un-block successfully"))},fetchData:function(){var e={iUserId:this.model.getId()},t={context:this};utils.api.get("profile/detail",e,t).done(this.fetchDataDone).fail(this.fetchDataFail)},fetchDataDone:function(e){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;var t=e.BasicInfo;t.aContacts=e.Details,t.sAboutMe=e.About_Me?e.About_Me.About_Me:"",this.model.set(t),this.refreshView()},fetchDataFail:function(){utils.debug.error(arguments)},refreshView:function(){if(!this.model.canView()){this.$infoHolder.html(utils.helper.permission_deny());return}this.$menuBtn.removeClass("hide"),this.$infoHolder.html(this.templateUpdate({item:this.model})),(new i({model:this.model})).render().inject();var e=new Array;this.model.isOwner()||e.push("checkin"),(new r).render({sItemType:this.model.getType(),iItemId:this.model.getId(),exclude:e}).inject(),this.listView=new n({},this.$activityHolder,this.$scroller,{loadnew:!1,loadmore:!0}),this.listView.render({sItemType:this.model.getType(),iItemId:this.model.getId()}).inject(),this.$activityHolder.removeClass("hide")}})}),define("text!user/tpl/user-detail-photo.html",[],function(){return'<!-- friend/tpl/index.html-->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back"></div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Photos\') %>\n        </div>\n	</div>\n</div>\n\n<div class="content content-background with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list clearfix" id="photo_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item current" href="#user-photo/<%= item.getId() %>">\n        	<div class=""><%= _t(\'Photos\') %></div>\n        </a>\n        <a class="menu-item" href="#user-album/<%= item.getId() %>">\n        	<div class="sibling"><%= _t(\'Albums\') %></div>\n        </a>\n    </div>\n</div>\n'}),define("photo/model/photo",[],function(){var e=Backbone.Model.extend({idAttribute:"iPhotoId",defaults:{sModelType:"photo",bCanLike:!0,bCanShare:!0,bCanComment:!0}});return e.prototype.getType=function(){return this.get("sType")||this.get("sModelType")},e.prototype.getId=function(){return this.id||this.get("iId")},e.prototype.getPosterTitle=function(){return this.get("sUserName")||""},e.prototype.getPosterImageSrc=function(){return this.get("sUserImageUrl")||""},e.prototype.getImgSrc=function(){return this.get("sPhotoUrl")||this.get("sPhoto_Url")},e.prototype.getUrl=function(){return"#photo-detail/"+(this.getParentType()?this.getParentType():this.getType())+"/"+this.getParentId()+"/"+this.getId()},e.prototype.getParentId=function(){return this.get("iObjectParentId")||this.get("iParentId")||this.get("iAlbumId")||this.get("iEventId")||0},e.prototype.getUrlWithAlbum=function(){return"#photo-detail/"+this.getType()+"/"+this.getAlbumId()+"/"+this.getId()},e.prototype.getAlbumId=function(){return this.get("iAlbumId")||0},e.prototype.getResizedImageUrl=function(){return this.get("resizedImageUrl")},e.prototype.isShowInfo=function(){return this.get("isShowInfo")!==void 0?this.get("isShowInfo"):!0},e.prototype.getAlbumTitle=function(){return this.get("sAlbumName")||this.get("sAlbumTitle")},e.prototype.getAlbumType=function(){return this.get("sAlbumType")||this.getParentType()},e.prototype.getAlbumUrl=function(){return"#photo-album-detail/"+this.getAlbumType()+"/"+this.getAlbumId()},e.prototype.hasAlbum=function(){return this.getAlbumId()>0?!0:!1},e}),define("text!photo/tpl/photo-item.html",[],function(){return'<!-- friend/tpl/friend-item -->\n<div class="item-wrapper">\n	<a href="<%= item.getUrl() %>" class="item-image" style="background-image: url(<%= item.getImgSrc() %>)"></a>\n	<div class="item-footer">\n		<div class="item-stats <%= item.isLiked() ? \'liked\': \'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<span><%= item.getLikeCount() %></span>\n			<i class="icon icon-activity-like-white"></i>\n		</div>\n		<div class="item-footer-author">\n			<a class="item-poster-link" href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %> </a>\n			<div class="item-posted-date">\n				<i class="icon icon-time"></i>\n				<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n			</div>\n		</div>\n		<a class="item-poster-image" href="<%= item.getPosterUrl() %>" class="footer-author-image" style="background-image:url(<%= item.getPosterImageSrc() %>)";></a>\n	</div>			\n</div>\n'}),define("text!photo/tpl/photo-item-in-profile.html",[],function(){return'<div class="item-wrapper">\n	<a href="<%= item.getUrl() %>" class="item-image" style="background-image: url(<%= item.getImgSrc() %>)">\n	</a>\n</div>\n'}),define("photo/ipad/view/photo-item",["text!photo/tpl/photo-item-in-profile.html"],function(){var e=require("text!photo/tpl/photo-item-in-profile.html");return{templateInProfile:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.model.getType()=="profile_photo"||this.model.getType()=="event_photo"?this.$el.html(this.templateInProfile({item:this.model})):this.$el.html(this.template({item:this.model})),this}}}),define("photo/view/photo-item",["text!photo/tpl/photo-item.html","photo/ipad/view/photo-item"],function(e){return Backbone.ItemView.extend({events:{},className:"photo-item",moduleId:"photo/view/photo-item",template:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!photo/tpl/photo-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- loading -->\n</div>'}),define("photo/view/photo-list",["photo/model/photo","photo/view/photo-item","text!photo/tpl/photo-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iInDetails:1,sOrder:"latest",iAmountOfPhoto:12},followById:!1,api:"photo/filter",phraseNotFound:"No photos found.",phraseNotMore:"No more photos.",className:"clearfix photo-list",template:_.template(n),itemModel:e,itemView:t,parseData:function(e,t){var n=this;return e.map(function(e){return n.settings.iParentId!=void 0&&(e.iParentId=parseInt(n.settings.iParentId,10)),n.settings.sParentType!=void 0&&(e.sParentType=n.settings.sParentType),new t(e)})}})}),define("user/view/user-detail-photo",["text!user/tpl/user-detail-photo.html","photo/view/photo-list"],function(e,t){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content",photoListHolder:"#photo_list_view_holder"},template:_.template(e),render:function(e){return this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.scroller),this.$photoListHolder=this.$el.find(this.region.photoListHolder),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$photoListHolder,this.$scroller,{iParentId:this.model.getId(),sParentType:"profile_photo"}),this.listView.render({bIsUserProfile:!0,iUserId:this.model.getId()}).inject(),this}})}),define("text!user/tpl/user-detail-album.html",[],function(){return'<!-- friend/tpl/index.html-->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back"></div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Albums\') %>\n        </div>\n	</div>\n</div>\n\n<div class="content content-background with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list clearfix" id="photo_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item" href="#user-photo/<%= item.getId() %>">\n        	<div class=""><%= _t(\'Photos\') %></div>\n        </a>\n        <a class="menu-item current " href="#user-album/<%= item.getId() %>">\n        	<div class="sibling"><%= _t(\'Albums\') %></div>\n        </a>\n    </div>\n</div>\n'}),define("photo/model/album",["photo/model/photo"],function(){var e=require("photo/model/photo"),t=Backbone.Model.extend({idAttribute:"iAlbumId",defaults:{sModelType:"photo_album",bCanLike:!0,bCanComment:!0}});return t.prototype.getTitle=function(){return this.get("sName")||this.get("sTitle")},t.prototype.getPosterTitle=function(){return this.get("sUserName")},t.prototype.getPosterImageSrc=function(){return this.get("sUserImageUrl")||""},t.prototype.getImageSrc=function(){return this.get("sAlbumImageURL")},t.prototype.getPhotoCount=function(){return this.get("iTotalPhoto")||0},t.prototype.getPhotoCountText=function(){var e=this.getPhotoCount(),t=e+(e==1?" photo":" photos");return t},t.prototype.getSamplePhotos=function(){var t=this.get("aSamplePhotos"),n=[];_.each(t,function(t){t.sModelType="photo",t.resizedImageUrl=constants.siteUrl+"/wideimage/resize.php?src="+_.escape(t.sPhotoUrl)+"&w=320&h=177",t.iAlbumId=this.getId();var r=new e(t);n.push(r)},this);var r=utils.setting.get("mfox_limit_photo_to_scroll");return r>0&&(n=n.slice(0,r)),n},t.prototype.canShare=function(){this.get("bCanShare")?!0:!1},t.prototype.getUrl=function(){return"#photo-album-detail/"+this.getType()+"/"+this.getId()},t}),define("text!photo/tpl/album-item.html",[],function(){return'<!-- photo/tpl/album-item -->\n<div class="item-wrapper">\n	<div class="swiper-container">\n		<div class="swiper-wrapper">\n			<% _.each(item.getSamplePhotos(), function(sample){ %>\n			<div class="swiper-slide item-image" style="background-image: url(<%= sample.getResizedImageUrl() %>)" rel="link" data-url="<%= sample.getUrl() %>"></div>\n			<%}); %>\n		</div>\n	</div>\n	<div class="item-header">\n		<div class="item-headline" rel="link" data-url="<%= item.getUrl() %>">\n			<%= item.getTitle() %>\n		</div>\n	</div>\n	<div class="item-footer">\n		<div class="item-stats" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n			<i class="icon icon-activity-share-white"></i>\n		</div>\n		<div class="item-stats" id="<%= item.getDataId(\'comment\') %>" rel="delegate">\n			<span><%= item.getCommentCount() %></span>\n			<i class="icon icon-activity-comment-white"></i>\n		</div>\n		<div class="item-stats next <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<span><%= item.getLikeCount() %></span>\n			<i class="icon icon-activity-like-white"></i>\n		</div>\n		<a class="item-poster-link" href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n		<div class="item-posted-date">\n			<i class="icon icon-time"></i>\n			<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n		</div>\n		<a href="<%= item.getPosterUrl() %>" class="item-poster-image" style="background-image:url(<%= item.getPosterImageSrc() %>)";></a>\n	</div>\n</div>'}),define("photo/view/album-item",["text!photo/tpl/album-item.html"],function(e){return Backbone.ItemView.extend({className:"photo-album-item",moduleId:"photo/view/album-item",template:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},events:{},inject:function(e){e(this.$el);var t=this.$el.find(".item-wrapper").first().width();this.$el.find(".item-image").css({width:t});var n=this.$el.find(".swiper-container");n.swiper({scrollContainer:!1,mode:"horizontal",slidesPerView:"auto",slidesPerViewFit:!0,visibilityFullFit:!0})}})}),define("text!photo/tpl/album-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading ...  -->\n</div>'}),define("text!photo/tpl/album-my-item.html",[],function(){return'<!-- photo/tpl/album-item -->\n<div class="item-wrapper">\n	<div class="swiper-container">\n		<div class="swiper-wrapper">\n			<% _.each(item.getSamplePhotos(), function(sample){ %>\n			<div class="swiper-slide item-image" style="background-image: url(<%= sample.getResizedImageUrl() %>)" rel="link" data-url="<%= sample.getUrl() %>"></div>\n			<%}); %>\n		</div>\n	</div>\n	<div class="item-header">\n		<div class="item-headline" rel="link" data-url="<%= item.getUrl() %>">\n			<%= item.getTitle() %>\n		</div>\n	</div>\n	<div class="item-footer">\n		<div class="item-stats <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<span><%= item.getLikeCount() %></span>\n			<i class="icon icon-activity-like-white"></i>\n		</div>\n		<div class="item-stats" id="<%= item.getDataId(\'comment\') %>" rel="delegate">\n			<span><%= item.getCommentCount() %></span>\n			<i class="icon icon-activity-comment-white"></i>\n		</div>\n		<div class="item-posted-date">\n			<i class="icon icon-time"></i>\n			<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n		</div>\n		<div class="item-stats" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n			<i class="icon icon-activity-share-white"></i>\n		</div>\n	</div>\n	<% if(item.isOwner()) {%>\n        <div class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n            <span class="icon icon-setting"></span>\n        </div>\n    <% } %>\n</div>'}),define("text!photo/tpl/album-item-setting.html",[],function(){return'<div class="setting-list">\n    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'edit\') %>">\n    	<%= _t(\'Edit\') %>\n    </a>\n    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n    	<%= _t(\'Delete\') %>\n    </a>\n</div>\n\n\n'}),define("photo/view/album-item-setting",["text!photo/tpl/album-item-setting.html"],function(){var e=require("text!photo/tpl/album-item-setting.html"),t=Backbone.View.extend({template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(){return utils.popup.open(this.$el),this}});return t}),define("photo/view/album-my-item",["text!photo/tpl/album-my-item.html","photo/view/album-item-setting"],function(e,t){return Backbone.ItemView.extend({className:"photo-my-album-item",template:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.attr("data-albumid",this.model.getId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.$el);var t=this.$el.find(".item-wrapper").first().width();this.$el.find(".item-image").css({width:t});var n=this.$el.find(".swiper-container");n.swiper({scrollContainer:!0,mode:"horizontal",slidesPerView:"auto"})},events:{edit:"editAlbum"},settingView:t,editAlbum:function(e){window.location.href="#photos/edit-album/"+this.model.getId()},doDeleteConfirm:function(e){var t=this,n=$(e.currentTarget);if(n.hasClass("processing"))return;utils.modal.confirm(_t("Do you want to delete this album?"),function(e){e===1&&(n.addClass("processing"),utils.api.post("photo/albumdelete",{iAlbumId:t.model.getId()}).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));t.deleteSuccess(e)}).always(function(){n.removeClass("processing")}))},_t("Confirm"),[_t("Ok"),_t("Cancel")])},deleteSuccess:function(e){utils.modal.toast(_t("The album has been deleted successfully.")),this.$el.remove(),utils.popup.close()}})}),define("photo/ipad/view/album-list",["photo/view/album-item","photo/view/album-my-item"],function(){var e=require("photo/view/album-item"),t=require("photo/view/album-my-item");return{init:function(n){document.URL.match("user-album")?this.itemView=t:this.itemView=e}}}),define("photo/view/album-list",["photo/model/album","photo/view/album-item","text!photo/tpl/album-list.html","photo/ipad/view/album-list"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"",iPage:1,sSearch:"",sOrder:"latest",iCategoryId:0,iAmountOfAlbum:8},moduleId:"photo/view/album-list",followById:!1,api:"photo/filter_album",phraseNotFound:"No albums found.",phraseNotMore:"No more albums.",className:"photo-album-list",template:_.template(n),itemModel:e,itemView:t})}),define("user/view/user-detail-album",["text!user/tpl/user-detail-album.html","photo/view/album-list"],function(e,t){return Backbone.PolyplatformView.extend({template:_.template(e),region:{wrapper:"#main",scroller:"#content",albumListHolder:"#photo_list_view_holder"},render:function(){return this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.scroller),this.$albumListHolder=this.$el.find(this.region.albumListHolder),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$albumListHolder,this.$scroller,{}),this.listView.render({bIsUserProfile:!0,iUserId:this.model.getId()}).inject(),this}})}),define("user/controller/user-detail",["user/model/user","user/view/user-detail-info","user/view/user-detail-photo","user/view/user-detail-album"],function(e,t,n,r){function i(n){var r=utils.history._data.length==0&&n==Backbone.iUserId;utils.history.push(r),utils.observer.trigger("router:changed"),(new t({model:new e({iUserId:n})})).render({bIsRoot:r}).inject()}function s(t){utils.history.push(),utils.observer.trigger("router:changed"),(new n({model:new e({iUserId:t})})).render().inject()}function o(t){utils.history.push(),utils.observer.trigger("router:changed"),(new r({model:new e({iUserId:t})})).render().inject()}utils.router.route("user-photo/:id",s),utils.router.route("user-album/:id",o),utils.router.route("user/:id(/:action)",i)}),define("user/plugin/signup-data",["core"],function(){var e={sUserName:"",sFullName:"",sEmail:"",sPassword:"",sTimeZone:0,sFirstName:"",sLastName:"",iGender:"",sBirthday:"",sFacebook:"",sTwitter:"",sAim:"",sAbout:"",sLoginBy:null,sLoginUID:null,sCoordinates:"",iWidth:"",iHeight:"",sImgSrc:"",bIsAgreeTerms:!1},t=function(){this.all=e};return t.prototype.reset=function(){return this.all=e,this},t.prototype.update=function(e){return this.all=$.extend({},this.all,e),this},new t}),define("user/plugin/social-connect",["user/plugin/signup-data","user/model/user","core"],function(){var e=require("user/plugin/signup-data"),t=require("user/model/user"),n=require("core"),r=function(e,t){this._type=e,this._connect_url=encodeURI(t),this._id=null,this._token=null,this._token_secret=null};return r.prototype={connect:function(){var e="",t="",n=this;window.localStorage.setItem("sLoginBy",n._type);var r=window.open(encodeURI(n._connect_url),"_blank","location=no, status=no");r.addEventListener("loadstop",function(i){var s=decodeURI(i.url);utils.debug.log("Callback URL: "+s);switch(n._type){case"facebook":e=/[\?\&]access_token=([^&]+)/.exec(s);var o=/\?error=(.+)$/.exec(s);utils.debug.log(e),e&&(r.close(),n._token=e[1],n.getFacebookProfile()),o&&navigator.notification.alert(n._type+" connect error: "+JSON.stringify(o));break;case"twitter":e=/[\?\&]access_token=([^&]+)/.exec(s),t=/[\?\&]secret_token=([^&]+)/.exec(s),json_data=/[\?\&]json_data=([^&]+)/.exec(s),o=/\?error=(.+)$/.exec(s);if(e&&t){r.close(),n._token=e[1],n._token_secret=t[1];var u=JSON.parse(decodeURIComponent(json_data[1]));if(u.id){n._id=u.id;var a=u.name.split("+"),f={id:u.id,email:"",first_name:a[0],last_name:a[1],username:u.screen_name};n.processLogin(f)}}o&&navigator.notification.alert(n._type+" connect error: "+JSON.stringify(o));break;case"linkedin":break;default:}})},getFacebookProfile:function(){utils.debug.log(this);var e=this;$.ajax({url:"https://graph.facebook.com/me",data:{access_token:this._token},dataType:"json",success:function(t){e.processLogin(t)},error:function(e){navigator.notification.alert(JSON.stringify(e)),errorCallback(e)}})},getTwitterProfile:function(){},quickLogin:function(e){constants.token=e.token,n.viewer.set(e),localStorage.setItem("token",e.token),localStorage.setItem("viewer",JSON.stringify(e)),window.location.href="#newsfeed",window.location.reload()},processLogin:function(n){var r="user/login",i={sLoginBy:this._type,sEmail:n.email,sLoginUID:n.id,sAccessToken:this._token,sSecretToken:this._token_secret},s=this;console.log(JSON.stringify(n)),utils.api.post(r,i).done(function(r){if(r==null){navigator.notification.alert("Cannot connect to server");return}if(r.token!=null)s.quickLogin(r);else{utils.modal.toast("This account does not exists, please create a new one.");var i=new t(n);e.update({sFirstName:i.getFirstName(),sFullName:i.getFirstName()+" "+i.getLastName(),sUserName:i.getUserName(),sEmail:i.getEmail(),sLastName:i.getLastName(),iGender:n.gender=="male"?1:n.gender=="female"?0:2,sLoginUID:i.getId(),sAccessToken:s._token,sSecretToken:s._token_secret,sFacebook:n.link,sLoginBy:s._type}),window.location="#signup"}})}},r}),define("text!user/tpl/user-login.html",[],function(){return'<div class="ipad-user-login-mask"></div>\n<div class="ipad-user-login-area">\n	<div class="content swiper-container" id="content">\n		<div class="swiper-wrapper">\n			<div class="swiper-slide" data-url="1">\n				<div class="login-logo"></div>\n\n				<div class="login-form" id="login-form">\n					<div class="form-group">\n						<input class="control-full" type="email" id="email" name="email" placeholder="<%= _t(\'Email Address\') %>" />\n					</div>					\n\n					<div class="form-group">\n						<input class="control-full" type="password" id="password" name="password" placeholder="<%= _t(\'Password\') %>" />\n					</div>\n\n					<div class="form-group">\n						<button type="button" id="btn-login" class="btn btn-success btn-large-fluid"><%= _t(\'Sign In\') %></button>\n					</div>\n\n					<div class="form-group form-group-flex">\n						<div id="login_by_facebook_btn" class="btn btn-facebook btn-small-fluid" >Facebook</div>\n			    		<div id="login_by_twitter_btn" class="btn btn-twitter btn-small-fluid">Twitter</div>\n					</div>\n					\n					<div class="form-group form-group-border-signup">\n						<a href="#signup" class="btn btn-danger btn-large-fluid" id="btn-signup"><%= _t(\'Sign Up\') %></a>\n					</div>\n				</div>\n\n				<div class="signing-in">\n					<div class="loading-image"></div>\n					<div class="loading-content"><%= _t(\'Signing In ...\') %></div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class="footer footer-fixed">\n		<a href="#forgot-password" id="forgot-password"><%= _t(\'Forgot password?\') %></a>	\n	</div>\n</div>'}),define("user/view/user-login",["core","user/plugin/social-connect","text!user/tpl/user-login.html"],function(e,t,n){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content",form:"#login-form"},className:"page user-login-page",template:_.template(n),doLogin:function(t){var n=$(t.currentTarget),r=$(this.region.form),i=$(this.el);if(r.data("lock"))return;var s=r.find("#email").val(),o=r.find("#password").val();if(!s){utils.modal.alert("Email is empty!");return}if(!utils.validator.isEmail(s)){utils.modal.alert("Please enter a valid email address");return}if(!o){utils.modal.alert("Password is empty!");return}var u={sEmail:s,sPassword:o};r.data("lock",!0),i.addClass("signin-loading"),utils.observer.trigger("blockui"),utils.api.get("user/login",u).done(function(t){t.hasOwnProperty("token")&&t.hasOwnProperty("user_id")?(utils.debug.log("user logged in",t),constants.token=t.token,e.viewer.set(t),localStorage.setItem("token",t.token),localStorage.setItem("viewer",JSON.stringify(t)),$.ajaxSetup({headers:{token:t.token}}),utils.observer.trigger("user:login",t),window.location.href=constants.home):utils.modal.alert(t.error_message)}).fail(function(e){utils.debug.log(arguments)}).always(function(e){i.removeClass("signin-loading"),utils.observer.trigger("releaseui"),n.text("Sign In"),r.data("lock",!1)})},render:function(e){this.$el.html(this.template(e));var t=Math.max(window.screen.height/window.devicePixelRatio,window.innerHeight);return this.$el.find(".footer").css({top:t-67}),this.$el.css({"min-height":t}),this.$scroller=this.$el.find(this.region.scroller),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this},events:{"click #btn-login":"doLogin","click #login_by_facebook_btn":"loginByFacebook","click #login_by_twitter_btn":"loginByTwitter"},loginByFacebook:function(){var e=new t("facebook","social-connect-facebook.html");e.connect()},loginByTwitter:function(){var e=new t("twitter","social-connect-twitter.html");e.connect()}})}),define("user/controller/user-login",["user/view/user-login"],function(e){function t(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({}).inject()}utils.router.route("login",t)}),define("user/controller/user-logout",["user/view/user-login"],function(e){function t(){utils.history.clear(),utils.history.push(),utils.observer.trigger("router:changed"),utils.observer.trigger("user:logout"),localStorage.setItem("user.viewer",""),localStorage.setItem("token",""),constants.token="",utils.api.setup({token:null}),window.location.href="#login"}utils.router.route("logout",t)}),define("text!user/tpl/user-signup-step-01.html",[],function(){return'<!-- user/tpl/signup/step01 -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" id="cancel_btn">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="btn-next">\n			<%= _t(\'Next\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title"><%= _t(\'Create Account\') %></div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="form-general" id="signup-form">\n				<div class="form-title">\n					<%= _t(\'Personal information\') %>\n				</div>\n\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-username" name="username" placeholder="<%= _t(\'Username\') %>" value="<%= data.sUserName %>"  />\n				</div>\n\n				<div class="form-group">\n					<input type="email" class="control-full" id="signup-email" name="email" placeholder="<%= _t(\'Email\') %>" value="<%= data.sEmail %>"  />\n				</div>\n\n				<div class="form-group">\n					<input type="password" class="control-full" id="signup-password" name="password" placeholder="<%= _t(\'Password\') %>" value="<%= data.sPassword %>"  />\n				</div>\n\n				<div class="form-group">\n					<input type="password" class="control-full" id="signup-confirm" name="password_confirm" placeholder="<%= _t(\'Confirm password\') %>" value="<%= data.sPassword %>" />\n				</div>\n\n				<div class="form-group">\n					<select name="timezone" class="control-full" id="signup-timezone" value="<%= data.sTimeZone %>">\n						<option number="-8.00" value="US/Pacific">(UTC-8) Pacific Time (US &amp; Canada)</option>\n						<option number="-7.00" value="US/Mountain">(UTC-7) Mountain Time (US &amp; Canada)</option>\n						<option number="-6.00" value="US/Central">(UTC-6) Central Time (US &amp; Canada)</option>\n						<option number="-5.00" value="US/Eastern">(UTC-5) Eastern Time (US &amp; Canada)</option>\n						<option number="-4.00" value="America/Halifax">(UTC-4)  Atlantic Time (Canada)</option>\n						<option number="-9.00" value="America/Anchorage">(UTC-9)  Alaska (US &amp; Canada)</option>\n						<option number="-10.00" value="Pacific/Honolulu">(UTC-10) Hawaii (US)</option>\n						<option number="-11.00" value="Pacific/Samoa">(UTC-11) Midway Island, Samoa</option>\n						<option number="-12.00" value="Etc/GMT-12">(UTC-12) Eniwetok, Kwajalein</option>\n						<option number="-3.30" value="Canada/Newfoundland">(UTC-3:30) Canada/Newfoundland</option>\n						<option number="-3.00" value="America/Buenos_Aires">(UTC-3) Brasilia, Buenos Aires, Georgetown</option>\n						<option number="-2.00" value="Atlantic/South_Georgia">(UTC-2) Mid-Atlantic</option>\n						<option number="-1.00" value="Atlantic/Azores">(UTC-1) Azores, Cape Verde Is.</option>\n						<option number="0.00" value="Europe/London">Greenwich Mean Time (Lisbon, London)</option>\n						<option number="1.00" value="Europe/Berlin">(UTC+1) Amsterdam, Berlin, Paris, Rome, Madrid</option>\n						<option number="2.00" value="Europe/Athens">(UTC+2) Athens, Helsinki, Istanbul, Cairo, E. Europe</option>\n						<option number="3.00" value="Europe/Moscow">(UTC+3) Baghdad, Kuwait, Nairobi, Moscow</option>\n						<option number="3.30" value="Iran">(UTC+3:30) Tehran</option>\n						<option number="4.00" value="Asia/Dubai">(UTC+4) Abu Dhabi, Kazan, Muscat</option>\n						<option number="4.30" value="Asia/Kabul">(UTC+4:30) Kabul</option>\n						<option number="5.00" value="Asia/Yekaterinburg">(UTC+5) Islamabad, Karachi, Tashkent</option>\n						<option number="5.30" value="Asia/Calcutta">(UTC+5:30) Bombay, Calcutta, New Delhi</option>\n						<option number="5.45" value="Asia/Katmandu">(UTC+5:45) Nepal</option>\n						<option number="6.00" value="Asia/Omsk">(UTC+6) Almaty, Dhaka</option>\n						<option number="6.30" value="Indian/Cocos">(UTC+6:30) Cocos Islands, Yangon</option>\n						<option number="7.00" value="Asia/Krasnoyarsk">(UTC+7) Bangkok, Jakarta, Hanoi</option>\n						<option number="8.00" value="Asia/Hong_Kong">(UTC+8) Beijing, Hong Kong, Singapore, Taipei</option>\n						<option number="9.00" value="Asia/Tokyo">(UTC+9) Tokyo, Osaka, Sapporto, Seoul, Yakutsk</option>\n						<option number="9.30" value="Australia/Adelaide">(UTC+9:30) Adelaide, Darwin</option>\n						<option number="10.00" value="Australia/Sydney">(UTC+10) Brisbane, Melbourne, Sydney, Guam</option>\n						<option number="11.00" value="Asia/Magadan">(UTC+11) Magadan, Solomon Is., New Caledonia</option>\n						<option number="12.00" value="Pacific/Auckland">(UTC+12) Fiji, Kamchatka, Marshall Is., Wellington</option>\n					</select>\n				</div>\n				<div class="form-group sigup_agree_term">\n					<input id="term-condition-checkbox" type="checkbox" <% if(data.bIsAgreeTerms) print(\'checked="checked"\') %>" />\n                    <%= _t(\'Read and agree with\') %> <a href="javascript:void(0)" id="term-condition-link"> <%= _t(\'Term & Service\') %> </a>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("text!user/tpl/term-condition.html",[],function(){return'<div class="term-condition">\n	<div class="term-condition-title popup-title">\n		<div class="btn-close-popup" id="btn-close-term-condition"></div>\n		<%= _t(\'Term & Service\') %>\n	</div>\n	<div id="term-condition-content" class="term-condition-content swiper-container native-vscroll">\n		<div class="swiper-wrapper">\n			<div class="swiper-slide" id="term_and_condition_content_holder">\n			    <div class="loading-initiator">\n						\n			    </div> 		\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("user/view/term-condition",["text!user/tpl/term-condition.html"],function(e){return Backbone.View.extend({template:_.template(e),events:{"click #btn-close-term-condition":"closePopup"},region:{scroller:"#popup-content",holder:"#term_and_condition_content_holder"},render:function(){this.$el.html(this.template()),this.$holder=this.$el.find(this.region.holder);var e={context:this,beforeSend:this.beforeSend};return utils.api.post("user/signup_term",{},e).done(this.postDone).always(this.postComplete),this},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){$(this.region.holder).html(e.message)},inject:function(){return utils.popup.open(this.$el),this.$scroller.ensureVerticalScroll(),this},closePopup:function(){utils.popup.close()}})}),define("user/view/user-signup-step-01",["text!user/tpl/user-signup-step-01.html","user/plugin/signup-data","user/view/term-condition"],function(e,t){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content"},termConditionView:require("user/view/term-condition"),events:{"click #cancel_btn":"onCancelClick","click #btn-next":"goNext","click #term-condition-link":"showTermCondition","click #signup-birthday":"handleDates"},template:_.template(e),goNext:function(e){var n=$(e.currentTarget);if(n.hasClass("processing"))return;var r=this.$el,i=r.find("#signup-fullname").val(),s=r.find("#signup-email").val(),o=r.find("#signup-password").val(),u=r.find("#signup-confirm").val(),a=r.find("#signup-gender").val(),f=r.find("#signup-birthday").val(),l=r.find("#term-condition-checkbox").is(":checked"),c=r.find("#signup-username"),h=r.find("#signup-password"),p=r.find("#signup-confirm"),d=r.find("#signup-email"),v=r.find("#signup-birthday");h.removeClass("error"),p.removeClass("error"),d.removeClass("error"),v.removeClass("error");if(!i){c.addClass("error"),utils.modal.alert(_t("Fullname can not be empty!"));return}if(!s){d.addClass("error"),utils.modal.alert(_t("Email can not be null!"));return}if(!utils.validator.isEmail(s)){d.addClass("error"),utils.modal.alert(_t("Email is not valid!"));return}if(!o){h.addClass("error"),utils.modal.alert(_t("Password can not be empty!"));return}if(o.indexOf(" ")>-1){h.addClass("error"),utils.modal.alert(_t("Password should not contain space"));return}if(o.length<6){h.addClass("error"),utils.modal.alert(_t("Password must be longer than 6"));return}if(!u||u!=o){p.addClass("error"),utils.modal.alert(_t("Password does not match"));return}if(!l){utils.modal.alert(_t("You must agree to the terms of service to continue"));return}t.update({sEmail:s,sPassword:o,sFullName:i,iGender:a,sBirthday:f,bIsAgreeTerms:l}),n.addClass("processing");var m=utils.api.post("user/signup_check_email",{sEmail:s});$.when(m).done(function(e){if(e.error_code>0){utils.modal.alert(e.error_message),d.addClass("error");return}window.location.href="#signup/step03"}).always(function(){n.removeClass("processing")})},render:function(e){var n=this;return this.$el.html(this.template({data:t.all})),this.$scroller=this.$el.find(this.region.scroller),this.$input_eles=$("input",this.$el),this.$input_eles.each(function(){$(this).bind("input propertychange",function(){n.toggleBtn()})}),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this},showTermCondition:function(e){(new this.termConditionView).render().inject()},toggleBtn:function(){var e=!0;this.$input_eles.each(function(){$(this).attr("type")!="checkbox"&&$(this).val()!=""&&(e=!1)}),$("#btn-next").toggleClass("disabled",e)},onCancelClick:function(){utils.modal.confirm(_t("No account will be created if you cancel this screen"),function(e){e==1&&(t.reset(),window.location.href="#login")},_t("Confirm"),[_t("Ok"),_t("Cancel")])},handleDates:function(e){constants.platform=="android"?this.handleDatesAndroid(e):this.handleDatesiOS(e)},handleDatesiOS:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n));var r=utils.setting.get("user_date_of_birth_start"),i=utils.setting.get("user_date_of_birth_end"),s=new Date(r,0,1,0,0,0),o=new Date(i,11,31,23,59,59);datePicker.show({date:n,minDate:s,maxDate:o,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);n.getTime()>o.getTime()?n=o:n.getTime()<s.getTime()&&(n=s),t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},handleDatesAndroid:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n));var r=utils.setting.get("user_date_of_birth_start"),i=utils.setting.get("user_date_of_birth_end"),s=Date.parse(r+"/01/01 00:00:00"),o=Date.parse(i+"/12/31 23:59:59");datePicker.show({date:n,minDate:s,maxDate:o,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);n.getTime()>o?n.setTime(o):n.getTime()<s&&n.setTime(s),t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})}})}),define("text!user/tpl/user-signup-step-02.html",[],function(){return'<!-- user/tpl/signup/step02 -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" id="cancel_btn">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="btn-next">\n			<%= _t(\'Next\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'General Information\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="form-general" id="signup-form">\n				<!-- form content -->\n				<div class="form-title">\n					<%= _t(\'Personal information\') %>\n				</div>\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-firstname" name="firstname" placeholder="<%= _t(\'First Name\') %>" value="<%= data.sFirstName %>"/>\n				</div>\n\n				<div class="form-group">\n					<input type="text"  class="control-full"id="signup-lastname" name="lastname" placeholder="<%= _t(\'Last Name\') %>" value="<%= data.sLastName %>"/>\n				</div>\n\n				<div class="form-group">\n					<select id="signup-gender" class="control-full" name="gender" value="<%= data.iGender %>">\n						<option value=""><%= _t(\'Select Gender\') %></option>\n                        <option value="1" <% if (parseInt(data.iGender, 10) === 1) print(\'selected="selected"\') %> ><%= _t(\'Male\') %></option>\n						<option value="0" <% if (parseInt(data.iGender, 10) === 0) print(\'selected="selected"\') %> ><%= _t(\'Female\') %></option>\n					</select>\n				</div>\n\n				<div class="form-group group-span-inline clearfix" id="form_input_birthday">\n					<span id="label_birthday"><%= _t(\'Birthday\') %></span>\n					<input class="pull-right" type="date" id="signup-birthday" value="<%= data.sBirthday %>"/>\n				</div>\n\n				<div class="form-title">\n					<%= _t(\'Contact information\') %>\n				</div>\n\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-website" name="website" placeholder="Website" value="<%= data.sWebsite %>"/>\n				</div>\n\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-facebook" name="facebook" placeholder="Facebook" value="<%= data.sFacebook %>"/>\n				</div>\n\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-twitter" name="twitter" placeholder="Twitter" value="<%= data.sTwitter %>"/>\n				</div>\n\n				<div class="form-group">\n					<input type="text" class="control-full" id="signup-aim" name="aim" placeholder="AIM" value="<%= data.sAim %>"/>\n				</div>\n				\n				<div class="form-title">\n					<%= _t(\'About me\') %>\n				</div>\n				\n				<div class="form-group">\n					<textarea name="aboutme" id="signup-about" class="control-full textarea" placeholder="<%= _t(\'About me\') %>"><%= data.sAbout %></textarea>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("user/view/user-signup-step-02",["text!user/tpl/user-signup-step-02.html","user/plugin/signup-data"],function(e,t){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content"},events:{"click #cancel_btn":"onCancelClick","click #btn-next":"goNext","click #form_input_birthday":"focusBirthday","click #signup-birthday":"handleDates"},template:_.template(e),goNext:function(){var e=this.$el,n=e.find("#signup-firstname").val(),r=e.find("#signup-lastname").val(),i=e.find("#signup-gender").val(),s=e.find("#signup-website").val(),o=e.find("#signup-facebook").val(),u=e.find("#signup-twitter").val(),a=e.find("#signup-aim").val(),f=e.find("#signup-about").val(),l=e.find("#signup-birthday").val(),c=e.find("#signup-firstname"),h=e.find("#signup-lastname"),p=e.find("#signup-gender");c.removeClass("error"),h.removeClass("error"),p.removeClass("error");if(!n.trim()){c.addClass("error"),utils.modal.alert("First Name can not be empty!");return}if(!r.trim()){h.addClass("error"),utils.modal.alert("Last Name can not be empty!");return}t.update({sFirstName:n,sLastName:r,iGender:i,sWebsite:s,sFacebook:o,sTwitter:u,sAim:a,sAbout:f,sBirthday:l}),window.location.href="#signup/step03"},render:function(e){var n=this;return this.context=$.extend({},e),this.$el.html(this.template({data:t.all})),this.$scroller=this.$el.find(this.region.scroller),this.$input_eles=$("input",this.$el),this.$input_eles.each(function(){$(this).bind("input propertychange",function(){n.toggleBtn()})}),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.toggleBtn(),this},focusBirthday:function(e){$("#signup-birthday",this.$el).focus()},handleDates:function(e){if(constants.platform!="android")return;var t=$(e.currentTarget),n=Date.parse(t.val())||new Date;typeof n=="number"&&(n=new Date(n)),datePicker.show({date:n,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},toggleBtn:function(){var e=!0;this.$input_eles.each(function(){$(this).attr("type")!="checkbox"&&$(this).val()!=""&&(e=!1)}),$("#btn-next").toggleClass("disabled",e)},onCancelClick:function(){utils.modal.confirm(_t("No account will be created if you cancel this screen"),function(e){e==1&&(t.reset(),window.location.href="#login")},_t("Confirm"),[_t("Ok"),_t("Cancel")])}})}),define("text!user/tpl/user-signup-step-03.html",[],function(){return'<!-- user/tpl/signup/step03 -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" id="cancel_btn">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="btn-next">\n			<%= _t(\'Save\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title"><%= _t(\'Upload Avatar\') %></div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="form-general" id="signup-form-edit-avatar">\n				<!-- form content -->\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("text!user/tpl/select-crop-image.html",[],function(){return'<div id="img_container">\n</div>\n'}),define("user/view/select-crop-image",["text!user/tpl/select-crop-image.html"],function(e){return Backbone.View.extend({template:_.template(e),render:function(){return this.$el.html(this.template()),this.selectPhoto(),this},selectPhoto:function(){function t(t){e.sImgSrc=t,$("#img_container").append('<img id="profile_photo" class="photo-cropping" src="'+t+'" />'),setTimeout(function(){e.initJcrop($("#profile_photo"))},200)}function n(e){utils.modal.alert(e),window.history.back()}var e=this;navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},initJcrop:function(e){function o(e){e.w>0&&e.h>0?t.coordinates=e.x+":"+e.y+":"+e.w+":"+e.h:t.coordinates=""}var t=this,n=e.width(),r=e.height();this.iWidth=n,this.iHeight=r;var i=48;if(n<48||r<48)i=Math.min(n,r);var s=[0,0,100,100];n>100&&r>100?(s[0]=n/2-50,s[1]=r/2-50,s[2]=s[0]+100,s[3]=s[1]+100):r<n?(s[0]=n/2-r/2,s[1]=0,s[2]=s[0]+r,s[3]=r):(s[0]=0,s[1]=r/2-n/2,s[2]=n,s[3]=s[0]+n),this.coordinates=s[0]+":"+s[1]+":"+n+":"+r,e.Jcrop({aspectRatio:1,minSize:[i,i],setSelect:s,onSelect:o,onChange:o})},getData:function(){return{sCoordinates:this.coordinates,iHeight:this.iHeight,iWidth:this.iWidth,sImgSrc:this.sImgSrc}}})}),define("user/view/user-signup-step-03",["text!user/tpl/user-signup-step-03.html","user/plugin/signup-data","user/view/select-crop-image","core"],function(){var e=require("user/view/select-crop-image"),t=require("text!user/tpl/user-signup-step-03.html"),n=require("user/plugin/signup-data"),r=require("core");return Backbone.View.extend({initialize:function(){this.cropView=new e},region:{wrapper:"#main",scroller:"#content"},events:{"click #cancel_btn":"onCancelClick","click #btn-next":"goNext"},template:_.template(t),goNext:function(){var e=this.cropView.getData();n.update(e),utils.debug.log("post data to completed signup form."),this.postSignupForm()},render:function(e){return this.context=$.extend({data:n.all},e),this.$el.html(this.template(this.context)),this.$scroller=this.$el.find(this.region.scroller),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$postBtn=$("#btn-next"),this.$el.find("#signup-form-edit-avatar").html(this.cropView.render().el),this},postSignupForm:function(){function t(t){console.log("DATA",t);if(parseInt(t.error_code,10)>0){if(t.error_code==4||t.error_code==5){utils.modal.alert(t.error_message),window.location.href="#login";return}utils.modal.alert(t.error_message||"Post URL failed!"),window.location="#signup/step01";return}utils.modal.toast("Signup sucessfully"),e.quickLogin(t)}function r(e){utils.modal.alert("Cannot Create Account! "),utils.debug.error("Error uploading file: "+JSON.stringify(e))}function i(){e.$postBtn.removeClass("processing")}if(this.$postBtn.hasClass("processing"))return;var e=this;this.$postBtn.addClass("processing");var s=n.all;utils.api.uploadImage("user/signup_account",s.sImgSrc,s).done(t).fail(r).always(i)},quickLogin:function(e){n.reset(),constants.token=e.token,r.viewer.set(e),localStorage.setItem("token",e.token),localStorage.setItem("viewer",JSON.stringify(e)),window.location.href="#newsfeed",window.location.reload()},onCancelClick:function(){utils.modal.confirm(_t("No account will be created if you cancel this screen"),function(e){e==1&&(n.reset(),window.location.href="#login")},_t("Confirm"),[_t("Ok"),_t("Cancel")])}})}),define("user/controller/user-signup",["user/plugin/signup-data","user/view/user-signup-step-01","user/view/user-signup-step-02","user/view/user-signup-step-03"],function(){function i(){utils.history.push(),utils.observer.trigger("router:changed"),(new t).render({}).inject()}function s(){utils.history.push(),utils.observer.trigger("router:changed"),(new n).render({}).inject()}function o(){utils.observer.trigger("router:changed"),(new r).render({}).inject()}var e=require("user/plugin/signup-data"),t=require("user/view/user-signup-step-01"),n=require("user/view/user-signup-step-02"),r=require("user/view/user-signup-step-03");utils.router.route("signup",i),utils.router.route("signup/step01",i),utils.router.route("signup/step02",s),utils.router.route("signup/step03",o)}),define("text!user/tpl/user-about.html",[],function(){return'<!-- user/tpl/about -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back"></div>\n	</div>\n    <% if(item.isOwner()) { %>\n        <div class="header-right">\n            <div class="btn-top btn-more" id="menu_toggle">\n            </div>\n        </div>\n    <% } %>\n	<div class="header-center">\n		<div id="page_title" class="title">\n            <%= _t(\'About\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu" class="top-menu hide"> </div>\n<div id="content" class="content with-header swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n            <div class="user-profile-info">\n                <div id="basic-info-holder">\n                    <div class="loading-initiator"></div>\n                </div>\n                <div id="user-extend-info">\n                </div>\n            </div>\n			<div class="pvs"></div>\n		</div>\n	</div>\n</div>\n\n'}),define("text!user/tpl/user-extend-info.html",[],function(){return'\n<div class="user-extend-info-title"><%= _t(\'About me\') %></div>\n<div>\n    <%if (typeof(About_Me) != "undefined" && About_Me != null) {%><p><%= utils.str.shorten(About_Me.About_Me,200,true) %></p><%}%>\n</div>\n\n<div class="user-extend-info-title"><%= _t(\'Contact information\') %></div>\n<div>\n    <%if (typeof(Details) != "undefined" && Details != null) {%>\n    <ul>\n        <%if ("" != Details.website) {%><li ><span class="icon icon-globe"></span> <%=Details.website%></li><%}%>\n        <%if ("" != Details.facebook) {%><li ><span class="icon icon-facebook-sign"></span> <%=Details.facebook%></li><%}%>\n        <%if ("" != Details.twitter) {%><li ><span class="icon icon-twitter"></span> <%=Details.twitter%></li><%}%>\n    </ul>\n    <%}%>\n</div>\n'}),define("user/view/user-about",["text!user/tpl/user-about.html","text!user/tpl/user-extend-info.html","user/view/user-basic-info","user/view/user-topmenu"],function(){var e=require("text!user/tpl/user-about.html"),t=require("text!user/tpl/user-extend-info.html"),n=require("user/view/user-basic-info"),r=require("user/view/user-topmenu");return Backbone.View.extend({template:_.template(e),topMenuView:r,events:{"click #menu_toggle":"toggleMenu"},region:{wrapper:"#main",scroller:"#content"},render:function(){return this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.scroller),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(){var e={iUserId:this.model.getId()},t={context:this,beforeSend:this.beforeSend};utils.api.post("profile/detail",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){this.model.set(e.BasicInfo),this.model.set("sAboutMe",e.About_Me?e.About_Me.About_Me:""),(new n({model:this.model})).render().inject(),this.$el.find("#user-extend-info",this.$el).html(_.template(t)({item:this.model})),this.$scroller.trigger("refresh")},toggleMenu:function(e){utils.topMenu.toggle(this,this.model)}})}),define("user/controller/user-about",["user/model/user","user/view/user-about"],function(e,t){function n(n){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iUserId:n})})).render().inject()}utils.router.route("user-about/:id",n)}),define("text!user/tpl/edit-profile-info.html",[],function(){return'<!-- user/tpl/edit-profile-info.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n    <div class="header-right" id="save-edit-btn" >\n		<div class="btn-top">\n			<%= _t(\'Save\') %>	\n		</div>\n	</div>\n	<div class="header-center" href="#">\n		<div class="title">\n            <%= _t(\'Personal Info\') %>\n		</div>\n	</div>\n</div>\n\n<!-- swiper -->\n<div class="content content-background with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list vertical">\n                <div id="edit-profile-content">\n                    <div class="loading-initiator"></div>\n                </div>\n\n			</div>\n		</div>\n	</div>\n</div>\n\n\n'}),define("text!user/tpl/edit-profile-info-content.html",[],function(){return'<div class="pvm"></div>\n<div class="form-title">\n    <%= _t(\'Personal Information\') %>\n</div>\n<div class="form-group">\n    <input id="city" type="text" class="control-full text" placeholder="<%= _t(\'City\') %>" value="<%= item.getCity() %>" />\n</div>\n\n<div class="form-group">\n    <input id="zip_postalcode" type="text" class="control-full text" placeholder="<%= _t(\'Zip/Postal Code\') %>" value="<%= item.getZipPostalCode() %>" />\n</div>\n\n<div class="form-group">\n    <select class="control-full" id="country" name="country">\n        <option value=""><%= _t(\'Select Country\') %></option>\n        <% for(var i = 0, len = countries.length; i < len; i++) {%>\n        <option value="<%= countries[i].sISO %>" <%if (item.getCountryISO() == countries[i].sISO) {%> selected="selected"<%}%>><%= countries[i].sCountry %></option>\n\n        <% } %>\n\n    </select>\n</div>\n\n<div class="form-group">\n    <select class="control-full" id="gender" name="gender">\n        <option value=""><%= _t(\'Select Gender\') %></option>\n        <option value="1"<%if (item.getGender() == \'Male\') {%> selected="selected"<%}%>><%= _t(\'Male\') %></option>\n        <option value="2"<%if (item.getGender() == \'Female\') {%> selected="selected"<%}%>><%= _t(\'Female\') %></option>\n    </select>\n</div>\n\n<div class="form-group group-span-inline clearfix">\n    <span><%= _t(\'Birthday\') %></span>\n    <input type="date" id="profile_birthday" value="<%= item.getBirthdayToParseYMD() %>" />\n</div>\n\n<div class="form-title">\n    <%= _t(\'About Me\') %> \n</div>\n\n<div class="form-group">\n    <textarea id="profile_about_me" placeholder="About Me" class="control-full textarea"><%= item.getAboutMe() %></textarea>\n</div>\n<div class="pvl"></div>'}),define("user/view/edit-profile-info",["text!user/tpl/edit-profile-info.html","text!user/tpl/edit-profile-info-content.html"],function(e,t){return Backbone.View.extend({template:_.template(e),templateInfoContent:_.template(t),region:{holder:"#main",scroller:"#content",content:"#edit-profile-content"},events:{"click #save-edit-btn":"submitEditForm","click #profile_birthday":"handleDates"},render:function(){return this.$holder=$(this.region.holder),this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$contentHolder=this.$el.find(this.region.content),this},inject:function(){return this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(){var e={iUserId:this.model.getId()},t={context:this,beforeSend:this.beforeSend},n=utils.api.post("profile/info",e,t),r=utils.api.post("core/country",e,t),i=this;$.when(n,r).done(function(e,t){e=e[0],t=t[0];if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;if(t.error_code>0)return utils.modal.alert(t.error_message||"Post URL failed!"),!1;i.refreshView(e,t)})},fetchComplete:function(){},beforeSend:function(){},fetchDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.fetchSuccess(e)},fetchSuccess:function(e){this.refreshView(e),utils.observer.trigger("user:update")},refreshView:function(e,t){console.log("mmdata",e);var n=e.BasicInfo;n.sAboutMe=_.isUndefined(e.About_Me)||_.isUndefined(e.About_Me.About_Me)?"":e.About_Me.About_Me,this.model.set(n),this.$contentHolder.html(this.templateInfoContent({item:this.model,countries:t})),this.$postBtn=this.$el.find("#save-edit-btn"),this.$firstName=this.$el.find("#first_name"),this.$lastName=this.$el.find("#last_name"),this.$gender=this.$el.find("#gender"),this.$birthday=this.$el.find("#profile_birthday"),this.$website=this.$el.find("#profile_website"),this.$facebook=this.$el.find("#profile_facebook"),this.$twitter=this.$el.find("#profile_twitter"),this.$aim=this.$el.find("#profile_aim"),this.$aboutMe=this.$el.find("#profile_about_me"),this.$city=this.$el.find("#city"),this.$zipPostal=this.$el.find("#zip_postalcode"),this.$country=this.$el.find("#country")},submitEditForm:function(){if(this.$postBtn.hasClass("processing"))return;var e={iUserId:this.model.getId(),sCity:this.$city.val(),sZipCode:this.$zipPostal.val(),sCountryIso:this.$country.val(),iGender:this.$gender.val(),sBirthday:this.$birthday.val(),sAbout:this.$aboutMe.val()},t={context:this,beforeSend:this.beforeSendSubmitEditForm};utils.api.post("user/edit_profile",e,t).done(this.submitEditDone).always(this.submitEditComplete)},handleDates:function(e){constants.platform=="android"?this.handleDatesAndroid(e):this.handleDatesiOS(e)},handleDatesiOS:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n));var r=utils.setting.get("user_date_of_birth_start"),i=utils.setting.get("user_date_of_birth_end"),s=new Date(r,0,1,0,0,0),o=new Date(i,11,31,23,59,59);datePicker.show({date:n,minDate:s,maxDate:o,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);n.getTime()>o.getTime()?n=o:n.getTime()<s.getTime()&&(n=s),t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},handleDatesAndroid:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n));var r=utils.setting.get("user_date_of_birth_start"),i=utils.setting.get("user_date_of_birth_end"),s=Date.parse(r+"/01/01 00:00:00"),o=Date.parse(i+"/12/31 23:59:59");datePicker.show({date:n,minDate:s,maxDate:o,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);n.getTime()>o?n.setTime(o):n.getTime()<s&&n.setTime(s),t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},submitEditComplete:function(){this.$postBtn.removeClass("processing")},beforeSendSubmitEditForm:function(){this.$postBtn.addClass("processing")},submitEditDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.submitEditSuccess(e)},submitEditSuccess:function(e){utils.observer.trigger("user:update"),utils.modal.toast("Edit Successfully"),utils.history.back()}})}),define("user/controller/user-edit",["user/model/user","user/view/edit-profile-info"],function(e,t){function n(n){utils.observer.trigger("router:changed"),(new t({model:new e({iUserId:n})})).render().inject()}utils.router.route("user-edit/:id",n)}),define("text!user/tpl/edit-user-photo.html",[],function(){return'<!-- user/tpl/about -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n    <div class="header-right">\n		<div class="btn-top" id="save-photo">\n			<%= _t(\'Save\') %>	\n		</div>\n	</div>\n	<div class="header-center">\n		<div id="page_title" class="title">\n            <%= _t(\'Edit My Photo\') %>\n		</div>\n	</div>\n</div>\n\n<div id="content" class="content with-header ">\n    <div id="edit-avatar">\n\n    </div>\n</div>\n\n\n\n'}),function(e){e.Jcrop=function(t,n){function a(e){return Math.round(e)+"px"}function f(e){return r.baseClass+"-"+e}function l(){return e.fx.step.hasOwnProperty("backgroundColor")}function c(t){var n=e(t).offset();return[n.left,n.top]}function h(e){return[e.pageX-i[0],e.pageY-i[1]]}function p(t){typeof t!="object"&&(t={}),r=e.extend(r,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){typeof r[t]!="function"&&(r[t]=function(){})})}function d(e,t,n){i=c(A),nt.setCursor(e==="move"?e:e+"-resize");if(e==="move")return nt.activateHandlers(m(t),E,n);var r=Z.getFixed(),s=g(e),o=Z.getCorner(g(s));Z.setPressed(Z.getCorner(s)),Z.setCurrent(o),nt.activateHandlers(v(e,r),E,n)}function v(e,t){return function(n){if(!r.aspectRatio)switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}else switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}Z.setCurrent(n),tt.update()}}function m(e){var t=e;return rt.watchKeys(),function(e){Z.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,tt.update()}}function g(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function y(e){return function(t){return r.disabled?!1:e==="move"&&!r.allowMove?!1:(i=c(A),K=!0,d(e,h(t)),t.stopPropagation(),t.preventDefault(),!1)}}function b(e,t,n){var r=e.width(),i=e.height();r>t&&t>0&&(r=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,r=n/e.height()*e.width()),X=e.width()/r,V=e.height()/i,e.width(r).height(i)}function w(e){return{x:e.x*X,y:e.y*V,x2:e.x2*X,y2:e.y2*V,w:e.w*X,h:e.h*V}}function E(e){var t=Z.getFixed();t.w>r.minSelect[0]&&t.h>r.minSelect[1]?(tt.enableHandles(),tt.done()):tt.release(),nt.setCursor(r.allowSelect?"crosshair":"default")}function S(e){if(r.disabled)return!1;if(!r.allowSelect)return!1;K=!0,i=c(A),tt.disableHandles(),nt.setCursor("crosshair");var t=h(e);return Z.setPressed(t),tt.update(),nt.activateHandlers(x,E,e.type.substring(0,5)==="touch"),rt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function x(e){Z.setCurrent(e),tt.update()}function T(){var t=e("<div></div>").addClass(f("tracker"));return o&&t.css({opacity:0,backgroundColor:"white"}),t}function it(e){_.removeClass().addClass(f("holder")).addClass(e)}function st(e,t){function b(){window.setTimeout(w,c)}var n=e[0]/X,i=e[1]/V,s=e[2]/X,o=e[3]/V;if(Q)return;var u=Z.flipCoords(n,i,s,o),a=Z.getFixed(),f=[a.x,a.y,a.x2,a.y2],l=f,c=r.animationDelay,h=u[0]-f[0],p=u[1]-f[1],d=u[2]-f[2],v=u[3]-f[3],m=0,g=r.swingSpeed;n=l[0],i=l[1],s=l[2],o=l[3],tt.animMode(!0);var y,w=function(){return function(){m+=(100-m)/g,l[0]=Math.round(n+m/100*h),l[1]=Math.round(i+m/100*p),l[2]=Math.round(s+m/100*d),l[3]=Math.round(o+m/100*v),m>=99.8&&(m=100),m<100?(ut(l),b()):(tt.done(),tt.animMode(!1),typeof t=="function"&&t.call(yt))}}();b()}function ot(e){ut([e[0]/X,e[1]/V,e[2]/X,e[3]/V]),r.onSelect.call(yt,w(Z.getFixed())),tt.enableHandles()}function ut(e){Z.setPressed([e[0],e[1]]),Z.setCurrent([e[2],e[3]]),tt.update()}function at(){return w(Z.getFixed())}function ft(){return Z.getFixed()}function lt(e){p(e),gt()}function ct(){r.disabled=!0,tt.disableHandles(),tt.setCursor("default"),nt.setCursor("default")}function ht(){r.disabled=!1,gt()}function pt(){tt.done(),nt.activateHandlers(null,null)}function dt(){_.remove(),C.show(),C.css("visibility","visible"),e(t).removeData("Jcrop")}function vt(e,t){tt.release(),ct();var n=new Image;n.onload=function(){var i=n.width,s=n.height,o=r.boxWidth,u=r.boxHeight;A.width(i).height(s),A.attr("src",e),D.attr("src",e),b(A,o,u),O=A.width(),M=A.height(),D.width(O).height(M),F.width(O+j*2).height(M+j*2),_.width(O).height(M),et.resize(O,M),ht(),typeof t=="function"&&t.call(yt)},n.src=e}function mt(e,t,n){var i=t||r.bgColor;r.bgFade&&l()&&r.fadeTime&&!n?e.animate({backgroundColor:i},{queue:!1,duration:r.fadeTime}):e.css("backgroundColor",i)}function gt(e){r.allowResize?e?tt.enableOnly():tt.enableHandles():tt.disableHandles(),nt.setCursor(r.allowSelect?"crosshair":"default"),tt.setCursor(r.allowMove?"move":"default"),r.hasOwnProperty("trueSize")&&(X=r.trueSize[0]/O,V=r.trueSize[1]/M),r.hasOwnProperty("setSelect")&&(ot(r.setSelect),tt.done(),delete r.setSelect),et.refresh(),r.bgColor!=I&&(mt(r.shade?et.getShades():_,r.shade?r.shadeColor||r.bgColor:r.bgColor),I=r.bgColor),q!=r.bgOpacity&&(q=r.bgOpacity,r.shade?et.refresh():tt.setBgOpacity(q)),R=r.maxSize[0]||0,U=r.maxSize[1]||0,z=r.minSize[0]||0,W=r.minSize[1]||0,r.hasOwnProperty("outerImage")&&(A.attr("src",r.outerImage),delete r.outerImage),tt.refresh()}var r=e.extend({},e.Jcrop.defaults),i,s=navigator.userAgent.toLowerCase(),o=/msie/.test(s),u=/msie [1-6]\./.test(s);typeof t!="object"&&(t=e(t)[0]),typeof n!="object"&&(n={}),p(n);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},C=e(t),k=!0;if(t.tagName=="IMG"){if(C[0].width!=0&&C[0].height!=0)C.width(C[0].width),C.height(C[0].height);else{var L=new Image;L.src=C[0].src,C.width(L.width),C.height(L.height)}var A=C.clone().removeAttr("id").css(N).show();A.width(C.width()),A.height(C.height()),C.after(A).hide()}else A=C.css(N).show(),k=!1,r.shade===null&&(r.shade=!0);b(A,r.boxWidth,r.boxHeight);var O=A.width(),M=A.height(),_=e("<div />").width(O).height(M).addClass(f("holder")).css({position:"relative",backgroundColor:r.bgColor}).insertAfter(C).append(A);r.addClass&&_.addClass(r.addClass);var D=e("<div />"),P=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),H=e("<div />").width("100%").height("100%").css("zIndex",320),B=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=Z.getFixed();r.onDblClick.call(yt,e)}).insertBefore(A).append(P,H);k&&(D=e("<img />").attr("src",A.attr("src")).css(N).width(O).height(M),P.append(D)),u&&B.css({overflowY:"hidden"});var j=r.boundary,F=T().width(O+j*2).height(M+j*2).css({position:"absolute",top:a(-j),left:a(-j),zIndex:290}).mousedown(S),I=r.bgColor,q=r.bgOpacity,R,U,z,W,X,V,J=!0,K,Q,G;i=c(A);var Y=function(){function e(){var e={},t=["touchstart","touchmove","touchend"],n=document.createElement("div"),r;try{for(r=0;r<t.length;r++){var i=t[r];i="on"+i;var s=i in n;s||(n.setAttribute(i,"return;"),s=typeof n[i]=="function"),e[t[r]]=s}return e.touchstart&&e.touchend&&e.touchmove}catch(o){return!1}}function t(){return r.touchSupport===!0||r.touchSupport===!1?r.touchSupport:e()}return{createDragger:function(e){return function(t){return r.disabled?!1:e==="move"&&!r.allowMove?!1:(i=c(A),K=!0,d(e,h(Y.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(e){return S(Y.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),Z=function(){function u(r){r=p(r),n=e=r[0],i=t=r[1]}function a(e){e=p(e),s=e[0]-n,o=e[1]-i,n=e[0],i=e[1]}function f(){return[s,o]}function l(r){var s=r[0],o=r[1];0>e+s&&(s-=s+e),0>t+o&&(o-=o+t),M<i+o&&(o+=M-(i+o)),O<n+s&&(s+=O-(n+s)),e+=s,n+=s,t+=o,i+=o}function c(e){var t=h();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function h(){if(!r.aspectRatio)return v();var s=r.aspectRatio,o=r.minSize[0]/X,u=r.maxSize[0]/X,a=r.maxSize[1]/V,f=n-e,l=i-t,c=Math.abs(f),h=Math.abs(l),p=c/h,g,y,b,w;return u===0&&(u=O*10),a===0&&(a=M*10),p<s?(y=i,b=h*s,g=f<0?e-b:b+e,g<0?(g=0,w=Math.abs((g-e)/s),y=l<0?t-w:w+t):g>O&&(g=O,w=Math.abs((g-e)/s),y=l<0?t-w:w+t)):(g=n,w=c/s,y=l<0?t-w:t+w,y<0?(y=0,b=Math.abs((y-t)*s),g=f<0?e-b:b+e):y>M&&(y=M,b=Math.abs(y-t)*s,g=f<0?e-b:b+e)),g>e?(g-e<o?g=e+o:g-e>u&&(g=e+u),y>t?y=t+(g-e)/s:y=t-(g-e)/s):g<e&&(e-g<o?g=e-o:e-g>u&&(g=e-u),y>t?y=t+(e-g)/s:y=t-(e-g)/s),g<0?(e-=g,g=0):g>O&&(e-=g-O,g=O),y<0?(t-=y,y=0):y>M&&(t-=y-M,y=M),m(d(e,t,g,y))}function p(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>O&&(e[0]=O),e[1]>M&&(e[1]=M),[Math.round(e[0]),Math.round(e[1])]}function d(e,t,n,r){var i=e,s=n,o=t,u=r;return n<e&&(i=n,s=e),r<t&&(o=r,u=t),[i,o,s,u]}function v(){var r=n-e,s=i-t,o;return R&&Math.abs(r)>R&&(n=r>0?e+R:e-R),U&&Math.abs(s)>U&&(i=s>0?t+U:t-U),W/V&&Math.abs(s)<W/V&&(i=s>0?t+W/V:t-W/V),z/X&&Math.abs(r)<z/X&&(n=r>0?e+z/X:e-z/X),e<0&&(n-=e,e-=e),t<0&&(i-=t,t-=t),n<0&&(e-=n,n-=n),i<0&&(t-=i,i-=i),n>O&&(o=n-O,e-=o,n-=o),i>M&&(o=i-M,t-=o,i-=o),e>O&&(o=e-M,i-=o,t-=o),t>M&&(o=t-M,i-=o,t-=o),m(d(e,t,n,i))}function m(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,n=0,i=0,s,o;return{flipCoords:d,setPressed:u,setCurrent:a,getOffset:f,moveOffset:l,getCorner:c,getFixed:h}}(),et=function(){function s(e,t){i.left.css({height:a(t)}),i.right.css({height:a(t)})}function o(){return u(Z.getFixed())}function u(e){i.top.css({left:a(e.x),width:a(e.w),height:a(e.y)}),i.bottom.css({top:a(e.y2),left:a(e.x),width:a(e.w),height:a(M-e.y2)}),i.right.css({left:a(e.x2),width:a(O-e.x2)}),i.left.css({width:a(e.x)})}function f(){return e("<div />").css({position:"absolute",backgroundColor:r.shadeColor||r.bgColor}).appendTo(n)}function l(){t||(t=!0,n.insertBefore(A),o(),tt.setBgOpacity(1,0,1),D.hide(),c(r.shadeColor||r.bgColor,1),tt.isAwake()?p(r.bgOpacity,1):p(1,1))}function c(e,t){mt(v(),e,t)}function h(){t&&(n.remove(),D.show(),t=!1,tt.isAwake()?tt.setBgOpacity(r.bgOpacity,1,1):(tt.setBgOpacity(1,1,1),tt.disableHandles()),mt(_,0,1))}function p(e,i){t&&(r.bgFade&&!i?n.animate({opacity:1-e},{queue:!1,duration:r.fadeTime}):n.css({opacity:1-e}))}function d(){r.shade?l():h(),tt.isAwake()&&p(r.bgOpacity)}function v(){return n.children()}var t=!1,n=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),i={top:f(),left:f().height(M),right:f().height(M),bottom:f()};return{update:o,updateRaw:u,getShades:v,setBgColor:c,enable:l,disable:h,resize:s,refresh:d,opacity:p}}(),tt=function(){function l(t){var n=e("<div />").css({position:"absolute",opacity:r.borderOpacity}).addClass(f(t));return P.append(n),n}function c(t,n){var r=e("<div />").mousedown(y(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return Y.support&&r.bind("touchstart.jcrop",Y.createDragger(t)),H.append(r),r}function h(e){var t=r.handleSize,i=c(e,n++).css({opacity:r.handleOpacity}).addClass(f("handle"));return t&&i.width(t).height(t),i}function p(e){return c(e,n++).addClass("jcrop-dragbar")}function d(e){var t;for(t=0;t<e.length;t++)o[e[t]]=p(e[t])}function v(e){var t,n;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}i[e[n]]=l(t)}}function m(e){var t;for(t=0;t<e.length;t++)s[e[t]]=h(e[t])}function g(e,t){r.shade||D.css({top:a(-t),left:a(-e)}),B.css({top:a(t),left:a(e)})}function b(e,t){B.width(Math.round(e)).height(Math.round(t))}function E(){var e=Z.getFixed();Z.setPressed([e.x,e.y]),Z.setCurrent([e.x2,e.y2]),S()}function S(e){if(t)return x(e)}function x(e){var n=Z.getFixed();b(n.w,n.h),g(n.x,n.y),r.shade&&et.updateRaw(n),t||C(),e?r.onSelect.call(yt,w(n)):r.onChange.call(yt,w(n))}function N(e,n,i){if(!t&&!n)return;r.bgFade&&!i?A.animate({opacity:e},{queue:!1,duration:r.fadeTime}):A.css("opacity",e)}function C(){B.show(),r.shade?et.opacity(q):N(q,!0),t=!0}function k(){M(),B.hide(),r.shade?et.opacity(1):N(1),t=!1,r.onRelease.call(yt)}function L(){u&&H.show()}function O(){u=!0;if(r.allowResize)return H.show(),!0}function M(){u=!1,H.hide()}function _(e){e?(Q=!0,M()):(Q=!1,O())}function j(){_(!1),E()}var t,n=370,i={},s={},o={},u=!1;r.dragEdges&&e.isArray(r.createDragbars)&&d(r.createDragbars),e.isArray(r.createHandles)&&m(r.createHandles),r.drawBorders&&e.isArray(r.createBorders)&&v(r.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var F=T().mousedown(y("move")).css({cursor:"move",position:"absolute",zIndex:360});return Y.support&&F.bind("touchstart.jcrop",Y.createDragger("move")),P.append(F),M(),{updateVisible:S,update:x,release:k,refresh:E,isAwake:function(){return t},setCursor:function(e){F.css("cursor",e)},enableHandles:O,enableOnly:function(){u=!0},showHandles:L,disableHandles:M,animMode:_,setBgOpacity:N,done:j}}(),nt=function(){function s(t){F.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",l).bind("touchend.jcrop",c):i&&e(document).bind("mousemove.jcrop",u).bind("mouseup.jcrop",a)}function o(){F.css({zIndex:290}),e(document).unbind(".jcrop")}function u(e){return t(h(e)),!1}function a(e){return e.preventDefault(),e.stopPropagation(),K&&(K=!1,n(h(e)),tt.isAwake()&&r.onSelect.call(yt,w(Z.getFixed())),o(),t=function(){},n=function(){}),!1}function f(e,r,i){return K=!0,t=e,n=r,s(i),!1}function l(e){return t(h(Y.cfilter(e))),!1}function c(e){return a(Y.cfilter(e))}function p(e){F.css("cursor",e)}var t=function(){},n=function(){},i=r.trackDocument;return i||F.mousemove(u).mouseup(a).mouseout(a),A.before(F),{activateHandlers:f,setCursor:p}}(),rt=function(){function i(){r.keySupport&&(t.show(),t.focus())}function s(e){t.hide()}function o(e,t,n){r.allowMove&&(Z.moveOffset([t,n]),tt.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function a(e){if(e.ctrlKey||e.metaKey)return!0;G=e.shiftKey?!0:!1;var t=G?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:r.allowSelect&&tt.release();break;case 9:return!0}return!1}var t=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),n=e("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return r.keySupport&&(t.keydown(a).blur(s),u||!r.fixedSupport?(t.css({position:"absolute",left:"-20px"}),n.append(t).insertBefore(A)):t.insertBefore(A)),{watchKeys:i}}();Y.support&&F.bind("touchstart.jcrop",Y.newSelection),H.hide(),gt(!0);var yt={setImage:vt,animateTo:st,setSelect:ot,setOptions:lt,tellSelect:at,tellScaled:ft,setClass:it,disable:ct,enable:ht,cancel:pt,release:tt.release,destroy:dt,focus:rt.watchKeys,getBounds:function(){return[O*X,M*V]},getWidgetSize:function(){return[O,M]},getScaleFactor:function(){return[X,V]},getOptions:function(){return r},ui:{holder:_,selection:B}};return o&&_.bind("selectstart",function(){return!1}),C.data("Jcrop",yt),yt},e.fn.Jcrop=function(t,n){var r;return this.each(function(){if(e(this).data("Jcrop")){if(t==="api")return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else this.tagName=="IMG"?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r)}):(e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r))}),this},e.Jcrop.Loader=function(t,n,r){function o(){s.complete?(i.unbind(".jcloader"),e.isFunction(n)&&n.call(s)):window.setTimeout(o,50)}var i=e(t),s=i[0];i.bind("load.jcloader",o).bind("error.jcloader",function(t){i.unbind(".jcloader"),e.isFunction(r)&&r.call(s)}),s.complete&&e.isFunction(n)&&(i.unbind(".jcloader"),n.call(s))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),define("jcrop",function(e){return function(){var t,n;return t||e.jcrop}}(this)),function(e,t){function h(e,t,n){var r=u[t.type]||{},i=t.empty||n;return i&&e==null?null:t.def&&e==null?t.def:(r.floor?e=~~e:e=parseFloat(e),e==null||isNaN(e)?t.def:r.mod?(e%=r.mod,e<0?r.mod+e:e):r.min>e?r.min:r.max<e?r.max:e)}function p(t){var n=s(),r=n._rgba=[];t=t.toLowerCase(),c(i,function(e,i){var s=i.re.exec(t),u=s&&i.parse(s),a,f=i.space||"rgba",l=o[f].cache;if(u)return a=n[f](u),n[l]=a[l],r=n._rgba=a._rgba,!1});if(r.length!==0)return Math.max.apply(Math,r)===0&&e.extend(r,l.transparent),n;if(t=l[t])return t}function d(e,t,n){return n=(n+1)%1,n*6<1?e+(t-e)*6*n:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),r=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},o={rgba:{cache:"_rgba",props:{red:{idx:0,type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},u={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},a=o.rgba.props,f=s.support={},l,c=e.each;o.hsla.props.alpha=a.alpha,s.fn=s.prototype={constructor:s,parse:function(n,r,i,u){if(n===t)return this._rgba=[null,null,null,null],this;if(n instanceof e||n.nodeType)n=n instanceof e?n.css(r):e(n).css(r),r=t;var f=this,d=e.type(n),v=this._rgba=[],m;r!==t&&(n=[n,r,i,u],d="array");if(d==="string")return this.parse(p(n)||l._default);if(d==="array")return c(a,function(e,t){v[t.idx]=h(n[t.idx],t)}),this;if(d==="object")return n instanceof s?c(o,function(e,t){n[t.cache]&&(f[t.cache]=n[t.cache].slice())}):c(o,function(e,t){c(t.props,function(e,r){var i=t.cache;if(!f[i]&&t.to){if(n[e]==null||e==="alpha")return;f[i]=t.to(f._rgba)}f[i][r.idx]=h(n[e],r,!0)})}),this},is:function(e){var t=s(e),n=!0,r=this;return c(o,function(e,i){var s=t[i.cache],o;return s&&(o=r[i.cache]||i.to&&i.to(r._rgba)||[],c(i.props,function(e,t){if(s[t.idx]!=null)return n=s[t.idx]===o[t.idx],n})),n}),n},_space:function(){var e=[],t=this;return c(o,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var n=s(e),r=n._space(),i=o[r],a=this[i.cache]||i.to(this._rgba),f=a.slice();return n=n[i.cache],c(i.props,function(e,r){var i=r.idx,s=a[i],o=n[i],l=u[r.type]||{};if(o===null)return;s===null?f[i]=o:(l.mod&&(o-s>l.mod/2?s+=l.mod:s-o>l.mod/2&&(s-=l.mod)),f[r.idx]=h((o-s)*t+s,r))}),this[r](f)},blend:function(t){if(this._rgba[3]===1)return this;var n=this._rgba.slice(),r=n.pop(),i=s(t)._rgba;return s(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});return n[3]===1&&(n.pop(),t="rgb("),t+n.join(",")+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return e==null&&(e=t>2?1:0),t&&t<3&&(e=Math.round(e*100)+"%"),e});return n[3]===1&&(n.pop(),t="hsl("),t+n.join(",")+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(r*255)),"#"+e.map(n,function(e,t){return e=(e||0).toString(16),e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}},s.fn.parse.prototype=s.fn,o.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;return o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240,f===0||f===1?c=f:f<=.5?c=u/a:c=u/(2-a),[Math.round(l)%360,c,f,i==null?1:i]},o.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s,u,a,f;return[Math.round(d(o,s,t+1/3)*255),Math.round(d(o,s,t)*255),Math.round(d(o,s,t-1/3)*255),i]},c(o,function(n,i){var o=i.props,u=i.cache,a=i.to,f=i.from;s.fn[n]=function(n){a&&!this[u]&&(this[u]=a(this._rgba));if(n===t)return this[u].slice();var r=e.type(n),i=r==="array"||r==="object"?n:arguments,l=this[u].slice(),p;return c(o,function(e,t){var n=i[r==="object"?e:t.idx];n==null&&(n=l[t.idx]),l[t.idx]=h(n,t)}),f?(p=s(f(l)),p[u]=l,p):s(l)},c(o,function(t,i){if(s.fn[t])return;s.fn[t]=function(s){var o=e.type(s),u=t==="alpha"?this._hsla?"hsla":"rgba":n,a=this[u](),f=a[i.idx],l;return o==="undefined"?f:(o==="function"&&(s=s.call(this,f),o=e.type(s)),s==null&&i.empty?this:(o==="string"&&(l=r.exec(s),l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))),a[i.idx]=s,this[u](a)))}})}),c(n,function(t,n){e.cssHooks[n]={set:function(t,r){var i,o,u;if(e.type(r)!=="string"||(i=p(r))){r=s(i||r);if(!f.rgba&&r._rgba[3]!==1){u=n==="backgroundColor"?t.parentNode:t;do o=e.curCSS(u,"backgroundColor");while((o===""||o==="transparent")&&(u=u.parentNode)&&u.style);r=r.blend(o&&o!=="transparent"?o:"_default")}r=r.toRgbaString()}t.style[n]=r}},e.fx.step[n]=function(t){t.colorInit||(t.start=s(t.elem,n),t.end=s(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}}),e(function(){var e=document.createElement("div"),t=e.style;t.cssText="background-color:rgba(1,1,1,.5)",f.rgba=t.backgroundColor.indexOf("rgba")>-1}),l=e.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),define("jcolor",function(e){return function(){var t,n;return t||e.jcolor}}(this)),define("user/view/edit-user-photo",["text!user/tpl/edit-user-photo.html","user/view/select-crop-image","jcrop","jcolor"],function(){var e=require("text!user/tpl/edit-user-photo.html"),t=require("user/view/select-crop-image");return Backbone.View.extend({initialize:function(){this.coordinates="",this.sImgSrc="",this.cropView=new t},events:{"click #save-photo":"savePhoto"},template:_.template(e),region:{main:"#main"},render:function(){return this.$holder=$(this.region.main),this.$el.html(this.template()),this.$scroller=this.$el.find("#content"),this.$postBtn=this.$el.find("#save-photo"),this},inject:function(){return this.$holder.html(this.$el),this.$el.find("#edit-avatar").html(this.cropView.render().el),this},savePhoto:function(){function n(e){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;utils.modal.toast("Edit sucessfully"),utils.observer.trigger("user:update"),utils.history.back()}function r(e){utils.modal.alert("Cannot upload photo")}var e={iUserId:this.model.getId()},t=this.cropView.getData();t.coordinates!==""&&(e.sCoordinates=t.sCoordinates,e.iWidth=t.iWidth,e.iHeight=t.iHeight),utils.api.uploadImage("user/edit_avatar",t.sImgSrc,e).done(n).fail(r)}})}),define("user/controller/user-edit-photo",["user/model/user","user/view/edit-user-photo"],function(e,t){function n(n){utils.observer.trigger("router:changed"),(new t({model:new e({iUserId:n})})).render().inject()}utils.router.route("user-edit-photo/:id",n)}),define("text!user/tpl/edit-user-cover.html",[],function(){return'<!-- user/tpl/about -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n    <div class="header-right">\n		<div class="btn-top" id="save-photo">\n			<%= _t(\'Save\') %>	\n		</div>\n	</div>\n	<div class="header-center">\n		<div id="page_title" class="title">\n            <%= _t(\'Edit Cover\') %>\n		</div>\n	</div>\n</div>\n\n<div id="content" class="content with-header ">\n    <div id="edit-avatar">\n        <div id="img_container">\n        </div>\n\n    </div>\n</div>\n\n\n\n'}),define("user/view/edit-user-cover",["text!user/tpl/edit-user-cover.html"],function(){var e=require("text!user/tpl/edit-user-cover.html");return Backbone.View.extend({initialize:function(){},events:{"click #save-photo":"savePhoto"},template:_.template(e),region:{main:"#main"},render:function(){return this.$holder=$(this.region.main),this.$el.html(this.template()),this.$scroller=this.$el.find("#content"),this.$postBtn=this.$el.find("#save-photo"),this},inject:function(){return this.$holder.html(this.$el),this.selectPhoto(),this},savePhoto:function(){function t(e){utils.modal.toast("Edit sucessfully"),utils.history.back()}function n(e){utils.modal.alert("Cannot upload photo")}var e={iUserId:this.model.getId()};utils.api.uploadImage("user/edit_cover",this.sImgSrc,e).done(t).fail(n)},selectPhoto:function(){function t(t){e.sImgSrc=t,$("#img_container").append('<img id="profile_photo" class="photo-cropping" src="'+t+'" />')}function n(e){utils.modal.alert(e),window.history.back()}var e=this;navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})}})}),define("user/controller/user-edit-cover",["user/model/user","user/view/edit-user-cover"],function(e,t){function n(n){utils.observer.trigger("router:changed"),(new t({model:new e({iUserId:n})})).render().inject()}utils.router.route("user-edit-cover/:id",n)}),define("text!user/tpl/user-forgot-password.html",[],function(){return'<!-- user/tpl/signup/forgot-password.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title"><%= _t(\'Forgot Password\') %></div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="btn-send-email">\n            <%= _t(\'Send\') %>\n		</div>\n	</div>\n</div>\n<div class="content with-header forgot-password swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="form-general">\n                <div class="form-title">\n                    <%= _t(\'An email with instruction will be sent to your email below to reset password.\') %>\n                </div>\n                <div class="form-group ">\n                    <input placeholder="<%= _t(\'Your email\') %>" type="email" name="email" id="email_to_reset_password"  value="" class="control-full text"  />\n                </div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("user/view/user-forgot-password",["text!user/tpl/user-forgot-password.html"],function(e){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content"},events:{"click #btn-send-email":"sendEmail"},template:_.template(e),render:function(){return this.$el.html(this.template({})),this.$scroller=this.$el.find(this.region.scroller),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.$email=this.$el.find("#email_to_reset_password"),this.$email.focus(),this.$postBtn=this.$el.find("#btn-send-email"),this},sendEmail:function(e){if(!this.isValidate()||this.$postBtn.isProcessing())return;var t={sEmail:this.$email.val()},n={context:this,beforeSend:this.beforeSend};utils.api.post("user/forgot",t,n).done(this.postDone).always(this.postComplete)},isValidate:function(){if(this.$email.val().trim()==""){var e="Please enter your email";return utils.modal.alert(e),!1}if(!utils.validator.isEmail(this.$email.val())){var e="Please enter a valid email";return utils.modal.alert(e),!1}return!0},postComplete:function(){this.$postBtn.isProcessing(!1)},beforeSend:function(){this.$postBtn.isProcessing(!0)},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){var t=_t("You have been sent an email with instructions how to reset your password. If the email does not arrive within several minutes, be sure to check your spam or junk mail folders.");utils.modal.alert(t),utils.history.back()}})}),define("user/controller/user-forgot-password",["utils","user/view/user-forgot-password"],function(e,t){function n(){e.history.push(),e.observer.trigger("router:changed"),(new t).render().inject()}e.router.route("forgot-password",n)}),define("user/main",["user/plugin/connect","user/plugin/activity","user/plugin/block-this","user/controller/user-detail","user/controller/user-login","user/controller/user-logout","user/controller/user-signup","user/controller/user-about","user/controller/user-edit","user/controller/user-edit-photo","user/controller/user-edit-cover","user/controller/user-forgot-password"],function(){}),define("user",["user/main"],function(e){return e}),define("text!activity/tpl/attachment-checkin.html",[],function(){return'<div class="att-item-image" style="background-image: url(<%= imgSrc %>); height:160px;">\n    <div class="close_button"><a href="javascript:void(0);" id="remove_att"></a></div>\n    <!-- Remove style later -->\n	<div class="att-item-marker">\n		<div class="att-item-title"><%= checkin.sTitle %></div>\n	</div>\n</div>\n'}),define("activity/view/attachment-checkin",["text!activity/tpl/attachment-checkin.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-checkin",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n=$(".item-attachment").width();constants.isTablet&&(n-=32);var r=160,i="http://maps.googleapis.com/maps/api/staticmap?center="+t.fLatitude+","+t.fLongitude+"&zoom=15&size="+n+"x"+r+"&maptype=roadmap&markers=color:red%7C"+t.fLatitude+","+t.fLongitude+"&sensor=false";return this.$el.html(this.template({feed:e,checkin:t,imgSrc:i,width:n,height:r})),this},inject:function(e){return e.html(this.$el),this}})}),define("activity/plugin/activity",["activity/view/attachment-checkin"],function(e){utils.attachment.add(["ynmobile_map"],e),utils.headline.add(["ynmobile_checkin"],function(e){return e.hasAttachment()?_t("has checked in - at ")+'<span class="feed-location-name">'+e.getAttachments()[0].sLocationName+"</span>":""})}),define("text!activity/tpl/newsfeed.html",[],function(){return'<!-- activity/tpl/newsfeed.html -->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center">\n        <div class="title" id="page_title">\n            <%= _t(\'News Feed\') %>\n        </div>\n	</div>\n	<%= utils.helper.chat_header_btn() %>\n</div>\n<!-- swiper -->\n<div id="activity_minibar_holder" class="clearfix">\n	\n</div>\n<div id="newstory_view_holder" class="hide">\n	<!-- new story view -->\n</div>\n<div class="content content-background with-topbar swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<%= utils.helper.loadnew() %>\n			<div class="pvs"></div>\n			<div class="swiper-list vertical-align" id="activity-list"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n'}),define("text!activity/tpl/activity-newstory.html",[],function(){return"<div class=\"new-stage\">\n	<i class=\"icon-arrow-up\"></i>\n	<span>\n		<% if(number < 2){ %>\n		<%= number %> <%= _t('Story') %>\n		<% } else {%>\n		<%= number %> <%= _t('Stories') %>\n		<% } %>\n	</span>	\n</div>"}),define("activity/view/activity-newstory",["text!activity/tpl/activity-newstory.html"],function(e){return Backbone.View.extend({template:_.template(e),className:"activity-new-story",api:"feed/getupdate",defaults:{iMinId:0},query:{},interval:60,intervalProcessId:0,initialize:function(e,t,n){this.$scroller=n,this.$holder=t,this.$ajax=!1;var r=this;this.$scroller.on("loadnew:load",function(){r.hide(),r.$scroller.scrollTop(1)}).on("query:changed",function(e,t){t.iMinId&&t.iMinId+1!=r.query.iMinId&&r.resetQuery({iMinId:t.iMinId+1})})},render:function(){return this.$el.html(this.template({number:4})),this},inject:function(){return this.$holder.html(this.$el),this},hide:function(){this.$holder.addClass("hide")},show:function(){this.$holder.removeClass("hide")},updateView:function(e){this.$el.html(this.template({number:e})),e>0?this.$holder.removeClass("hide"):this.$hodler.addClass("hide")},events:{click:"onStickerClick"},onStickerClick:function(){this.$scroller.trigger("loadnew:start").trigger("loadnew:load")},fetchData:function(){if(!/#newsfeed/.test(utils.history.getCurrentUrl()))return;try{this.$ajax&&this.$ajax.abort(),this.intervalProcessId&&window.clearTimeout(this.intervalProcessId),this.intervalProcessId=0}catch(e){}this.$ajax=utils.api.get(this.api,this.query,{context:this}).done(this.fetchDone).always(this.fetchAlways)},fetchDone:function(e){if(e.error_code&&e.error_code>0)return;e.iTotalFeedUpdate&&this.updateView(e.iTotalFeedUpdate)},fetchAlways:function(){this.$ajax=!1;var e=this;this.intervalProcessId=window.setTimeout(function(){e.fetchData()},this.interval*1e3)},resetQuery:function(e){var t=this;try{this.$ajax&&this.$ajax.abort(),this.intervalProcessId&&window.clearTimeout(this.intervalProcessId),this.intervalProcessId=0}catch(n){}this.query=$.extend({},this.defaults,e),this.intervalProcessId=window.setTimeout(function(){t.fetchData()},this.interval*1e3)}})}),define("activity/view/newsfeed",["text!activity/tpl/newsfeed.html","activity/view/activity-list","activity/view/activity-minibar","activity/view/activity-newstory"],function(e,t,n){var r=require("activity/view/activity-newstory");return Backbone.View.extend({region:{holder:"#main"},className:"newsfeed-page",template:_.template(e),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(e)),this.$scroller=this.$el.find("#content"),this},inject:function(){$(this.region.holder).html(this.$el),this.$scroller.ensureVerticalScroll();var e=this.$el.find("#newsfeed_new_story_stage");return this.listView=(new t({},this.$el.find("#activity-list"),this.$scroller,{loadmore:!0,loadnew:!0,checknew:!0,$elCheckNewStory:e})).render().inject(),this.miniBarView=(new n).render().inject(),this.newStoryView=(new r({},this.$el.find("#newstory_view_holder"),this.$scroller)).render().inject(),this},events:{"click #newsfeed_new_story_stage":"loadNew"},loadNew:function(e){this.$el.find("#newsfeed_new_story_stage").addClass("hide"),this.$el.find("#content").trigger("loadnew:start").trigger("loadnew:load")}})}),define("activity/controller/newsfeed",["activity/view/newsfeed"],function(e){function t(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({}).inject()}utils.router.route("newsfeed",t)}),define("text!activity/tpl/activity-detail.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n            <%= _t(\'News Feed\') %>\n        </div>\n	</div>\n</div>\n\n<!-- swiper -->\n<div class="content content-activity-detail content-background with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list vertical activity-item">\n				<div class="pvl"></div>\n	          	<div id="activity_detail_view_holder" class="clearfix">\n	                <div class="loading-initiator">\n	                    <!-- Loading ... --> \n	                </div>\n	            </div>\n                <!-- activity detail -->\n            </div>\n            <div id="activity_extra_holder" class="activity-detail hide"></div>\n            <div class="pvl"></div>\n			<%= utils.helper.loadmore() %>	\n		</div>\n	</div> \n</div>\n'}),define("text!activity/tpl/activity-detail-update.html",[],function(){return'<div class="item-wrapper">\n	<div class="item-image">\n		<img src="<%= item.getPosterImageSrc() %>" />\n	</div>\n	<div class="item-setting" clickable="true" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n		<i class="icon icon-setting"></i>\n	</div>\n	<div class="item-headline">\n		<% if (item.getActionType()==\'post\' || item.getActionType()==\'feed_comment\') { %>\n			<%= item.getHeadline() %>\n			<span class="feed-icon-privacy-status icon-privacy-everyone gray"></span>\n		<% } else { %>\n			<a href="<%=item.getPosterUrl()%>"><%= item.getPosterTitle() %></a>\n            <span class="feed-icon-privacy-status <%= item.getPrivacyClass() %> gray"></span>\n			<!-- <span class="feed-icon-privacy-status icon-privacy-friends gray"></span>\n			<span class="feed-icon-privacy-status icon-privacy-friends-of-friends active"></span>\n			<span class="feed-icon-privacy-status icon-privacy-only-me"></span>\n			<span class="feed-icon-privacy-status icon-privacy-custom gray"></span> -->\n			<% if(item.getHeadline()) { %>\n				<p><%= item.getHeadline() %></p> \n			<% } %>	\n		<% } %>\n	</div>\n	<div class="item-subline">\n		<i class="icon icon-time"></i>\n		<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n	</div>\n	<% if(item.hasStory()){ %>\n	<div class="clearfix item-story">\n		<%= utils.str.shorten(item.getStory(), 200, true) %>\n	</div>\n	<% } %>\n	<% if(item.hasAttachment()){ %>\n	<div class="clear item-attachment">\n		\n	</div>\n	<% } %>\n	<div class="pvm"></div>\n	<div class="actions-justify gray">\n		<div class="action-item <%= item.isLiked()?\' liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<i class="icon icon-activity-like"></i>\n			<span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>	\n		</div>\n		<% if(item.canComment()){%>\n		<div class="action-item js-comment-btn" id="<%= item.getDataId(\'comment\') %>" rel="delegate" data-display="focus">			\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>\n		</div>\n		<%} %>\n		<% if(item.canShare()) { %>\n		<div class="action-item" id="<%= item.getDataId(\'share\') %>" data-id="<%= item.getDataId() %>" rel="delegate">\n			<i class="icon icon-activity-share"></i>\n			<span class="text-label" data-suffix="true"><%= _t(\'Share\') %></span>\n		</div>\n		<%} %>\n	</div>\n</div>\n'}),define("text!activity/tpl/activity-detail-setting.html",[],function(){return'<div class="setting-list">\n    <div class="setting-item <%if (this.model.getDislikeCount() < 1) {%>hide<%}%>" id="dislike-list"></div>\n	<%if (item.canDislike()) {%>\n    <div class="setting-item" id="<%=item.getDataId(\'dislike\')%>" rel="delegate">\n        <%= item.isDisliked() ? _t(\'Remove Dislike\') : _t(\'Dislike\')%>\n    </div>\n    <%}%>\n	<% if(item.canDelete()){ %>\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n		<%= _t(\'Delete this post\') %>\n	</a>\n	<% } %>\n	<% if (!item.isOwner()) { %>\n	<a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n		<%= _t(\'Report this post\') %>\n	</a>\n	<% } %>	\n</div>\n'}),define("dislike/model/dislike",[],function(){return Backbone.Model.extend({idAttribute:"",defaults:{sModelType:"dislike",iDislikeId:0,iUserId:0,sFullName:"",sImage:""}})}),define("dislike/collection/dislike",["dislike/model/dislike"],function(e){return Backbone.Collection.extend({model:e})}),define("text!dislike/tpl/dislike-detail.html",[],function(){return"<span class=\"you-dislike\"><%= phrase0 %></span>\n<%= phrase1 %>\n<% if(hasAnd){ %>\n<%= _t('and') %>\n<% } %>\n<% if (phrase2 != ''){ %>\n    <a id=\"other-dislikes\"><%= phrase2 %> </a> \n<%} %>\n<%= _t('disliked this') %>\n\n"}),define("text!dislike/tpl/dislike-list-item.html",[],function(){return'<div class="dislike_item">\n    <a href="#user/<%= iUserId %>">\n        <img src="<%= sImage %>" />\n        <span><%= utils.str.shorten(sFullName, 22) %></span>\n    </a>\n</div>\n\n'}),define("dislike/view/dislike-list-item",["text!dislike/tpl/dislike-list-item.html"],function(e){return Backbone.View.extend({template:_.template(e),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}),define("text!dislike/tpl/dislike-list.html",[],function(){return'<div id="dislike-list-wrapper">\n    <div class="popup-title"><%= _t(\'People who disliked this\') %></div>\n    <div id="dislike-list-content" class="swiper-container">\n        <div class="swiper-wrapper">\n            <div class="swiper-slide">\n                <div id="dislike-list-holder" class="dislike-list-holder">\n                	<div class="loading-initiator"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n'}),define("dislike/view/dislike-list",["dislike/model/dislike","dislike/view/dislike-list-item","text!dislike/tpl/dislike-list.html"],function(e,t,n){return Backbone.View.extend({events:{},region:{scroller:"#dislike-list-content",holder:"#dislike-list-holder"},template:_.template(n),render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$dislikeListHolder=this.$el.find(this.region.holder),this.isFirst=!0,this},inject:function(){return utils.popup.open(this.$el),constants.os_version<"30"&&this.$scroller.ensureSwiper(),this.fetchData(),this},fetchData:function(){var e={iAmountOfDislike:9999,iItemId:this.model.get("iItemId"),sItemType:this.model.get("sItemType"),sParentId:this.model.get("sParentId")},t={context:this,beforeSend:this.beforeSend};utils.api.post("like/dislikelistalldislike",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(n){this.isFirst&&(this.isFirst=!1,this.$dislikeListHolder.find(".loading-initiator").remove()),_.each(n,function(n){this.$dislikeListHolder.append((new t({model:new e({iDislikeId:n.iDislikeId,iUserId:n.iUserId,sFullName:n.sFullName,sImage:n.sImage})})).render().el)},this),constants.os_version<"30"&&this.$scroller.trigger("refresh")}})}),define("dislike/model/dislike-list",[],function(){return Backbone.Model.extend({defaults:{sItemType:"",iItemId:0}})}),define("dislike/view/dislike-detail",["text!dislike/tpl/dislike-detail.html","dislike/view/dislike-list","dislike/model/dislike-list"],function(e,t,n){return Backbone.View.extend({template:_.template(e),className:"dislike-content",events:{"click #other-dislikes":"handleClickOnOtherDislikes"},initialize:function(e){var t=this;this.model.on("change:bIsDisliked",function(){t.doUpdateDislike()})},doUpdateDislike:function(){this.render().inject()},handleClickOnOtherDislikes:function(){(new t({model:new n({iItemId:this.model.getId(),sItemType:this.model.getType(),sParentId:this.model.getParentModuleId()})})).render().inject()},render:function(){var e="You",t="",n="",r=this.model.getDislikeCount(),i=r-1,s=this.model.dislikes;return 1==this.model.isDisliked()?(t="",e="You",r>1&&(e="You and ",t="",n=i>1?i+" others":i+" other")):r>0&&s.length&&(t='<a href="#user/'+s.at(0).get("iUserId")+'" >'+s.at(0).get("sDisplayName")+"</a>",r>1&&(n=r-1,r-1>1?n+=" others":n+=" other")),r>1&&!this.model.isDisliked()&&(e="You and "),r<1?this.$el.addClass("hide"):this.$el.removeClass("hide"),this.$el.html(this.template({isDisliked:this.model.isDisliked(),phrase0:e,phrase1:t,phrase2:n,hasAnd:t!=""&&n!=""})),this.model.isDisliked()||this.$el.find(".you-dislike").addClass("hide"),this}})}),define("activity/view/activity-detail-setting",["text!activity/tpl/activity-detail-setting.html","dislike/collection/dislike","dislike/view/dislike-detail"],function(e,t,n){return Backbone.View.extend({template:_.template(e),render:function(){var e=this;return this.$el.html(this.template({item:this.model})),this.$dislikeHolder=this.$el.find("#dislike-list"),this.$dislikeBtn=this.$el.find("#"+this.model.getDataId("dislike")),this.model.on("change:iTotalDislike change:bIsDisliked",function(){e.updateView()}),this},inject:function(){return this.model.dislikes=new t,this.model.dislikes.add(this.model.getUserDislike()),this.$dislikeHolder.html((new n({model:this.model})).render().el),utils.popup.open(this.$el),this},updateView:function(){var e=this.model.getDislikeCount()<1?!0:!1;this.$dislikeHolder.toggleClass("hide",e);var t=this.model.isDisliked()?_t("Remove Dislike"):_t("Dislike");this.$dislikeBtn.html(t)}})}),define("activity/view/activity-detail",["activity/view/activity-item","text!activity/tpl/activity-detail.html","text!activity/tpl/activity-detail-update.html","activity/view/activity-detail-setting"],function(e,t,n,r){return e.extend({events:{},template:_.template(t),templateUpdate:_.template(n),settingView:r,className:"activity-detail-page",render:function(){var e=this;return this.$holder=$("#main"),this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find("#content"),this.$activityHolder=this.$el.find("#activity_extra_holder"),this.$detailHolder=this.$el.find("#activity_detail_view_holder"),this.$el.prop("id",this.model.getDataId()),this},inject:function(){return this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll(),utils.api.get("feed/get",{iActionId:this.model.getId(),bIsGetOneFeed:!0,sParentId:this.model.getParentModuleId()},{context:this}).done(function(e){this.model.set(e[0]),this.doUpdateView()}).fail(function(){utils.debug.log(arguments)}),utils.helper.addActivityExtraBlock(this.model,this.$activityHolder,this.$scroller),this},doUpdateView:function(){var e=this.model.hasAttachment();this.$detailHolder.html(this.templateUpdate({item:this.model,hasAttachment:e}));if(e){var t=utils.attachment.translate(this.model.getAttachmentType());this.$attachment=this.$el.find(".item-attachment"),t&&(this.attView=new t({model:this.model}),this.attView.render().inject(this.$attachment))}return this.$activityHolder.removeClass("hide"),this.$scroller.trigger("refresh"),this},doDeleteConfirm:function(e){var t=this;utils.popup.close(),utils.modal.confirm("Delete this post?",function(e){e==1&&t.doDelete()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},doDelete:function(){utils.api.post("feed/delete",{iActionId:this.model.getId(),sParentId:this.model.getParentModuleId()},{context:this}).done(function(e){e.error_code>0?this.doDeleteFail(e.messsage):this.doDeleteSuccess()}).fail(function(){this.doDeleteFail()})},doDeleteFail:function(e){utils.modal.alert(e||_t("Can not delete this post!"))},doDeleteSuccess:function(){utils.history.back()}})}),define("activity/controller/activity-detail",["activity/view/activity-detail","activity/model/feed"],function(e,t){function n(n,r,i){utils.history.push(),utils.observer.trigger("router:changed"),(new e({model:new t({iActionId:n,parentModuleId:i?i:""})})).render().inject()}utils.router.route("feed/:id(/:action)(/:parentId)",n),utils.router.route("feed/:id","activityDetail",n)}),define("text!activity/tpl/compose-status.html",[],function(){return'<!-- activity/tpl/compose-status.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="activity_status_post_btn">\n			<%= _t(\'Post\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title"><%= _t(\'Update Status\') %></div>\n	</div>\n</div>\n\n<div id="content" class="content with-header-footer swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="form-general form-update-status">\n                <div id="privacy_holder">\n                </div>\n				<div class="input-textarea">\n					<textarea class="fluid-no-border" id="activiy_status_compose_text" placeholder="<%= _t(\'What\\\'s on your mind...\') %>"></textarea>\n				</div>\n			</div>\n\n            <!-- To display attachmet here -->\n            <div id="compose_status_attachment_holder"> </div>\n		</div>\n	</div>\n\n</div>\n\n<!-- Select attachment type here -->\n<div id="compose_status_select_attachment_holder"> </div>\n'}),define("text!activity/tpl/compose-attachment.html",[],function(){return'<div class="footer with-action">\n	<div class="clearfix actions-justify gray">\n        <% if(exclude.indexOf(\'camera\') === -1) {%>\n		<div class="action-item js-status-add-attachment-link" data-type="camera" >\n			<i class="icon icon-attachment-camera"></i>\n		</div>\n        <% } %>\n\n        <% if(exclude.indexOf(\'gallery\') === -1) {%>\n		<div class="action-item js-status-add-attachment-link" data-type="gallery">\n			<i class="icon icon-attachment-gallery"></i>\n		</div>\n        <% } %>\n\n        <% if(exclude.indexOf(\'video\') === -1) {%>\n		<div class="action-item js-status-add-attachment-link" data-type="video">\n			<i class="icon icon-attachment-video"></i>\n		</div>\n        <% } %>\n\n        <% if(exclude.indexOf(\'checkin\') === -1) {%>\n		<div class="action-item js-status-add-attachment-link" data-type="checkin">\n			<i class="icon icon-attachment-checkin"></i>\n		</div>\n        <% } %>\n\n        <% if(exclude.indexOf(\'link\') === -1) {%>\n		<div class="action-item js-status-add-attachment-link" data-type="link">\n			<i class="icon icon-attachment-link"></i>\n		</div>\n        <% } %>\n\n	</div>\n</div>\n'}),define("text!activity/tpl/compose-attachment-link.html",[],function(){return'<div class="update-status-attachment-link">\n	<input type="submit" id="submit_link_btn" value="<%= _t(\'Save\') %>" class="btn btn-active">	\n	<div class="update-input-attachment-link">\n		<input class="control-full" placeholder="<%= _t(\'Insert URL\') %>" type="text" id="link_url" />\n	</div>\n</div>\n\n'}),define("text!activity/tpl/attachment-link.html",[],function(){return'<div class="user_add_content link">\n    <div class="close_button"><a href="javascript:void(0);" id="remove_attachment_btn"></a></div>\n    <div class="wrap">\n		<%if (sDefaultImage != null) {%><div class="wrap_img" style="background-image:url(<%=sDefaultImage%>);"></div><%}%>\n        <div class="wrap_content">\n            <%if (sTitle != null) {%><div class="link_post_title"><%=sTitle%></div><%}%>\n            <%if (sLink != null) {%><div class="link_post_source"><%=sLink%></div><%}%>\n            <%if (sDescription != null) {%><div class="link_post_desc"><%=utils.helper.shorten(sDescription, 200, "...")%></div><%}%>\n        </div>\n        <div class="clear"></div>\n    </div>\n</div>\n\n'}),define("activity/view/compose-attachment-link",["text!activity/tpl/compose-attachment-link.html","text!activity/tpl/attachment-link.html"],function(){var e=require("text!activity/tpl/compose-attachment-link.html"),t=require("text!activity/tpl/attachment-link.html"),n=Backbone.View.extend({region:{main:"#simple-popup",attachment_holder:"#compose_status_select_attachment_holder"},events:{"click #submit_link_btn":"submitLink"},template:_.template(e),render:function(){return this.$el.html(this.template()),this.$postBtn=$("#submit_link_btn",this.$el),this.$linkUrl=$("#link_url",this.$el),this},inject:function(){return utils.popup.open(this.$el),this},close:function(){return utils.popup.close(),this},submitLink:function(){if(this.$postBtn.hasClass("processing"))return!1;if(!this.isLinkValidate())return!1;var e={sLink:utils.helper.checkToAddHttpIntoLinkIfNeccessary(this.$linkUrl.val())},t={context:this,beforeSend:this.beforeSend};utils.api.post("link/preview",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){this.$postBtn.removeClass("processing"),this.$postBtn.val("Save")},beforeSend:function(){this.$postBtn.addClass("processing"),this.$postBtn.val("Saving...")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post link failed!"),!1;this.postSuccess(e)},isLinkValidate:function(){return this.$linkUrl.val().trim()===""?(utils.modal.alert("Please enter your link"),!1):!0},postSuccess:function(e){var n={sDefaultImage:e.sDefaultImage,sTitle:e.sTitle,sLink:e.sLink,sDescription:e.sDescription},r=_.template(t),i=r(n);utils.observer.trigger("attachment:success",{data:n,html:i,type:"link"}),utils.modal.toast("Submit link successfully"),this.close()}});return n}),define("text!activity/tpl/compose-attachment-video.html",[],function(){return'<div id="ynupdate_status_video_popup">\n	<div class="form-group">\n		<input class="control-full" placeholder="<%= _t(\'Video URL\') %>" type="text" id="video_url" />\n	</div>\n    <ul id="video_type_list">\n        <li data-type="1"><a data-type="1" href="javascript:void(0);">Youtube</a></li>\n        <li data-type="2"><a data-type="2" href="javascript:void(0);">Vimeo</a></li>\n    </ul>\n    <div class="clear"></div>\n    <input class="btn btn-active btn-small-fluid" type="submit" id="submit_video_btn" value="<%= _t(\'Save\') %>">\n</div>\n\n'}),define("text!activity/tpl/attachment-video.html",[],function(){return'<div class="user_add_content link">\n    <div class="close_button"><a href="javascript:void(0);" id="remove_attachment_btn"></a></div>\n    <div class="wrap">\n        <%if (sThumb != null) {%><img class="float" alt="" src="<%=sThumb%>" /><%}%>\n        <div>\n            <%if (sTitle != null) {%><div class="link_post_title"><%=sTitle%></div><%}%>\n            <%if (sLink != null) {%><div class="link_post_source"><%=sLink%></div><%}%>\n            <%if (sDescription != null) {%><div class="link_post_desc"><%= utils.helper.shorten(sDescription, 200, "...")%></div><%}%>\n        </div>\n    </div>\n</div>\n\n'}),define("activity/view/compose-attachment-video",["text!activity/tpl/compose-attachment-video.html","text!activity/tpl/attachment-video.html"],function(){var e=require("text!activity/tpl/compose-attachment-video.html"),t=require("text!activity/tpl/attachment-video.html"),n=Backbone.View.extend({initialize:function(){this.videoType=0},events:{"click #submit_video_btn":"submitVideo","click #video_type_list li":"changeVideoType"},region:{main:"#simple-popup"},template:_.template(e),render:function(){return this.$el.html(this.template()),this.$postBtn=$("#submit_video_btn",this.$el),this.$videoUrl=$("#video_url",this.$el),this},inject:function(){return utils.popup.open(this.$el),this},changeVideoType:function(e){var t=$(e.currentTarget);this.videoType=t.data("type"),$("#video_type_list li").removeClass("active"),t.addClass("active")},submitVideo:function(){if(this.$postBtn.hasClass("processing"))return!1;if(!this.isLinkValidate())return!1;var e={sLink:this.$videoUrl.val(),iType:this.videoType},t={context:this,beforeSend:this.beforeSend};utils.api.post("video/parser",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){this.$postBtn.removeClass("processing"),this.$postBtn.val("Save")},beforeSend:function(){this.$postBtn.addClass("processing"),this.$postBtn.val("Saving...")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},isLinkValidate:function(){return this.$videoUrl.val().trim()===""?(utils.modal.alert("Please enter your url"),!1):this.videoType===0?(utils.modal.alert("Please choose your video type"),!1):!0},postSuccess:function(e){var n={iVideoId:e.iVideoId,iPhotoId:e.iPhotoId,sTitle:e.sTitle,sDescription:e.sDescription,sThumb:e.sThumb,sLink:this.$videoUrl.val()},r=_.template(t),i=r(n);utils.observer.trigger("attachment:success",{data:n,html:i,type:"video"}),utils.modal.toast("Submit URL successfully"),this.close()},close:function(){return utils.popup.close(),this}});return n}),define("text!activity/tpl/compose-attachment-checkin.html",[],function(){return'<!-- activity/tpl/compose-attachment-checkin.html -->\n<div class="header">\n	<div class="header-left">\n        <div class="btn-top" id="checkin_back_btn">\n        	<%= _t(\'Cancel\') %>\n        </div>\n	</div>\n	<div class="header-right">\n		<!-- <div class="btn-top" id="activity_status_post_btn">Post</div> -->\n	</div>\n	<div class="header-center">\n		<div class="title"><%= _t(\'Check-in\') %></div>\n	</div>\n</div>\n\n<div id="content-bottom" class="content with-header swiper-container">\n    <div class="swiper-wrapper">\n        <div class="swiper-slide">\n            <div class="form-general update-status-checkin">\n                <!-- checkin -->\n                <div class="layout_container">\n                    <div class="content_container">\n                        <div class="yncheckin">\n                            <div id="location_map" class="map">\n                            </div>\n                            <div class="action_checkin">\n								<div class="form-group">\n									<input class="control-full" type="text" id="search_keyword" placeholder="Search your location"/>\n								</div>\n                                <div id="location_not_found" class="not-found hide"><span><%= _t(\'Location is not found.\') %></span></div>\n                                <div id="location_loading" class="not-found hide"><span><%= _t(\'Loading...\') %></span></div>\n\n                                <div class="checkin-list-content">\n                                    <div id="checkinlistviewitem">\n                                    </div>\n                                    <%= utils.helper.loadmore() %>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n\n'}),define("activity/model/checkinLocation",[],function(){var e=Backbone.Model.extend({});return e}),define("text!activity/tpl/checkin-location-item.html",[],function(){return'<div class="checkin-item" id="<%=id%>" data-longitude="<%=longitude%>" data-latitude="<%=latitude%>" data-name="<%=name%>">\n    <a href="javascript:void(0);" data-longitude="<%=longitude%>" data-latitude="<%=latitude%>" data-name="<%=name%>"><%=name%></a>\n    <!-- <span>70 Lu Gia - Quan 11</span> -->\n</div>\n'}),define("activity/view/checkin-location-item",["text!activity/tpl/checkin-location-item.html"],function(){var e=require("text!activity/tpl/checkin-location-item.html"),t=Backbone.View.extend({template:_.template(e),render:function(e){return this.$el.html(this.template(this.model.toJSON())),this}});return t}),define("text!activity/tpl/attachment-checkin-to-add.html",[],function(){return'<div class="user_add_content link">\n    <div class="close_button"><a href="javascript:void(0);" id="remove_attachment_btn"></a></div>\n    <div class="wrap">\n        <%if (sImage != null) {%><img class="float" alt="" src="<%=sImage%>" /><%}%>\n        <div>\n            <%if (sLocation != null) {%><div class="link_post_title"><%=sLocation%></div><%}%>\n        </div>\n        <div class="clear"></div>\n    </div>\n</div>\n\n'}),define("activity/view/compose-attachment-checkin",["text!activity/tpl/compose-attachment-checkin.html","activity/model/checkinLocation","activity/view/checkin-location-item","text!activity/tpl/attachment-checkin-to-add.html","core"],function(){var e=require("core"),t=require("text!activity/tpl/compose-attachment-checkin.html"),n=require("activity/model/checkinLocation"),r=require("activity/view/checkin-location-item"),i=require("text!activity/tpl/attachment-checkin-to-add.html");return Backbone.View.extend({initialize:function(){},events:{"click #checkin_back_btn":"handleBack","click #checkinlistviewitem .checkin-item":"handleSelectALocation"},region:{main:"#main-bottom",content:"#content-bottom"},template:_.template(t),render:function(e){var t=this;this.$el.html(this.template(e)),this.autoTrigger($("#search_keyword",this.$el),function(){t.checkin()}),this.$scroller=$("#checkinlistviewitem_id",this.$el),this.$notFound=$("#location_not_found",this.$el),this.$loading=$("#location_loading",this.$el),this.$mapHolder=this.$el.find("#location_map");var n={latitude:0,longitude:0},r=localStorage.getItem("checkin_coords");if(r){var i=JSON.parse(r);n=$.extend(n,i)}var s="http://maps.googleapis.com/maps/api/staticmap?center="+n.latitude+","+n.longitude+"&zoom=15&size="+screen.width+"x137"+"&maptype=roadmap&markers=color:red%7C"+n.latitude+","+n.longitude+"&sensor=false";return this.$mapHolder.html('<img src="'+s+'" height="137" />'),this.fetchLocation(),this},fetchLocation:function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){e.currentLong=t.coords.longitude,e.currentLat=t.coords.latitude,localStorage.setItem("checkin_coords",JSON.stringify({latitude:e.currentLat,longitude:e.longitude}));var n="http://maps.googleapis.com/maps/api/staticmap?center="+t.coords.latitude+","+t.coords.longitude+"&zoom=15&size="+screen.width+"x137"+"&maptype=roadmap&markers=color:red%7C"+t.coords.latitude+","+t.coords.longitude+"&sensor=false";e.$mapHolder.html('<img src="'+n+'" height="137" />'),e.checkin()},function(t){utils.modal.alert(t.message||_t("Device cannot get your current position!")),e.close()},{enableHighAccuracy:!1})},handleBack:function(){this.close()},inject:function(){var e=$(this.region.main),t=this;return e.html(this.el),this.content=$(this.region.content),this.content.vscroll(),this.content.on("loadmore:load",function(){t.checkin(!0)}),this},loadMore:function(){},checkin:function(e){if(typeof this.currentLong=="undefined")return utils.modal.alert("Device cannot get your current position!"),!1;if(this.nextPageToken==""&&e){utils.modal.toast("No more result"),this.content.trigger("loadmore:end");return}var t=$("#search_keyword").val(),n=2e3,e=typeof e!="undefined"?e:!1,r;this.searchRadius=n,this.searchKeyword=t,e||$("#checkinlistviewitem",this.$el).empty(),r="https://maps.googleapis.com/maps/api/place/nearbysearch/json?key="+constants.GOOGLE_API_KEY+"&sensor=true"+"&location="+this.currentLat+","+this.currentLong+"&keyword="+t+"&radius="+n,e&&typeof this.nextPageToken!="undefined"&&(r=r+"&pagetoken="+this.nextPageToken);var i={},s={context:this,beforeSend:this.beforeSend};$.ajax({url:encodeURI(r),context:this,beforeSend:this.beforeSend,type:"GET",cache:!1,timeout:4e4,data:i}).done(this.postDone).always(this.postComplete).fail(this.handleFail)},handleFail:function(){utils.modal.alert("Cannot get data from server.")},postComplete:function(){this.content.trigger("loadmore:end"),this.$loading.addClass("hide")},beforeSend:function(){this.$notFound.addClass("hide"),this.$loading.removeClass("hide")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){if(e.results.length>0){this.$notFound.addClass("hide");for(var t=0;t<e.results.length;t++){var i=new n;i.set("id",t),i.set("name",e.results[t].name),i.set("icon",e.results[t].icon),i.set("longitude",e.results[t].geometry.location.lng),i.set("latitude",e.results[t].geometry.location.lat),$("#checkinlistviewitem",this.$el).append((new r({model:i})).render().el)}this.nextPageToken=e.next_page_token||"",console.log(this.nextPageToken)}else this.$notFound.removeClass("hide")},handleSelectALocation:function(e){var t=$(e.target),n=t.data(),r={name:n.name,latitude:n.latitude,longitude:n.longitude,sImage:"http://maps.googleapis.com/maps/api/staticmap?center="+n.latitude+","+n.longitude+"&zoom=14&size=100x100"+"&maptype=roadmap&markers=color:red%7C"+n.latitude+","+n.longitude+"&sensor=false",sLocation:n.name},s=_.template(i),o=s(r);utils.observer.trigger("attachment:success",{data:r,html:o,type:"checkin"}),this.close(),utils.modal.toast("Choose location successfully")},close:function(){$("body").removeClass("bottom-open"),utils.observer.trigger("bottom:close")},handleOnKeyup:function(){},autoTrigger:function(e,t,n){function s(){t()}var r,i=n||2e3;e.keyup(function(){clearTimeout(r),r=setTimeout(s,i)}),e.keydown(function(){clearTimeout(r)})}})}),define("text!activity/tpl/attachment-photo.html",[],function(){return'<div class="user_add_content photo">\n    <div class="wrap">\n        <div class="wrap_photo">\n            <div class="close_button"><a href="javascript:void(0);" id="remove_attachment_btn"></a></div>\n            <%if (sImgSrc != null) {%><img src="<%=sImgSrc%>" /><%}%>\n        </div>\n    </div>\n</div>\n\n'}),define("activity/view/compose-attachment",["text!activity/tpl/compose-attachment.html","activity/view/compose-attachment-link","activity/view/compose-attachment-video","activity/view/compose-attachment-checkin","text!activity/tpl/attachment-photo.html"],function(){var e=require("text!activity/tpl/compose-attachment.html"),t=require("activity/view/compose-attachment-link"),n=require("activity/view/compose-attachment-video"),r=require("activity/view/compose-attachment-checkin"),i=require("text!activity/tpl/attachment-photo.html"),s=Backbone.View.extend({initialize:function(){this.maximumAttachment=1,this.numOfAttachment=0,utils.observer.on("attachment:success",function(){this.numOfAttachment++},this),utils.observer.on("attachment:remove",function(){this.numOfAttachment--},this)},events:{"click .js-status-add-attachment-link":"addAttachment"},template:_.template(e),region:{main:"#compose_status_select_attachment_holder"},render:function(e){return this.context=$.extend({exclude:[]},e),this.$el.html(this.template(this.context)),this},inject:function(){console.log(this.region);var e=$(this.region.main);return e.html(this.el),this},addAttachment:function(e){var t=$(e.currentTarget).data();if(this.numOfAttachment>=this.maximumAttachment)return utils.modal.alert("Cannot contain more than one item. Please remove the current selection before adding another item."),!1;switch(t.type){case"video":this.addVideo();break;case"link":this.addLink();break;case"camera":this.addFromCamera();break;case"gallery":this.addFromGallery();break;case"checkin":this.addCheckin()}},browsePhotoSuccess:function(e){var t=_.template(i),n=t({sImgSrc:e}),r={sImgSrc:e};utils.observer.trigger("attachment:success",{data:r,html:n,type:"photo"})},browePhotoFail:function(e){},addFromGallery:function(){navigator.camera.getPicture(this.browsePhotoSuccess,this.browsePhotoFail,{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG})},addFromCamera:function(){function t(t){var n=t[0].fullPath;e.browsePhotoSuccess(n)}function n(e){}var e=this;navigator.device.capture.captureImage(t,n,{limit:1})},addLink:function(){this.composeLinkView=new t,this.composeLinkView.render().inject()},addVideo:function(){this.composeVideoView=new n,this.composeVideoView.render().inject()},addCheckin:function(){this.composeCheckinView=new r,this.composeCheckinView.render().inject(),$("body").addClass("bottom-open"),utils.observer.trigger("bottom:open")}});return s}),define("text!activity/tpl/privacy-holder.html",[],function(){return'\n<span class="icon-privacy-status <%= item.getClass() %> gray"></span>\n'}),define("text!activity/tpl/choose-privacy.html",[],function(){return'<div class="loading-initiator"></div>\n<!-- <div class="setting-list"> -->\n<!--     <a class="menu-item"> <span class="icon-privacy-status icon-privacy-everyone gray"> </span> Everyone </a> -->\n<!--     <a class="menu-item"> <span class="icon-privacy-status icon-privacy-friends gray"></span> Friend </a> -->\n<!--     <span class="icon-privacy-status icon-privacy-friends-of-friends active"></span> -->\n<!--     <span class="icon-privacy-status icon-privacy-only-me"></span> -->\n<!--     <span class="icon-privacy-status icon-privacy-custom gray"></span> -->\n<!-- </div> -->\n'}),define("text!activity/tpl/choose-privacy-item.html",[],function(){return'<div class="privacy-item <% if(item.isChosen()) print(\'active\') %>" >\n    <span class="icon-privacy-status <%= item.getClass() %> gray"></span> <%= item.getPhrase() %>\n</div>\n'}),define("activity/view/choose-privacy-item",["text!activity/tpl/choose-privacy-item.html"],function(e){var t=Backbone.View.extend({template:_.template(e),initialize:function(){this.model.on("change",function(){this.render()},this)},events:{click:"setChosen"},setChosen:function(){this.model.collection.setChosen(this.model.id)},render:function(){return this.$el.html(this.template({item:this.model})),this}});return t}),define("activity/view/choose-privacy",["text!activity/tpl/choose-privacy.html","activity/view/choose-privacy-item"],function(){var e=require("text!activity/tpl/choose-privacy.html"),t=require("activity/view/choose-privacy-item"),n=Backbone.View.extend({initialize:function(){this.model.on("all",function(){this.updateView()},this),this.model.on("privacy-chosen",function(){this.close()},this)},className:"privacy-list",region:{},events:{},template:_.template(e),render:function(){return this.$el.html(this.template()),this},inject:function(){return utils.popup.open(this.$el),this.model.length>0&&this.updateView(),this},close:function(){return utils.popup.close(),this},updateView:function(e){this.$el.html(""),_.each(this.model.models,function(e){e.getValue()!=4&&this.$el.append((new t({model:e})).render().el)},this)}});return n}),define("activity/collection/privacy",["activity/model/privacy"],function(e){var t=Backbone.Collection.extend({model:e,setChosen:function(e){_.each(this.models,function(t){t.id==e?t.set("isChosen",!0):t.set("isChosen",!1)},this),this.trigger("privacy-chosen")},getChosen:function(){var t=this.findWhere({isChosen:!0});return t?t:new e({sValue:0,sPhrase:"everyone"})}});return t}),define("activity/view/privacy-holder",["text!activity/tpl/privacy-holder.html","activity/view/choose-privacy","activity/collection/privacy"],function(e){var t=require("activity/view/choose-privacy"),n=require("activity/collection/privacy"),r=Backbone.View.extend({template:_.template(e),initialize:function(){this.model=new n,this.model.on("privacy-chosen",function(){this.render()},this)},events:{click:"showPrivacy"},region:{main:"#privacy_holder"},render:function(){return this.$el.html(this.template({item:this.model.getChosen()})),this},getChosenValue:function(){return this.model.getChosen().getValue()},inject:function(){var e=$(this.region.main);return e.html(this.el),this},showPrivacy:function(){(new t({model:this.model})).render().inject(),this.fetchData()},fetchData:function(){var e={},t={context:this,beforeSend:this.beforeSend};utils.api.post("privacy/privacy",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post link failed!"),!1;this.postSuccess(e)},postSuccess:function(e){this.model.set(e)}});return r}),define("activity/view/compose-status",["text!activity/tpl/compose-status.html","activity/view/compose-attachment","activity/view/privacy-holder","core"],function(){var e=require("core"),t=require("text!activity/tpl/compose-status.html"),n=require("activity/view/compose-attachment"),r=require("activity/view/privacy-holder");return Backbone.View.extend({initialize:function(){utils.observer.on("attachment:success",this.handleAttachSucess,this),this.attachment={type:"text"}},events:{"click #activity_status_post_btn":"post","click #remove_attachment_btn":"removeAttachment","keyup #activiy_status_compose_text":"onKeyup","input #activiy_status_compose_text":"onKeyup","paste #activiy_status_compose_text":"onKeyup"},region:{main:"#main",content:"#content"},template:_.template(t),render:function(t){return this.context=$.extend({sItemType:"user",iItemId:e.viewer.getId()},t),this.$el.html(this.template(this.context)),this.$text=$("#activiy_status_compose_text",this.$el),this.$postBtn=$("#activity_status_post_btn",this.$el),this.$attachmentPickerHolder=$("#compose_status_select_attachment_holder",this.$el),this.$attachmentHolder=$("#compose_status_attachment_holder",this.$el),this},inject:function(){$(this.region.main).html(this.$el),this.$scroller=this.$el.find("#content"),this.$scroller.ensureVerticalScroll();var e=["video"];return(this.context.sItemType==="event"||this.context.sItemType==="fevent")&&e.push("checkin"),this.composeAttachment=(new n).render({exclude:e}).inject(),this.privacyView=(new r).render().inject(),(this.context.sItemType==="event"||this.context.sItemType==="fevent")&&this.privacyView.$el.addClass("hide"),this},handleAttachSucess:function(e){this.$attachmentHolder.html(e.html),this.attachment.data=e.data,this.attachment.type=e.type},removeAttachment:function(){this.$attachmentHolder.html(""),this.attachment={type:"text"},utils.observer.trigger("attachment:remove")},post:function(){if(this.$postBtn.hasClass("processing"))return!1;if(!this.isPostValidated())return!1;var e={sContent:this.$text.val(),iSubjectId:this.context.iItemId,sSubjectType:this.context.sItemType,iPrivacy:this.privacyView.getChosenValue()},t={context:this,beforeSend:this.beforeSend};switch(this.attachment.type){case"link":this.postStatusWithLink(e,t);break;case"video":this.postStatusWithVideo(e,t);break;case"photo":this.postStatusWithPhoto(e,t);break;case"checkin":this.postStatusWithCheckin(e,t);break;default:utils.api.post("feed/post",e,t).done(this.postDone).always(this.postComplete)}},postStatusWithPhoto:function(e,t){var n=this,r=this.attachment.data.sImgSrc,i=$.extend(e,{isPostStatus:!0,sStatusInfo:e.sContent,sSubjectType:e.sSubjectType,iSubjectId:e.iSubjectId});utils.api.uploadImage("photo/upload",r,i).done(function(e){n.postSuccess()}).fail(this.hanleUploadPhotoFail)},handleUploadPhotoSuccess:function(e,t,n){var r=n;r.iPhotoId!=null?(e.aAttachment={photo_id:r.iPhotoId,type:"photo"},utils.api.post("feed/post",e,t).done(this.postDone).always(this.postComplete)):utils.modal.alert("Can not upload file(s). Please try again later.")},hanleUploadPhotoFail:function(e){utils.modal.alert("Can not upload file(s). Please try again later."),utils.debug.error("Error upload file :"+JSON.stringify(e))},postStatusWithLink:function(e,t){e.aAttachment={uri:this.attachment.data.sLink,title:this.attachment.data.sTitle,description:this.attachment.data.sDescription,thumb:this.attachment.data.sDefaultImage,type:"link"},utils.api.post("feed/post",e,t).done(this.postDone).always(this.postComplete)},postStatusWithVideo:function(e,t){e.aAttachment={photo_id:this.attachment.data.iPhotoId,video_id:this.attachment.data.iVideoId,title:this.attachment.data.sTitle,description:this.attachment.data.sDescription,type:"video"},utils.api.post("feed/post",e,t).done(this.postDone).always(this.postComplete)},postStatusWithCheckin:function(e,t){e.sLocation=this.attachment.data.name,e.fLatitude=this.attachment.data.latitude,e.fLongitude=this.attachment.data.longitude,e.iUserId=e.iSubjectId,e.sStatus=e.sContent,utils.api.post("user/checkin",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){this.$postBtn.removeClass("processing")},beforeSend:function(){this.$postBtn.addClass("processing")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message),!1;this.postSuccess()},isPostValidated:function(){return this.$text.val().trim()===""?(utils.modal.alert("Please enter your message"),!1):!0},postSuccess:function(){utils.modal.toast("Post status successfully"),window.history.back()},triggerCamera:function(){this.composeAttachment.addFromCamera()},triggerCheckin:function(){this.composeAttachment.addCheckin()},onKeyup:function(e){var t=this.$text.val().trim()=="";t?this.$postBtn.addClass("disabled"):this.$postBtn.removeClass("disabled")}})}),define("activity/controller/activity-compose",["activity/view/compose-status"],function(e){function t(t,n){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sItemType:t,iItemId:n}).inject()}function n(t,n){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sItemType:t,iItemId:n}).inject().triggerCamera()}function r(t,n){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sItemType:t,iItemId:n}).inject().triggerCheckin()}utils.router.route("activity/compose-status(/:sItemType)(/:iItemId)",t),utils.router.route("activity/compose-status-photo(/:sItemType)(/:iItemId)",n),utils.router.route("activity/compose-status-checkin(/:sItemType)(/:iItemId)",r)}),define("like/model/like-detail",[],function(){return Backbone.Model.extend({defaults:{aLikes:[],bIsLike:!1,iTotalLike:0,iItemId:0,sItemType:""},getUserLikes:function(){return this.get("aUserLike")}})}),define("comment/model/comment",[],function(){return Backbone.Model.extend({idAttribute:"iCommentId",defaults:{sModelType:"core_comment",UserLike:[],bIsLiked:!1,iCommentId:0,iItemId:0,iTotalComment:0,iTotalLike:0,iUserId:0,sContent:"",sFullName:"",sImage:"",sItemType:"",sModelType:"",sTime:"",sTimeConverted:""},getContent:function(){return this.get("sContent")},getItemId:function(){return this.get("iItemId")},getLikeLabel:function(){var e="",t=this.getLikeCount();return t>0&&(e+=t+" "),e+(t>1?_t("likes"):_t("like"))},getDislikeLabel:function(){var e="",t=this.getDislikeCount();return t>0&&(e+=t+" "),e+(t>1?_t("dislikes"):_t("dislike"))},canDislike:function(){return utils.setting.get("like_allow_dislike")||!1}})}),define("comment/collection/comment",["comment/model/comment"],function(e){return Backbone.Collection.extend({model:e})}),define("comment/model/comment-list",["comment/collection/comment"],function(e){return Backbone.Model.extend({defaults:{aComments:new e,iTotalComment:0,iItemId:0,sItemType:""},getTotalComment:function(){return parseInt(this.get("iTotalComment"),10)},getComments:function(){return this.get("aComments")},getItemType:function(){return this.get("sItemType")},getItemId:function(){return this.get("iItemId")}})}),define("like/model/like",[],function(){return Backbone.Model.extend({idAttribute:"",defaults:{sModelType:"like",iLikeId:0,iUserId:0,sFullName:"",sImage:""}})}),define("like/collection/like",["like/model/like"],function(e){return Backbone.Collection.extend({model:e})}),define("text!comment/tpl/post-comment.html",[],function(){return'<div class="btn-comment">\n	<input type="submit" class="btn btn-large-fluid btn-primary" id="submit-comment-btn" value="<%= _t(\'Post\') %>"/>\n</div>\n<div class="input-comment">\n	<input type="text" class="control-full" id="comment-content" placeholder="<%= _t(\'Comment here\') %>"/>\n</div>'}),define("comment/view/post-comment",["text!comment/tpl/post-comment.html"],function(e){return Backbone.View.extend({template:_.template(e),events:{"click #submit-comment-btn":"postComment"},postComment:function(){if(this.$postBtn.hasClass("processing"))return!1;if(this.$content.val().trim()=="")return utils.modal.alert("Please enter your comment"),!1;var e={sItemType:this.model.getType(),sParentId:this.model.getParentModuleId(),iItemId:this.model.getId(),sText:this.$content.val()},t={context:this,beforeSend:this.beforeSend};utils.api.post("comment/add",e,t).done(this.postDone).always(this.postComplete)},render:function(e){return this.$el.html(this.template()),this.$content=$("#comment-content",this.$el),this.$postBtn=$("#submit-comment-btn",this.$el),this.model.canComment()||this.$el.addClass("hide"),this},postComplete:function(){this.$postBtn.removeClass("processing")},beforeSend:function(){this.$postBtn.addClass("processing")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){e.parentModuleId=this.model.getParentModuleId(),this.model.comments.add(e),this.model.set("iTotalComment",this.model.getCommentCount()+1),this.$content.val("")}})}),define("text!comment/tpl/comment-list.html",[],function(){return'<div class="loading-initiator hide">\n	\n</div>'}),define("text!comment/tpl/comment-item.html",[],function(){return'<div class="clearfix item-wrapper">\n	<a class="item-image" href="<%= item.getPosterUrl() %>" style="background-image: url(<%= item.getPosterImageSrc() %>); "></a>\n	<div class="item-headline">\n		<span><span class="icon icon-time"></span><%= item.getLivetime() %></span>\n		<a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n	</div>\n	<div class="item-content">\n	 	<%= utils.str.shorten(item.getContent(),100, true) %>\n	</div>\n	<div class="item-subline comment-action-holder"></div>\n</div>\n'}),define("text!comment/tpl/comment-action.html",[],function(){return'<div class="comment-action">\n	<div class="action-item">\n		<a class="text link-like <%if (item.isLiked()) {%>liked<%}%>"><%=item.getLikeLabel()%></a>		\n	</div>\n	<%if(item.canDislike()){%>\n	<span class="middot">-</span>\n	<div class="action-item">\n		<a class="text link-dislike <%if (item.isDisliked()) {%>disliked<%}%>"><%=item.getDislikeLabel()%></a>\n	</div>\n	<%}%>\n	<%if(item.isOwner()){%>\n	<span class="middot">-</span>\n	<div class="action-item">				\n		<a class="text delete-comment"><%= _t(\'delete\') %></a>\n	</div>\n	<%}%>\n</div>'}),define("text!like/tpl/like-list-item.html",[],function(){return'<div class="like_item">\n    <a href="#user/<%= iUserId %>">\n        <img src="<%= sImage %>" />\n        <span><%= utils.str.shorten(sFullName, 22) %></span>\n    </a>\n</div>\n\n'}),define("like/view/like-list-item",["text!like/tpl/like-list-item.html"],function(e){return Backbone.View.extend({template:_.template(e),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}),define("text!like/tpl/like-list.html",[],function(){return'<div id="like-list-wrapper">\n    <div class="popup-title"><%= _t(\'People who liked this\') %></div>\n    <div id="like-list-content" class="swiper-container">\n        <div class="swiper-wrapper">\n            <div class="swiper-slide">\n                <div id="like-list-holder" class="like-list-holder">\n                	<div class="loading-initiator"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n'}),define("like/view/like-list",["like/model/like","like/view/like-list-item","text!like/tpl/like-list.html"],function(e,t,n){return Backbone.View.extend({events:{},region:{scroller:"#like-list-content",holder:"#like-list-holder"},template:_.template(n),render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$likeListHolder=this.$el.find(this.region.holder),this.isFirst=!0,this},inject:function(){return utils.popup.open(this.$el),constants.os_version<"30"&&this.$scroller.ensureSwiper(),this.fetchData(),this},fetchData:function(){var e={iAmountOfLike:9999,iItemId:this.model.get("iItemId"),sItemType:this.model.get("sItemType"),sParentId:this.model.get("sParentId")},t={context:this,beforeSend:this.beforeSend};utils.api.post("like/listalllikes",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(n){this.isFirst&&(this.isFirst=!1,this.$likeListHolder.find(".loading-initiator").remove()),_.each(n,function(n){this.$likeListHolder.append((new t({model:new e({iLikeId:n.iLikeId,iUserId:n.iUserId,sFullName:n.sFullName,sImage:n.sImage})})).render().el)},this),constants.os_version<"30"&&this.$scroller.trigger("refresh")}})}),define("like/model/like-list",[],function(){return Backbone.Model.extend({defaults:{sItemType:"",iItemId:0}})}),define("comment/view/comment-item",["text!comment/tpl/comment-item.html","text!comment/tpl/comment-action.html","like/view/like-list","like/model/like-list"],function(e,t,n,r){return Backbone.View.extend({events:{"click .delete-comment":"onDelete","click .link-like":"onLikeClick","click .link-dislike":"onDislikeClick","click .other-likes":"handleClickOnOtherLikes"},className:"comment-item",template:_.template(e),templateAction:_.template(t),initialize:function(){var e=this;this.model.on("change:bIsLiked change:bIsDisliked",function(){e.updateView()})},render:function(){return this.$el.html(this.template({item:this.model})),utils.debug.log(this.model),this.$el.find(".comment-action-holder").html(this.templateAction({item:this.model})),this},inject:function(e){return e(this.el),this},onDelete:function(e){var t=this;utils.modal.confirm("Do you want to delete this comment?",function(e){e==1&&t.deleteComment()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},deleteComment:function(){var e={iCommentId:this.model.getId(),iItemId:this.model.getItemId(),sItemType:this.model.getItemType()},t={context:this,beforeSend:this.beforeSend};utils.api.post("comment/remove",e,t).done(this.postDone).always(this.postComplete).fail(this.postFail)},postComplete:function(){},beforeSend:function(){this.$el.addClass("hide")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),this.$el.removeClass("hide"),!1;this.postSuccess(e)},postSuccess:function(e){this.collection.remove(this.model),utils.modal.toast(_t("Delete comment successfully"))},postFail:function(){this.$el.removeClass("hide")},handleClickOnOtherLikes:function(){(new n({model:new r({iItemId:this.model.getId(),sItemType:this.model.getItemType()})})).render().inject()},updateView:function(){this.$el.find(".comment-action-holder").html(this.templateAction({item:this.model}))},onLikeClick:function(e){var t=$(e.currentTarget);if(t.isProcessing())return;t.isProcessing(!0);var n=this.model.isLiked(),r=this.model.getLikeCount(),i=n?"like/unlike":"like/like";this.model.set({bIsLiked:!n,iTotalLike:n?r-1:r+1});var s={iCommentId:this.model.getId(),iItemId:this.model.getItemId(),sItemType:this.model.getItemType(),sParentId:this.model.getParentModuleId()},o={context:this};utils.api.post(i,s,o).done(function(e){if(e.error_code&&e.error_code>0){utils.modal.alert(e.error_message||e.message||_t("Can not load data from server")),this.model.set({bIsLiked:n,iTotalLike:r});return}e.message&&utils.modal.toast(e.message)}).always(function(){t.isProcessing(!1)})},onDislikeClick:function(e){var t=$(e.currentTarget);if(t.isProcessing())return;t.isProcessing(!0);var n=this.model.isDisliked(),r=this.model.getDislikeCount(),i=n?"like/removedislike":"like/dislike";this.model.set({bIsDisliked:!n,iTotalDislike:n?r-1:r+1});var s={iCommentId:this.model.getId(),iItemId:this.model.getItemId(),sItemType:this.model.getItemType()},o={context:this};utils.api.post(i,s,o).done(function(e){if(e.error_code&&e.error_code>0){utils.modal.alert(e.error_message||_t("Can not load data from server")),this.model.set({bIsDisliked:n,iTotalDislike:r});return}e.message&&utils.modal.toast(e.message)}).always(function(){t.isProcessing(!1)})}})}),define("comment/view/comment-list",["text!comment/tpl/comment-list.html","comment/collection/comment","comment/view/comment-item"],function(e,t,n){return Backbone.View.extend({region:{more:".view-more-comment"},events:{"click .view-more-comment":"viewMoreComment"},className:"comment-list",template:_.template(e),isFirst:!0,initialize:function(e,t,n){this.processing=!1,this.$holder=t,this.$scroller=n;var r=this;this.model.comments.on("add",function(e){r.appendComment(e)},this).on("remove",function(){r.model.set("iTotalComment",r.model.getCommentCount()-1)})},loadMoreComment:function(){if(this.processing)return;var e={iItemId:this.model.getId(),sParentId:this.model.getParentModuleId(),sItemType:this.model.getType(),iLastCommentIdViewed:this.lastCommentId},t={context:this,beforeSend:this.beforeSend};utils.api.post("comment/listallcomments",e,t).done(this.postDone).always(this.postComplete)},render:function(){var e=this;return this.$el.html(""),this.$loadMore=$(this.region.more,this.$el),this.$noMoreComment=$(".no-more-comment",this.$el),this.$scroller.trigger("loadmore:end"),this.model.comments.each(function(e){this.appendComment(e)},this),setTimeout(function(){e.$scroller.trigger("loadmore:unlock").trigger("refresh")},1e3),this.checkLoadMore(),this.$scroller.on("loadmore:load",function(){e.loadMoreComment()}),this},inject:function(){return this.$holder.html(this.$el),this},checkLoadMore:function(){this.model.getCommentCount()>this.model.comments.length||(this.$scroller.data("loadmore_state",!1),this.$noMoreComment.removeClass("hide"))},appendComment:function(e){this.$el.append((new n({collection:this.model.comments,model:e})).render().el),this.lastCommentId=e.getId(),this.$scroller.trigger("refresh")},prependComment:function(e){this.$el.prepend((new n({collection:this.model,model:e})).render().el),this.lastCommentId==void 0&&(this.lastCommentId=e.getId()),this.$scroller.trigger("refresh")},postComplete:function(){this.processing=!1,this.$scroller.trigger("loadmore:end")},beforeSend:function(){this.processing=!0},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){this.model.comments.add(e),this.checkLoadMore()}})}),define("text!like/tpl/like-detail.html",[],function(){return"<span class=\"you-like\"><%= phrase0 %></span>\n<%= phrase1 %>\n<% if(hasAnd){ %>\n<%= _t('and') %>\n<% } %>\n<% if (phrase2 != ''){ %>\n    <a id=\"other-likes\"><%= phrase2 %> </a> \n<%} %>\n<%= _t('liked this') %>\n\n"}),define("like/view/like-detail",["text!like/tpl/like-detail.html","like/view/like-list","like/model/like-list","core"],function(e,t,n,r){return Backbone.View.extend({template:_.template(e),className:"like-content",events:{"click #other-likes":"handleClickOnOtherLikes"},initialize:function(e){var t=this;this.model.on("change:bIsLiked",function(){t.doUpdateLike()})},doUpdateLike:function(){this.render().inject()},handleClickOnOtherLikes:function(){(new t({model:new n({iItemId:this.model.getId(),sItemType:this.model.getType(),sParentId:this.model.getParentModuleId()})})).render().inject()},render:function(){var e="You",t="",n="",i=this.model.getLikeCount(),s=i-1,o=this.model.likes;if(1==this.model.isLiked())t="",e="You",i>1&&(e="You and ",t="",n=s>1?s+" others":s+" other");else if(i>0&&o.length){var u=0;o.at(0).get("iUserId")==r.viewer.getId()&&(u=1),t='<a href="#user/'+o.at(u).get("iUserId")+'" >'+o.at(u).get("sDisplayName")+"</a>",i>1&&(n=i-1,i-1>1?n+=" others":n+=" other")}return i>1&&!this.model.isLiked()&&(e="You and "),i<1?this.$el.addClass("hide"):this.$el.removeClass("hide"),this.$el.html(this.template({isLiked:this.model.isLiked(),phrase0:e,phrase1:t,phrase2:n,hasAnd:t!=""&&n!=""})),this.model.isLiked()||this.$el.find(".you-like").addClass("hide"),this}})}),define("text!activity/tpl/activity-extra.html",[],function(){return'<div id="like-list">\n	\n</div>\n<%if (item.canComment()) {%>\n<div id="comment-form">\n	\n</div>\n<%}%>\n<div id="comment_list_holder">\n    <div class="loading-initiator">\n    </div>\n</div>\n'}),define("activity/view/activity-extra",["like/model/like-detail","comment/model/comment-list","comment/collection/comment","like/collection/like","comment/view/post-comment","comment/view/comment-list","like/view/like-detail","text!activity/tpl/activity-extra.html"],function(e,t){var n=require("like/model/like-detail"),r=require("comment/model/comment-list"),i=require("comment/collection/comment"),s=require("like/collection/like"),e=require("comment/view/comment-list"),o=require("like/view/like-detail"),u=require("comment/view/post-comment"),t=require("text!activity/tpl/activity-extra.html");return Backbone.View.extend({className:"activity-extra",region:{main:"#activity_extra_holder",content:"#content"},initialize:function(e,t,n){this.$holder=t,this.$scroller=n},template:_.template(t),render:function(e){return this.$el.html(this.template({item:this.model})),this.fetchExtraData(),this.$likeHolder=this.$el.find("#like-list"),this.$commentListViewHolder=this.$el.find("#comment_list_holder"),this.$postCommentHolder=this.$el.find("#comment-form"),this},fetchExtraData:function(){var e={iItemId:this.model.getId(),sParentId:this.model.getParentModuleId(),sItemType:this.model.getType()},t={context:this};utils.api.post("statistic/info",e,t).done(this.postDone).always(this.postComplete)},inject:function(){return this.$holder.html(this.$el),this.$scroller.data("loadmore_state",!0),this},postComplete:function(){},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message),!1;this.postSuccess(e)},postSuccess:function(t){var n=this;this.model.likes=new s,this.model.likes.add(t.aLikes),this.$likeHolder.html((new o({model:this.model})).render().el),this.model.comments=new i(t.aComments),_.each(this.model.comments.models,function(e){e.set("parentModuleId",this.model.getParentModuleId())},this),this.model.set("bCanComment",t.bCanComment),this.postCommentView=new u({model:this.model}),this.$postCommentHolder.html(this.postCommentView.render().$el),this.commentListView=new e({model:this.model},this.$commentListViewHolder,this.$scroller),this.commentListView.render().inject(),this.postCommentView.on("comment:add",function(e){n.commentListView.prependComment(e)})}})}),define("activity/main",["core","activity/plugin/activity","activity/plugin/activity","activity/controller/newsfeed","activity/controller/activity-detail","activity/controller/activity-compose","activity/view/activity-extra"],function(e){var t=require("activity/view/activity-extra");utils.helper.addActivityExtraBlock=function(e,n,r){(new t({model:e},n,r)).render().inject()},e.sidebar.configs.set("new_feed",{icon:"icon-sidebar-activity",url:"#newsfeed",label:"News Feed"})}),define("activity",["activity/main"],function(e){return e}),define("beeber_box",[],function(){var e=function(e,t){this.isShown=!1,this.boxView=e;var n=this;$(document).on("click",t,function(){console.log("clicked on "+t),n.isShown?n.close():n.open()})};return e.prototype.open=function(){if(1==this.isShown)return this.isShown=!0;utils.observer.trigger("beeber:before_open",this),this.isShown=!0,this.view=new this.boxView,this.view.render().inject().open()},e.prototype.close=function(){0==this.isShown&&(this.isShown=!1),this.view.close(),this.isShown=!1,utils.observer.trigger("beeber:after_close",this)},e}),define("text!request/tpl/request-box.html",[],function(){return'<div id="box-request-content" class="box-request-content swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="request_list_view_holder" class="box-request-list">\n				\n			</div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>'}),define("request/model/request",[],function(){var e=Backbone.Model.extend({idAttribute:"iRequestId",defaults:{sModelType:"request",sRequestType:"friend_request"}});return e.prototype.getPosterId=function(){return this.get("iResourceId")},e.prototype.getPosterType=function(){return"user"},e.prototype.getPosterImageSrc=function(){return this.get("UserProfileImg_Url")},e.prototype.getRequestType=function(){return this.get("sRequestType")||""},e}),define("text!request/tpl/request-box-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading -->\n</div>'}),define("request/view/request-box-list",["request/model/request","text!request/tpl/request-box-list.html"],function(e,t){return Backbone.ListView.extend({defaults:{sView:"all",iPage:1,sSearch:"",iCategory:0,iAmountOfVideo:5},followById:!1,api:"notification/friendrequested",phraseNotFound:"No new friend request.",phraseNotMore:"No more friend request.",className:"friend-reques-list",template:_.template(t),itemModel:e,itemView:null,handleInjectItem:function(e,t){var n=utils.requestProxy.get(e);if(!n)return;this.$el.find("#request_item_"+e.getPosterId()).length==0&&(new n({model:e})).render().inject(t)}})}),define("request/view/request-box",["core","text!request/tpl/request-box.html","request/view/request-box-list"],function(e,t,n){return Backbone.View.extend({region:{wrapper:"#box-request",scroller:"#box-request-content",indicator:"#beeber-request-indicator",listViewHolder:"#request_list_view_holder"},template:_.template(t),render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$listViewHolder=this.$el.find(this.region.listViewHolder),this.$wrapper=$(this.region.wrapper),this.$indicator=$(this.region.indicator),this},inject:function(){return this.$wrapper.html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$listViewHolder,this.$scroller,{loadnew:!0,loadmore:!1}),this.listView.render().inject(),this},open:function(){return this.$wrapper.addClass("open"),this.$indicator.addClass("active"),this.$indicator.find(".beeber-counter").addClass("hide"),e.updater.setNumberNewRequest(0),this},close:function(){var e=this;return this.$wrapper.removeClass("open"),this.$indicator.removeClass("active"),window.setTimeout(function(){e.remove()},300),this}})}),define("request/plugin/request-box",["beeber_box","request/view/request-box"],function(e,t){return new e(t,"#beeber-request-indicator")}),define("request/main",["request/plugin/request-box"],function(){return{enable:!0}}),define("request",["request/main"],function(e){return e}),define("text!friend/tpl/request/friend-request.html",[],function(){return'<!-- video/tpl/video-item -->\n<div class="clearfix item-wrapper">\n	<div class="item-image">\n		<a href="<%= item.getPosterUrl() %>">\n            <img src="<%= item.getPosterImageSrc() %>" width="48" height="48"/>\n        </a>\n	</div>\n	<div class="item-headline">\n		<a href="<%= item.getPosterUrl() %>"><%= utils.str.shorten(item.getPosterTitle(),22,false) %></a> <%= _t(\'has sent a friend request\') %>\n	</div>\n	<div class="item-action">\n		<div class="btn btn-primary btn-long" id="friend_accept_btn"><%= _t(\'Accept\') %></div>\n		<div class="btn btn-default btn-long" id="friend_deny_btn"><%= _t(\'Deny\') %></div>\n	</div>\n</div>\n'}),define("friend/view/request/friend-request",["text!friend/tpl/request/friend-request.html"],function(e){return Backbone.View.extend({className:"beeber-request-item",template:_.template(e),render:function(){return this.$el.attr("id","request_item_"+this.model.getPosterId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.$el)},events:{"click #friend_accept_btn":"acceptFriend","click #friend_deny_btn":"denyFriend"},acceptFriend:function(e){var t=this,n=$(e.currentTarget);if(this.isProcessing())return;n.addClass("processing");var r={iUserId:this.model.getPosterId()};utils.api.post("friend/confirm",r).complete(function(){n.removeClass("processing")}).done(function(e){if(e.hasOwnProperty("error_code")&&e.error_code){utils.modal.alert(e.error_message);return}n.parent().html('<div class="friend-confirmed">Confirmed</div>')})},denyFriend:function(e){var t=this,n=$(e.currentTarget);if(this.isProcessing())return;n.addClass("processing");var r={iUserId:this.model.getPosterId()};utils.api.post("friend/deny",r).complete(function(){n.removeClass("processing")}).done(function(e){if(e.hasOwnProperty("error_code")&&e.error_code){utils.modal.alert(e.error_message);return}n.parent().html('<div class="friend-denied">Denied</div>')})},isProcessing:function(){return $("#friend_accept_btn").hasClass("processing")?!0:$("#friend_deny_btn").hasClass("processing")?!0:!1}})}),define("friend/plugin/request",["friend/view/request/friend-request"],function(e){utils.requestProxy.add(["friend_request"],e)}),define("friend/plugin/friend-action",[],function(e,t){utils.observer.on("friend:friend-action",function(e,t){var n=e.data("friend"),r=n.split(";"),i=parseInt(r[0],10),s=parseInt(r[1],10),o=parseInt(r[2],10),u=parseInt(r[3],10),a=["OK","cancel"],f=1,l=2,c=3,h,p,d,v,m,g=function(){e.isProcessing(!1)},y=function(){e.isProcessing(!0)},b=function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;w(e)},w=function(e){utils.observer.trigger("friend:action-done",{iItemId:i,isFriend:d,isSentRequest:v,isSentRequestBy:m}),utils.modal.toast("Action completed"),utils.popup.close()};s?(p="friend/delete",message="Do you want to remove this member from your friend list?",d=!1,v=!1,m=!1):o?(p="friend/cancelrequest",message="Do you want to cancel friend request to this member?",d=!1,v=!1,m=!1):u?(a=["Accept","Reject","Cancel"],f=1,c=2,l=3,p="friend/confirm",message="Do you want to confirm this friend request?",d=!0,v=!1,m=!1):(p="friend/add",message="Do you want to add this member to your friend list?",d=!1,v=!0,m=!1),e.isProcessing()?utils.modal.info("Item is processing"):utils.modal.confirm(message,function(e){var t={iUserId:i},n={beforeSend:y};e!=l&&(e===f?utils.api.post(p,t,n).done(b).always(g):e===c&&(d=!1,v=!1,m=!1,p="friend/deny",utils.api.post(p,t,n).done(b).always(g)))},_t("Confirm"),a)})}),define("friend/plugin/activity",[],function(){utils.headline.add("friends",function(e){return e.set("sContent",""),_t("%s is now friend with %s",e.getPosterLink(),e.getObjectLink(11))})}),define("text!friend/tpl/friend-index.html",[],function(){return'<!-- friend/tpl/friend-index.html-->\n<div class="header">\n    <% if(bIsRoot) {%>\n        <div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n            <i class="icon icon-sidebar"></i>\n        </div>\n    <% } else { %>\n        <div class="header-left">\n            <div class="btn-top btn-back" rel="back"></div>\n        </div>\n    <% } %>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Friends\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder"></div>\n\n<div class="content with-header with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'No friends found.\') %></div>\n			<div class="" id="friend_list_view_holder">\n				\n			</div>\n			<!-- currently list all friends, need improve to load more -->\n		</div>\n	</div>\n</div>\n'}),define("friend/model/friend",["require"],function(e){return Backbone.Model.extend({idAttribute:"id",defaults:{sModelType:"user"},isSelf:function(){return this.getId()==Backbone.iUserId},getName:function(){return this.get("sFullName")},getTitle:function(){return this.get("sFullName")},getUrl:function(){return"#user/"+this.getId()},getLink:function(){return'<a href="'+this.getUrl()+'">'+this.getTitle()+"</a>"},getMultualFriendCount:function(){return this.get("iMutualFriends")||0},getTextMutualFriend:function(){var e=this.get("iMutualFriends");return e+(e==1?" mutual friend":" mutual friends")},isFriend:function(){return this.get("isFriend")||!1},getImgSrc:function(){return this.get("UserProfileImg_Url")||""},isSentRequestBy:function(){return this.get("bSentRequestBy")||!1},isSentRequest:function(){return this.get("bSentRequest")||!1},getStatus:function(){return this.get("sStatus")||""},hasNewMessage:function(){return!!this.get("bHasNewMessage")}})}),define("text!friend/tpl/friend-item.html",[],function(){return'<!-- friend/tpl/friend-item -->\n<div class="clearfix item-wrapper">\n	<div class="item-image">\n		<a href="<%= item.getUrl() %>">\n			<img src="<%= item.getImgSrc() %>">	\n		</a>\n	</div>\n	<a class="item-headline" href="<%= item.getUrl() %>"><%= item.getPosterTitle() %></a>\n	<%if (!item.isSelf()) {%>\n    <div class="item-subline">\n		<span class="item-stats"><%= item.getTextMutualFriend() %></span>\n	</div>\n	<div id="item_action_holder" class="item-action">\n        <%if (item.isSentRequestBy()) {%>\n		<%} else if (item.isSentRequest()) {%>\n        <div class="request-sent"><%= _t(\'Request sent\') %></div>\n        <%} else if (!item.isFriend() && !item.isOwner()) {%>\n        <div id="add_friend_btn" class="btn btn-primary btn-long"><%= _t(\'Add friend\') %></div>\n        <%} else {%>\n        <a href="#messages/compose/<%=item.getId()%>" class="btn btn-primary btn-long"><%= _t(\'Send a message\') %></a>\n        <%}%>\n	</div>\n    <%}%>\n</div>'}),define("friend/view/friend-item",["text!friend/tpl/friend-item.html"],function(e){return Backbone.View.extend({region:{},className:"friend-item",template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.$el)},events:{"click #add_friend_btn":"addFriend"},addFriend:function(e){var t=$(e.currentTarget);if(t.hasClass("processing"))return;t.addClass("processing");var n={iUserId:this.model.getId()},r={context:this};utils.api.post("friend/add",n,r).always(function(){t.removeClass("processing")}).done(function(e){if(e.hasOwnProperty("error_code")&&e.error_code){utils.modal.alert(e.error_message);return}t.parent().html('<div class="request-sent">Request sent</div>')})}})}),define("text!friend/tpl/friend-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- loading friend -->\n</div>'}),define("friend/view/friend-list",["friend/model/friend","friend/view/friend-item","text!friend/tpl/friend-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sAction:"all",iAmountOfFriend:20,iPage:1},followById:!1,api:"friend/get",phraseNotFound:"No friends found.",phraseNotMore:"No more friends.",className:"friend-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!friend/tpl/friend-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search no-padding"></div>\n</div>\n<div id="adv_search_holder" class="search-advanced no-padding no-padding hide">\n\n	<div class="form-search-group include-btn-search">\n		<div class="form-group group-no-margin">\n			<span class="icon-search" id="search-button"></span>\n			<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search friend\') %>" value="" />\n		</div>\n	</div>\n\n</div>\n'}),define("friend/view/friend-search",["text!friend/tpl/friend-search.html"],function(e){return Backbone.View.extend({region:{wrapper:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.wrapper).html(this.$el),this},events:{"click #search_icon":"submitSearch","click #adv_search_toggle_btn":"toggleSearch"},toggleSearch:function(){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.trigger("submit",{sSearch:this.$keywordInput.val()||""})}})}),define("friend/view/friend-index",["text!friend/tpl/friend-index.html","friend/view/friend-list","friend/view/friend-search"],function(e,t,n){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content",listViewHolder:"#friend_list_view_holder"},template:_.template(e),render:function(e){return this.query=$.extend({},e),this.$el.html(this.template(this.query)),this.$scroller=this.$el.find(this.region.scroller),this.$listViewHolder=this.$el.find(this.region.listViewHolder),this},inject:function(){var e=this;return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.searchView=new n,this.searchView.render().inject(),this.searchView.on("submit",function(t){var n=$.extend({},e.query,t);e.listView.resetQuery(n)}),this.listView=new t({},this.$listViewHolder,this.$scroller,{loadmore:!0,loadnew:!1}),this.listView.render(this.query).inject(),this}})}),define("friend/controller/friend-index",["core","friend/view/friend-index"],function(e,t,n){function r(n){var r=!0;n&&(r=!1),utils.history.push(r),utils.observer.trigger("router:changed"),n=n||e.viewer.getId(),(new t).render({iUserId:n,bIsRoot:r}).inject()}utils.router.route("friends(/:userId)",r)}),define("friend/main",["core","friend/plugin/request","friend/plugin/friend-action","friend/plugin/activity","friend/controller/friend-index"],function(e){e.sidebar.configs.set("friend",{icon:"icon-sidebar-friend",label:"Friends",url:"#friends"})}),define("friend",["friend/main"],function(e){return e}),define("text!message/tpl/message-box.html",[],function(){return'<div class="box-header">\n	<a href="#messages/compose">\n		<i class="icon icon-compose-message"></i>\n		<span><%= _t(\'New Message\') %></span>\n	</a>\n</div>\n<div id="box-message-content" class="box-message-content swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="message_box_list_view_holder"></div>\n			<div class="pvm"></div>			\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="box-footer">\n    <div class="text-anchor">\n    	<div class=""><a href="#messages"><%= _t(\'See All\') %></a></div>\n    </div>\n</div>'}),define("message/model/conversation",[],function(){var e=Backbone.Model.extend({});return e.prototype.getId=function(){return this.get("iConversationId")},e.prototype.getUrl=function(){return"#message/"+this.getId()},e.prototype.getTitle=function(){return this.get("sTitle")},e.prototype.getDescription=function(){return this.get("sBody").replace(/\[img\][^\[]+\[\/img\]/gi,"")},e.prototype.getPosterTitle=function(){return this.get("sOwnerFullName")},e.prototype.getPosterImageSrc=function(){return this.get("sOwnerImage")},e.prototype.getPosterId=function(){return this.get("iOwnerId")},e.prototype.getPosterUrl=function(){return"#user/"+this.getPosterId()},e.prototype.getPosterLink=function(){return'<a href="'+this.getPosterUrl()+'">'+this.getPosterTitle()+"</a>"},e.prototype.isRead=function(){return!1!==this.get("bIsRead")},e.prototype.getPostedDate=function(){return this.get("sTimeConverted")},e.prototype.getFolder=function(){return this.get("sNameOfFolder")},e.prototype.isReply=function(){return this.get("bIsReply")?!0:!1},e.prototype.getRecipients=function(){return this.get("aRecipients")},e}),define("text!message/tpl/message-box-item.html",[],function(){return'<!-- message/message-box-item.html -->\n<a href="<%= item.getUrl() %>" class="clearfix item-wrapper">\n	<div class="item-image">\n		<img src="<%= item.getPosterImageSrc() %>"/>\n	</div>\n	<div class="item-headline">\n		<div class="item-subline">\n			<i class="icon icon-time"></i>\n			<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>	\n		</div>\n		<span><%= item.getPosterTitle() %></span>\n	</div>\n	<div class="item-description">\n		<%= item.getTitle() %>\n	</div>\n</a>\n'}),define("message/view/message-box-item",["text!message/tpl/message-box-item.html"],function(e){return Backbone.View.extend({className:"box-message-item",template:_.template(e),render:function(){return this.model.isRead()||this.$el.addClass("message-new"),this.$el.attr("id","message_item_"+this.model.getId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!message/tpl/message-box-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading ... -->\n</div>'}),define("message/view/message-box-list",["message/model/conversation","message/view/message-box-item","text!message/tpl/message-box-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"all",iPage:1,sSearch:"",iCategory:0,iAmountOfMessage:10},followById:!1,api:"message/inbox",phraseNotFound:"No messages found.",phraseNotMore:"No more messages.",className:"box-conversation-list",template:_.template(n),itemModel:e,itemView:t})}),define("message/view/message-box",["core","text!message/tpl/message-box.html","message/view/message-box-list"],function(e,t,n){return Backbone.View.extend({region:{wrapper:"#box-message",indicator:"#beeber-message-indicator",scroller:"#box-message-content",listViewHolder:"#message_box_list_view_holder",scroller:"#box-message-content"},events:{"click .box-footer":"viewAll"},template:_.template(t),viewAll:function(){utils.observer.trigger("router:changed"),window.location.href="#messages"},render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$listViewHolder=this.$el.find(this.region.listViewHolder),this.$wrapper=$(this.region.wrapper),this.$indicator=$(this.region.indicator),this},inject:function(){return this.$wrapper.html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$listViewHolder,this.$scroller,{loadnew:!1,loadmore:!0}),this.listView.render(this.query).inject(),this},open:function(){return this.$wrapper.addClass("open"),this.$indicator.find(".beeber-counter").addClass("hide"),this.$indicator.addClass("active"),e.updater.setNumberNewMessage(0),this},close:function(){var e=this;return this.$wrapper.removeClass("open"),this.$indicator.removeClass("active"),window.setTimeout(function(){e.remove()},300),this}})}),define("message/plugin/message-box",["beeber_box","message/view/message-box"],function(e,t){return new e(t,"#beeber-message-indicator")}),define("text!message/tpl/conversation-index.html",[],function(){return'<!-- message/tpl/message-index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n		<a class="btn-top btn-add" href="#messages/compose"></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title"><%= _t(filter == \'inbox\'? \'Inbox\': \'Sent\') %></div>\n	</div>\n</div>\n\n<div id="search_view_holder"></div>\n\n<div class="content with-header-footer body-bg with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'No messages found.\') %></div>\n			<div class="" id="conversation_list_view_holder">\n			</div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n        <a class="menu-item <%= filter == \'inbox\'? \'current\': \'\' %>" href="#messages">\n        	<div class=""><%= _t(\'Inbox\') %></div>\n        </a>\n        <a class="menu-item <%= filter == \'sent\'? \'current\': \'\' %>" href="#messages/sent">\n        	<div class="sibling"><%= _t(\'Sent\') %></div>\n        </a>\n    </div>\n</div>'}),define("text!message/tpl/conversation-item.html",[],function(){return'<!-- video/tpl/video-item -->\n<a href="<%= item.getUrl() %>" class="clearfix item-wrapper">\n	<div class="item-image">\n		<img src="<%= item.getPosterImageSrc() %>" width="48" height="48"/>\n	</div>\n	<div class="item-headline">\n		<div class="item-subline">\n			<%if (item.getFolder() != \'sent\') {%><span class="item-folder"><%=item.getFolder()%></span><%}%>\n			<i class="icon icon-time"></i>\n			<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n		</div>\n		\n		<span><%= item.getPosterTitle() %></span>\n	</div>\n	<div class="item-title">\n		<%if (item.isReply()) {%><%=_t(\'Re\')%>: <%}%><%= item.getTitle() %>\n	</div>\n	<div class="item-description">\n		<%= utils.str.shorten(item.getDescription(), 100) %>\n	</div>\n</a>\n'}),define("message/view/conversation-item",["text!message/tpl/conversation-item.html"],function(e){return Backbone.View.extend({region:{},className:"conversation-item",template:_.template(e),render:function(){return this.model.isRead()||this.$el.addClass("message-new"),this.$el.attr("id","conversation_item_"+this.model.getId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!message/tpl/conversation-list.html",[],function(){return'<div class="loading-initiator">\r\n	<!-- loading ... -->\r\n</div>\r\n'}),define("message/view/conversation-list",["message/model/conversation","message/view/conversation-item","text!message/tpl/conversation-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,sSearch:"",iCategoryId:0,iAmountOfMessage:10},followById:!1,api:"message/fetch",phraseNotFound:"No message found.",phraseNotMore:"No more message.",className:"conversation-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!message/tpl/conversation-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\n</div>\n<div id="adv_search_holder" class="search-advanced hide">\n	<div class="form-search-group include-btn-search">\n		<div class="form-group group-no-margin">\n			<span id="search_icon" class="icon-search"></span>\n			<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search your messages\') %>" value="">\n		</div>\n	</div>\n</div>'}),define("message/view/conversation-search",["text!message/tpl/conversation-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this},events:{"click #search_icon":"submitSearch","click #adv_search_toggle_btn":"toggleSearch"},toggleSearch:function(){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.trigger("submit",{sSearch:this.$keywordInput.val()||""})}})}),define("message/view/conversation-index",["text!message/tpl/conversation-index.html","message/view/conversation-list","message/view/conversation-search"],function(e){var t=require("message/view/conversation-list"),n=require("message/view/conversation-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(e){return this.query=$.extend({},{filter:"inbox"},e),this.$el.html(this.template(this.query)),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#conversation_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!0}),this.searchView=new n,this.searchView.render().inject(),this.listView.render(this.query).inject();var r=this;return this.searchView.on("submit",function(e){var t=$.extend({},r.query,e);r.listView.resetQuery(t)}),this}})}),define("message/controller/conversation-index",["core","message/view/conversation-index"],function(e,t){var n=function(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({filter:"inbox"}).inject()},r=function(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({filter:"sent"}).inject()};utils.router.route("messages",n),utils.router.route("messages/sent",r)}),define("text!message/tpl/conversation-detail.html",[],function(){return'<!-- message/tpl/message-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<a class="btn-top" href="#message/<%=iConversationId%>/reply"><%= _t(\'Reply\') %></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n			<%= _t(\'Loading ...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="content" class="content with-header-footer swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="message-recipient-list" class="hide">\n				<%= _t(\'Between\') %> <a href="<%=viewer.getUrl()%>"><%= _t(\'You\') %></a> \n				<%= _t(\'and\') %> <span id="recipients_list_less"></span>\n				<span id="recipients_list_more" class="hide"></span>\n	            <i id="toggle_recipients" class="hide"><%= _t(\'More\') %></i>\n            </div>\n			<div class="swiper-list vertical" id="message_list_view_holder"> <!-- message-list -->\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-1 fobos">\n        <a class="menu-item hide" id="conversation_reply_btn" href="#message-reply/<%=item.getId()%>">\n        	<div class=""><%= _t(\'Reply\') %></div>\n        </a>\n        <div class="menu-item">\n        	<div class="sibling" id="conversation_delete_btn"><%= _t(\'Delete\') %></div>\n        </div>\n    </div>\n</div>'}),define("message/model/message",[],function(){var e=Backbone.Model.extend({});return e.prototype.getId=function(){return this.get("iMessageId")},e.prototype.getConversationId=function(){return this.get("iConversationId")},e.prototype.getTitle=function(){return this.get("iConversationTitle")},e.prototype.getUrl=function(){return"#message/"+this.getId()},e.prototype.getPosterTitle=function(){return this.get("sFullName")},e.prototype.getPosterImageSrc=function(){return this.get("sImage")},e.prototype.getContent=function(){return this.get("sBody")},e.prototype.getPostedDate=function(){return this.get("sTimeConverted")},e.prototype.getPosterId=function(){return this.get("iUserId")},e.prototype.getPosterUrl=function(){return"#user/"+this.getPosterId()},e}),define("text!message/tpl/message-item.html",[],function(){return'<div class="clearfix message-item">\n	<div class="item-image">\n		<a href="<%= item.getPosterUrl() %>">\n			<img src="<%= item.getPosterImageSrc() %>" />\n		</a>\n	</div>\n	<div class="item-headline">\n		<div class="item-subline">\n			<i class="icon icon-time"></i>\n            <span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n		</div>\n		<a href="<%= item.getPosterUrl() %>">\n			<%= item.getPosterTitle() %>\n		</a>\n	</div>\n	<div class="item-description">\n		<%= item.getContent() %>\n	</div>\n	<div class="item-attachment">\n	</div>\n</div>'}),define("text!message/tpl/attachment/album_photo.html",[],function(){return'<div class="item-att-image" rel="link" data-url="#photo-detail/album_photo/0/<%=item.iId%>">\r\n	<img src="<%=item.sUrl%>" style="width: 100%" class="responsive-max-width"/>\r\n</div>\r\n<div class="item-att-title">\r\n	<a href="#album_photo/<%=item.iId%>"><%=item.sTitle%></a>\r\n</div>\r\n<div class="item-att-description">\r\n	<%=item.sDescription%>\r\n</div>'}),define("text!message/tpl/attachment/core_link.html",[],function(){return"<div class=\"item-att-image\">\r\n	<a href=\"javascript:window.open('<%=item.sLink_Url%>', '_blank', 'location=yes');\"><img src=\"<%=item.sUrl%>\" /></a>\r\n</div>\r\n<div class=\"item-att-title\">\r\n	<a href=\"javascript:window.open('<%=item.sLink_Url%>', '_blank', 'location=yes');\"><%=item.sTitle%></a>\r\n</div>\r\n<div class=\"item-att-description\">\r\n	<%=item.sDescription%>\r\n</div>"}),define("text!message/tpl/attachment/music_playlist_song.html",[],function(){return'<div class="item-att-image">\r\n	<a href="#music_playlist_song/<%=item.iId%>"><i class="icon-music"></i></a>\r\n</div>\r\n<div class="item-att-title">\r\n	<a href="#music_playlist_song/<%=item.iId%>"><%=item.sTitle%></a>\r\n</div>\r\n<div class="item-att-description">\r\n	<%=item.sDescription%>\r\n</div>'}),define("text!message/tpl/attachment/video.html",[],function(){return'<div class="item-att-image">\r\n	<a href="#video/<%=item.iId%>"><img src="<%=item.sUrl%>" /></a>\r\n</div>\r\n<div class="item-att-title">\r\n	<a href="#video/<%=item.iId%>"><%=item.sTitle%></a>\r\n</div>\r\n<div class="item-att-description">\r\n	<%=item.sDescription%>\r\n</div>'}),define("message/view/message-item-attachment",["text!message/tpl/attachment/album_photo.html","text!message/tpl/attachment/core_link.html","text!message/tpl/attachment/music_playlist_song.html","text!message/tpl/attachment/video.html"],function(){var e={album_photo:require("text!message/tpl/attachment/album_photo.html"),advalbum_photo:require("text!message/tpl/attachment/album_photo.html"),core_link:require("text!message/tpl/attachment/core_link.html"),music_playlist_song:require("text!message/tpl/attachment/music_playlist_song.html"),video:require("text!message/tpl/attachment/video.html")};return Backbone.View.extend({region:{},template:null,render:function(t){return this.template=_.template(e[t.sType]),this.$el.addClass("attachment_"+t.sType),this.$el.html(this.template({item:t})),this}})}),define("message/view/message-item",["text!message/tpl/message-item.html","message/view/message-item-attachment"],function(e,t){return Backbone.View.extend({template:_.template(e),render:function(){this.$el.html(this.template({item:this.model}));if(this.model.get("aAttachments")!=""){var e=this.$el.find(".item-attachment");e.html((new t).render(this.model.get("aAttachments")).el)}return this},inject:function(e){e(this.el)}})}),define("text!message/tpl/message-list.html",[],function(){return'<div class="loading-initiator">\n	\n</div>'}),define("message/view/message-list",["message/model/message","message/view/message-item","text!message/tpl/message-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1},followById:!1,api:"message/detail",phraseNotFound:"No messages found.",phraseNotMore:"No more messages.",className:"message-list",template:_.template(n),itemModel:e,itemView:t})}),define("message/view/conversation-detail",["core","text!message/tpl/conversation-detail.html","message/model/conversation","message/view/message-list"],function(e,t,n,r){return Backbone.View.extend({region:{main:"#main",content:"#content"},template:_.template(t),events:{"click #toggle_recipients":"toggleRecipients","click #conversation_delete_btn":"deleteConversation"},render:function(){return this.context={item:this.model,viewer:e.viewer},this.$el.html(this.template(this.context)),this.$pageTitle=this.$el.find("#page_title"),this.$replyBtn=this.$el.find("#conversation_reply_btn"),this.$listHolder=this.$el.find("#message_list_view_holder"),this},inject:function(){var e=this;this.$holder=$(this.region.main),this.$holder.html(this.$el),this.$scroller=this.$el.find(this.region.content),this.$scroller.ensureVerticalScroll(),utils.api.get("message/conversation_detail",{iConversationId:this.model.getId()}).done(function(t){if(t.hasOwnProperty("error_code")&&t.error_code){utils.modal.alert(t.error_message);return}e.model.set(t),e.updateInfo()}),(new r({},this.$listHolder,this.$scroller,{loadmore:!1,loadnew:!1})).render({iItemId:this.model.getId()}).inject()},updateInfo:function(){this.$pageTitle.html(this.model.getTitle()),this.model.getFolder()!="sent"&&this.$replyBtn.removeClass("hide"),this.appendRecipients()},appendRecipients:function(t){var t=this.model.getRecipients(),n=e.viewer.getId(),r=-1;$.each(t,function(e,t){t.iUserId==n&&(r=e)}),r>-1&&t.splice(r,1);var i=$("#recipients_list_less"),s=$("#recipients_list_more");i.empty(),s.empty(),i.append('<a href="#user/'+t[0].iUserId+'">'+t[0].sUserName+"</a>");if(t.length>1){i.append(" and "+(t.length-1)+" others");var o="";_.each(t,function(e){o+=', <a href="#user/'+e.iUserId+'">'+e.sUserName+"</a>"}),s.html(o.substring(2)),$("#toggle_recipients").removeClass("hide")}$("#message-recipient-list").removeClass("hide")},toggleRecipients:function(e){var t=$(e.currentTarget),n=$("#recipients_list_less"),r=$("#recipients_list_more");n.toggleClass("hide"),r.toggleClass("hide"),current=t.html(),t.html(current=="More"?"Less":"More")},deleteConversation:function(e){var t=this,n=$(e.currentTarget);if(n.hasClass("processing"))return;utils.modal.confirm("Are you sure to delete this message?",function(e){if(e==1){n.addClass("processing");var r={iItemId:t.model.getId(),sType:t.model.getFolder()=="sent"?"sentbox":t.model.getFolder()};utils.api.post("message/delete",r).done(function(e){if(e.hasOwnProperty("error_code")&&e.error_code){utils.modal.alert(e.error_message);return}utils.history.goRoot()}).complete(function(){n.removeClass("processing")})}},_t("Confirm"),[_t("Ok"),_t("Cancel")])}})}),define("message/controller/conversation-detail",["message/model/conversation","message/view/conversation-detail"],function(e,t){function n(n){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iConversationId:n})})).render().inject()}utils.router.route("message/:id",n)}),define("text!message/tpl/message-compose.html",[],function(){return'<!-- activity/tpl/newsfeed.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n    <div class="header-right">\n		<div class="btn-top disabled" id="post_message_btn">\n			<%= _t(\'Send\') %>	\n		</div>\n	</div>\n	<div class="header-center" href="#">\n		<div class="title">\n			<%= _t(\'Compose\') %>\n		</div>\n	</div>\n</div>\n\n<!-- swiper -->\n<div class="content with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list vertical">\n				<div class="clearfix jumptop"></div>\n				<div class="form-group">\n                    <div id="message_to_holder">\n                    </div>\n				</div>\n				<div class="form-group">\n					<input id="subject" type="text" class="control-full text" placeholder="Subject" />\n				</div>\n				<div class="from-group">\n					<textarea id="message" rows="4" class="control-full textarea" name="body" placeholder="Message"></textarea>\n				</div>\n\n                <div id="compose_message_attachment_holder"> </div>\n			</div>\n		</div>\n	</div>\n</div>\n\n\n<div id="compose_message_select_attachment_holder"> </div>\n\n'}),define("friend/collection/friend",["friend/model/friend"],function(e){return Backbone.Collection.extend({model:e})}),define("text!message/tpl/friend-list.html",[],function(){return'<div id="wrap_mail_to_user" class="wrap_mail_to_user">\n    <ul id="to_user_list" class="mail_list">\n        <li  class="list_user_send_last"><input type="text" id="mail_to_user" placeholder="<%= _t(\'To\') %>" /></li>\n        <div class="clear"></div>\n    </ul>\n</div>\n'}),define("text!message/tpl/friend-list-item.html",[],function(){return"<span><%=item.get('sFullName')%></span>\n<span class=\"friend_search_remove\" data-id=\"<%=item.get('id')%>\"><%= _t('Remove') %></span>\n\n"}),define("message/view/friend-list-item",["text!message/tpl/friend-list-item.html"],function(){var e=require("text!message/tpl/friend-list-item.html"),t=Backbone.View.extend({template:_.template(e),tagName:"li",className:"list_user_send",render:function(e){return this.context=$.extend({},e),$(this.el).html(this.template(this.context)),this}});return t}),define("message/view/friend-list",["core","friend/collection/friend","text!message/tpl/friend-list.html","message/view/friend-list-item"],function(){var e=require("core"),t=require("friend/collection/friend"),n=require("text!message/tpl/friend-list.html"),r=require("message/view/friend-list-item"),i=Backbone.View.extend({initialize:function(){this.selectedFriends=new t},events:{"click #wrap_mail_to_user":"focusToInput","click .friend_search_remove":"removeUser"},template:_.template(n),region:{main:"#message_to_holder"},render:function(e){return this.context=$.extend({},e),this.$el.html(this.template()),this.$inputText=$("#mail_to_user",this.$el),this.getFriends(),this},inject:function(){var e=$(this.region.main);return e.html(this.el),this},focusToInput:function(){this.$inputText.focus()},getFriends:function(){var t={iUserId:e.viewer.getId(),sAction:"all",iAmountOfFriend:9999},n={context:this,beforeSend:this.beforeSend};return utils.api.post("friend/get",t,n).done(this.postDone).always(this.postComplete),this},postComplete:function(){this.userSelected||this.changeInputPlaceHolder("To"),this.enableInput()},beforeSend:function(){this.changeInputPlaceHolder("Loading friend list ..."),this.disableInput()},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Cannot retrieve friend list. Please try again later"),!1;this.postSuccess(e)},postSuccess:function(e){var n=this;n.model=new t(e),null!=n.context.iUserId&&_.each(n.model.models,function(e){e.get("id")==n.context.iUserId&&(n.userSelected=!0,n.$inputText.val(""),n.changeInputPlaceHolder(""),n.$inputText.parent().before((new r).render({item:e}).el),n.selectedFriends.add(e),n.model.remove(e),n.toggleBtn())}),n.initAutoComplete()},disableInput:function(){this.$inputText.attr("disabled","disabled")},enableInput:function(){this.$inputText.removeAttr("disabled")},changeInputPlaceHolder:function(e){this.$inputText.attr("placeholder",e)},getSelectedFriends:function(){return this.selectedFriends},removeUser:function(e){var t=this,n=$(e.currentTarget);_.each(t.selectedFriends.models,function(e){e.get("id")==n.data("id")&&(t.selectedFriends.remove(e),t.model.add(e))}),n.parent().remove(),t.selectedFriends.length==0&&t.changeInputPlaceHolder("To"),t.toggleBtn()},toggleBtn:function(){var e=$("#post_message_btn");this.simpleValidate()?e.removeClass("disabled"):e.addClass("disabled")},simpleValidate:function(){var e=$("#subject"),t=$("#message"),n=this.selectedFriends;return n.length===0?!1:e.val().trim()===""?!1:t.val().trim()===""?!1:!0},initAutoComplete:function(){var e=this;this.$inputText.autocomplete({collection:this.model,attr:"sFullName",img_link:"UserProfileImg_Url",noCase:!0,ul_class:"autocomplete shadow",onselect:function(t){e.$inputText.val(""),e.changeInputPlaceHolder(""),e.$inputText.parent().before((new r).render({item:t}).el),e.selectedFriends.add(t),e.model.remove(t),e.toggleBtn(),setTimeout(function(){e.$inputText.focus()},200)},ul_css:{"z-index":1234}})}});return i}),define("message/view/message-compose",["core","text!message/tpl/message-compose.html","activity/view/compose-attachment","message/view/friend-list"],function(e,t){var n=require("activity/view/compose-attachment"),r=require("message/view/friend-list");return Backbone.View.extend({events:{"click #post_message_btn":"post","click #remove_attachment_btn":"removeAttachment"},removeAttachment:function(){this.$attachmentHolder.html(""),this.attachment={type:"text"},utils.observer.trigger("attachment:remove")},initialize:function(){utils.observer.on("attachment:success",this.handleAttachSucess,this),this.attachment={type:"text"}},region:{main:"#main",content:"#content"},handleAttachSucess:function(e){this.$attachmentHolder.html(e.html),this.attachment.data=e.data,this.attachment.type=e.type},template:_.template(t),render:function(e){var t=this;return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this.$attachmentHolder=$("#compose_message_attachment_holder",this.$el),this.$postBtn=$("#post_message_btn",this.$el),this.$to=$("#to",this.$el),this.$subject=$("#subject",this.$el),this.$message=$("#message",this.$el),this.$subject.bind("input propertychange",function(){t.toggleBtn()}),this.$message.bind("input propertychange",function(){t.toggleBtn()}),this},inject:function(){var e=$(this.region.main);e.html(this.el);var t=$(this.region.content);return t.vscroll(),this.composeAttachment=(new n({})).setRegion({main:"#compose_message_select_attachment_holder"}).render({exclude:["checkin","link","video"]}).inject(),this.friendList=(new r).render(this.context).inject(),this},getSelectedUserIds:function(){var e=$.map(this.friendList.getSelectedFriends().models,function(e,t){return e.id});return e.join(",")},post:function(){if(this.$postBtn.hasClass("processing"))return!1;if(!this.isPostValidate())return!1;var e={sUserIds:this.getSelectedUserIds(),sSubject:this.$subject.val(),sText:this.$message.val()},t={context:this,beforeSend:this.beforeSend};switch(this.attachment.type){case"link":this.sendMesageWithLink(e,t);break;case"video":this.sendMesageWithVideo(e,t);break;case"photo":this.sendMessageWithPhoto(e,t);break;case"checkin":this.postStatusWithCheckin(e,t);break;case"user":default:utils.api.post("message/compose",e,t).done(this.postDone).always(this.postComplete)}},sendMesageWithLink:function(e,t){e.attachmentData={uri:this.attachment.data.sLink,title:this.attachment.data.sTitle,description:this.attachment.data.sDescription,thumb:this.attachment.data.sDefaultImage,type:"link"},utils.api.post("message/compose",e,t).done(this.postDone).always(this.postComplete)},sendMesageWithVideo:function(e,t){e.attachmentData={photo_id:this.attachment.data.iPhotoId,video_id:this.attachment.data.iVideoId,title:this.attachment.data.sTitle,description:this.attachment.data.sDescription,type:"video"},utils.api.post("message/compose",e,t).done(this.postDone).always(this.postComplete)},sendMessageWithPhoto:function(e,t){function r(r){n.handleUploadPhotoSuccess(e,t,r)}function i(e){utils.debug.warn("[FAIL] message/attach",e)}var n=this;utils.api.uploadImage("message/attach",this.attachment.data.sImgSrc,{}).done(r).fail(i)},handleUploadPhotoSuccess:function(e,t,n){n.sImagePath!=null?(e.sText=e.sText+" "+n.sImagePath,e.attachmentData={type:"photo"},utils.api.post("message/compose",e,t).done(this.postDone).always(this.postComplete)):utils.modal.alert("Can not upload file(s). Please try again later.")},toggleBtn:function(){this.simpleValidate()?this.$postBtn.removeClass("disabled"):this.$postBtn.addClass("disabled")},simpleValidate:function(){var e=this.friendList.getSelectedFriends();return e.length===0?!1:this.$subject.val().trim()===""?!1:this.$message.val().trim()===""?!1:!0},isPostValidate:function(){var e=this.friendList.getSelectedFriends();return e.length===0?(utils.modal.alert("Please choose a recipient"),!1):this.$subject.val().trim()===""?(utils.modal.alert("Please enter the subject"),!1):this.$message.val().trim()===""?(utils.modal.alert("Please enter the message"),!1):!0},postComplete:function(){this.$postBtn.removeClass("processing")},beforeSend:function(){this.$postBtn.addClass("processing")},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message),!1;this.postSuccess()},postSuccess:function(){utils.modal.toast("Send message successfully"),window.location="#messages/sent"}})}),define("message/controller/message-compose",["core","message/view/message-compose"],function(e,t){function n(e){utils.history.push(),utils.observer.trigger("router:changed"),(new t).render({iUserId:e}).inject()}utils.router.route("messages/compose(/:id)",n)}),define("text!message/tpl/message-reply.html",[],function(){return'<!-- message/tpl/message-reply.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="send_btn"><%= _t(\'Send\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title" id="page_title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="content" class="content with-header-footer swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="message-recipient-list" class="hide">\n				<%= _t(\'Between\') %> <a href="<%=viewer.getUrl()%>"><%= _t(\'You\') %></a> \n				<%= _t(\'and\') %> <span id="recipients_list_less"></span>\n				<span id="recipients_list_more" class="hide"></span>\n	            <i id="toggle_recipients" class="hide"><%= _t(\'More\') %></i>\n            </div>\n			<div class="form-general">\n				<textarea class="fluid-no-border" id="reply_message" placeholder="<%= _t(\'Reply Message...\') %>"></textarea>\n			</div>\n		</div>\n	</div>\n</div>'}),define("message/view/message-reply",["core","text!message/tpl/message-reply.html"],function(e,t){return Backbone.View.extend({region:{main:"#main",content:"#content"},template:_.template(t),render:function(t){return this.context={viewer:e.viewer,iConversationId:t},this.$el.html(this.template(this.context)),this},inject:function(){var e=this,t=$(this.region.main);t.html(this.el);var n=$(this.region.content);return n.vscroll(),utils.api.get("message/conversation_detail",{iConversationId:this.context.iConversationId}).done(function(t){if(t.hasOwnProperty("error_code")&&t.error_code){utils.modal.alert(t.error_message);return}$("#page_title").html(t.sTitle),e.appendRecipients(t.aRecipients)}),this},appendRecipients:function(t){var n=this,r=e.viewer.getId(),i=-1;$.each(t,function(e,t){t.iUserId==r&&(i=e)}),i>-1&&t.splice(i,1);var s=$("#recipients_list_less"),o=$("#recipients_list_more");s.empty(),o.empty(),s.append('<a href="#user/'+t[0].iUserId+'">'+t[0].sUserName+"</a>");if(t.length>1){s.append(" and "+(t.length-1)+" others");var u="";_.each(t,function(e){u+=', <a href="#user/'+e.iUserId+'">'+e.sUserName+"</a>"}),o.html(u.substring(2)),$("#toggle_recipients").removeClass("hide")}$("#message-recipient-list").removeClass("hide")},events:{"click #toggle_recipients":"toggleRecipients","click #send_btn":"sendReply"},toggleRecipients:function(e){var t=$(e.currentTarget),n=$("#recipients_list_less"),r=$("#recipients_list_more");n.toggleClass("hide"),r.toggleClass("hide"),current=t.html(),t.html(current=="More"?"Less":"More")},sendReply:function(e){var t=$(e.currentTarget);if(t.hasClass("processing"))return;var n=$("#reply_message").val();if(n.trim()==""){utils.modal.alert("Please fill the message.");return}t.addClass("processing");var r={iItemId:this.context.iConversationId,sText:n};utils.api.post("message/reply",r).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));window.location.href="#messages/sent"}).complete(function(){t.removeClass("processing")})}})}),define("message/controller/message-reply",["core","message/view/message-reply"],function(e,t){function n(e){utils.history.push(),utils.observer.trigger("router:changed"),(new t).render(e).inject()}utils.router.route("message-reply/:id",n)}),define("message/main",["core","message/plugin/message-box","message/controller/conversation-index","message/controller/conversation-detail","message/controller/message-compose","message/controller/message-reply"],function(e){e.sidebar.configs.set("mail",{icon:"icon-sidebar-message",label:"Mails",url:"#messages"})}),define("message",["message/main"],function(e){return e}),define("text!link/tpl/attachment-link.html",[],function(){return'\n<div class="att-item-wrapper">\n	<div class="att-col-image">\n		<a href="javascript:void(0)" onclick="window.open(<%= onclick %>)">\n			<img class="att-item-image" src="<%= attachment.sPhoto_Url%>" />\n		</a>\n	</div>\n	<div class="att-col-info">\n		<div class="att-item-title">\n			<a href="javascript:void(0)" onclick="window.open(<%= onclick %>)">\n				<%= attachment.sTitle %>\n			</a>\n		</div>\n		<div class="att-item-subline"><%= domain %></div>\n		<div class="att-item-description"><%= utils.str.shorten(attachment.sDescription,100)%></div>\n	</div>\n</div>'}),define("link/view/attachment-link",["text!link/tpl/attachment-link.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-link",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n={item:e,attachment:t,domain:"",onclick:["'"+t.sOriginalLink_Url+"'","'_blank'","'location=yes'"].join(",")};return this.$el.html(this.template(n)),this},inject:function(e){e.html(this.el)}})}),define("link/plugin/activity",["link/view/attachment-link"],function(e){utils.attachment.add(["core_link","link"],e),utils.headline.add(["link"],function(e){return _t("shared a link")})}),define("link/main",["link/plugin/activity"],function(){return{enable:!0}}),define("link",["link/main"],function(e){return e}),define("text!notification/tpl/notification-box.html",[],function(){return'<div id="box-notification-content" class="box-notification-content swiper-container">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvs"></div>\n			<div id="notification_box_list_view_holder" class="box-notification-list"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="box-footer">\n    <div class="menu-item" id="mark_read_all_btn">\n    	<a class=""><%= _t(\'Mark all as read\') %></a>\n    </div>\n</div>'}),define("notification/plugin/notification-type",[],function(){function e(){this.maps={},this.add=function(e,t){for(var n=0;n<e.length;++n)this.maps[e[n]]=t;return this},this.getItemDetailUrl=function(e){var t=e.get("sTypeId");return this.maps.hasOwnProperty(t)?this.maps[t](e):"#none"}}var t=new e;return t.add(["comment_advancedphoto_tag","comment_event","comment_event_tag","comment_feed_tag","comment_fevent","comment_fevent_tag","comment_user_statustag","comment_videochannel","comment_videochannel_tag","event_approved","event_comment","event_comment_feed","event_invite","feed_comment_like","feed_comment_link","fevent_approved","fevent_comment","fevent_comment_feed","fevent_repeattonormalwarning","photo_approved","photo_tag","videochannel","videochannel_favourite"],function(e){return"#none"}),t.add(["comment_advancedphoto","advancedphoto_like"],function(e){return!e.get("aLink")||!e.get("aLink").iPhotoId?"#none":"#photo-detail/advancedphoto/0/"+e.get("aLink").iPhotoId}),t.add(["comment_photo","photo_like"],function(e){return!e.get("aLink")||!e.get("aLink").iPhotoId?"#none":"#photo-detail/photo/0/"+e.get("aLink").iPhotoId}),t.add(["event_comment_like","event_like"],function(e){return e.hasOwnProperty("iItemId")?"#event/"+e.iItemId:"#none"}),t.add(["fevent_comment_like","fevent_like"],function(e){return!e.get("aLink")||!e.get("aLink").iEventId?"#none":"#event/"+e.get("aLink").iEventId}),t.add(["comment_feed","comment_user_status","feed_comment_profile","feed_mini_like","user_status_like"],function(e){return!e.get("aLink")||!e.get("aLink").iFeedId?"#none":"#feed/"+e.get("aLink").iFeedId}),t.add(["friend_accept","friend_accepted"],function(e){return!e.get("aLink")||!e.get("aLink").iUserId?"#none":"#user/"+e.get("aLink").iUserId}),t.add(["comment_music_album","music_album_like"],function(e){return!e.get("aLink")||!e.get("aLink").iAlbumId?"#none":"#music_album/"+e.get("aLink").iAlbumId}),t.add(["comment_music_song","music_song_like"],function(e){return!e.get("aLink")||!e.get("aLink").iSongId?"#none":"#music_song/"+e.get("aLink").iSongId}),t.add(["comment_photo_album","photo_album_like"],function(e){return!e.get("aLink")||!e.get("aLink").iAlbumId?"#none":"#photo-album-detail/photo_album/"+e.get("aLink").iAlbumId}),t.add(["comment_advancedphoto_album","advancedphoto_album_like"],function(e){return!e.get("aLink")||!e.get("aLink").iAlbumId?"#none":"#photo-album-detail/advancedphoto_album/"+e.get("aLink").iAlbumId}),t.add(["video_like"],function(e){return!e.get("aLink")||!e.get("aLink").iVideoId?"#none":"#video/"+e.get("aLink").iVideoId}),t.add(["videochannel_like"],function(e){return!e.get("aLink")||!e.get("aLink").iVideoId?"#none":"#videochannel/"+e.get("aLink").iVideoId}),t}),define("notification/model/notification",["notification/plugin/notification-type"],function(e){return Backbone.Model.extend({idAttribute:"iNotificationId",defaults:{sResourceType:"user",iResourceId:0,sMessage:"",sUserImage:""},getTypeId:function(){return this.get("sTypeId")},getItemUrl:function(){return e.getItemDetailUrl(this)},getHeadline:function(){return this.get("sMessage")?this.get("sMessage").replace(/(<span [^>]+>)([^<]+)+(<\/span>)+/ig,'<span class="text-anchor">$2</span>'):""},getPosterImageSrc:function(){return this.get("sUserImage")}})}),define("text!notification/tpl/notification-box-item.html",[],function(){return'<!-- video/tpl/video-item -->\n<a href="<%= item.getItemUrl() %>">\n	<div class="clearfix item-wrapper">\n		<div class="item-image">\n			<img src="<%= item.getPosterImageSrc() %>" />\n		</div>\n		<div class="item-headline">\n			<%= item.getHeadline() %>\n		</div>\n		<div class="item-subline">\n			<i class="icon icon-notification-type <%= item.getTypeId() %>"></i>\n			<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n		</div>\n	</div>\n</a>\n'}),define("notification/view/notification-box-item",["text!notification/tpl/notification-box-item.html"],function(e){return Backbone.View.extend({region:{},className:"box-notification-item",template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.$el)},events:{"click a":"makeRead"},makeRead:function(e){var t=this,n={iNotificationId:this.model.getId()};utils.api.post("notification/makeread",n).done(function(e){if(e.hasOwnProperty("error_code")&&e.error_code){utils.modal.alert(e.error_message);return}t.$el.remove()})}})}),define("text!notification/tpl/notification-box-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading ... -->\n</div>'}),define("notification/view/notification-box-list",["notification/model/notification","notification/view/notification-box-item","text!notification/tpl/notification-box-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iMinId:0,iMaxId:0,iLimit:10},followById:!0,api:"notification/fetch_notification",phraseNotFound:"No notification found.",phraseNotMore:"No new notification.",className:"notification-list",template:_.template(n),itemModel:e,itemView:t,loadMoreSuccess:function(e){var t=this.parseData(e,this.itemModel),n=t.length,r=this.$el,i=this;this.isFirst&&(n?r.html(""):r.html(utils.helper.notfound(_t(this.phraseNotFound)))),this.isFirst=!1;var s=function(e){r.append(e).trigger("injected")};_.each(t,function(e){e.getHeadline()&&i.handleInjectItem(e,s)});if(n&&this.followById){var o=t[n-1].getId(),u=t[0].getId();this.query.iMinId=Math.max(o,u,this.query.iMinId),this.query.iMaxId=this.query.iMaxId>0?Math.min(o,u,this.query.iMaxId):Math.min(o,u)}else this.query.iPage=(this.query.iPage||0)+1;n?(this.settings.loadmore&&this.$scroller.trigger("loadmore:unlock"),this.settings.loadnew&&this.followById&&this.$scroller.trigger("loadnew:unlock")):this.isFirst||(this.settings.loadmore&&this.$scroller.trigger("loadmore:lock"),utils.modal.toast(_t(this.phraseNotMore))),this.$scroller.trigger("refresh").trigger("query:changed",this.query),this.$scroller.trigger("loadmore:end")}})}),define("notification/view/notification-box",["core","core/plugin/updater","text!notification/tpl/notification-box.html","notification/view/notification-box-list"],function(e,t,n,r){return Backbone.View.extend({region:{wrapper:"#box-notification",indicator:"#beeber-notification-indicator",listViewHolder:"#notification_box_list_view_holder",scroller:"#box-notification-content"},events:{"click #mark_read_all_btn":"markReadAll"},markReadAll:function(){var e=this;utils.api.post("notification/markreadall").done(function(n){t.setNumberNewNotification(0),e.close()})},template:_.template(n),viewAll:function(){utils.observer.trigger("router:changed"),window.location.href="#messages"},render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$listViewHolder=this.$el.find(this.region.listViewHolder),this.$wrapper=$(this.region.wrapper),this.$indicator=$(this.region.indicator),this},inject:function(){return this.$wrapper.html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new r({},this.$listViewHolder,this.$scroller,{loadnew:!1,loadmore:!0}),this.listView.render(this.query).inject(),this},open:function(){return this.$wrapper.addClass("open"),this.$indicator.find(".beeber-counter").addClass("hide"),this.$indicator.addClass("active"),e.updater.setNumberNewMessage(0),this},close:function(){var e=this;return this.$wrapper.removeClass("open"),this.$indicator.removeClass("active"),window.setTimeout(function(){e.remove()},300),this}})}),define("notification/plugin/notification-box",["beeber_box","notification/view/notification-box"],function(e,t){return new e(t,"#beeber-notification-indicator")}),define("notification/main",["notification/plugin/notification-box"],function(){return{enable:!0}}),define("notification",["notification/main"],function(e){return e}),define("text!video/tpl/attachment-video.html",[],function(){return'<!-- video/tpl/attachment/video.html -->\n<div class="att-item-image" style="background-image: url(<%= video.sPhoto_Url %>)">\n	<div class="icon icon-item-mask"></div>\n	<span class="att-item-length"><%= duration %></span>\n</div>\n<div class="att-item-info">\n	<div class="att-item-title text-link">\n		<a href="#video/<%= video.iId %>" ><%= video.sTitle%></a>\n	</div>\n	<div class="att-item-description">\n		<%= utils.str.shorten(video.sDescription || \'\', 85 , false) %>\n	</div>\n	<div class="att-item-subline"><%= fromDomain %></div>\n</div>\n'}),define("video/view/attachment-video",["text!video/tpl/attachment-video.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-video",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n=numeral(t.iDuration).format("00:00").replace(/^0:/,""),r=t.sOriginalLink_Url;return r=="www.uploaded.com"&&(r=""),this.$el.html(this.template({feed:e,video:t,duration:n,fromDomain:r})),this.$el.attr({rel:"link","data-url":"#video/"+t.iId}),this},inject:function(e){e.html(this.$el)}})}),define("video/plugin/activity",["video/view/attachment-video"],function(e){utils.headline.add(["comment_video","comment_videochannel","comment_ynvideo","ynvideo_comment_video"],function(e){return _t("%s commented on video %s",e.getPosterLink(),e.getItemLink(22))}),utils.headline.add(["video","videochannel"],function(e){return _t("shared a video")}),utils.headline.add(["video_new","videochannel_new","ynvideo_new"],function(e){return _t("%s posted new video %s",e.getPosterLink(),e.getItemLink(22))}),utils.headline.add(["video_add_favorite","videochannel_add_favorite","ynvideo_add_favorite"],function(e){return _t("%s added video %s to his/her favourite playlist%s",e.getPosterLink(),e.getItemLink(22))}),utils.headline.add(["video_playlist_new","videochannel_playlist_new","ynvideo_playlist_new"],function(e){return _t("%s posted a new video playlist",e.getPosterLink(),e.getItemLink(22))}),utils.attachment.add(["video","ynvideo","videochannel"],e)}),define("text!video/tpl/video-index.html",[],function(){return'<!-- video/tpl/index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n		<a class="btn-top btn-add" href="#videos/add"></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Videos\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder">\n	<!-- search box hear -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list vertical-align">\n				<div class="pvl"></div>\n				<div id="video_list_view_holder">\n\n				</div>\n				<%= utils.helper.loadmore() %>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n		<a class="menu-item current" href="#videos">\n		<div class="">\n			<%= _t(\'All Videos\') %>\n		</div> </a>\n		<a class="menu-item" href="#videos/my">\n		<div class="sibling">\n			<%= _t(\'My Videos\') %>\n		</div> </a>\n	</div>\n</div>\n'}),define("video/model/video",["core"],function(){var e=Backbone.Model.extend({idAttribute:"iVideoId",defaults:{sModelType:"video",bCanRate:!0,bCanLike:!0,bCanComment:!0,bCanShare:!0}});return e.prototype.isInProcess=function(){return this.get("bInProcess")},e.prototype.getEmbedHtml=function(){return this.get("sEmbed")},e.prototype.getImageSrc=function(){return this.get("sVideoImage")},e.prototype.getPosterUrl=function(){return"#user/"+this.getPosterId()},e.prototype.getDuration=function(){return parseInt(this.get("iDuration",10))||0},e.prototype.getDurationFormat=function(){return this.get("iDuration")},e.prototype.canRate=function(){return!0},e.prototype.getCategoryId=function(){return this.get("iCategory")||0},e.prototype.getViewPrivacyVal=function(){return this.get("iPrivacy")||"0"},e.prototype.getCommentPrivacyVal=function(){return this.get("iPrivacyComment")||"0"},e}),define("text!video/tpl/video-item.html",[],function(){return'<!-- video/tpl/video-item -->\n<div class="item-wrapper clearfix">\n	<a class="item-image" style="background-image: url(<%= item.getImageSrc() %>)" href="<%= item.getUrl() %>">\n		<div class="item-mask"></div>\n		<span class="item-video-length"><%= item.getDurationFormat() %></span>\n	</a>\n	<div class="item-video-info">\n		<div class="item-info-top">\n			<div class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n				<i class="icon icon-setting"></i>\n			</div>			\n			<div class="item-poster-image">\n				<img src="<%= item.getPosterImageSrc() %>" />\n			</div>\n			<div class="item-poster-link">\n				<a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n			</div>\n			<div class="item-posted-date">\n				<i class="icon icon-time"></i>\n	            <span class="livetime" data-livetime="1394763970"><%= item.getLivetime() %></span>\n			</div>\n			<div class="item-top-separator"></div>\n			<div class="item-headline" data-url="<%= item.getUrl() %>" rel="link">\n				<%= item.getTitle() %>\n			</div>\n			<div class="item-description">\n	            <%= utils.str.shorten(item.getDescription(), 150, false) %>\n			</div>\n		</div>\n		<div class="item-info-bottom">\n			<div class="actions-justify gray">\n				<div class="action-item can-rate <%= item.isRated()?\'rated\':\'\' %>" id="<%= item.getDataId(\'rate\') %>" rel="delegate">			\n					<i class="icon icon-activity-rate"></i>			\n					<span class="text-label" data-suffix="true"><%= item.getRateValueLabel() %></span>\n				</div>\n				<% if(item.canLike()){%>\n				<div class="action-item <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">				\n						<i class="icon icon-activity-like"></i>				\n						<span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>\n					</div>\n				<%} %>\n				<% if(item.canComment()){%>\n				<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate">\n					<i class="icon icon-activity-comment"></i>			\n					<span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>\n				</div>\n				<%} %>\n				<% if(item.canShare()){ %>\n				<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n					<i class="icon icon-activity-share"></i>			\n					<span class="text-label" data-suffix="true"><%= item.getShareCountLabel() %></span>\n				</div>\n				<% } %>\n			</div>\n		</div>\n	</div>\n</div>\n<div class="pvl"></div>\n'}),define("text!video/tpl/video-my-item.html",[],function(){return'<!-- video/tpl/video-item -->\n<div class="item-wrapper clearfix">\n	<a class="item-image" style="background-image: url(<%= item.getImageSrc() %>)" href="<%= item.getUrl() %>">\n		<div class="item-mask"></div>\n		<span class="item-video-length"><%= item.getDurationFormat() %></span>\n	</a>\n	<div class="item-video-info">\n		<div class="item-info-top">\n			<div class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n				<i class="icon icon-setting"></i>\n			</div>			\n			<div class="item-poster-image">\n				<img src="<%= item.getPosterImageSrc() %>" />\n			</div>\n			<div class="item-poster-link">\n				<a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n			</div>\n			<div class="item-posted-date">\n				<i class="icon icon-time"></i>\n	            <span class="livetime" data-livetime="1394763970"><%= item.getLivetime() %></span>\n			</div>\n			<div class="item-top-separator"></div>\n			<div class="item-headline" data-url="<%= item.getUrl() %>" rel="link">\n				<%= item.getTitle() %>\n			</div>\n			<div class="item-description">\n	            <%= utils.str.shorten(item.getDescription(), 150, false) %>\n			</div>\n		</div>\n\n		<div class="actions-justify gray">\n			<div class="action-item can-rate <%= item.isRated()?\'rated\':\'\' %>" id="<%= item.getDataId(\'rate\') %>" rel="delegate">			\n				<i class="icon icon-activity-rate"></i>			\n				<span class="text-info" data-suffix="true"><%= item.getRateValueLabel() %></span>\n			</div>\n			<% if(item.canLike()){%>\n			<div class="action-item <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">				\n					<i class="icon icon-activity-like"></i>				\n					<span class="text-info" data-suffix="true"><%= item.getLikeCountLabel() %></span>\n				</div>\n			<%} %>\n			<% if(item.canComment()){%>\n			<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate">\n				<i class="icon icon-activity-comment"></i>			\n				<span class="text-anchor" data-suffix="true"><%= item.getCommentCountLabel() %></span>\n			</div>\n			<%} %>\n			<% if(item.canShare()){ %>\n			<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n				<i class="icon icon-activity-share"></i>			\n				<span class="text-anchor" data-suffix="true"><%= item.getShareCountLabel() %></span>\n			</div>\n			<% } %>\n		</div>\n	</div>	\n</div>\n<div class="pvm"></div>'}),define("text!video/tpl/video-setting.html",[],function(){return'<div class="setting-list">\n	<% if(item.isOwner()){%>\n		<a class="setting-item" href="#videos/edit/<%= item.getId() %>">\n			<%= _t(\'Edit this video\') %>\n		</a>\n		<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n			<%= _t(\'Delete this video\') %>\n		</a>\n	<%}else{ %>\n		<a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n			<%= _t(\'Report this video\') %>\n		</a>\n	<% } %>\n</div>\n'}),define("video/view/video-setting",["text!video/tpl/video-setting.html"],function(e){return Backbone.PopupView.extend({template:_.template(e)})}),define("video/view/video-item",["text!video/tpl/video-item.html","text!video/tpl/video-my-item.html","video/view/video-setting"],function(e,t,n){return Backbone.ItemView.extend({className:"video-item",template:_.template(e),templateMy:_.template(t),settingView:n,events:{},render:function(e){return e=e||{},!_.isUndefined(e.sView)&&e.sView=="my"?this.$el.html(this.templateMy({item:this.model})):this.$el.html(this.template({item:this.model})),this.$el.attr("id",this.model.getDataId()),this},inject:function(e){return e(this.$el),this},doDeleteConfirm:function(){var e=this,t=_t("Are you sure to delete this video?");utils.popup.close(),utils.modal.confirm(t,function(t){t==1&&e.doDelete()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},doDelete:function(){var e=this;this.$el.addClass("hide"),utils.api.post("video/delete",{iVideoId:this.model.getId()}).done(function(t){t.error_code&&t.error_code>0?e.doDeleteFail(t):e.doDeleteSuccess(t)}).fail(function(){e.doDeleteFail()})},doDeleteFail:function(e){this.$el.removeClass("hide"),utils.modal.alert(e.error_message||_t("Can not delete this video"))},doDeleteSuccess:function(e){this.$el.remove(),utils.modal.toast(e.message)}})}),define("text!video/tpl/video-list.html",[],function(){return'<div id="video_list_holder">\n	<div class="loading-initiator"></div>\n</div>\n'}),define("video/view/video-list",["video/model/video","video/view/video-item","text!video/tpl/video-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"all",iPage:1,sSearch:"",iCategory:0,iAmountOfVideo:5,sOrder:"creation_date"},followById:!1,api:"video/search",phraseNotFound:"No videos found.",phraseNotMore:"No more videos.",className:"video-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!video/tpl/video-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>	\n</div>\n<div id="adv_search_holder" class="search-advanced hide">\n	<div class="form-search-group include-btn-search">\n		<div class="form-group">\n			<span id="search_icon" class="icon-search"></span>\n			<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search Video\') %>" value="">\n		</div>\n	</div>\n\n	<div class="form-search-group">\n		<div class="form-group">\n			<select class="control-full" id="search_category">\n                <option value="0" selected="true"><%= _t(\'All Categories\') %></option>\n            </select>\n        </div>\n    </div>\n    <div class="form-search-group">\n        <div class="form-group">\n			<select class="control-full" id="search_order">\n               <option value="creation_date" selected="true"><%= _t(\'Most Recent\') %></option>\n               <option value="view_count"><%= _t(\'Most Viewed\') %></option>\n               <option value="rating"><%= _t(\'Highest Rated\') %></option>\n            </select>\n        </div>\n	</div>\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>">\n	</div>\n</div>'}),define("video/view/video-search",["text!video/tpl/video-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$categoryInput=this.$el.find("#search_category"),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this.fetchData(),this},fetchData:function(){utils.api.get("video/categories",{},{context:this}).done(this.updateView)},updateView:function(e){if(e.error_code)return utils.modal.alert(e.error_message);_.each(e,function(e){this.$categoryInput.append(new Option(e.sName,e.iCategoryId))},this)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",iCategory:this.$categoryInput.val()||0,sOrder:this.$orderInput.val()||"creation_date"})}})}),define("video/view/video-index",["text!video/tpl/video-index.html","video/view/video-list","video/view/video-search"],function(e){var t=require("video/view/video-list"),n=require("video/view/video-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(){return this.$el.html(this.template()),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#video_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1}),this.searchView=new n,this.searchView.render().inject(),this.listView.render({}).inject();var r=this;return this.searchView.on("submit",function(e){r.listView.resetQuery(e)}),this}})}),define("text!video/tpl/video-my.html",[],function(){return'<!-- video/tpl/index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n		<a class="btn-top btn-add" href="#videos/add"></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Videos\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder">\n	<!-- search box hear -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list vertical-align">\n				<div class="pvl"></div>\n				<div id="video_list_view_holder">\n\n				</div>\n				<%= utils.helper.loadmore() %>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n		<a class="menu-item" href="#videos">\n		<div class="">\n			<%= _t(\'All Videos\') %>\n		</div> </a>\n		<a class="menu-item current" href="#videos/my">\n		<div class="sibling">\n			<%= _t(\'My Videos\') %>\n		</div> </a>\n	</div>\n</div>'}),define("text!video/tpl/video-my-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading -->\n</div>'}),define("video/view/video-my-list",["video/model/video","video/view/video-item","text!video/tpl/video-my-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"my",iPage:1,sSearch:"",iCategory:0,iAmountOfVideo:5},api:"video/search",phraseNotFound:"No videos found.",phraseNotMore:"No more videos.",className:"video-list",template:_.template(n),itemModel:e,itemView:t})}),define("video/view/video-my",["text!video/tpl/video-my.html","video/view/video-my-list","video/view/video-search"],function(e){var t=require("video/view/video-my-list"),n=require("video/view/video-search");return Backbone.View.extend({region:{main:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(){return this.$el.html(this.template()),this},inject:function(){var e=$(this.region.main).html(this.$el),r=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#video_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1}),this.searchView=new n,this.searchView.render().inject(),this.listView.render({}).inject();var i=this;return this.searchView.on("submit",function(e){i.listView.resetQuery(e)}),this}})}),define("video/controller/video-index",["video/view/video-index","video/view/video-my"],function(e,t){function n(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({sView:"all"}).inject()}function r(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({sView:"my"}).inject()}utils.router.route("videos",n),utils.router.route("videos/my",r)}),define("text!video/tpl/video-detail-info.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top btn-more hide" id="top_menu_toggle">\n		</div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div class="content content-background with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="video_detail_info_holder" class="video-detail-info">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n			<div id="activity_extra_holder" class="hide"></div>\n			<div class="pvl"></div>\n		</div>\n	</div>\n</div>\n'}),define("text!video/tpl/video-detail-info-update.html",[],function(){return'<!-- video/tpl/video-detail-info-update.html -->\n<div class="item-wrapper">\n	<div id="video-player" class="video-player">\n		<div id="video_in_process" class="in-process hide">\n			<%= _t(\'The video you are looking for has not been processed yet\') %>\n		</div>\n		<div id="mp4_uploaded_player" class="mp4-uploaded-player hide">\n			<!-- <video controls id="video_player_control" class="hide">\n	            <source src="" type="video/mp4">\n	        </video> -->\n		</div>\n		<div id="video_embed_iframe" class="video-embed-iframe hide">\n			\n		</div>\n	</div>\n	<div class="item-info-top">\n		<div class="item-poster-image">\n			<a href="<%= item.getPosterUrl() %>"><img src="<%= item.getPosterImageSrc() %>" /></a>\n		</div>\n		<div class="item-posted-date">\n			<i class="icon icon-time"></i>\n		    <span class="livetime" data-livetime="1394763970"><%= item.getLivetime() %></span>\n		</div>\n		<div class="item-poster-link">\n			<a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n		</div>	\n		<div class="item-top-separator"></div>\n		<div class="item-description">\n			<% if (item.getTitle()) { %>\n				<div class="item-headline">\n					<a href="<%= item.getUrl() %>"><%= item.getTitle() %></a>\n				</div>\n			<% } %>\n			<%= utils.str.shorten(item.getDescription(), 1000, true) %>\n		</div>\n		\n	</div>\n		\n		<div class="actions-justify gray">\n		<div class="action-item <%= item.isRated()?\'rated\':\'\' %>" id="<%= item.getDataId(\'rate\') %>" rel="delegate" data-fixtop="true" >			\n			<i class="icon icon-activity-rate"></i>\n			<span class="text-label" data-suffix="true"><%= item.getRateValueLabel() %></span>\n		</div>\n		<div class="action-item <%= item.isLiked()?\' liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">			\n			<i class="icon icon-activity-like"></i>\n			<span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>\n		</div>\n		<% if(item.canComment()){%>\n		<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate" data-display="focus">		\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>\n		</div>\n		<%} %>\n		<% if(item.canShare()) { %>\n		<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate" data-fixtop="true">\n			<i class="icon icon-activity-share"></i>\n			<span class="text-label" data-suffix="true"><%= item.getShareCountLabel() %></span>\n		</div>\n		<%} %>\n	</div>\n</div>\n'}),define("text!video/tpl/video-topmenu.html",[],function(){return'<div class="setting-list prevent-video-overlay">\n	<div class="setting-item <%if (this.model.getDislikeCount() < 1) {%>hide<%}%>" id="dislike-list"></div>\n	<%if (item.canDislike()) {%>\n    <div class="setting-item" id="<%=item.getDataId(\'dislike\')%>" rel="delegate">\n        <%= item.isDisliked() ? _t(\'Remove Dislike\') : _t(\'Dislike\')%>\n    </div>\n    <%}%>\n	<%if (item.isOwner()){%>\n	<a class="setting-item" href="#videos/edit/<%= item.getId()%>"><%= _t(\'Edit this video\') %></a>\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>"><%= _t(\'Delete this video\') %></a>\n	<% }else{ %>\n	<a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate"><%= _t(\'Report this video\') %></a>\n	<% } %>\n</div>\n'}),define("video/view/video-topmenu",["text!video/tpl/video-topmenu.html","dislike/collection/dislike","dislike/view/dislike-detail"],function(e,t,n){return Backbone.TopMenuView.extend({template:_.template(e),render:function(){var e=this;return this.$el.html(this.template({item:this.model})),this.$dislikeHolder=this.$el.find("#dislike-list"),this.$dislikeBtn=this.$el.find("#"+this.model.getDataId("dislike")),this.model.on("change:iTotalDislike change:bIsDisliked",function(){e.updateView()}),this},inject:function(){return this.model.dislikes=new t,this.model.dislikes.add(this.model.getUserDislike()),this.$dislikeHolder.html((new n({model:this.model})).render().el),utils.popup.open(this.$el),this},hide:function(){return utils.popup.close(),this},updateView:function(){var e=this.model.getDislikeCount()<1?!0:!1;this.$dislikeHolder.toggleClass("hide",e);var t=this.model.isDisliked()?_t("Remove Dislike"):_t("Dislike");this.$dislikeBtn.html(t)}})}),define("video/view/video-detail-info",["video/view/video-item","text!video/tpl/video-detail-info.html","text!video/tpl/video-detail-info-update.html","video/view/video-topmenu"],function(e,t,n,r){return e.extend({events:{"click #top_menu_toggle":"toggleTopMenu"},region:{holder:"#main",scroller:"#content",detailHolder:"#video_detail_info_holder",activityExtraHolder:"#activity_extra_holder",topMenu:"#top_menu_toggle"},className:"video-detail-page",template:_.template(t),topMenuView:r,templateDetail:_.template(n),render:function(){return this.$el.html(this.template({item:this.model})),this.$holder=$("#main"),this.$activityExtraHolder=this.$el.find(this.region.activityExtraHolder),this.$detailHolder=this.$el.find(this.region.detailHolder),this.$scroller=this.$el.find(this.region.scroller),this.$topMenuBtn=this.$el.find(this.region.topMenu),this.$el.attr({id:this.model.getDataId()}),this},inject:function(){return this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),utils.helper.addActivityExtraBlock(this.model,this.$activityExtraHolder,this.$scroller),this},fetchData:function(){var e={iVideoId:this.model.getId()},t={context:this};utils.api.get("video/detail",e,t).done(this.fetchDataComplete).fail(function(){utils.debug.log(arguments)})},fetchDataComplete:function(e){e.error_code&&e.error_code>0?utils.modal.alert(e.error_message):(this.model.set(e),this.updateView())},fetchDataFail:function(e,t){t=t||_t("Could not fetch data"),utils.modal.alert(t)},updateView:function(){if(this.model.get("bCanView")==0){this.$el.html(utils.helper.privatepage());return}this.$topMenuBtn.removeClass("hide"),this.$el.find("#page_title").html(this.model.getTitle()),this.$detailHolder.html(this.templateDetail({item:this.model})),this.model.get("bInProcess")&&this.$el.find("#video_in_process").removeClass("hide"),this.model.get("sVideoUrl")==""&&this.model.get("sType")=="uploaded"&&this.$el.find("#video_in_process").removeClass("hide");if(this.model.getEmbedHtml()!=""){var e=this.model.getEmbedHtml(),t=this.$el.find(".item-wrapper").width()-10;e=e.replace(/width=(\".*?\")/,'width="'+t+'"').replace(/height=(\".*?\")/,'height="'+t*9/16+'"'),this.$el.find("#video_embed_iframe").html(e).removeClass("hide")}if(null!=this.model.get("sVideoUrl")&&""!=this.model.get("sVideoUrl")){var n=this.model.get("sVideoUrl");this.$mp4VideoPlayer=this.$el.find("#mp4_uploaded_player"),this.$mp4VideoPlayer.html('<video controls id="video_player_control"><source src="'+n+'" type="video/mp4"></video>'),this.$mp4VideoPlayer.removeClass("hide")}this.$activityExtraHolder.removeClass("hide")},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model)},doDeleteConfirm:function(){var e=this;utils.modal.confirm(_t("Are you sure to delete this video?"),function(t){t==1&&e.doDelete()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},doDelete:function(){utils.observer.trigger("blockui");var e={iVideoId:this.model.getId()},t={context:this};utils.api.post("video/delete",e,t).always(function(){utils.observer.trigger("releaseui")}).done(function(e){e.error_code&&e.error_code>0?this.doDeleteFail(e):this.doDeleteSuccess(e)}).fail(function(){this.doDeleteFail()})},doDeleteSuccess:function(e){utils.modal.toast(e.message),utils.history.back()},doDeleteFail:function(e){utils.modal.alert(e.error_message||_t("Can not load data from server"))}})}),define("video/controller/video-detail",["video/model/video","video/view/video-detail-info"],function(e,t){function n(n,r){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iVideoId:n})})).render().inject()}function r(n,r){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iVideoId:n,sModelType:"videochannel"})})).render().inject()}utils.router.route("video/(:id)(/:comment)",n),utils.router.route("ynvideo/(:id)(/:comment)",n),utils.router.route("videochannel/(:id)(/:comment)",r)}),define("text!video/tpl/video-add.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="save_btn">\n			<%= _t(\'Save\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Upload Video\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvs"></div>\n			<div id="video-edit-form" class="form-general">\n				<div class="form-group">\n					<input type="text" class="control-full" id="ftitle" placeholder="<%= _t(\'Video name\') %>"/>\n				</div>\n				<div class="form-group">\n					<textarea class="control-full textarea" id="fdescription" placeholder="<%= _t(\'Description\') %>"></textarea>\n				</div>\n				\n				<div class="form-group">\n					<select class="control-full" id="fcategory_id">\n			            <option value=""><%= _t(\'Categories\') %></option>\n			        </select>\n			   </div>\n			   <div class="form-group">\n					<select class="control-full" id="fauth_view">\n						 <option value=""><%= _t(\'Privacy\') %></option>\n			        </select>\n			   </div>\n			   <div class="form-group">\n					<select class="control-full" id="fauth_comment">\n						 <option value=""><%= _t(\'Comment Privacy\') %></option>\n			        </select>\n				</div>\n				<div class="ynwrap_button enable">\n					<div class="btn btn-primary" id="from_device_btn">\n						<%= _t(\'From device\') %>\n					</div>\n					<div class="btn btn-primary" id="from_url_btn">\n						<%= _t(\'From URL\') %>\n					</div>\n				</div>\n				<div class="form-group attach-video-url-stage hide" id="attach_video_url_stage" >\n					<span id="video_url_text"></span>\n					<i class="icon icon-remove" id="close_btn"></i>\n				</div>\n				<input type="hidden" id="video_type" />\n				<input type="hidden" id="video_url" />\n				<input type="hidden" id="video_path" />\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("text!video/tpl/video-add-from-url.html",[],function(){return'<input placeholder="<%= _t(\'Video URL\') %>" type="text" id="video_url">\n<ul id="video_type_list">\n    <li class="video-type" data-type="1">Youtube</a></li>\n    <li class="video-type" data-type="2">Vimeo</li>\n</ul>\n<div class="clear"></div>\n<div class="btn btn-active btn-small-fluid" id="submit_video_from_url_btn"><%= _t(\'Save\') %></div>'}),define("video/view/video-add-from-url",["text!video/tpl/video-add-from-url.html"],function(){var e=Backbone.View.extend({initialize:function(e,t,n){this.deferred=t,this.settings=$.extend({needParse:!1},n)},id:"ynupdate_status_video_popup",template:_.template(require("text!video/tpl/video-add-from-url.html")),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this},inject:function(){return utils.popup.open(this.$el),this},events:{"click .video-type":"selectUrlType","click #submit_video_from_url_btn":"submitUrl"},submitUrl:function(e){var t=this.$("#video_url"),n=t.val(),r=this.settings.needParse,i=this.iVideoType,s=this.$("#submit_video_from_url_btn");if(s.isProcessing())return!1;if(utils.validator.isEmpty(n))return utils.modal.alert(_t("Please insert URL")),!1;if(!utils.validator.isUrl(n))return utils.modal.alert(_t("Link is not valid")),!1;if(!i)return utils.modal.alert(_t("Please choose video type")),!1;if(i==1&&!utils.validator.isYoutubeVideoUrl(n))return utils.modal.alert(_t("Link is not valid YouTube video")),!1;if(i==2&&!utils.validator.isVimeoVideoUrl(n))return utils.modal.alert(_t("Link is not valid Vimeo video")),!1;if(!r)return this.deferred.resolve({error_code:0,error_message:"",sVideoUrl:n,iVideoType:i}),utils.popup.close(),!0;utils.api.post("video/parser",{sLink:n,iType:i},{context:this,beforeSend:function(){s.isProcessing(!0),utils.observer.trigger("blockui")}}).done(function(e){console.log(e)}).fail(function(e){utils.modal.alert(e.error_message)}).always(function(){s.isProcessing(!1),utils.observer.trigger("releaseui")})},selectUrlType:function(e){var t=$(e.currentTarget);t.closest("ul").find("li").removeClass("active"),t.addClass("active"),this.iVideoType=t.data("type")}});return function(t,n){var r=$.Deferred(),i=(new e({},r,n)).render(t).inject();return i.deferred}}),define("video/view/video-add",["core","text!video/tpl/video-add.html","video/view/video-add-from-url"],function(e){return Backbone.View.extend({region:{main:"#main",content:"#content"},className:"page-event-edit",template:_.template(require("text!video/tpl/video-add.html")),render:function(e){var t=this;return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this.$saveBtn=this.$el.find("#save_btn"),this.$videoTitleInput=this.$el.find("#ftitle"),this.$videoUrlInput=this.$el.find("#video_url"),this.$videoTypeInput=this.$el.find("#video_type"),this.$attachVideoUrlStage=this.$el.find("#attach_video_url_stage"),this.$videoUrlInput=this.$el.find("#video_url"),this.$videoUrlText=this.$el.find("#video_url_text"),this.loadCategory(),this.loadPrivacy(),this.loadCommentPrivacy(),this.$el.find("input").bind("input propertychange",function(){var e=t.$videoTitleInput.val().trim()==""||t.$videoUrlInput.val().trim()=="";t.$saveBtn.toggleClass("disabled",e)}),this},inject:function(){var e=$(this.region.main);e.html(this.el);var t=$(this.region.content);return t.vscroll(),this},events:{"click #from_device_btn":"selectVideo","click #from_url_btn":"browseUrl","touchstart #video_type_list li":"selectUrlType","click #submit_btn":"saveData","click #close_btn":"cancelUrl","click #cancel_btn":"closePopup","click #save_btn":"saveVideo","click .overlayPopup_createVideo":"closePopup"},browseUrl:function(){if(this.$fromUrlBtn.hasClass("disabled"))return!1;var e=require("video/view/video-add-from-url"),t=this,n={needParse:!1};(new e(null,n)).done(function(e){console.log(e),t.attachVideoFromUrl(e)})},saveVideo:function(){if(this.$saveBtn.isProcessing())return!1;var e=this.$videoUrlInput.val(),t=this.$videoTitleInput.val(),n=this.$videoTypeInput.val();return utils.validator.isEmpty(t)?(utils.modal.alert("Video title is required"),!1):utils.validator.isEmpty(e)?(utils.modal.alert("Video URL is required"),!1):this.createVideoFromUrl()},collectFormData:function(){return{sUrl:this.$videoUrlInput.val(),type:this.$videoTypeInput.val(),parent_id:e.viewer.getId(),parent_type:"user",category_id:this.$el.find("#fcategory_id").val()||0,title:this.$videoTitleInput.val(),description:this.$el.find("#fdescription").val(),auth_view:this.$el.find("#fauth_view").val()||"0",auth_comment:this.$el.find("#fauth_comment").val()||"0",search:1}},createVideoFromUrl:function(){var e=this,t=this.collectFormData();this.$saveBtn.addClass("processing"),utils.api.post("video/create",t).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));utils.modal.toast(e.message),window.location.href="#videos/my"}).always(function(){e.$saveBtn.removeClass("processing")})},createVideoFromSource:function(){var e=this.collectFormData(),t=this.$videoPathInput.val();utils.api.uploadVideo("video/upload",t,e).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));utils.modal.toast(e.message),window.location.href="#videos/my"})},selectVideo:function(){function t(t){e.attachVideoFromDevice(t)}function n(e){}var e=this;navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,mediaType:Camera.MediaType.VIDEO})},loadCategory:function(){var e=this.$("#fcategory_id");utils.api.get("video/categories",{},{context:this}).done(function(t){_.each(t,function(t){e.append(new Option(t.sName,t.iCategoryId))})})},loadPrivacy:function(){var e=this.$("#fauth_view");utils.api.get("privacy/privacy",{},{context:this}).done(function(t){_.each(t,function(t){e.append(new Option(t.sPhrase,t.sValue))})})},loadCommentPrivacy:function(){var e=this.$("#fauth_comment");utils.api.get("privacy/privacycomment",{},{context:this}).done(function(t){_.each(t,function(t){e.append(new Option(t.sPhrase,t.sValue))})})},saveData:function(){if(!this.checkVideo())return;if($("#video_url").val()==""){utils.modal.alert("Please insert url");return}var e=window.localStorage.getItem("VideoCreateView.sUrlType");if(null==e||""==e){utils.modal.alert("Please choose you type video");return}$("#popupURL").removeClass("ynopen"),$("#video_path").val(""),$("#url_text").text($("#video_url").val()),$(".ynvideo_content_return").show(),$("#from_device_btn").addClass("disable"),$("#ftitle").val()!=""&&$("#save_btn").removeClass("disable")},checkVideo:function(){var e=this;if($("#video_url").val()=="")return utils.modal.alert("Please insert URL."),$("#video_url").focus(),!1;var t=$("#video_url").val(),n=$("#video_type_list li.active").data("type");console.log("url type: "+n);var r="";if(n=="1"){r=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;if(!t.match(r))return utils.modal.alert("Link is not valid."),!1}else if(n=="2"){r=/\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;if(!t.match(r))return utils.modal.alert("Link is not valid."),!1}else if(n=="3"){r=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;if(!t.match(r))return utils.modal.alert("Link is not valid."),!1}return window.localStorage.setItem("VideoCreateView.sVideoType","url"),window.localStorage.setItem("VideoCreateView.sUrlType",n),!0},attachVideoFromUrl:function(e){this.$videoPathInput.val(""),this.$videoUrlInput.val(e.sVideoUrl),this.$videoUrlText.html(e.sVideoUrl),this.$videoTypeInput.val(e.iVideoType),$("#ftitle").val()!=""&&this.$saveBtn.removeClass("disabled"),this.$fromUrlBtn.addClass("disabled"),this.$fromDeviceBtn.addClass("disabled"),this.$attachVideoUrlStage.removeClass("hide")},attachVideoFromDevice:function(e){this.$videoPathInput.val(e),this.$videoUrlText.html("Video from your device"),this.$videoUrlInput.val(""),this.$videoTypeInput.val(""),$("#ftitle").val()!=""&&this.$saveBtn.removeClass("disabled"),this.$fromUrlBtn.addClass("disabled"),this.$fromDeviceBtn.addClass("disabled"),this.$attachVideoUrlStage.removeClass("hide"),window.localStorage.setItem("VideoCreateView.sVideoType","device")},cancelUrl:function(){this.$videoPathInput.val(""),this.$videoUrlText.html(""),this.$videoUrlInput.val(""),this.$videoTypeInput.val(""),this.$saveBtn.addClass("disabled"),this.$fromUrlBtn.removeClass("disabled"),this.$fromDeviceBtn.removeClass("disabled"),this.$attachVideoUrlStage.addClass("hide"),window.localStorage.removeItem("VideoCreateView.sVideoType"),window.localStorage.removeItem("VideoCreateView.sUrlType")}})}),define("text!video/tpl/video-edit.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="save_btn">\n			<%= _t(\'Save\') %>\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Edit Video\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="video-edit">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n\n<!--div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvs"></div>\n				<div id="video-edit-form" class="form-general">\n					<div class="form-group">\n						<input type="text" class="control-full" id="ftitle" placeholder="<%= _t(\'Video name\') %>"/>\n					</div>\n					<div class="form-group">\n						<textarea class="control-full textarea" id="fdescription" placeholder="<%= _t(\'Description\') %>"></textarea>\n					</div>	\n					<div class="form-group">\n						<input type="text" class="control-full" id="ftag" placeholder="<%= _t(\'Tag (keywords)\') %>"  />\n					</div>\n					<div class="form-group">\n						<select class="control-full" id="fcategory_id">\n				            <option value=""><%= _t(\'Categories\') %></option>\n				        </select>\n					</div>\n					<div class="form-group">\n						<select class="control-full" id="fauth_view">\n							 <option value=""><%= _t(\'Privacy\') %></option>\n				        </select>\n				    </div>\n					<div class="form-group">\n						<select class="control-full" id="fauth_comment">\n							 <option value=""><%= _t(\'Comment Privacy\') %></option>\n				        </select>\n				   </div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div-->\n'}),define("text!video/tpl/video-edit-update.html",[],function(){return'<div class="form-general">\n	<div class="form-group form-input-control">\n		<input type="text" class="control-full" id="ftitle" placeholder="<%= _t(\'Video title\') %>" value="<%=model.getTitle()%>" />\n	</div>\n	\n	<div class="form-group form-input-control">\n		<textarea class="control-full textarea" id="fdescription" placeholder="<%= _t(\'Description\') %>"><%=model.getDescription()%></textarea>\n	</div>\n	\n	\n	<div class="form-group group-no-margin">\n		<select class="control-full" id="fcategory_id">\n			<option value=""><%= _t(\'Categories\') %></option>\n			<%_.each(category_options, function (category) {%>\n			<option value="<%=category.iCategoryId%>" <%if (category.iCategoryId == model.getCategoryId()) {%>selected="selected"<%}%>><%=category.sName%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group group-no-margin">\n		<select class="control-full" id="fauth_view">\n			<option value=""><%= _t(\'Privacy\') %></option>\n			<%_.each(view_options, function (option) {%>\n			<option value="<%=option.sValue%>" <%if (option.sValue == model.getViewPrivacyVal()) {%>selected="selected"<%}%>><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="fauth_comment">\n			<option value=""><%= _t(\'Comment Privacy\') %></option>\n			<%_.each(comment_options, function (option) {%>\n			<option value="<%=option.sValue%>" <%if (option.sValue == model.getCommentPrivacyVal()) {%>selected="selected"<%}%>><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n</div>'}),define("video/view/video-edit",["text!video/tpl/video-edit.html","text!video/tpl/video-edit-update.html"],function(e,t){return Backbone.View.extend({region:{holder:"#main",scroller:"#content",updateHolder:"#video-edit"},events:{"click #save_btn":"saveVideo"},className:"video-add",template:_.template(e),templateUpdate:_.template(t),render:function(e){return this.$el.html(this.template({item:this.model})),this.$holder=$(this.region.holder),this.$scroller=this.$el.find(this.region.scroller),this.$saveBtn=this.$el.find("#save_btn"),this.$updateHolder=this.$el.find(this.region.updateHolder),this.$videoTitleInput=this.$el.find("#ftitle"),this},inject:function(){return this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(){var e=this,t=utils.api.get("video/categories"),n=utils.api.get("privacy/privacy"),r=utils.api.get("privacy/privacycomment"),i={iVideoId:this.model.getId()},s=utils.api.get("video/detail",i);$.when(t,n,r,s).done(function(t,n,r,i){var t=t[0],n=n[0],r=r[0],i=i[0];if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));if(n.error_code&&n.error_code>0)return utils.modal.alert(n.error_message||_t("Can not load data from server"));if(r.error_code&&r.error_code>0)return utils.modal.alert(r.error_message||_t("Can not load data from server"));if(i.error_code&&i.error_code>0)return utils.modal.alert(i.error_message||_t("Can not load data from server"));e.model.set(i),e.updateContext={category_options:t,view_options:n,comment_options:r,model:e.model},e.updateView()}).fail(function(){})},updateView:function(){this.$updateHolder.html(this.templateUpdate(this.updateContext))},collectFormData:function(){return{iVideoId:this.model.getId(),iCategoryId:this.$el.find("#fcategory_id").val()||0,title:this.$el.find("#ftitle").val(),description:this.$el.find("#fdescription").val(),tags:this.$el.find("#ftag").val(),auth_view:this.$el.find("#fauth_view").val()||"0",auth_comment:this.$el.find("#fauth_comment").val()||"0",search:1}},saveVideo:function(){if(this.$saveBtn.hasClass("processing"))return;var e=this.collectFormData(),t={context:this};if(utils.validator.isEmpty(e.title))return utils.modal.alert(_t("Video title is required")),!1;this.$saveBtn.addClass("processing"),utils.api.post("video/edit",e).done(this.doSaveComplete).fail(this.doSaveFail)},doSaveComplete:function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));utils.modal.toast(e.message),utils.history.back()},doSaveFail:function(e,t){t=t||_t("Could not save data"),this.$saveBtn.removeClass("processing"),utils.modal.alert(t)}})}),define("video/controller/video-edit",["video/model/video","video/view/video-add","video/view/video-edit"],function(e,t,n){function r(){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({})})).render({iVideoId:null}).inject()}function i(t){utils.history.push(),utils.observer.trigger("router:changed"),(new n({model:new e({iVideoId:t})})).render().inject()}utils.router.route("videos/add",r),utils.router.route("videos/edit/:id",i)}),define("video/main",["core","video/plugin/activity","video/controller/video-index","video/controller/video-detail","video/controller/video-edit"],function(e){e.sidebar.configs.set("video",{icon:"icon-sidebar-video",label:"Videos",url:"#videos"})}),define("video",["video/main"],function(e){return e}),define("text!photo/tpl/attachment-album.html",[],function(){return"<div>\n	attachment album\n</div>"}),define("photo/view/attachment-album",["text!photo/tpl/attachment-album.html"],function(){return Backbone.View.extend({region:{},render:function(e){return this.$el.html("text translate albums"),this},inject:function(e){return e.html(this.el),this}})}),define("text!photo/tpl/attachment-photo.html",[],function(){return'<div class="swiper-container">\n	<div class="swiper-wrapper">\n	<% _.each(attachments,function(attachment){ %>\n        <%if (attachment.getImgSrc()) {%>\n    	<div rel="link" data-url="<%=attachment.getUrl()%>" class="swiper-slide attachment-photo-item">\n    		<span class="attachment-photo-item-thumb" style="background-image: url(<%= attachment.getImgSrc() %>)">\n    		</span>\n		</div>\n        <%}%>\n	<%}); %>\n	</div>\n</div>'}),define("photo/view/attachment-photo",["text!photo/tpl/attachment-photo.html","photo/model/photo"],function(e){var t=require("photo/model/photo");return Backbone.View.extend({className:"attachment-photo",template:_.template(e),count:0,render:function(){var e=this.model,n=e.getAttachments();n=n.map(function(n){return parseInt(n.iAlbumId)||(n.iParentId=e.get("iObjectOwnerId"),n.sParentType=e.get("sObjectOwnerType")),new t(n)});var r=this.count=n.length,i=utils.setting.get("mfox_limit_photo_to_scroll");return i>0&&(n=n.slice(0,i)),this.$el.html(this.template({item:this.model,attachments:n,count:r,elementId:$.newElenentId()})),this},inject:function(e){e.html(this.el);if(this.count>1){var t=$(e).find(".swiper-container"),n=t.width();t.find(".attachment-photo-item").css({width:n}),t.addClass("swiper-album-photo"),t.swiper({mode:"horizontal",slidesPerView:"auto"}),t.trigger("refresh")}return this}})}),define("photo/plugin/activity",["photo/view/attachment-album","photo/view/attachment-photo"],function(e,t){utils.headline.add(["photo","advancedphoto"],function(e){if(e.hasAttachment()){var t=e.getAttachments();return t.length>1?_t("shared a few photos"):_t("shared a photo")}return""}),utils.attachment.add(["photo","advancedphoto"],t)}),define("text!photo/tpl/album-index.html",[],function(){return'<!-- photo/tpl/album-index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n	<%if(!iUserId || iUserId == iViewerId){ %>\n		<a class="btn-top btn-add" href="#photos/add-album"></a>\n	<%}%>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Albums\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder">\n	<!-- search holder -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list" id="album_list_view_holder">\n				\n			</div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <%if(!iUserId){ %>\n	        <a class="menu-item current" href="#albums">\n	        	<div class=""><%= _t(\'Albums\') %></div>\n	        </a>\n	        <a class="menu-item" href="#photos">\n	        	<div class="sibling"><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item" href="#albums/my">\n	        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n	        </a>\n            <a class="menu-item" href="#photos/my">\n				<%= _t(\'My Photos\') %>\n			</a>\n        <%}else{%>\n	        <a class="menu-item" href="#photos-of/user/<%=iUserId%>">\n	        	<div class=""><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#albums-of/<%=iUserId%>">\n	        	<div class="sibling"><%= _t(\'Albums\') %></div>\n	        </a>\n        <%}%>\n    </div>\n</div>\n'}),define("text!photo/tpl/album-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\n</div>\n\n<div id="adv_search_holder" class="search-advanced hide">\n\n	<div class="form-search-group form-group include-btn-search">\n		<span id="search_icon" class="icon-search"></span>\n		<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search albums\') %>" value="<%=sSearch%>" />\n	</div>\n	\n	<%if (sView != \'my\') {%>	\n	<div class="form-search-group form-group">\n		<select class="control-full" id="search_category">\n			<option value="0" selected="true"><%= _t(\'All Categories\') %></option>\n        </select>\n    </div>\n    \n	<div class="form-search-group form-group">        \n			<select class="control-full" id="search_order">\n                <option value="latest"><%= _t(\'Latest\') %></option>\n                <option value="most_disscussed"><%= _t(\'Most Discussed\') %></option>\n            </select>\n	</div>\n	<%}%>\n\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>" />\n	</div>\n</div>\n\n'}),define("photo/view/album-search",["text!photo/tpl/album-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(e){return this.query=$.extend({sView:"all",sSearch:""},e),this.$el.html(this.template(this.query)),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",sOrder:this.$orderInput.val()||"latest"})}})}),define("text!photo/tpl/photo-more-menu.html",[],function(){return'<div class="setting-list">\n    <a class="setting-item" href="#photos/my">\n    	<%= _t(\'My Photos\') %>\n    </a>\n</div>\n'}),define("photo/view/photo-more-menu",["text!photo/tpl/photo-more-menu.html"],function(e){return Backbone.PopupView.extend({template:_.template(e),events:{"touchend a":"hideMenu"},hideMenu:function(e){utils.popup.isShown()&&utils.popup.close()}})}),define("photo/view/album-index",["core","text!photo/tpl/album-index.html","photo/view/album-list","photo/view/album-search","photo/view/photo-more-menu"],function(e,t){var n=require("photo/view/album-list"),r=require("photo/view/album-search"),i=require("photo/view/photo-more-menu");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(t),initialize:function(){},render:function(t){return this.query=$.extend({iViewerId:e.viewer.getId(),iUserId:0},t),this.$el.html(this.template(this.query)),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$el.find("#album_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1}),this.searchView=new r,this.searchView.render().inject(),this.listView.render({}).inject();var t=this;return this.searchView.on("submit",function(e){t.listView.resetQuery(e)}),this},events:{"click #footer_more_btn":"showMoreMenu"},showMoreMenu:function(e){this.moreMenu=new i,this.moreMenu.render().inject()}})}),define("photo/controller/album-index",["photo/view/album-index"],function(e){function t(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({}).inject()}function n(t){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({iUserId:t}).inject()}utils.router.route("albums",t),utils.router.route("albums-of/:id",n)}),define("text!photo/tpl/photo-index.html",[],function(){return'<!-- friend/tpl/index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n\n	<div class="header-right">\n	<%if(!iUserId || iUserId == iViewerId){ %>\n		<a class="btn-top btn-add" href="#photos/add-album"></a>\n	<%}%>\n	</div>\n\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'Photos\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder">\n	<!-- search here -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list clearfix" id="photo_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <%if(!iUserId){ %>\n	        <a class="menu-item" href="#albums">\n	        	<div class=""><%= _t(\'Albums\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#photos">\n	        	<div class="sibling"><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item" href="#albums/my">\n	        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n	        </a>\n            <a class="menu-item" href="#photos/my">\n				<%= _t(\'My Photos\') %>\n			</a>\n        <%}else{%>\n	        <a class="menu-item" href="#photos-of/user/<%=iUserId%>">\n	        	<div class=""><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#albums-of/<%=iUserId%>">\n	        	<div class="sibling"><%= _t(\'Albums\') %></div>\n	        </a>\n        <%}%>\n    </div>\n</div>\n'}),define("text!photo/tpl/photo-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\n</div>\n\n<div id="adv_search_holder" class="search-advanced hide">\n	<div class="form-search-group">\n		<div class="form-group">\n			<select class="control-full" id="search_category">\n				<option value="0" selected="true"><%= _t(\'All Categories\') %></option>\n            </select>\n        </div>\n        <div class="form-group">\n			<select class="control-full" id="search_order">\n                <option value="latest"><%=_t(\'Latest\')%></option>\n                <option value="most_viewed"><%=_t(\'Most Viewed\')%></option>\n                <option value="most_disscussed"><%=_t(\'Most Discussed\')%></option>\n            </select>\n        </div>\n	</div>\n	\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>" />\n	</div>\n</div>'}),define("photo/ipad/view/photo-search",["require"],function(e){return{events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"}}}),define("photo/view/photo-search",["text!photo/tpl/photo-search.html","photo/ipad/view/photo-search"],function(e){return Backbone.PolyplatformView.extend({moduleId:"photo/view/photo-search",region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(e){return this.query=$.extend({sView:"all",sSearch:""},e),this.$el.html(this.template(this.query)),this.$categoryInput=this.$el.find("#search_category"),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this.fetchData(),this},fetchData:function(){utils.api.get("photo/categories",{},{context:this}).done(this.updateView)},updateView:function(e){if(e.error_code)return utils.modal.alert(e.error_message);_.each(e,function(e){if(e.iCategoryId==0)return;this.$categoryInput.append(new Option(e.sName,e.iId))},this)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",iCategoryId:this.$categoryInput.val()||0,sOrder:this.$orderInput.val()||"latest"})}})}),define("photo/view/photo-index",["core","text!photo/tpl/photo-index.html","photo/view/photo-list","photo/view/photo-search","photo/view/photo-more-menu"],function(e,t){var n=require("photo/view/photo-list"),r=require("photo/view/photo-search"),i=require("photo/view/photo-more-menu");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(t),initialize:function(){},render:function(t){return this.query=$.extend({type:"user",iUserId:0},t),this.$el.html(this.template({iUserId:t.iUserId||null,iViewerId:e.viewer.getId()})),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$el.find("#photo_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1,iParentId:0}),this.searchView=new r,this.searchView.render().inject(),this.listView.render(this.query).inject();var t=this;return this.searchView.on("submit",function(e){t.listView.resetQuery(e)}),this},events:{"click #footer_more_btn":"showMoreMenu"},showMoreMenu:function(e){this.moreMenu=new i,this.moreMenu.render().inject()}})}),define("text!photo/tpl/photo-detail-item.html",[],function(){return'<div class="content-slide">\r\n    <div class="photo_display" id="photo_zoom_<%= item.getId() %>" style="line-height: <% print(\'\' + (window.screen.height - 100) + \'px\') %>;">\r\n		<!-- <img class="lazy" id="img_slide_<%= item.getId() %>" src="<%= item.get(\'sPhotoUrl\') %>" style="position: absolute; left:0px;right:0px; bottom:0px; margin:auto; top; 0px; z-index: 0;  width: 100%; height: auto;" /> -->\r\n        <img class="lazy" id="img_slide_<%= item.getId() %>" src="<%= item.get(\'sPhotoUrl\') %>" style="width:100%;"/>\r\n	</div>\r\n</div>\r\n'}),define("text!photo/tpl/photo-detail-action.html",[],function(){return'<div class="photo_detail_info" id="photo_title_<%= item.getId() %>">\n    <div class="photo-headline">\n        <span class="photo-title"><%=utils.str.shorten(item.getTitle(), 20, false)%></span>\n        <%if (item.hasAlbum()) {%>\n        	<%=_t(\'in\')%> <span class="album-title"><%=utils.str.shorten(item.getAlbumTitle(), 20, false)%></span>\n        <%}%>\n    </div>\n    <% if ( item.getDescription() ) { %>\n    <div class="photo-status margin-bottom">\n        <%= utils.str.shorten(item.getDescription(), 200, true) %>\n    </div>\n    <% } %>\n    <div class="photo-info-author">\n        <div class="photo-time">\n            <i class="icon icon-time"></i>\n            <span data-utime="<%= item.getTimestamp() %>" class="livetimestamp"><%= item.getLivetime() %></span>\n        </div>\n        <div class="photo-author">\n            <a class="item-photo-author" href="<%= item.getPosterUrl() %>"><img src="<%= _.escape(item.getPosterImageSrc()) %>" /></a>\n            <a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n        </div>        \n    </div>\n    <div class="clear clearfix"></div>\n</div>\n<div class="footer with-action">\n    <div class="clearfix actions-justify gray">\n        <div class="action-item <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n            <div class="sibling">                \n                <i class="icon icon-activity-like"></i>\n                <span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>\n            </div>\n        </div>\n        <% if(item.canComment()){%>\n        <div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate"data-display="page">\n			<i class="icon icon-activity-comment"></i>\n            <span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>\n		</div>\n        <%} %>\n        <% if(item.canShare()) { %>\n        <div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n            <div class="sibling">\n                <i class="icon icon-activity-share"></i>\n                <span class="text-label" data-suffix="true"><%= item.getShareCountLabel() %></span>\n            </div>\n        </div>\n        <%} %>\n        <div class="action-item menu-item item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n            <div class="sibling">\n               <span class="text-label"> <%=_t(\'More\') %></span>\n            </div>\n        </div>\n    </div>\n    <div class="clear clearfix"></div>\n</div>\n'}),define("text!photo/tpl/photo-detail-setting.html",[],function(){return'<div class="setting-list">\n    <div class="setting-item <%if (this.model.getDislikeCount() < 1) {%>hide<%}%>" id="dislike-list"></div>\n	<%if (item.canDislike()) {%>\n    <div class="setting-item" id="<%=item.getDataId(\'dislike\')%>" rel="delegate">\n        <%= item.isDisliked() ? _t(\'Remove Dislike\') : _t(\'Dislike\')%>\n    </div>\n    <%}%>\n    <% if(item.isOwner()) { %>\n        <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'edit\') %>">\n        	<%= _t(\'Edit Photo\') %>\n        </a>\n        <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n        	<%= _t(\'Delete Photo\') %>\n        </a>\n        <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'makeProfile\') %>" >\n        	<%= _t(\'Make Profile Photo\') %>\n        </a>\n    <% } else {%>\n        <a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n        	<%= _t(\'Report this photo\') %>\n        </a>\n    <% } %>\n    <a class="processing-status hide"> </a>\n</div>\n'}),define("photo/view/photo-detail-setting",["text!photo/tpl/photo-detail-setting.html","dislike/collection/dislike","dislike/view/dislike-detail"],function(e,t,n){return Backbone.View.extend({template:_.template(e),render:function(){var e=this;return this.$el.html(this.template({item:this.model})),this.$dislikeHolder=this.$el.find("#dislike-list"),this.$dislikeBtn=this.$el.find("#"+this.model.getDataId("dislike")),this.model.on("change:iTotalDislike change:bIsDisliked",function(){e.updateView()}),this},inject:function(){return this.model.dislikes=new t,this.model.dislikes.add(this.model.getUserDislike()),this.$dislikeHolder.html((new n({model:this.model})).render().el),utils.popup.open(this.$el),this},updateView:function(){var e=this.model.getDislikeCount()<1?!0:!1;this.$dislikeHolder.toggleClass("hide",e);var t=this.model.isDisliked()?_t("Remove Dislike"):_t("Dislike");this.$dislikeBtn.html(t)}})}),define("text!photo/tpl/photo-edit.html",[],function(){return'<div class="form-general">\n    <div class="form-title">\n       *<%= _t(\'Title\') %>\n    </div>\n	<div class="form-group ">\n        <input class="control-full" type="text" name="sTitle" id="title" value="<%= item.getTitle() %>" placeholder="<%= _t(\'Title\') %>"  />\n	</div>\n\n    <div class="form-title">\n       <%= _t(\'Description\') %>\n    </div>\n\n	<div class="form-group ">\n        <textarea class="control-full textarea" type="text" name="sDescription" id="description" placeholder="<%= _t(\'Description\') %>" ><%= item.getDescription() %></textarea>\n	</div>\n\n    <input class="btn btn-active btn-small-fluid" type="submit" id="save_photo" value="<%= _t(\'Save\') %>">\n\n</div>\n'}),define("photo/view/photo-edit",["text!photo/tpl/photo-edit.html"],function(e){return Backbone.View.extend({template:_.template(e),events:{"click #save_photo":"savePhoto"},render:function(){return this.$el.html(this.template({item:this.model})),this.$title=$("#title",this.$el),this.$description=$("#description",this.$el),this.$postBtn=$("#save_photo",this.$el),this},inject:function(){utils.popup.open(this.$el)},savePhoto:function(){if(this.$postBtn.isProcessing())return;if(!this.isValidate())return;var e={iPhotoId:this.model.getId(),sItemType:this.model.getType(),sTitle:this.$title.val(),sDescription:this.$description.val()},t={context:this,beforeSend:this.beforeSend};utils.api.post("photo/edit",e,t).done(this.postDone).always(this.postComplete)},isValidate:function(){return this.$title.val().trim()==""?(utils.modal.alert(_t("Please provide title for your photo")),!1):!0},postComplete:function(){this.$postBtn.isProcessing(!1),this.$postBtn.val(_t("Save"))},beforeSend:function(){this.$postBtn.isProcessing(!0),this.$postBtn.val(_t("Saving..."))},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){utils.popup.close(),utils.modal.toast(_t("Edit photo successfully")),this.model.set({sTitle:this.$title.val(),sDescription:this.$description.val()})}})}),define("photo/view/photo-detail-action",["text!photo/tpl/photo-detail-action.html","comment/view/comment-page","photo/view/photo-detail-setting","photo/view/photo-edit"],function(e,t,n){return Backbone.ItemView.extend({region:{holder:"#photo_detail_action_view_holder"},events:{edit:"onEditClick",makeProfile:"onMakePhotoProfileClick"},template:_.template(e),settingView:n,editView:require("photo/view/photo-edit"),render:function(){return this.$processingStatus=this.$el.find(".processing-status"),this.$holder=$("#photo_detail_action_view_holder"),this.$el.html(this.template({item:this.model})),this.$el.prop("id",this.model.getDataId()),this.model.on("change",this.updateView,this),this},inject:function(){return this.$holder.html(this.$el),this},updateView:function(){return this.$el.html(this.template({item:this.model})),this},onEditClick:function(){(new this.editView({model:this.model})).render().inject()},doDeleteConfirm:function(){if(this.$processingStatus.isProcessing())return;var e=this,t=_t("Do you want to delete this photo");utils.modal.confirm(t,function(t){t==1&&e.doDelete()})},doDelete:function(){var e={iPhotoId:this.model.getId(),iItemId:this.model.getId(),sItemType:this.model.getType()},t={context:this,beforeSend:this.beforeSendDelete};utils.api.post("photo/delete",e,t).done(this.postDeleteDone).always(this.postDeleteComplete)},postDeleteComplete:function(){this.$processingStatus.isProcessing(!1),this.$processingStatus.html("")},beforeSendDelete:function(){this.$processingStatus.isProcessing(!0),this.$processingStatus.html("Deleting...")},postDeleteDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postDeleteSuccess(e)},postDeleteSuccess:function(e){utils.popup.close(),utils.modal.toast(_t("Photo deleted successfully")),utils.history.back()},onMakePhotoProfileClick:function(){if(this.$processingStatus.isProcessing())return;var e=_t("Do you want to make this photo your profile photo"),t=this;utils.modal.confirm(e,function(e){e==1&&t.doMakeProfilePhoto()})},doMakeProfilePhoto:function(){var e={iPhotoId:this.model.getId(),iItemId:this.model.getId(),sItemType:this.model.getType()},t={context:this,beforeSend:this.beforeSendMakeProfile};utils.api.post("photo/setprofile",e,t).done(this.postMakeProfileDone).always(this.postMakeProfileComplete)},postMakeProfileComplete:function(){this.$processingStatus.isProcessing(!1),this.$processingStatus.html("")},beforeSendMakeProfile:function(){this.$processingStatus.isProcessing(!0),this.$processingStatus.html("Setting profile...")},postMakeProfileDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postMakeProfileSuccess(e)},postMakeProfileSuccess:function(e){utils.popup.close(),utils.modal.toast(_t("Set as profile photo successfully")),utils.observer.trigger("user:update")}})}),define("photo/view/photo-detail-item",["text!photo/tpl/photo-detail-item.html","photo/view/photo-detail-action"],function(e,t){return Backbone.ItemView.extend({className:"swiper-slide",template:_.template(e),actionView:require("photo/view/photo-detail-action"),render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)},events:{active:"onActive"},onActive:function(){(new this.actionView({model:this.model})).render().inject()}})}),define("text!photo/tpl/photo-detail-page.html",[],function(){return'<!-- swiper -->\r\n<div class="content content-background content-photo-detail swiper-container" id="content">\r\n	<div class="swiper-wrapper photo-loading" id="photo-detail">\r\n	</div>\r\n</div>\r\n<div id="photo_detail_action_view_holder">\r\n	\r\n</div>\r\n<div class="btn-close-photo-detail" rel="back"></div>\r\n'}),define("photo/view/photo-details",["photo/view/photo-detail-item","text!photo/tpl/photo-detail-page.html","photo/model/photo","photo/view/photo-detail-action"],function(e,t,n){function i(e,t,r,i){utils.api.get(r,e).done(function(e){e.hasOwnProperty("error_code")&&e.error_code&&(e.hasOwnProperty("error_message")?utils.modal.alert(e.error_message):utils.modal.alert("Unknown errors"));var r=e.map(function(e){return new n(e)});delete e,t.addItems(r,i),delete r}).fail(function(){utils.debug.log(arguments)})}var r=require("photo/view/photo-detail-action");return Backbone.View.extend({region:{main:"#main",content:"#content",list:"#photo-detail"},isFirst:!0,template:_.template(t),render:function(e){return this.context=$.extend({sType:null,iInDetails:1,serviceUrl:null,iAmountOfPhoto:100},e),this.isFirst=!0,this.$el.html(this.template(this.context)),this.$scroller=this.$el.find("#content"),this},inject:function(){var e=this;$(this.region.main).html(this.el);var t=$(this.region.content);this.loadnext()},integrateIScroll:function(e){var t=this.$scroller,n=parseInt(e,10),r=this,i="#photo_id_"+r.context.iPhotoId;setTimeout(function(){var e=_activateZoom=function(){var e=undefined;return function(t){var n=t.activeSlide(),r=$(n).find(".photo_display").get(0);$(n).trigger("active"),console.log(n),e!==undefined&&e.destroy(),e=new iScroll(r,{hideScrollbar:!0,hScrollbar:!1,vScrollbar:!1,zoom:!0,onZoomEnd:function(e){var t=$(this.wrapper);parseInt(this.scale)==1?t.removeClass("swiper-no-swiping"):t.addClass("swiper-no-swiping")},onZoomStart:function(e){e.type==="touchstart"?this.originX=Math.abs(e.touches[0].pageX+e.touches[1].pageX)/2-this.x:e.type==="touchend"&&(this.wrapperOffsetLeft=0)}})}}();myPhotoDetailSwiper=new Swiper("#content",{noSwiping:!0,initialSlide:n,onSlideChangeEnd:e,onInit:e,onFirstInit:function(){window.setTimeout(function(){r.$el.find(i).trigger("active"),r.$el.find(".invisible").removeClass("invisible")},2e3)}})})},loadnext:function(){var e=this.getQuery();i(e,this,this.context.serviceUrl,"loadnext")},loadprevious:function(){var e=this.getQuery();i(e,this,this.context.serviceUrl,"loadprevious")},getQuery:function(){var e=null;if(this.context.iParentId==0)this.context.serviceUrl="photo/fullphotoslide",e={iCurrentPhotoId:this.context.iPhotoId,iAmountOfPhoto:this.context.iAmountOfPhoto,iInDetails:this.context.iInDetails};else switch(this.context.sType){case"photo":case"advancedphoto":this.context.serviceUrl="photo/fullalbumslide",e={iCurrentPhotoId:this.context.iPhotoId,iAlbumId:this.context.iParentId,iAmountOfPhoto:this.context.iAmountOfPhoto,iInDetails:this.context.iInDetails};break;case"event_photo":case"fevent_photo":this.context.serviceUrl="event/listphotos",e={iCurrentPhotoId:this.context.iPhotoId,iEventId:this.context.iParentId,iAmountOfPhoto:this.context.iAmountOfPhoto,iInDetails:this.context.iInDetails};break;case"profile_photo":this.context.serviceUrl="photo/fullphotoslide",e={iCurrentPhotoId:this.context.iPhotoId,iUserId:this.context.iParentId,iAmountOfPhoto:this.context.iAmountOfPhoto,iInDetails:this.context.iInDetails};break;case"user":this.context.serviceUrl="photo/onephotoslide",e={iCurrentPhotoId:this.context.iPhotoId,iUserId:this.context.iParentId,iInDetails:this.context.iInDetails,sAction:"current"};break;default:this.context.serviceUrl="photo/fullphotoslide",e={iCurrentPhotoId:this.context.iPhotoId,iAmountOfPhoto:this.context.iAmountOfPhoto,iInDetails:this.context.iInDetails}}return e},addItems:function(t,n){function u(e){i[n=="loadnext"?"append":"prepend"](e)}$(this.region.list).removeClass("photo-loading");var r=this,i=$(this.region.list),s=this.$scroller,o=$(this.region.content);this.isFirst&&(this.isFirst=!1,o.find(".loading-initiator").remove()),_.each(t,function(t){var n="#photo_id_"+t.getId();$(n).length||(new e({model:t},s)).render().inject(u)});var a=0;for(var f=0;f<t.length;++f)if(t[f].getId()==r.context.iPhotoId){utils.debug.log("integate iscroll with "+f),r.integrateIScroll(f);break}o.trigger(n+":end").trigger("refresh").data("ready",!0)}})}),define("photo/controller/photo-index",["core","photo/view/photo-index","photo/view/photo-details"],function(e,t,n){function r(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({}).inject()}function i(e,n){utils.history.push(),utils.observer.trigger("router:changed"),(new t).render({type:e,iUserId:n}).inject()}function s(e,t,r){utils.history.push(),utils.observer.trigger("router:changed"),(new n).render({iPhotoId:r,iParentId:t,sType:e}).inject()}function o(e,t){utils.history.push(),utils.observer.trigger("router:changed"),(new n).render({iPhotoId:t,sType:e}).inject()}utils.router.route("photos",r),utils.router.route("photos-of/:type/:id(/:act)",i),utils.router.route(/photo-detail\/(\w+)\/(\d+)\/(\d+)/,s),utils.router.route(/photo-detail\/(\w+)\/(\d+)\/(\d+)\/comment/,s),utils.router.route("photo-detail/:type/(d+)(/:action)",o)}),define("text!photo/tpl/album-my.html",[],function(){return'<!-- photo/tpl/album-index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n	<%if(!iUserId || iUserId == viewerId){ %>\n		<a class="btn-top btn-add" href="#photos/add-album"></a>\n	<%}%>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n\n	<div class="header-center title">\n        <div class="title" id="page_title">\n            <%= _t(\'My Albums\') %>\n        </div>\n	</div>\n</div>\n\n<div id="search_view_holder">\n	<!-- search holder -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list photo-album-list" id="album_my_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <%if(!iUserId){ %>\n	        <a class="menu-item" href="#albums">\n	        	<div class=""><%= _t(\'Albums\') %></div>\n	        </a>\n	        <a class="menu-item" href="#photos">\n	        	<div class="sibling"><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#albums/my">\n	        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n	        </a>\n            <a class="menu-item" href="#photos/my">\n				<%= _t(\'My Photos\') %>\n			</a>\n        <%}else{%>\n	        <a class="menu-item" href="#photos-of/user/<%=iUserId%>">\n	        	<div class=""><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#albums-of/<%=iUserId%>">\n	        	<div class="sibling"><%= _t(\'Albums\') %></div>\n	        </a>\n        <%}%>\n    </div>\n</div>\n'}),define("text!photo/tpl/album-my-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading ...  -->\n</div>'}),define("photo/view/album-my-list",["photo/model/album","photo/view/album-my-item","text!photo/tpl/album-my-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"",iPage:1,sSearch:"",sOrder:"recent",iUserId:null,iCategoryId:0,iAmountOfAlbum:8},followById:!1,api:"photo/myalbum",phraseNotFound:"No albums found.",phraseNotMore:"No more albums.",className:"album-list",template:_.template(n),itemModel:e,itemView:t})}),define("photo/view/album-my",["core","text!photo/tpl/album-my.html","photo/view/album-my-list","photo/view/photo-more-menu"],function(e,t){var n=require("photo/view/album-my-list"),r=require("photo/view/photo-more-menu");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(t),initialize:function(){},render:function(e){return this.query=$.extend({iUserId:0},e),this.$el.html(this.template(this.query)),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$el.find("#album_my_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1}),this.listView.render({}).inject();var t=this;return this},events:{"click #footer_more_btn":"showMoreMenu"},showMoreMenu:function(e){this.moreMenu=new r,this.moreMenu.render().inject()}})}),define("photo/controller/album-my",["core","photo/view/album-my"],function(e,t){function n(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({}).inject()}utils.router.route("albums/my",n)}),define("text!photo/tpl/photo-my.html",[],function(){return'<!-- friend/tpl/index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n\n	<div class="header-right">\n		<a class="btn-top btn-add" href="#photos/add-album"></a>\n	</div>\n</div>\n\n<div class="content with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list clearfix" id="photo_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <%if(!iUserId){ %>\n	        <a class="menu-item" href="#albums">\n	        	<div class=""><%= _t(\'Albums\') %></div>\n	        </a>\n	        <a class="menu-item" href="#photos">\n	        	<div class="sibling"><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item" href="#albums/my">\n	        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#photos/my">\n				<%= _t(\'My Photos\') %>\n			</a>\n        <%}else{%>\n	        <a class="menu-item" href="#photos-of/user/<%=iUserId%>">\n	        	<div class=""><%= _t(\'Photos\') %></div>\n	        </a>\n	        <a class="menu-item current" href="#albums-of/<%=iUserId%>">\n	        	<div class="sibling"><%= _t(\'Albums\') %></div>\n	        </a>\n        <%}%>\n    </div>\n</div>\n'}),define("text!photo/tpl/photo-my-item.html",[],function(){return'<div class="item-wrapper">\n	<a href="<%= item.getUrl() %>" class="item-image" style="background-image: url(<%= item.getImgSrc() %>)">\n	</a>\n    <%if (item.hasAlbum()) {%>\n    <div class="item-footer-my">\n        <div class="item-parent">\n            <span><%=_t(\'in\')%> </span><a href="<%=item.getAlbumUrl()%>"><%=item.getAlbumTitle()%></a>\n        </div>\n    </div>\n    <%}%>\n</div>\n'}),define("photo/view/photo-my-item",["text!photo/tpl/photo-my-item.html"],function(e){return Backbone.ItemView.extend({events:{},className:"photo-item",template:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!photo/tpl/photo-my-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- loading -->\n</div>'}),define("photo/view/photo-my-list",["photo/model/photo","photo/view/photo-my-item","text!photo/tpl/photo-my-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iInDetails:1,sOrder:"latest",iAmountOfPhoto:12},followById:!1,api:"photo/my",phraseNotFound:"No photos found.",phraseNotMore:"No more photos.",className:"clearfix photo-list",template:_.template(n),itemModel:e,itemView:t,parseData:function(e,t){return e.map(function(e){return e.iParentId=Backbone.iUserId,e.sParentType="profile_photo",new t(e)})}})}),define("photo/view/photo-my",["core","text!photo/tpl/photo-my.html","photo/view/photo-my-list","photo/view/photo-more-menu"],function(e,t){var n=require("photo/view/photo-my-list"),r=require("photo/view/photo-more-menu");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(t),initialize:function(){},render:function(e){return this.query=$.extend({type:"user",iUserId:0},e),this.$el.html(this.template(this.query)),this},inject:function(){var e=$(this.region.holder).html(this.$el);return this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new n({},this.$el.find("#photo_list_view_holder"),this.$scroller,{loadmore:!0,loadnew:!1,iParentId:0}),this.listView.render(this.query).inject(),this},events:{"click #footer_more_btn":"showMoreMenu"},showMoreMenu:function(e){this.moreMenu=new r,this.moreMenu.render().inject()}})}),define("photo/controller/photo-my",["core","photo/view/photo-my"],function(e,t){function n(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new t).render({}).inject()}utils.router.route("photos/my",n)}),define("text!photo/tpl/album-add-index.html",[],function(){return'<!-- photo/tpl/album-add-index.html-->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n        <div class="btn-top" id="save_btn"><%=_t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n        <div class="title"><% typeForm == \'edit\' ? print(_t(\'Edit Album\')) :  print(_t(\'Create Album\')) %></div>\n	</div>\n</div>\n<div class="content with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="photo-album-edit">\n				<div class="loading-initiator">\n					<!-- Loading ...  -->\n				</div>\n			</div>\n			<div id="photo-album-edit-photo-list">\n			</div>\n			<div id="photo_upload_list" class="photo-upload-list">\n				<!-- List of photos to be delete/edit -->\n		    </div>\n		</div>\n	</div>	\n</div>\n\n<div class="footer with-action">\n	<div class="clearfix actions-justify gray">\n        <a class="action-item" id="album_form_photo_capture">\n            <i class="icon icon-attachment-camera"></i>\n        </a>\n        <a class="action-item" id="album_form_photo_browse" >\n        	<i class="icon icon-attachment-gallery"></i>\n        </a>\n    </div>\n</div>\n'}),define("text!photo/tpl/album-add-form.html",[],function(){return'<div class="form-general">\n	<div class="form-group">\n	    <input class="control-full" type="text" name="sTitle" id="sTitle" value="<%= data.sTitle %>" placeholder="<%= _t(\'Album name\')%>"  />\n	</div>\n\n	<div class="form-group">\n	    <textarea class="control-full textarea" name="sDescription" id="sDescription" placeholder="<%= _t(\'Description\') %>"><%= data.sDescription %></textarea>\n	</div>\n\n	<div class="form-group">\n	    <select class="control-full" name="iPrivacy" id="iPrivacy">\n            <option value=""><%= _t(\'Album Priviacy\') %></option>\n	        <%_.each(data.view_options, function (option) {%>\n                <option value="<%=option.sValue%>" <% if(option.sValue == data.sViewPrivacy) print(\'selected="selected"\') %> >\n                    <%=option.sPhrase%>\n                </option>\n			<%}, this);%>\n	    </select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" name="iPrivacyComment" id="iPrivacyComment">\n            <option value=""><%= _t(\'Comment Privacy\') %></option>\n	        <%_.each(data.comment_options, function (option) {%>\n                <option value="<%=option.sValue%>" <% if(option.sValue == data.sCommentPrivacy) print(\'selected="selected"\') %> >\n                    <%=option.sPhrase%>\n                </option>\n			<%}, this);%>\n	    </select>\n	</div>\n</div>\n'}),define("text!photo/tpl/attachment-album-photo-item.html",[],function(){return'<!--li class="ynphoto_upload_item"-->\r\n<div class="attachment-photo-item">\r\n	<span class="attachment-photo-image" data-src="<%= item.ImgSrc %>" data-photoid="<%= item.PhotoId %>">\r\n        <img src="<%= item.ImgSrc %>" />\r\n    </span>\r\n	<div class="close_button">\r\n		<a href="javascript:void(0);" id="remove_att" data-photoid="<%= item.PhotoId %>" data-src="<%= item.ImgSrc %>"></a>\r\n	</div>\r\n</div>\r\n\r\n'}),define("photo/view/attachment-album-photo-item",["text!photo/tpl/attachment-album-photo-item.html"],function(e){return Backbone.View.extend({region:{},template:_.template(e),render:function(e){return this.$el.html(this.template({item:e})),this},inject:function(e){e(this.el)}})}),define("photo/collection/photo",["photo/model/photo"],function(e){return Backbone.Collection.extend({model:e})}),define("photo/view/album-add-index",["text!photo/tpl/album-add-index.html","text!photo/tpl/album-add-form.html","photo/view/attachment-album-photo-item","photo/model/album","photo/collection/photo"],function(e,t,n,r){var i=require("photo/collection/photo");return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content",photo_list:"#photo_upload_list",edit_form:"#photo-album-edit"},template:_.template(e),templateForm:_.template(t),initialize:function(){this.photos=new i,this.model=null},render:function(e){return this.context=$.extend({iAlbumId:0,typeForm:null,aPhotoListId:[]},e),this.$el.html(this.template(this.context)),this.$postBtn=$("#save_btn",this.$el),this.$scroller=this.$el.find(this.region.scroller),this},inject:function(){$(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this.$scroller.trigger("refresh")},events:{"click #save_btn":"createAlbum","click #album_form_photo_capture":"capturePhoto","click #album_form_photo_browse":"browsePhoto","click .close_button":"deletePhoto"},addPhotoItem:function(e,t){var r=$("#photo_upload_list"),i=function(e){r.append(e)};(new n).render({PhotoId:e,ImgSrc:t}).inject(i),this.$scroller.trigger("refresh")},fetchData:function(){var e=[],t=this;this.dataInfo={typeForm:this.context.typeForm};var n=utils.api.get("photo/formadd",{}).done(function(e){t.dataInfo=$.extend(t.dataInfo,e)}).fail(function(){});if(this.context.typeForm=="edit"){var r=utils.api.get("photo/albumview",{iAlbumId:this.context.iAlbumId}).done(function(e){t.dataInfo=$.extend(t.dataInfo,e)}).fail(function(e){utils.debug.log(e)}),i=utils.api.get("photo/listalbumphoto",{iAlbumId:this.context.iAlbumId,iAmountOfPhoto:500},this.context).done(function(e){t.photos.add(e)}).fail(function(){utils.debug.log(arguments)});$.when(r,i,n).done(function(){t.updateView()})}else $.when(n).done(function(){t.updateView()})},updateView:function(){var e=this.$el.find("#photo-album-edit");e.html(_.template(require("text!photo/tpl/album-add-form.html"))({data:this.dataInfo}));var t=this.$el.find("#photo_upload_list");this.context.typeForm=="edit"&&_.each(this.photos.models,function(e){this.addPhotoItem(e.getId(),e.getImgSrc())},this);var n=this;window.setTimeout(function(){n.$scroller.trigger("refresh")},1e3)},createAlbum:function(){if(this.$postBtn.isProcessing())return;this.context.sTitle=$("#sTitle").val(),this.context.sDescription=$("#sDescription").val(),this.context.iCategoryId=$("#category_select").val(),this.context.sAuthView=$("#iPrivacy").val()||"everyone",this.context.sAuthComment=$("#iPrivacyComment").val()||"everyone";if(!this.context.sTitle)return utils.modal.alert(_t("Provide a name for your album."));var e=$(this.region.photo_list+" div.attachment-photo-item").size();if(e<=0)return utils.modal.alert(_t("Album must have at least one photo."));var t=this,n={sTitle:this.context.sTitle,sDescription:this.context.sDescription,iCategoryId:this.context.iCategoryId,sAuthView:this.context.sAuthView,sAuthComment:this.context.sAuthComment,iAlbumId:this.context.iAlbumId},r={context:this,beforeSend:this.beforeSend};utils.api.post(this.context.typeForm=="create"?"photo/albumcreate":"photo/albumedit",n,r).done(this.postDone).always(this.postComplete)},postComplete:function(){this.$postBtn.isProcessing(!1)},beforeSend:function(){this.$postBtn.isProcessing(!0)},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){var t=$(this.region.photo_list+" div.attachment-photo-item").size();this.context.iAlbumId=e.iAlbumId,t<=0?this.createFeed():this.uploadPhotos(0,t)},uploadPhotos:function(e,t){var n=$("#photo_upload_list > div").eq(e),r=n.find("span.attachment-photo-image").data("src"),i=n.find("span.attachment-photo-image").data("photoid"),s=this;i==0?utils.api.uploadImage("photo/upload",r,{iAlbumId:this.context.iAlbumId}).done(function(n){utils.debug.log("Respond Upload Photo: "+JSON.stringify(n)+" : "+e),s.context.aPhotoListId.push(n.iPhotoId),e+1>=t?s.createFeed():s.uploadPhotos(e+1,t)}):i>0&&(e+1>=t?s.createFeed():s.uploadPhotos(e+1,t))},createFeed:function(){var e;e={sPhotoIds:this.context.aPhotoListId.join(","),iAlbumId:this.context.iAlbumId},this.context.typeForm=="edit"?utils.modal.toast("You have edited the album successfully"):utils.modal.toast("You have created the album successfully"),this.context.aPhotoListId.length!=0&&utils.api.get("photo/postfeed",e).done(function(e){}),window.location="#albums/my"},capturePhoto:function(){function t(t){var n=t[0].fullPath;e.addPhotoItem(0,n)}function n(t){e.$scroller.trigger("refresh")}var e=this;navigator.device.capture.captureImage(t,n,{limit:1})},browsePhoto:function(){function t(t){var n=!0;$("#photo_upload_list").find("span.attachment-photo-image").length>0&&$("#photo_upload_list").find("span.attachment-photo-image").each(function(){$(this).data("src")==t&&(utils.modal.alert(_t("The image has been selected!")),n=!1)}),n&&e.addPhotoItem(0,t)}function n(t){e.$scroller.trigger("refresh")}var e=this;navigator.camera.getPicture(t,n,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,correctOrientation:!0})},deletePhoto:function(e){var t=$(this.region.photo_list+" div.attachment-photo-item").size();if(t==1)return utils.modal.alert(_t("Album must have at least one photo."));var n=$(e.target).parents(".attachment-photo-item"),r=$(e.target).find("#remove_att").data("photoid")||0;if(r){var i={iPhotoId:r};utils.modal.confirm(_t("Are you sure to delete this photo? (*Note: This action cannot rollback)"),function(e){e==1&&(n.parent().remove(),utils.api.get("photo/delete",i).done(function(e){utils.modal.toast("The photo has been deleted successfully.")}).fail(function(e){utils.debug.log(arguments)}))},_t("Confirm"),[_t("Ok"),_t("Cancel")])}else{n.parent().remove();var s=window.localStorage.getItem("album.totalAdded")||0;s>0&&(s--,window.localStorage.setItem("album.totalAdded",s))}}})}),define("photo/controller/album-add",["photo/view/album-add-index"],function(e){function t(){utils.observer.trigger("router:changed"),(new e).render({typeForm:"create",iAlbumId:null}).inject()}function n(t){utils.observer.trigger("router:changed"),(new e).render({typeForm:"edit",iAlbumId:t}).inject()}utils.router.route("photos/add-album",t),utils.router.route("photos/edit-album/:id",n)}),define("text!photo/tpl/album-detail-index.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top btn-more hide" id="top_menu_toggle">\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title" id="album_title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div class="content content-background with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="album-detail-info" class="album-detail-info padding-base">\n				<div id="photo_list_holder" class="photo-list clearfix">\n					<div class="loading-initiator">\n						<!-- Loading				 -->\n					</div>	\n				</div>\n				<div id="album_action_bar_holder" class="album-action-bar"></div>				\n			</div>\n			<div id="activity_extra_holder" class="hide">\n				<!-- loading activity extra -->\n			</div>\n		</div>\n	</div>\n</div>'}),define("text!photo/tpl/album-detail-photos.html",[],function(){return'<% items.each(function(item){%>\n	<div class="album-detail-photo-item">\n		<div rel="link" data-url="<%= item.getUrl() %>" class="item-image" style="background-image: url(<%= item.get(\'sPhotoUrl\') %>)"></div>\n	</div>\n<% })%>'}),define("text!photo/tpl/album-add-action-bar.html",[],function(){return'<div class="actions-justify gray">\r\n	<div class="action-item <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\r\n		<i class="icon icon-activity-like"></i>\r\n		<span data-suffix="true"><%= item.getLikeCountLabel() %></span>\r\n	</div>\r\n	<% if(item.canComment()){%>\r\n	<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate" data-display="focus">\r\n		<i class="icon icon-activity-comment"></i>\r\n		<span data-suffix="true"><%= item.getCommentCountLabel() %></span>\r\n	</div>\r\n	<%} %>\r\n	<% if(item.canShare()) { %>\r\n	<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\r\n		<i class="icon icon-activity-share"></i>\r\n		<span data-suffix="true"><%= item.getShareCountLabel() %></span>\r\n	</div>\r\n	<%} %>\r\n</div>'}),define("text!photo/tpl/album-detail-menu.html",[],function(){return'<div class="setting-list">\r\n	<%  if (item.isOwner()){ %>\r\n	<a class="setting-item" href="#photos/edit-album/<%= item.getId() %>"><%= _t(\'Edit\') %></a>\r\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>"><%= _t(\'Delete\') %></a>\r\n	<% } else { %>\r\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'report\') %>"><%= _t(\'Report\') %></a>\r\n	<% } %>\r\n</div>\r\n'}),define("photo/view/album-detail-menu",["text!photo/tpl/album-detail-menu.html"],function(e){return Backbone.TopMenuView.extend({template:_.template(e),inject:function(){return utils.popup.open(this.$el),this},hide:function(){return utils.popup.close(),this}})}),define("photo/view/album-detail-index",["utils","text!photo/tpl/album-detail-index.html","text!photo/tpl/album-detail-photos.html","text!photo/tpl/album-add-action-bar.html","photo/view/album-list","photo/view/album-detail-menu","photo/view/album-my-item","photo/collection/photo"],function(e,t,n,r){var i=require("photo/collection/photo"),s=require("photo/view/album-detail-menu"),o=require("photo/view/album-my-item");return o.extend({region:{main:"#main",content:"#content",barTplId:"#album-action-bar"},className:"album-detail-index",template:_.template(t),events:{"click #top_menu_toggle":"toggleTopMenu"},topMenuView:s,initialize:function(){this.photos=new i,Backbone.DetailView.prototype.initialize.apply(this,arguments)},render:function(e){return this.context=$.extend({iAlbumId:0,iAmountOfPhoto:500,iInDetails:1},e),this.$el.html(this.template(this.context)),this.$el.attr("id",this.model.getDataId()),this.$scroller=this.$el.find(this.region.content),this.$pageTitle=this.$el.find("#album_title"),this.topMenuToggleBtn=this.$el.find("#top_menu_toggle"),this.$actionBarHodler=this.$el.find("#album_action_bar_holder"),this.$photoListHolder=this.$el.find("#photo_list_holder"),this.$activityExtraHolder=this.$el.find("#activity_extra_holder"),this.fetchData(),this},toggleTopMenu:function(){e.topMenu.toggle(this,this.model)},inject:function(){return $(this.region.main).html(this.$el),this.$scroller.ensureVerticalScroll(),this},fetchData:function(){var t=this,n=e.api.get("photo/albumview",{iAlbumId:this.context.iAlbumId}).done(function(e){t.model.set(e)}).fail(function(){e.debug.log(arguments)}),r=e.api.get("photo/listalbumphoto",this.context).done(function(e){var n=e.map(function(e){return $.extend({iAlbumId:t.context.iAlbumId},e)});t.photos.add(n)}).fail(function(){e.debug.log(arguments)});$.when(n,r).done(function(){t.model.get("bCanView")==1?t.updateView():$(t.region.content).html("<div class='not-found'>You don't have permission to view this album</div>")}).fail(function(){})},updateView:function(){var t=this;this.$pageTitle.html(this.model.getTitle()),this.model.isOwner()&&this.topMenuToggleBtn.removeClass("hide"),this.$actionBarHodler.html(_.template(require("text!photo/tpl/album-add-action-bar.html"))({item:this.model})),this.$photoListHolder.html(_.template(require("text!photo/tpl/album-detail-photos.html"))({items:this.photos})),this.$activityExtraHolder.removeClass("hide"),e.helper.addActivityExtraBlock(this.model,this.$activityExtraHolder,this.$scroller)},deleteSuccess:function(t){e.modal.toast(_t("The album has been deleted successfully.")),window.location="#albums"}})}),define("photo/controller/album-detail",["utils","photo/model/album","photo/view/album-detail-index"],function(e,t,n){function r(r,i,s){e.history.push(),e.observer.trigger("router:changed"),(new n({model:new t({iAlbumId:i,sModelType:r})})).render({iAlbumId:i}).inject()}e.router.route("photo-album-detail/:type/:id(/:act)",r)}),define("photo/main",["core","photo/plugin/activity","photo/controller/album-index","photo/controller/photo-index","photo/controller/album-my","photo/controller/photo-my","photo/controller/album-add","photo/controller/album-detail"],function(e){e.sidebar.configs.set("photo",{icon:"icon-sidebar-photo",label:"Albums",url:"#albums"})}),define("photo",["photo/main"],function(e){return e}),define("text!music/tpl/attachment-music-playlist.html",[],function(){return'<div class="att-item-wrapper">\n	<div class="att-col-image">\n			<a href="<%= linkUrl %>">\n				<img class="att-item-image" src="<%= photoUrl%>" />\n			</a>\n	</div>\n	<div class="att-col-info">\n		<div class="att-item-title">\n			<a href="<%= linkUrl %>">\n				<%= title %>\n			</a>\n		</div>\n		<div class="att-item-description"><%= description %></div>\n	</div>\n</div>'}),define("music/view/attachment-music-playlist",["text!music/tpl/attachment-music-playlist.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-music-playlist",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n={item:e,attachment:t,photoUrl:t.sPhoto_Url||t.sFeedIcon,title:t.sTitle,description:t.sDescription,linkUrl:"#music_song/"+t.iId};return this.$el.html(this.template(n)),this},inject:function(e){e.html(this.el)}})}),define("music/plugin/activity",["music/view/attachment-music-playlist"],function(e){utils.headline.add(["music_playlist_new"],function(e){return _t("%s created a new playlist %s",e.getPosterLink(),e.getItemLink())}),utils.headline.add(["music_song","music_album"],function(e){return _t("shared a song")}),utils.attachment.add(["music_playlist","music_song","music_album","music"],e)}),define("text!music/tpl/action-more.html",[],function(){return'<div class="setting-list">\n    <a class="setting-item" href="#music_songs/my">\n		<%= _t(\'My songs\') %>\n	</a>\n</div>\n'}),define("music/view/more-action",["text!music/tpl/action-more.html"],function(e){var t=Backbone.View.extend({template:_.template(e),events:{"click .setting-item":"close"},render:function(){return this.$el.html(this.template()),this},inject:function(){return utils.popup.open(this.$el),this},close:function(){return utils.popup.close(),this}});return t}),define("music/plugin/open-more",["music/view/more-action"],function(e){utils.observer.on("music:open-more",function(){(new e).render().inject()})}),define("text!music/tpl/playlist-index.html",[],function(){return'<!-- music/tpl/music-index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n			<%= _t(\'Music\') %>\n		</div>\n	</div>\n</div>\n<div id="search_view_holder">\n<!-- Add search box in here -->\n</div>\n<div class="content content-background with-header-footer with-search body-bg swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvl"></div>\n			<div class="swiper-list vertical-align">\n				<div id="playlist_list_view_holder">\n				</div>\n				<%= utils.helper.loadmore() %>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n        <a class="menu-item current" href="#music_playlists">\n        	<div class=""><%= _t(\'Albums\') %></div>\n        </a>\n        <a class="menu-item" href="#music_songs">\n        	<div class="sibling"><%= _t(\'Songs\') %></div>\n        </a>\n        <a class="menu-item" href="#music_playlists/my">\n        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n        </a>\n        <a class="menu-item" href="#music_songs/my">\n			<%= _t(\'My songs\') %>\n		</a>\n    </div>\n</div>'}),define("text!music/tpl/playlist-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading Initiator -->\n</div>'}),define("music/model/playlist",["core"],function(e){return Backbone.Model.extend({idAttribute:"iAlbumId",defaults:{sModelType:"music_album",bCanPostComment:1,bCanLike:!0,bCanShare:!0},getTitle:function(){return this.get("sName")},getAlbumName:function(){return this.get("sAlbumName")},getLink:function(){return'<a href="'+this.getUrl()+'">'+this.getTitle()+"</a>"},getImageSrc:function(){return this.get("sImagePath")},getTrackCount:function(){return this.get("iTotalTrack")||0},getPlayCount:function(){return this.get("iTotalPlay")||0},getDescription:function(){return this.get("sDescription")||""},isOwner:function(){return e.viewer.getId()==this.getPosterId()}})}),define("text!music/tpl/playlist-item.html",[],function(){return'<!-- friend/tpl/friend-item -->\n<div class="clearfix item-wrapper">\n	<div class="item-image">\n		<a href="<%= item.getUrl() %>">\n			<span style="background-image: url(\'<%= item.getImageSrc() %>\');"></span>\n		</a>\n	</div>\n	<div class="item-stats-group">\n		<div class="item-stats">			\n			<i class="icon icon-music-track"></i>\n			<span class="text-info"><%= item.getTrackCount() %></span>\n		</div>\n		<div class="item-stats">			\n			<i class="icon icon-music-listen"></i>\n			<span class="text-info"><%= item.getPlayCount() %></span>\n		</div>\n		<div class="item-stats prevent <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<i class="icon icon-activity-like"></i>\n			<span class="text-info"><%= item.getLikeCount() %></span>\n		</div>\n        <% if(item.canComment()){%>\n		<div class="item-stats prevent" id="<%= item.getDataId(\'comment\') %>" rel="delegate">	\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-info"><%= item.getCommentCount() %></span>\n		</div>\n		<% } %>\n	</div>\n\n	<div class="item-group">\n		<div class="item-headline">\n			<a href="<%= item.getUrl() %>"><%= item.getTitle() %></a>\n		</div>\n		<div class="item-subline">\n			<%= _t(\'Created \') %> <%= item.get(\'sFullTimeStamp\') %>\n		</div>\n		<div class="item-subline">\n			<%= _t(\'by\') %> <a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>\n		</div>\n	</div>\n	<%if (item.getTrackCount() > 0) {%>\n	<div class="item-music-list-arrow"></div>\n	<%}%>\n</div>\n<div class="pvm"></div>\n'}),define("music/view/playlist-item",["text!music/tpl/playlist-item.html"],function(e){return Backbone.ItemView.extend({className:"music-playlist-item",template:_.template(e),events:{},render:function(){return this.$el.html(this.template({item:this.model})),this.$el.attr({id:this.model.getDataId(),rel:"link","data-url":this.model.getUrl()}),this},inject:function(e){e(this.$el)}})}),define("music/view/playlist-list",["text!music/tpl/playlist-list.html","music/model/playlist","music/view/playlist-item"],function(e,t,n){return Backbone.ListView.extend({defaults:{sSearch:"",sView:"all",iMaxId:0,iMinId:0,iLimit:5,iPage:1},followById:!0,api:"album/fetch",phraseNotFound:"No albums found.",phraseNotMore:"No more albums.",className:"music-playlist-list",template:_.template(e),itemModel:t,itemView:n})}),define("text!music/tpl/playlist-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search no-padding"></div>\n</div>\n\n<div id="adv_search_holder" class="search-advanced no-padding hide">\n	<div class="form-search-group include-btn-search">\n		<div class="form-group">\n			<span id="search_icon" class="icon-search"></span>\n			<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search albums\') %>" value="">\n		</div>\n		<div class="form-group">\n			<select class="control-full" id="search_order">\n               <option value="latest" selected="true"><%= _t(\'Latest\') %></option>\n               <option value="most_viewed"><%= _t(\'Most Viewed\') %></option>\n               <option value="most_liked"><%= _t(\'Most Liked\') %></option>\n               <option value="most_discussed"><%= _t(\'Most Discussed\') %></option>\n            </select>\n        </div>\n	</div>\n	\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>" />\n	</div>\n</div>'}),define("music/view/playlist-search",["text!music/tpl/playlist-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$categoryInput=this.$el.find("#search_category"),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this},fetchData:function(){utils.api.get("video/categories",{},{context:this}).done(this.updateView)},updateView:function(e){if(e.error_code)return utils.modal.alert(e.error_message);_.each(e,function(e){this.$categoryInput.append(new Option(e.sName,e.iCategoryId))},this)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",iCategoryId:this.$categoryInput.val()||0,sOrder:this.$orderInput.val()||"creation_date"})}})}),define("music/view/playlist-index",["text!music/tpl/playlist-index.html","music/view/playlist-list","music/view/playlist-search"],function(e){var t=require("music/view/playlist-list"),n=require("music/view/playlist-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),render:function(){return this.$el.html(this.template()),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#playlist_list_view_holder"),this.$scroller,{loadnew:!1}),this.searchView=new n,this.searchView.render().inject(),this.listView.render({}).inject();var r=this;return this.searchView.on("submit",function(e){r.listView.resetQuery(e)}),this}})}),define("text!music/tpl/playlist-my.html",[],function(){return'<!-- music/tpl/music-index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n			<%= _t(\'My Music\') %>\n		</div>\n	</div>\n</div>\n<div id="search_view_holder">\n<!-- Add search box in here -->\n</div>\n<div class="content content-background with-header-footer with-search body-bg swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvl"></div>\n			<div id="not_found" class="not-found hide">No albums found.</div>\n			<div class="swiper-list vertical-align">\n				<div id="playlist_list_view_holder">\n				</div>\n				<%= utils.helper.loadmore() %>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n        <a class="menu-item" href="#music_playlists">\n        	<div class=""><%= _t(\'Albums\') %></div>\n        </a>\n        <a class="menu-item" href="#music_songs">\n        	<div class="sibling"><%= _t(\'Songs\') %></div>\n        </a>\n        <a class="menu-item current" href="#music_playlists/my">\n        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n        </a>\n        <a class="menu-item" href="#music_songs/my">\n			<%= _t(\'My songs\') %>\n		</a>\n    </div>\n</div>'}),define("text!music/tpl/playlist-my-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading Initiator -->\n</div>'}),define("text!music/tpl/playlist-my-item.html",[],function(){return'<!-- friend/tpl/friend-item -->\n<div class="clearfix item-wrapper">\n	<div class="item-image">\n		<a href="<%= item.getUrl() %>">\n			<span style="background-image: url(\'<%= item.getImageSrc() %>\');"></span>\n		</a>\n	</div>\n	<div class="item-stats-group">\n		<div class="item-stats">\n			<i class="icon icon-music-track"></i>\n			<span class="text-info"><%= item.getTrackCount() %></span>			\n		</div>\n		<div class="item-stats">\n			<i class="icon icon-music-listen"></i>\n			<span class="text-info"><%= item.getPlayCount() %></span>			\n		</div>\n		<div class="item-stats prevent <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<i class="icon icon-activity-like"></i>\n			<span class="text-info"><%= item.getLikeCount() %></span>\n		</div>\n        <% if(item.canComment()){%>\n		<div class="item-stats prevent" id="<%= item.getDataId(\'comment\') %>" rel="delegate">			\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-info"><%= item.getCommentCount() %></span>\n		</div>\n		<% } %>		\n	</div>\n	<div class="item-group">\n		<div class="item-headline">\n			<a href="<%= item.getUrl() %>"><%= item.getTitle() %></a>\n		</div>\n		<div class="item-subline">\n			<%= _t(\'Created \') %> <%= item.get(\'sFullTimeStamp\') %>\n		</div>\n	</div>\n	<%if (item.getTrackCount() > 0) {%>\n	<div class="item-music-list-arrow"></div>\n	<%}%>\n</div>\n<div class="pvm"></div>\n'}),define("music/view/playlist-my-item",["text!music/tpl/playlist-my-item.html"],function(e){return Backbone.ItemView.extend({className:"music-playlist-item",template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this.$el.attr({id:this.model.getDataId(),rel:"link","data-url":this.model.getUrl()}),this},inject:function(e){e(this.el)},events:{"click .icon-pencil":"editAlbum"},editAlbum:function(e){var t=$(e.target).parents(".music-playlist-item"),n=$(e.target).data("playlistid")||0;window.location.href="#musics/edit-playlist/"+n},doDeleteClick:function(e){var t=_t("Are you sure to delete this playlist? (*Note: This action cannot rollback)"),n=this;utils.modal.confirm(t,function(e){e==1&&n.doDelete()},_t("Confirm"),[_t("Ok"),_t("Cancel")])},doDelete:function(){this.$el.addClass("hide"),utils.api.post("album/delete",{iAlbumId:this.model.getId()},{context:this}).done(function(e){e.error_code&&e.error_code>0?this.doDeleteFail(e):this.doDeleteSuccess()}).fail(function(e){this.$el.removeClass("hide")})},doDeleteFail:function(e){utils.modal.alert(e.error_message),this.$el.removeClass("hide")},doDeleteSuccess:function(){this.$el.remove(),utils.modal.toast(_t("Playlist successfully deleted."))}})}),define("text!search/tpl/search.html",[],function(){return'<div class="search-area">\r\n	<div class="search-simple">\r\n		<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\r\n	</div>\r\n	<div id="adv_search_holder" class="search-advanced hide">\r\n		<div class="form-search-group include-btn-search">\r\n			<div class="form-group">\r\n				<span class="icon-search" id="search-button"></span>\r\n				<input type="text" class="input-search control-full" id="search-textbox-item" placeholder="<%=sPlaceHolder%>" />\r\n			</div>\r\n		</div>\r\n\r\n		<div class="form-search-group">\r\n			<div class="form-group">\r\n				<select class="control-full" name="select-category" id="search_category">\r\n                    <option value="0"><%= _t(\'All Categories\') %></option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n        <div class="form-search-group">\r\n            <div class="form-group">\r\n				<select class="control-full" name="select-category" id="search_event_browseby">\r\n                    <option value="starttime"><%= _t(\'Start time\') %></option>\r\n                </select>\r\n            </div>\r\n		</div>\r\n		<div class="form-search-submit">\r\n			<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>" />\r\n		</div>\r\n	</div>\r\n</div>'}),define("search/view/search",["text!search/tpl/search.html"],function(e){return Backbone.View.extend({region:{searchbox:"#searchbox"},className:"search-item",template:_.template(e),render:function(e){return this.context=$.extend({bAdvanced:!0,sPlaceHolder:_t("Keywords...")},e),this.$el.html(this.template(this.context)),this},inject:function(){$(this.region.searchbox).append(this.el)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search-button":"doSearch"},toggleAdvSearch:function(e){$("#adv_search_holder").toggleClass("hide")},doSearch:function(){this.context.callBack($("#search-textbox-item").val())}})}),define("music/view/playlist-my-list",["text!music/tpl/playlist-my-list.html","music/model/playlist","music/view/playlist-my-item","search/view/search"],function(e,t,n,r){return Backbone.ListView.extend({defaults:{sSearch:"",sView:"my",iMaxId:0,iMinId:0,iLimit:5,iPage:1},followById:!0,api:"album/fetch",phraseNotFound:"No albums found.",phraseNotMore:"No more albums.",className:"music-playlist-list",template:_.template(e),itemModel:t,itemView:n})}),define("music/view/playlist-my",["text!music/tpl/playlist-my.html","music/view/playlist-my-list","music/view/playlist-search"],function(e){var t=require("music/view/playlist-my-list"),n=require("music/view/playlist-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(){return this.$el.html(this.template()),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#playlist_list_view_holder"),this.$scroller),this.searchView=new n,this.searchView.render().inject(),this.listView.render({}).inject();var r=this;return this.searchView.on("submit",function(e){r.listView.resetQuery(e)}),this}})}),define("music/controller/playlist-index",["music/view/playlist-index","music/view/playlist-my"],function(e,t){function n(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({}).inject()}function r(){utils.history.push(),utils.observer.trigger("router:changed"),(new t).render({}).inject()}utils.router.route("music_playlists/my",r),utils.router.route("music_playlists",n)});var mejs=mejs||{};mejs.version="2.12.0",mejs.meIndex=0,mejs.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/rtmp","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mpeg","video/youtube","video/x-youtube"]}],youtube:[{version:null,types:["video/youtube","video/x-youtube","audio/youtube","audio/x-youtube"]}],vimeo:[{version:null,types:["video/vimeo","video/x-vimeo"]}]},mejs.Utility={encodeUrl:function(e){return encodeURIComponent(e)},escapeHTML:function(e){return e.toString().split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},absolutizeUrl:function(e){var t=document.createElement("div");return t.innerHTML='<a href="'+this.escapeHTML(e)+'">x</a>',t.firstChild.href},getScriptPath:function(e){var t=0,n,r="",i="",s,o,u,a,f,l=document.getElementsByTagName("script"),c=l.length,h=e.length;for(;t<c;t++){u=l[t].src,s=u.lastIndexOf("/"),s>-1?(f=u.substring(s+1),a=u.substring(0,s+1)):(f=u,a="");for(n=0;n<h;n++){i=e[n],o=f.indexOf(i);if(o>-1){r=a;break}}if(r!=="")break}return r},secondsToTimeCode:function(e,t,n,r){typeof n=="undefined"?n=!1:typeof r=="undefined"&&(r=25);var i=Math.floor(e/3600)%24,s=Math.floor(e/60)%60,o=Math.floor(e%60),u=Math.floor((e%1*r).toFixed(3)),a=(t||i>0?(i<10?"0"+i:i)+":":"")+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+(n?":"+(u<10?"0"+u:u):"");return a},timeCodeToSeconds:function(e,t,n,r){typeof n=="undefined"?n=!1:typeof r=="undefined"&&(r=25);var i=e.split(":"),s=parseInt(i[0],10),o=parseInt(i[1],10),u=parseInt(i[2],10),a=0,f=0;return n&&(a=parseInt(i[3])/r),f=s*3600+o*60+u+a,f},convertSMPTEtoSeconds:function(e){if(typeof e!="string")return!1;e=e.replace(",",".");var t=0,n=e.indexOf(".")!=-1?e.split(".")[1].length:0,r=1;e=e.split(":").reverse();for(var i=0;i<e.length;i++)r=1,i>0&&(r=Math.pow(60,i)),t+=Number(e[i])*r;return Number(t.toFixed(n))},removeSwf:function(e){var t=document.getElementById(e);t&&/object|embed/i.test(t.nodeName)&&(mejs.MediaFeatures.isIE?(t.style.display="none",function(){t.readyState==4?mejs.Utility.removeObjectInIE(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))},removeObjectInIE:function(e){var t=document.getElementById(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}},mejs.PluginDetector={hasPluginVersion:function(e,t){var n=this.plugins[e];return t[1]=t[1]||0,t[2]=t[2]||0,n[0]>t[0]||n[0]==t[0]&&n[1]>t[1]||n[0]==t[0]&&n[1]==t[1]&&n[2]>=t[2]?!0:!1},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(e,t,n,r,i){this.plugins[e]=this.detectPlugin(t,n,r,i)},detectPlugin:function(e,t,n,r){var i=[0,0,0],s,o,u;if(typeof this.nav.plugins!="undefined"&&typeof this.nav.plugins[e]=="object"){s=this.nav.plugins[e].description;if(s&&(typeof this.nav.mimeTypes=="undefined"||!this.nav.mimeTypes[t]||!!this.nav.mimeTypes[t].enabledPlugin)){i=s.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");for(o=0;o<i.length;o++)i[o]=parseInt(i[o].match(/\d+/),10)}}else if(typeof window.ActiveXObject!="undefined")try{u=new ActiveXObject(n),u&&(i=r(u))}catch(a){}return i}},mejs.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(e){var t=[],n=e.GetVariable("$version");return n&&(n=n.split(" ")[1].split(","),t=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)]),t}),mejs.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(e){var t=[0,0,0,0],n=function(e,t,n,r){while(e.isVersionSupported(t[0]+"."+t[1]+"."+t[2]+"."+t[3]))t[n]+=r;t[n]-=r};return n(e,t,0,1),n(e,t,1,1),n(e,t,2,1e4),n(e,t,2,1e3),n(e,t,2,100),n(e,t,2,10),n(e,t,2,1),n(e,t,3,1),t}),mejs.MediaFeatures={init:function(){var e=this,t=document,n=mejs.PluginDetector.nav,r=mejs.PluginDetector.ua.toLowerCase(),i,s,o=["source","track","audio","video"];e.isiPad=r.match(/ipad/i)!==null,e.isiPhone=r.match(/iphone/i)!==null,e.isiOS=e.isiPhone||e.isiPad,e.isAndroid=r.match(/android/i)!==null,e.isBustedAndroid=r.match(/android 2\.[12]/)!==null,e.isBustedNativeHTTPS=location.protocol==="https:"&&(r.match(/android [12]\./)!==null||r.match(/macintosh.* version.* safari/)!==null),e.isIE=n.appName.toLowerCase().indexOf("microsoft")!=-1,e.isChrome=r.match(/chrome/gi)!==null,e.isFirefox=r.match(/firefox/gi)!==null,e.isWebkit=r.match(/webkit/gi)!==null,e.isGecko=r.match(/gecko/gi)!==null&&!e.isWebkit,e.isOpera=r.match(/opera/gi)!==null,e.hasTouch="ontouchstart"in window,e.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect;for(i=0;i<o.length;i++)s=document.createElement(o[i]);e.supportsMediaTag=typeof s.canPlayType!="undefined"||e.isBustedAndroid;try{s.canPlayType("video/mp4")}catch(u){e.supportsMediaTag=!1}e.hasSemiNativeFullScreen=typeof s.webkitEnterFullscreen!="undefined",e.hasWebkitNativeFullScreen=typeof s.webkitRequestFullScreen!="undefined",e.hasMozNativeFullScreen=typeof s.mozRequestFullScreen!="undefined",e.hasTrueNativeFullScreen=e.hasWebkitNativeFullScreen||e.hasMozNativeFullScreen,e.nativeFullScreenEnabled=e.hasTrueNativeFullScreen,e.hasMozNativeFullScreen&&(e.nativeFullScreenEnabled=s.mozFullScreenEnabled),this.isChrome&&(e.hasSemiNativeFullScreen=!1),e.hasTrueNativeFullScreen&&(e.fullScreenEventName=e.hasWebkitNativeFullScreen?"webkitfullscreenchange":"mozfullscreenchange",e.isFullScreen=function(){if(s.mozRequestFullScreen)return t.mozFullScreen;if(s.webkitRequestFullScreen)return t.webkitIsFullScreen},e.requestFullScreen=function(t){e.hasWebkitNativeFullScreen?t.webkitRequestFullScreen():e.hasMozNativeFullScreen&&t.mozRequestFullScreen()},e.cancelFullScreen=function(){e.hasWebkitNativeFullScreen?document.webkitCancelFullScreen():e.hasMozNativeFullScreen&&document.mozCancelFullScreen()}),e.hasSemiNativeFullScreen&&r.match(/mac os x 10_5/i)&&(e.hasNativeFullScreen=!1,e.hasSemiNativeFullScreen=!1)}},mejs.MediaFeatures.init(),mejs.HtmlMediaElement={pluginType:"native",isFullScreen:!1,setCurrentTime:function(e){this.currentTime=e},setMuted:function(e){this.muted=e},setVolume:function(e){this.volume=e},stop:function(){this.pause()},setSrc:function(e){var t=this.getElementsByTagName("source");while(t.length>0)this.removeChild(t[0]);if(typeof e=="string")this.src=e;else{var n,r;for(n=0;n<e.length;n++){r=e[n];if(this.canPlayType(r.type)){this.src=r.src;break}}}},setVideoSize:function(e,t){this.width=e,this.height=t}},mejs.PluginMediaElement=function(e,t,n){this.id=e,this.pluginType=t,this.src=n,this.events={},this.attributes={}},mejs.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:!1,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:!0,ended:!1,seeking:!1,duration:0,error:null,tagName:"",muted:!1,volume:1,currentTime:0,play:function(){this.pluginApi!=null&&(this.pluginType=="youtube"?this.pluginApi.playVideo():this.pluginApi.playMedia(),this.paused=!1)},load:function(){this.pluginApi!=null&&(this.pluginType!="youtube"&&this.pluginApi.loadMedia(),this.paused=!1)},pause:function(){this.pluginApi!=null&&(this.pluginType=="youtube"?this.pluginApi.pauseVideo():this.pluginApi.pauseMedia(),this.paused=!0)},stop:function(){this.pluginApi!=null&&(this.pluginType=="youtube"?this.pluginApi.stopVideo():this.pluginApi.stopMedia(),this.paused=!0)},canPlayType:function(e){var t,n,r,i=mejs.plugins[this.pluginType];for(t=0;t<i.length;t++){r=i[t];if(mejs.PluginDetector.hasPluginVersion(this.pluginType,r.version))for(n=0;n<r.types.length;n++)if(e==r.types[n])return"probably"}return""},positionFullscreenButton:function(e,t,n){this.pluginApi!=null&&this.pluginApi.positionFullscreenButton&&this.pluginApi.positionFullscreenButton(Math.floor(e),Math.floor(t),n)},hideFullscreenButton:function(){this.pluginApi!=null&&this.pluginApi.hideFullscreenButton&&this.pluginApi.hideFullscreenButton()},setSrc:function(e){if(typeof e=="string")this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(e)),this.src=mejs.Utility.absolutizeUrl(e);else{var t,n;for(t=0;t<e.length;t++){n=e[t];if(this.canPlayType(n.type)){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(n.src)),this.src=mejs.Utility.absolutizeUrl(e);break}}}},setCurrentTime:function(e){this.pluginApi!=null&&(this.pluginType=="youtube"?this.pluginApi.seekTo(e):this.pluginApi.setCurrentTime(e),this.currentTime=e)},setVolume:function(e){this.pluginApi!=null&&(this.pluginType=="youtube"?this.pluginApi.setVolume(e*100):this.pluginApi.setVolume(e),this.volume=e)},setMuted:function(e){this.pluginApi!=null&&(this.pluginType=="youtube"?(e?this.pluginApi.mute():this.pluginApi.unMute(),this.muted=e,this.dispatchEvent("volumechange")):this.pluginApi.setMuted(e),this.muted=e)},setVideoSize:function(e,t){this.pluginElement.style&&(this.pluginElement.style.width=e+"px",this.pluginElement.style.height=t+"px"),this.pluginApi!=null&&this.pluginApi.setVideoSize&&this.pluginApi.setVideoSize(e,t)},setFullscreen:function(e){this.pluginApi!=null&&this.pluginApi.setFullscreen&&this.pluginApi.setFullscreen(e)},enterFullScreen:function(){this.pluginApi!=null&&this.pluginApi.setFullscreen&&this.setFullscreen(!0)},exitFullScreen:function(){this.pluginApi!=null&&this.pluginApi.setFullscreen&&this.setFullscreen(!1)},addEventListener:function(e,t,n){this.events[e]=this.events[e]||[],this.events[e].push(t)},removeEventListener:function(e,t){if(!e)return this.events={},!0;var n=this.events[e];if(!n)return!0;if(!t)return this.events[e]=[],!0;for(i=0;i<n.length;i++)if(n[i]===t)return this.events[e].splice(i,1),!0;return!1},dispatchEvent:function(e){var t,n,r=this.events[e];if(r){n=Array.prototype.slice.call(arguments,1);for(t=0;t<r.length;t++)r[t].apply(null,n)}},hasAttribute:function(e){return e in this.attributes},removeAttribute:function(e){delete this.attributes[e]},getAttribute:function(e){return this.hasAttribute(e)?this.attributes[e]:""},setAttribute:function(e,t){this.attributes[e]=t},remove:function(){mejs.Utility.removeSwf(this.pluginElement.id),mejs.MediaPluginBridge.unregisterPluginElement(this.pluginElement.id)}},mejs.MediaPluginBridge={pluginMediaElements:{},htmlMediaElements:{},registerPluginElement:function(e,t,n){this.pluginMediaElements[e]=t,this.htmlMediaElements[e]=n},unregisterPluginElement:function(e){delete this.pluginMediaElements[e],delete this.htmlMediaElements[e]},initPlugin:function(e){var t=this.pluginMediaElements[e],n=this.htmlMediaElements[e];if(t){switch(t.pluginType){case"flash":t.pluginElement=t.pluginApi=document.getElementById(e);break;case"silverlight":t.pluginElement=document.getElementById(t.id),t.pluginApi=t.pluginElement.Content.MediaElementJS}t.pluginApi!=null&&t.success&&t.success(t,n)}},fireEvent:function(e,t,n){var r,i,s,o=this.pluginMediaElements[e];r={type:t,target:o};for(i in n)o[i]=n[i],r[i]=n[i];s=n.bufferedTime||0,r.target.buffered=r.buffered={start:function(e){return 0},end:function(e){return s},length:1},o.dispatchEvent(r.type,r)}},mejs.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight","youtube","vimeo"],enablePluginDebug:!1,type:"",pluginPath:mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",flashStreamer:"",enablePluginSmoothing:!1,enablePseudoStreaming:!1,pseudoStreamingStartQueryParam:"start",silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,pluginVars:[],timerRate:250,startVolume:.8,success:function(){},error:function(){}},mejs.MediaElement=function(e,t){return mejs.HtmlMediaElementShim.create(e,t)},mejs.HtmlMediaElementShim={create:function(e,t){var n=mejs.MediaElementDefaults,r=typeof e=="string"?document.getElementById(e):e,i=r.tagName.toLowerCase(),s=i==="audio"||i==="video",o=s?r.getAttribute("src"):r.getAttribute("href"),u=r.getAttribute("poster"),a=r.getAttribute("autoplay"),f=r.getAttribute("preload"),l=r.getAttribute("controls"),c,h;for(h in t)n[h]=t[h];return o=typeof o=="undefined"||o===null||o==""?null:o,u=typeof u=="undefined"||u===null?"":u,f=typeof f=="undefined"||f===null||f==="false"?"none":f,a=typeof a!="undefined"&&a!==null&&a!=="false",l=typeof l!="undefined"&&l!==null&&l!=="false",c=this.determinePlayback(r,n,mejs.MediaFeatures.supportsMediaTag,s,o),c.url=c.url!==null?mejs.Utility.absolutizeUrl(c.url):"",c.method=="native"?(mejs.MediaFeatures.isBustedAndroid&&(r.src=c.url,r.addEventListener("click",function(){r.play()},!1)),this.updateNative(c,n,a,f)):c.method!==""?this.createPlugin(c,n,u,a,f,l):(this.createErrorMessage(c,n,u),this)},determinePlayback:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h={method:"",url:"",htmlMediaElement:e,isVideo:e.tagName.toLowerCase()!="audio"},p,d,v,m,g;if(typeof t.type!="undefined"&&t.type!=="")if(typeof t.type=="string")s.push({type:t.type,url:i});else for(o=0;o<t.type.length;o++)s.push({type:t.type[o],url:i});else if(i!==null)c=this.formatType(i,e.getAttribute("type")),s.push({type:c,url:i});else for(o=0;o<e.childNodes.length;o++)l=e.childNodes[o],l.nodeType==1&&l.tagName.toLowerCase()=="source"&&(i=l.getAttribute("src"),c=this.formatType(i,l.getAttribute("type")),g=l.getAttribute("media"),(!g||!window.matchMedia||window.matchMedia&&window.matchMedia(g).matches)&&s.push({type:c,url:i}));!r&&s.length>0&&s[0].url!==null&&this.getTypeFromFile(s[0].url).indexOf("audio")>-1&&(h.isVideo=!1),mejs.MediaFeatures.isBustedAndroid&&(e.canPlayType=function(e){return e.match(/video\/(mp4|m4v)/gi)!==null?"maybe":""});if(n&&(t.mode==="auto"||t.mode==="auto_plugin"||t.mode==="native")&&!mejs.MediaFeatures.isBustedNativeHTTPS){r||(m=document.createElement(h.isVideo?"video":"audio"),e.parentNode.insertBefore(m,e),e.style.display="none",h.htmlMediaElement=e=m);for(o=0;o<s.length;o++)if(e.canPlayType(s[o].type).replace(/no/,"")!==""||e.canPlayType(s[o].type.replace(/mp3/,"mpeg")).replace(/no/,"")!==""){h.method="native",h.url=s[o].url;break}if(h.method==="native"){h.url!==null&&(e.src=h.url);if(t.mode!=="auto_plugin")return h}}if(t.mode==="auto"||t.mode==="auto_plugin"||t.mode==="shim")for(o=0;o<s.length;o++){c=s[o].type;for(u=0;u<t.plugins.length;u++){p=t.plugins[u],d=mejs.plugins[p];for(a=0;a<d.length;a++){v=d[a];if(v.version==null||mejs.PluginDetector.hasPluginVersion(p,v.version))for(f=0;f<v.types.length;f++)if(c==v.types[f])return h.method=p,h.url=s[o].url,h}}}return t.mode==="auto_plugin"&&h.method==="native"?h:(h.method===""&&s.length>0&&(h.url=s[0].url),h)},formatType:function(e,t){var n;return e&&!t?this.getTypeFromFile(e):t&&~t.indexOf(";")?t.substr(0,t.indexOf(";")):t},getTypeFromFile:function(e){e=e.split("?")[0];var t=e.substring(e.lastIndexOf(".")+1).toLowerCase();return(/(mp4|m4v|ogg|ogv|webm|webmv|flv|wmv|mpeg|mov)/gi.test(t)?"video":"audio")+"/"+this.getTypeFromExtension(t)},getTypeFromExtension:function(e){switch(e){case"mp4":case"m4v":return"mp4";case"webm":case"webma":case"webmv":return"webm";case"ogg":case"oga":case"ogv":return"ogg";default:return e}},createErrorMessage:function(e,t,n){var r=e.htmlMediaElement,i=document.createElement("div");i.className="me-cannotplay";try{i.style.width=r.width+"px",i.style.height=r.height+"px"}catch(s){}t.customError?i.innerHTML=t.customError:i.innerHTML=n!==""?'<a href="'+e.url+'"><img src="'+n+'" width="100%" height="100%" /></a>':'<a href="'+e.url+'"><span>'+mejs.i18n.t("Download File")+"</span></a>",r.parentNode.insertBefore(i,r),r.style.display="none",t.error(r)},createPlugin:function(e,t,n,r,i,s){var o=e.htmlMediaElement,u=1,a=1,f="me_"+e.method+"_"+mejs.meIndex++,l=new mejs.PluginMediaElement(f,e.method,e.url),c=document.createElement("div"),h,p,d;l.tagName=o.tagName;for(var v=0;v<o.attributes.length;v++){var m=o.attributes[v];m.specified==1&&l.setAttribute(m.name,m.value)}p=o.parentNode;while(p!==null&&p.tagName.toLowerCase()!="body"){if(p.parentNode.tagName.toLowerCase()=="p"){p.parentNode.parentNode.insertBefore(p,p.parentNode);break}p=p.parentNode}e.isVideo?(u=t.pluginWidth>0?t.pluginWidth:t.videoWidth>0?t.videoWidth:o.getAttribute("width")!==null?o.getAttribute("width"):t.defaultVideoWidth,a=t.pluginHeight>0?t.pluginHeight:t.videoHeight>0?t.videoHeight:o.getAttribute("height")!==null?o.getAttribute("height"):t.defaultVideoHeight,u=mejs.Utility.encodeUrl(u),a=mejs.Utility.encodeUrl(a)):t.enablePluginDebug&&(u=320,a=240),l.success=t.success,mejs.MediaPluginBridge.registerPluginElement(f,l,o),c.className="me-plugin",c.id=f+"_container",e.isVideo?o.parentNode.insertBefore(c,o):document.body.insertBefore(c,document.body.childNodes[0]),d=["id="+f,"isvideo="+(e.isVideo?"true":"false"),"autoplay="+(r?"true":"false"),"preload="+i,"width="+u,"startvolume="+t.startVolume,"timerrate="+t.timerRate,"flashstreamer="+t.flashStreamer,"height="+a,"pseudostreamstart="+t.pseudoStreamingStartQueryParam],e.url!==null&&(e.method=="flash"?d.push("file="+mejs.Utility.encodeUrl(e.url)):d.push("file="+e.url)),t.enablePluginDebug&&d.push("debug=true"),t.enablePluginSmoothing&&d.push("smoothing=true"),t.enablePseudoStreaming&&d.push("pseudostreaming=true"),s&&d.push("controls=true"),t.pluginVars&&(d=d.concat(t.pluginVars));switch(e.method){case"silverlight":c.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+f+'" name="'+f+'" width="'+u+'" height="'+a+'" class="mejs-shim">'+'<param name="initParams" value="'+d.join(",")+'" />'+'<param name="windowless" value="true" />'+'<param name="background" value="black" />'+'<param name="minRuntimeVersion" value="3.0.0.0" />'+'<param name="autoUpgrade" value="true" />'+'<param name="source" value="'+t.pluginPath+t.silverlightName+'" />'+"</object>";break;case"flash":mejs.MediaFeatures.isIE?(h=document.createElement("div"),c.appendChild(h),h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+f+'" width="'+u+'" height="'+a+'" class="mejs-shim">'+'<param name="movie" value="'+t.pluginPath+t.flashName+"?x="+new Date+'" />'+'<param name="flashvars" value="'+d.join("&amp;")+'" />'+'<param name="quality" value="high" />'+'<param name="bgcolor" value="#000000" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="allowFullScreen" value="true" />'+"</object>"):c.innerHTML='<embed id="'+f+'" name="'+f+'" '+'play="true" '+'loop="false" '+'quality="high" '+'bgcolor="#000000" '+'wmode="transparent" '+'allowScriptAccess="always" '+'allowFullScreen="true" '+'type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" '+'src="'+t.pluginPath+t.flashName+'" '+'flashvars="'+d.join("&")+'" '+'width="'+u+'" '+'height="'+a+'" '+'class="mejs-shim"></embed>';break;case"youtube":var g=e.url.substr(e.url.lastIndexOf("=")+1);youtubeSettings={container:c,containerId:c.id,pluginMediaElement:l,pluginId:f,videoId:g,height:a,width:u},mejs.PluginDetector.hasPluginVersion("flash",[10,0,0])?mejs.YouTubeApi.createFlash(youtubeSettings):mejs.YouTubeApi.enqueueIframe(youtubeSettings);break;case"vimeo":l.vimeoid=e.url.substr(e.url.lastIndexOf("/")+1),c.innerHTML='<iframe src="http://player.vimeo.com/video/'+l.vimeoid+'?portrait=0&byline=0&title=0" width="'+u+'" height="'+a+'" frameborder="0" class="mejs-shim"></iframe>'}return o.style.display="none",l},updateNative:function(e,t,n,r){var i=e.htmlMediaElement,s;for(s in mejs.HtmlMediaElement)i[s]=mejs.HtmlMediaElement[s];return t.success(i,i),i}},mejs.YouTubeApi={isIframeStarted:!1,isIframeLoaded:!1,loadIframeApi:function(){if(!this.isIframeStarted){var e=document.createElement("script");e.src="//www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),this.isIframeStarted=!0}},iframeQueue:[],enqueueIframe:function(e){this.isLoaded?this.createIframe(e):(this.loadIframeApi(),this.iframeQueue.push(e))},createIframe:function(e){var t=e.pluginMediaElement,n=new YT.Player(e.containerId,{height:e.height,width:e.width,videoId:e.videoId,playerVars:{controls:0},events:{onReady:function(){e.pluginMediaElement.pluginApi=n,mejs.MediaPluginBridge.initPlugin(e.pluginId),setInterval(function(){mejs.YouTubeApi.createEvent(n,t,"timeupdate")},250)},onStateChange:function(e){mejs.YouTubeApi.handleStateChange(e.data,n,t)}}})},createEvent:function(e,t,n){var r={type:n,target:t};if(e&&e.getDuration){t.currentTime=r.currentTime=e.getCurrentTime(),t.duration=r.duration=e.getDuration(),r.paused=t.paused,r.ended=t.ended,r.muted=e.isMuted(),r.volume=e.getVolume()/100,r.bytesTotal=e.getVideoBytesTotal(),r.bufferedBytes=e.getVideoBytesLoaded();var i=r.bufferedBytes/r.bytesTotal*r.duration;r.target.buffered=r.buffered={start:function(e){return 0},end:function(e){return i},length:1}}t.dispatchEvent(r.type,r)},iFrameReady:function(){this.isLoaded=!0,this.isIframeLoaded=!0;while(this.iframeQueue.length>0){var e=this.iframeQueue.pop();this.createIframe(e)}},flashPlayers:{},createFlash:function(e){this.flashPlayers[e.pluginId]=e;var t,n="//www.youtube.com/apiplayer?enablejsapi=1&amp;playerapiid="+e.pluginId+"&amp;version=3&amp;autoplay=0&amp;controls=0&amp;modestbranding=1&loop=0";mejs.MediaFeatures.isIE?(t=document.createElement("div"),e.container.appendChild(t),t.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+e.pluginId+'" width="'+e.width+'" height="'+e.height+'" class="mejs-shim">'+'<param name="movie" value="'+n+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="allowFullScreen" value="true" />'+"</object>"):e.container.innerHTML='<object type="application/x-shockwave-flash" id="'+e.pluginId+'" data="'+n+'" '+'width="'+e.width+'" height="'+e.height+'" style="visibility: visible; " class="mejs-shim">'+'<param name="allowScriptAccess" value="always">'+'<param name="wmode" value="transparent">'+"</object>"},flashReady:function(e){var t=this.flashPlayers[e],n=document.getElementById(e),r=t.pluginMediaElement;r.pluginApi=r.pluginElement=n,mejs.MediaPluginBridge.initPlugin(e),n.cueVideoById(t.videoId);var i=t.containerId+"_callback";window[i]=function(e){mejs.YouTubeApi.handleStateChange(e,n,r)},n.addEventListener("onStateChange",i),setInterval(function(){mejs.YouTubeApi.createEvent(n,r,"timeupdate")},250)},handleStateChange:function(e,t,n){switch(e){case-1:n.paused=!0,n.ended=!0,mejs.YouTubeApi.createEvent(t,n,"loadedmetadata");break;case 0:n.paused=!1,n.ended=!0,mejs.YouTubeApi.createEvent(t,n,"ended");break;case 1:n.paused=!1,n.ended=!1,mejs.YouTubeApi.createEvent(t,n,"play"),mejs.YouTubeApi.createEvent(t,n,"playing");break;case 2:n.paused=!0,n.ended=!1,mejs.YouTubeApi.createEvent(t,n,"pause");break;case 3:mejs.YouTubeApi.createEvent(t,n,"progress");break;case 5:}}},window.mejs=mejs,window.MediaElement=mejs.MediaElement,function(e,t,n){var r={locale:{strings:{}},methods:{}};r.locale.getLanguage=function(){return r.locale||{language:navigator.language}},r.locale.INIT_LANGUAGE=r.locale.getLanguage(),r.methods.checkPlain=function(e){var t,n,r={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};e=String(e);for(t in r)r.hasOwnProperty(t)&&(n=new RegExp(t,"g"),e=e.replace(n,r[t]));return e},r.methods.formatString=function(e,t){for(var n in t){switch(n.charAt(0)){case"@":t[n]=r.methods.checkPlain(t[n]);break;case"!":break;case"%":default:t[n]='<em class="placeholder">'+r.methods.checkPlain(t[n])+"</em>"}e=e.replace(n,t[n])}return e},r.methods.t=function(e,t,n){return r.locale.strings&&r.locale.strings[n.context]&&r.locale.strings[n.context][e]&&(e=r.locale.strings[n.context][e]),t&&(e=r.methods.formatString(e,t)),e},r.t=function(e,t,n){if(typeof e=="string"&&e.length>0){var i=r.locale.getLanguage();return n=n||{context:i.language},r.methods.t(e,t,n)}throw{name:"InvalidArgumentException",message:"First argument is either not a string or empty."}},t.i18n=r}(document,mejs),function(e,t){mejs.i18n.locale.language&&mejs.i18n.locale.strings&&(e[mejs.i18n.locale.language]=mejs.i18n.locale.strings)}(mejs.i18n.locale.strings),function(e,t){e.de={Fullscreen:"Vollbild","Go Fullscreen":"Vollbild an","Turn off Fullscreen":"Vollbild aus",Close:"Schließen"}}(mejs.i18n.locale.strings),function(e,t){e.zh={Fullscreen:"全螢幕","Go Fullscreen":"全屏模式","Turn off Fullscreen":"退出全屏模式",Close:"關閉"}}(mejs.i18n.locale.strings),typeof jQuery!="undefined"?mejs.$=jQuery:typeof ender!="undefined"&&(mejs.$=ender),function(e){mejs.MepDefaults={poster:"",defaultVideoWidth:480,defaultVideoHeight:270,videoWidth:-1,videoHeight:-1,defaultAudioWidth:400,defaultAudioHeight:30,defaultSeekBackwardInterval:function(e){return e.duration*.05},defaultSeekForwardInterval:function(e){return e.duration*.05},audioWidth:-1,audioHeight:-1,startVolume:.8,loop:!1,autoRewind:!0,enableAutosize:!0,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,autosizeProgress:!0,alwaysShowControls:!1,hideVideoControlsOnLoad:!1,clickToPlayPause:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,features:["playpause","current","progress","duration","tracks","volume","fullscreen"],isVideo:!0,enableKeyboard:!0,pauseOtherPlayers:!0,keyActions:[{keys:[32,179],action:function(e,t){t.paused||t.ended?t.play():t.pause()}},{keys:[38],action:function(e,t){var n=Math.min(t.volume+.1,1);t.setVolume(n)}},{keys:[40],action:function(e,t){var n=Math.max(t.volume-.1,0);t.setVolume(n)}},{keys:[37,227],action:function(e,t){if(!isNaN(t.duration)&&t.duration>0){e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.max(t.currentTime-e.options.defaultSeekBackwardInterval(t),0);t.setCurrentTime(n)}}},{keys:[39,228],action:function(e,t){if(!isNaN(t.duration)&&t.duration>0){e.isVideo&&(e.showControls(),e.startControlsTimer());var n=Math.min(t.currentTime+e.options.defaultSeekForwardInterval(t),t.duration);t.setCurrentTime(n)}}},{keys:[70],action:function(e,t){typeof e.enterFullScreen!="undefined"&&(e.isFullScreen?e.exitFullScreen():e.enterFullScreen())}}]},mejs.mepIndex=0,mejs.players={},mejs.MediaElementPlayer=function(t,n){if(this instanceof mejs.MediaElementPlayer){var r=this;return r.$media=r.$node=e(t),r.node=r.media=r.$media[0],typeof r.node.player!="undefined"?r.node.player:(r.node.player=r,typeof n=="undefined"&&(n=r.$node.data("mejsoptions")),r.options=e.extend({},mejs.MepDefaults,n),r.id="mep_"+mejs.mepIndex++,mejs.players[r.id]=r,r.init(),r)}return new mejs.MediaElementPlayer(t,n)},mejs.MediaElementPlayer.prototype={hasFocus:!1,controlsAreVisible:!0,init:function(){var t=this,n=mejs.MediaFeatures,r=e.extend(!0,{},t.options,{success:function(e,n){t.meReady(e,n)},error:function(e){t.handleError(e)}}),i=t.media.tagName.toLowerCase();t.isDynamic=i!=="audio"&&i!=="video",t.isDynamic?t.isVideo=t.options.isVideo:t.isVideo=i!=="audio"&&t.options.isVideo;if(n.isiPad&&t.options.iPadUseNativeControls||n.isiPhone&&t.options.iPhoneUseNativeControls)t.$media.attr("controls","controls"),n.isiPad&&t.media.getAttribute("autoplay")!==null&&(t.media.load(),t.media.play());else if(!n.isAndroid||!t.options.AndroidUseNativeControls){t.$media.removeAttr("controls"),t.container=e('<div id="'+t.id+'" class="mejs-container '+(mejs.MediaFeatures.svg?"svg":"no-svg")+'">'+'<div class="mejs-inner">'+'<div class="mejs-mediaelement"></div>'+'<div class="mejs-layers"></div>'+'<div class="mejs-controls"></div>'+'<div class="mejs-clear"></div>'+"</div>"+"</div>").addClass(t.$media[0].className).insertBefore(t.$media),t.container.addClass((n.isAndroid?"mejs-android ":"")+(n.isiOS?"mejs-ios ":"")+(n.isiPad?"mejs-ipad ":"")+(n.isiPhone?"mejs-iphone ":"")+(t.isVideo?"mejs-video ":"mejs-audio "));if(n.isiOS){var s=t.$media.clone();t.container.find(".mejs-mediaelement").append(s),t.$media.remove(),t.$node=t.$media=s,t.node=t.media=s[0]}else t.container.find(".mejs-mediaelement").append(t.$media);t.controls=t.container.find(".mejs-controls"),t.layers=t.container.find(".mejs-layers");var o=t.isVideo?"video":"audio",u=o.substring(0,1).toUpperCase()+o.substring(1);t.options[o+"Width"]>0||t.options[o+"Width"].toString().indexOf("%")>-1?t.width=t.options[o+"Width"]:t.media.style.width!==""&&t.media.style.width!==null?t.width=t.media.style.width:t.media.getAttribute("width")!==null?t.width=t.$media.attr("width"):t.width=t.options["default"+u+"Width"],t.options[o+"Height"]>0||t.options[o+"Height"].toString().indexOf("%")>-1?t.height=t.options[o+"Height"]:t.media.style.height!==""&&t.media.style.height!==null?t.height=t.media.style.height:t.$media[0].getAttribute("height")!==null?t.height=t.$media.attr("height"):t.height=t.options["default"+u+"Height"],t.setPlayerSize(t.width,t.height),r.pluginWidth=t.width,r.pluginHeight=t.height}mejs.MediaElement(t.$media[0],r),typeof t.container!="undefined"&&t.container.trigger("controlsshown")},showControls:function(e){var t=this;e=typeof e=="undefined"||e;if(t.controlsAreVisible)return;e?(t.controls.css("visibility","visible").stop(!0,!0).fadeIn(200,function(){t.controlsAreVisible=!0,t.container.trigger("controlsshown")}),t.container.find(".mejs-control").css("visibility","visible").stop(!0,!0).fadeIn(200,function(){t.controlsAreVisible=!0})):(t.controls.css("visibility","visible").css("display","block"),t.container.find(".mejs-control").css("visibility","visible").css("display","block"),t.controlsAreVisible=!0,t.container.trigger("controlsshown")),t.setControlsSize()},hideControls:function(t){var n=this;t=typeof t=="undefined"||t;if(!n.controlsAreVisible)return;t?(n.controls.stop(!0,!0).fadeOut(200,function(){e(this).css("visibility","hidden").css("display","block"),n.controlsAreVisible=!1,n.container.trigger("controlshidden")}),n.container.find(".mejs-control").stop(!0,!0).fadeOut(200,function(){e(this).css("visibility","hidden").css("display","block")})):(n.controls.css("visibility","hidden").css("display","block"),n.container.find(".mejs-control").css("visibility","hidden").css("display","block"),n.controlsAreVisible=!1,n.container.trigger("controlshidden"))},controlsTimer:null,startControlsTimer:function(e){var t=this;e=typeof e!="undefined"?e:1500,t.killControlsTimer("start"),t.controlsTimer=setTimeout(function(){t.hideControls(),t.killControlsTimer("hide")},e)},killControlsTimer:function(e){var t=this;t.controlsTimer!==null&&(clearTimeout(t.controlsTimer),delete t.controlsTimer,t.controlsTimer=null)},controlsEnabled:!0,disableControls:function(){var e=this;e.killControlsTimer(),e.hideControls(!1),this.controlsEnabled=!1},enableControls:function(){var e=this;e.showControls(!1),e.controlsEnabled=!0},meReady:function(e,t){var n=this,r=mejs.MediaFeatures,i=t.getAttribute("autoplay"),s=typeof i!="undefined"&&i!==null&&i!=="false",o,u;if(n.created)return;n.created=!0,n.media=e,n.domNode=t;if((!r.isAndroid||!n.options.AndroidUseNativeControls)&&(!r.isiPad||!n.options.iPadUseNativeControls)&&(!r.isiPhone||!n.options.iPhoneUseNativeControls)){n.buildposter(n,n.controls,n.layers,n.media),n.buildkeyboard(n,n.controls,n.layers,n.media),n.buildoverlays(n,n.controls,n.layers,n.media),n.findTracks();for(o in n.options.features){u=n.options.features[o];if(n["build"+u])try{n["build"+u](n,n.controls,n.layers,n.media)}catch(a){}}n.container.trigger("controlsready"),n.setPlayerSize(n.width,n.height),n.setControlsSize(),n.isVideo&&(mejs.MediaFeatures.hasTouch?n.$media.bind("touchstart",function(){n.controlsAreVisible?n.hideControls(!1):n.controlsEnabled&&n.showControls(!1)}):(mejs.MediaElementPlayer.prototype.clickToPlayPauseCallback=function(){console.log("media clicked",n.media,n.media.paused),n.options.clickToPlayPause&&(n.media.paused?n.media.play():n.media.pause())},n.media.addEventListener("click",n.clickToPlayPauseCallback),n.container.bind("mouseenter mouseover",function(){n.controlsEnabled&&(n.options.alwaysShowControls||(n.killControlsTimer("enter"),n.showControls(),n.startControlsTimer(2500)))}).bind("mousemove",function(){n.controlsEnabled&&(n.controlsAreVisible||n.showControls(),n.options.alwaysShowControls||n.startControlsTimer(2500))}).bind("mouseleave",function(){n.controlsEnabled&&!n.media.paused&&!n.options.alwaysShowControls&&n.startControlsTimer(1e3)})),n.options.hideVideoControlsOnLoad&&n.hideControls(!1),s&&!n.options.alwaysShowControls&&n.hideControls(),n.options.enableAutosize&&n.media.addEventListener("loadedmetadata",function(e){n.options.videoHeight<=0&&n.domNode.getAttribute("height")===null&&!isNaN(e.target.videoHeight)&&(n.setPlayerSize(e.target.videoWidth,e.target.videoHeight),n.setControlsSize(),n.media.setVideoSize(e.target.videoWidth,e.target.videoHeight))},!1)),e.addEventListener("play",function(){var e;for(e in mejs.players){var t=mejs.players[e];t.id!=n.id&&n.options.pauseOtherPlayers&&!t.paused&&!t.ended&&t.pause(),t.hasFocus=!1}n.hasFocus=!0},!1),n.media.addEventListener("ended",function(e){if(n.options.autoRewind)try{n.media.setCurrentTime(0)}catch(t){}n.media.pause(),n.setProgressRail&&n.setProgressRail(),n.setCurrentRail&&n.setCurrentRail(),n.options.loop?n.media.play():!n.options.alwaysShowControls&&n.controlsEnabled&&n.showControls()},!1),n.media.addEventListener("loadedmetadata",function(e){n.updateDuration&&n.updateDuration(),n.updateCurrent&&n.updateCurrent(),n.isFullScreen||(n.setPlayerSize(n.width,n.height),n.setControlsSize())},!1),setTimeout(function(){n.setPlayerSize(n.width,n.height),n.setControlsSize()},50),n.globalBind("resize",function(){n.isFullScreen||mejs.MediaFeatures.hasTrueNativeFullScreen&&document.webkitIsFullScreen||n.setPlayerSize(n.width,n.height),n.setControlsSize()}),n.media.pluginType=="youtube"&&n.container.find(".mejs-overlay-play").hide()}s&&e.pluginType=="native"&&(e.load(),e.play()),n.options.success&&(typeof n.options.success=="string"?window[n.options.success](n.media,n.domNode,n):n.options.success(n.media,n.domNode,n))},handleError:function(e){var t=this;t.controls.hide(),t.options.error&&t.options.error(e)},setPlayerSize:function(t,n){var r=this;typeof t!="undefined"&&(r.width=t),typeof n!="undefined"&&(r.height=n);if(r.height.toString().indexOf("%")>0||r.$node.css("max-width")==="100%"||r.$node[0].currentStyle&&r.$node[0].currentStyle.maxWidth==="100%"){var i=r.isVideo?r.media.videoWidth&&r.media.videoWidth>0?r.media.videoWidth:r.options.defaultVideoWidth:r.options.defaultAudioWidth,s=r.isVideo?r.media.videoHeight&&r.media.videoHeight>0?r.media.videoHeight:r.options.defaultVideoHeight:r.options.defaultAudioHeight,o=r.container.parent().closest(":visible").width(),u=r.isVideo||!r.options.autosizeProgress?parseInt(o*s/i,10):s;r.container.parent()[0].tagName.toLowerCase()==="body"&&(o=e(window).width(),u=e(window).height()),u!=0&&o!=0&&(r.container.width(o).height(u),r.$media.add(r.container.find(".mejs-shim")).width("100%").height("100%"),r.isVideo&&r.media.setVideoSize&&r.media.setVideoSize(o,u),r.layers.children(".mejs-layer").width("100%").height("100%"))}else r.container.width(r.width).height(r.height),r.layers.children(".mejs-layer").width(r.width).height(r.height);var a=r.layers.find(".mejs-overlay-play"),f=a.find(".mejs-overlay-button");a.height(r.container.height()-r.controls.height()),f.css("margin-top","-"+(f.height()/2-r.controls.height()/2).toString()+"px")},setControlsSize:function(){var t=this,n=0,r=0,i=t.controls.find(".mejs-time-rail"),s=t.controls.find(".mejs-time-total"),o=t.controls.find(".mejs-time-current"),u=t.controls.find(".mejs-time-loaded"),a=i.siblings();t.options&&!t.options.autosizeProgress&&(r=parseInt(i.css("width")));if(r===0||!r)a.each(function(){var t=e(this);t.css("position")!="absolute"&&t.is(":visible")&&(n+=e(this).outerWidth(!0))}),r=t.controls.width()-n-(i.outerWidth(!0)-i.width());i.width(r),s.width(r-(s.outerWidth(!0)-s.width())),t.setProgressRail&&t.setProgressRail(),t.setCurrentRail&&t.setCurrentRail()},buildposter:function(t,n,r,i){var s=this,o=e('<div class="mejs-poster mejs-layer"></div>').appendTo(r),u=t.$media.attr("poster");t.options.poster!==""&&(u=t.options.poster),u!==""&&u!=null?s.setPoster(u):o.hide(),i.addEventListener("play",function(){o.hide()},!1)},setPoster:function(t){var n=this,r=n.container.find(".mejs-poster"),i=r.find("img");i.length==0&&(i=e('<img width="100%" height="100%" />').appendTo(r)),i.attr("src",t),r.css({"background-image":"url("+t+")"})},buildoverlays:function(t,n,r,i){var s=this;if(!t.isVideo)return;var o=e('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-loading"><span></span></div></div>').hide().appendTo(r),u=e('<div class="mejs-overlay mejs-layer"><div class="mejs-overlay-error"></div></div>').hide().appendTo(r),a=e('<div class="mejs-overlay mejs-layer mejs-overlay-play"><div class="mejs-overlay-button"></div></div>').appendTo(r).click(function(){s.options.clickToPlayPause&&(i.paused?i.play():i.pause())});i.addEventListener("play",function(){a.hide(),o.hide(),n.find(".mejs-time-buffering").hide(),u.hide()},!1),i.addEventListener("playing",function(){a.hide(),o.hide(),n.find(".mejs-time-buffering").hide(),u.hide()},!1),i.addEventListener("seeking",function(){o.show(),n.find(".mejs-time-buffering").show()},!1),i.addEventListener("seeked",function(){o.hide(),n.find(".mejs-time-buffering").hide()},!1),i.addEventListener("pause",function(){mejs.MediaFeatures.isiPhone||a.show()},!1),i.addEventListener("waiting",function(){o.show(),n.find(".mejs-time-buffering").show()},!1),i.addEventListener("loadeddata",function(){o.show(),n.find(".mejs-time-buffering").show()},!1),i.addEventListener("canplay",function(){o.hide(),n.find(".mejs-time-buffering").hide()},!1),i.addEventListener("error",function(){o.hide(),n.find(".mejs-time-buffering").hide(),u.show(),u.find("mejs-overlay-error").html("Error loading this resource")},!1)},buildkeyboard:function(t,n,r,i){var s=this;s.globalBind("keydown",function(e){if(t.hasFocus&&t.options.enableKeyboard)for(var n=0,r=t.options.keyActions.length;n<r;n++){var s=t.options.keyActions[n];for(var o=0,u=s.keys.length;o<u;o++)if(e.keyCode==s.keys[o])return e.preventDefault(),s.action(t,i,e.keyCode),!1}return!0}),s.globalBind("click",function(n){e(n.target).closest(".mejs-container").length==0&&(t.hasFocus=!1)})},findTracks:function(){var t=this,n=t.$media.find("track");t.tracks=[],n.each(function(n,r){r=e(r),t.tracks.push({srclang:r.attr("srclang")?r.attr("srclang").toLowerCase():"",src:r.attr("src"),kind:r.attr("kind"),label:r.attr("label")||"",entries:[],isLoaded:!1})})},changeSkin:function(e){this.container[0].className="mejs-container "+e,this.setPlayerSize(this.width,this.height),this.setControlsSize()},play:function(){this.media.play()},pause:function(){this.media.pause()},load:function(){this.media.load()},setMuted:function(e){this.media.setMuted(e)},setCurrentTime:function(e){this.media.setCurrentTime(e)},getCurrentTime:function(){return this.media.currentTime},setVolume:function(e){this.media.setVolume(e)},getVolume:function(){return this.media.volume},setSrc:function(e){this.media.setSrc(e)},remove:function(){var e=this,t,n;for(t in e.options.features){n=e.options.features[t];if(e["clean"+n])try{e["clean"+n](e)}catch(r){}}e.media.pluginType==="native"?e.$media.prop("controls",!0):e.media.remove(),e.isDynamic||(e.media.pluginType==="native",e.$node.insertBefore(e.container)),delete mejs.players[e.id],e.container.remove(),e.globalUnbind(),delete e.node.player}},function(){function n(n,r){var i={d:[],w:[]};return e.each((n||"").split(" "),function(e,n){var s=n+"."+r;s.indexOf(".")===0?(i.d.push(s),i.w.push(s)):i[t.test(n)?"w":"d"].push(s)}),i.d=i.d.join(" "),i.w=i.w.join(" "),i}var t=/^((after|before)print|(before)?unload|hashchange|message|o(ff|n)line|page(hide|show)|popstate|resize|storage)\b/;mejs.MediaElementPlayer.prototype.globalBind=function(t,r,i){var s=this;t=n(t,s.id),t.d&&e(document).bind(t.d,r,i),t.w&&e(window).bind(t.w,r,i)},mejs.MediaElementPlayer.prototype.globalUnbind=function(t,r){var i=this;t=n(t,i.id),t.d&&e(document).unbind(t.d,r),t.w&&e(window).unbind(t.w,r)}}(),typeof jQuery!="undefined"&&(jQuery.fn.mediaelementplayer=function(e){return e===!1?this.each(function(){var e=jQuery(this).data("mediaelementplayer");e&&e.remove(),jQuery(this).removeData("mediaelementplayer")}):this.each(function(){jQuery(this).data("mediaelementplayer",new mejs.MediaElementPlayer(this,e))}),this}),e(document).ready(function(){e(".mejs-player").mediaelementplayer()}),window.MediaElementPlayer=mejs.MediaElementPlayer}(mejs.$),function(e){e.extend(mejs.MepDefaults,{playpauseText:mejs.i18n.t("Play/Pause")}),e.extend(MediaElementPlayer.prototype,{buildplaypause:function(t,n,r,i){var s=this,o=e(".music-cover-image"),u=e('<div class="mejs-button mejs-playpause-button mejs-play" ><button type="button" aria-controls="'+s.id+'" title="'+s.options.playpauseText+'" aria-label="'+s.options.playpauseText+'"></button>'+"</div>").appendTo(n).click(function(e){return e.preventDefault(),i.paused?i.play():i.pause(),!1});i.addEventListener("play",function(){o.addClass("rotation"),u.removeClass("mejs-play").addClass("mejs-pause")},!1),i.addEventListener("playing",function(){o.addClass("rotation"),u.removeClass("mejs-play").addClass("mejs-pause")},!1),i.addEventListener("pause",function(){o.removeClass("rotation"),u.removeClass("mejs-pause").addClass("mejs-play")},!1),i.addEventListener("paused",function(){o.removeClass("rotation"),u.removeClass("mejs-pause").addClass("mejs-play")},!1)}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{stopText:"Stop"}),e.extend(MediaElementPlayer.prototype,{buildstop:function(t,n,r,i){var s=this,o=e('<div class="mejs-button mejs-stop-button mejs-stop"><button type="button" aria-controls="'+s.id+'" title="'+s.options.stopText+'" aria-label="'+s.options.stopText+'"></button>'+"</div>").appendTo(n).click(function(){i.paused||i.pause(),i.currentTime>0&&(i.setCurrentTime(0),i.pause(),n.find(".mejs-time-current").width("0px"),n.find(".mejs-time-handle").css("left","0px"),n.find(".mejs-time-float-current").html(mejs.Utility.secondsToTimeCode(0)),n.find(".mejs-currenttime").html(mejs.Utility.secondsToTimeCode(0)),r.find(".mejs-poster").show())})}})}(mejs.$),function(e){e.extend(MediaElementPlayer.prototype,{buildprogress:function(t,n,r,i){e('<div class="mejs-time-rail"><span class="mejs-time-total"><span class="mejs-time-buffering"></span><span class="mejs-time-loaded"></span><span class="mejs-time-current"><span class="mejs-time-current-pointer"></span></span><span class="mejs-time-handle"></span><span class="mejs-time-float"><span class="mejs-time-float-current">00:00</span><span class="mejs-time-float-corner"></span></span></span></div>').appendTo(n),n.find(".mejs-time-buffering").hide(),e(".yn_bg_song").css({display:"block"});var s=this,o=n.find(".mejs-time-total"),u=n.find(".mejs-time-loaded"),a=n.find(".mejs-time-current"),f=n.find(".mejs-time-handle"),l=n.find(".mejs-time-float"),c=n.find(".mejs-time-float-current"),h=function(e){var t=e.pageX,n=o.offset(),r=o.outerWidth(!0),s=0,u=0,a=0;i.duration&&(t<n.left?t=n.left:t>r+n.left&&(t=r+n.left),a=t-n.left,s=a/r,u=s<=.02?0:s*i.duration,p&&u!==i.currentTime&&i.setCurrentTime(u),mejs.MediaFeatures.hasTouch||(l.css("left",a),c.html(mejs.Utility.secondsToTimeCode(u)),l.show()))},p=!1,d=!1;o.bind("mousedown",function(e){if(e.which===1)return p=!0,h(e),s.globalBind("mousemove.dur",function(e){h(e)}),s.globalBind("mouseup.dur",function(e){p=!1,l.hide(),s.globalUnbind(".dur")}),!1}).bind("mouseenter",function(e){d=!0,s.globalBind("mousemove.dur",function(e){h(e)}),mejs.MediaFeatures.hasTouch||l.show()}).bind("mouseleave",function(e){d=!1,p||(s.globalUnbind(".dur"),l.hide())}),i.addEventListener("progress",function(e){t.setProgressRail(e),t.setCurrentRail(e)},!1),i.addEventListener("timeupdate",function(e){t.setProgressRail(e),t.setCurrentRail(e)},!1),s.loaded=u,s.total=o,s.current=a,s.handle=f},setProgressRail:function(e){var t=this,n=e!=undefined?e.target:t.media,r=null;n&&n.buffered&&n.buffered.length>0&&n.buffered.end&&n.duration?r=n.buffered.end(0)/n.duration:n&&n.bytesTotal!=undefined&&n.bytesTotal>0&&n.bufferedBytes!=undefined?r=n.bufferedBytes/n.bytesTotal:e&&e.lengthComputable&&e.total!=0&&(r=e.loaded/e.total),r!==null&&(r=Math.min(1,Math.max(0,r)),t.loaded&&t.total&&t.loaded.width(t.total.width()*r))},setCurrentRail:function(){var e=this;if(e.media.currentTime!=undefined&&e.media.duration&&e.total&&e.handle){var t=Math.round(e.total.width()*e.media.currentTime/e.media.duration),n=t-Math.round(e.handle.outerWidth(!0)/2);e.current.width(t),e.handle.css("left",n)}}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{duration:-1,timeAndDurationSeparator:" <span> / </span> "}),e.extend(MediaElementPlayer.prototype,{buildcurrent:function(t,n,r,i){var s=this;e('<div class="mejs-time"><span class="mejs-currenttime">'+(t.options.alwaysShowHours?"00:":"")+(t.options.showTimecodeFrameCount?"00:00:00":"00:00")+"</span>"+"</div>").appendTo(n),s.currenttime=s.controls.find(".mejs-currenttime"),i.addEventListener("timeupdate",function(){t.updateCurrent()},!1)},buildduration:function(t,n,r,i){var s=this;n.children().last().find(".mejs-currenttime").length>0?e(s.options.timeAndDurationSeparator+'<span class="mejs-duration">'+(s.options.duration>0?mejs.Utility.secondsToTimeCode(s.options.duration,s.options.alwaysShowHours||s.media.duration>3600,s.options.showTimecodeFrameCount,s.options.framesPerSecond||25):(t.options.alwaysShowHours?"00:":"")+(t.options.showTimecodeFrameCount?"00:00:00":"00:00"))+"</span>").appendTo(n.find(".mejs-time")):(n.find(".mejs-currenttime").parent().addClass("mejs-currenttime-container"),e('<div class="mejs-time mejs-duration-container"><span class="mejs-duration">'+(s.options.duration>0?mejs.Utility.secondsToTimeCode(s.options.duration,s.options.alwaysShowHours||s.media.duration>3600,s.options.showTimecodeFrameCount,s.options.framesPerSecond||25):(t.options.alwaysShowHours?"00:":"")+(t.options.showTimecodeFrameCount?"00:00:00":"00:00"))+"</span>"+"</div>").appendTo(n)),s.durationD=s.controls.find(".mejs-duration"),i.addEventListener("timeupdate",function(){t.updateDuration()},!1)},updateCurrent:function(){var e=this;e.currenttime&&e.currenttime.html(mejs.Utility.secondsToTimeCode(e.media.currentTime,e.options.alwaysShowHours||e.media.duration>3600,e.options.showTimecodeFrameCount,e.options.framesPerSecond||25))},updateDuration:function(){var e=this;e.container.toggleClass("mejs-long-video",e.media.duration>3600),e.durationD&&(e.options.duration>0||e.media.duration)&&e.durationD.html(mejs.Utility.secondsToTimeCode(e.options.duration>0?e.options.duration:e.media.duration,e.options.alwaysShowHours,e.options.showTimecodeFrameCount,e.options.framesPerSecond||25))}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{muteText:mejs.i18n.t("Mute Toggle"),hideVolumeOnTouchDevices:!0,audioVolume:"horizontal",videoVolume:"vertical"}),e.extend(MediaElementPlayer.prototype,{buildvolume:function(t,n,r,i){if(mejs.MediaFeatures.hasTouch&&this.options.hideVolumeOnTouchDevices)return;var s=this,o=s.isVideo?s.options.videoVolume:s.options.audioVolume,u=o=="horizontal"?e('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+s.id+'" title="'+s.options.muteText+'" aria-label="'+s.options.muteText+'"></button>'+"</div>"+'<div class="mejs-horizontal-volume-slider">'+'<div class="mejs-horizontal-volume-total"></div>'+'<div class="mejs-horizontal-volume-current"></div>'+'<div class="mejs-horizontal-volume-handle"></div>'+"</div>").appendTo(n):e('<div class="mejs-button mejs-volume-button mejs-mute"><button type="button" aria-controls="'+s.id+'" title="'+s.options.muteText+'" aria-label="'+s.options.muteText+'"></button>'+'<div class="mejs-volume-slider">'+'<div class="mejs-volume-total"></div>'+'<div class="mejs-volume-current"></div>'+'<div class="mejs-volume-handle"></div>'+"</div>"+"</div>").appendTo(n),a=s.container.find(".mejs-volume-slider, .mejs-horizontal-volume-slider"),f=s.container.find(".mejs-volume-total, .mejs-horizontal-volume-total"),l=s.container.find(".mejs-volume-current, .mejs-horizontal-volume-current"),c=s.container.find(".mejs-volume-handle, .mejs-horizontal-volume-handle"),h=function(e,t){if(!a.is(":visible")&&typeof t=="undefined"){a.show(),h(e,!0),a.hide();return}e=Math.max(0,e),e=Math.min(e,1),e==0?u.removeClass("mejs-mute").addClass("mejs-unmute"):u.removeClass("mejs-unmute").addClass("mejs-mute");if(o=="vertical"){var n=f.height(),r=f.position(),i=n-n*e;c.css("top",Math.round(r.top+i-c.height()/2)),l.height(n-i),l.css("top",r.top+i)}else{var s=f.width(),r=f.position(),p=s*e;c.css("left",Math.round(r.left+p-c.width()/2)),l.width(Math.round(p))}},p=function(e){var t=null,n=f.offset();if(o=="vertical"){var r=f.height(),s=parseInt(f.css("top").replace(/px/,""),10),u=e.pageY-n.top;t=(r-u)/r;if(n.top==0||n.left==0)return}else{var a=f.width(),l=e.pageX-n.left;t=l/a}t=Math.max(0,t),t=Math.min(t,1),h(t),t==0?i.setMuted(!0):i.setMuted(!1),i.setVolume(t)},d=!1,v=!1;u.hover(function(){a.show(),v=!0},function(){v=!1,!d&&o=="vertical"&&a.hide()}),a.bind("mouseover",function(){v=!0}).bind("mousedown",function(e){return p(e),s.globalBind("mousemove.vol",function(e){p(e)}),s.globalBind("mouseup.vol",function(){d=!1,s.globalUnbind(".vol"),!v&&o=="vertical"&&a.hide()}),d=!0,!1}),u.find("button").click(function(){i.setMuted(!i.muted)}),i.addEventListener("volumechange",function(e){d||(i.muted?(h(0),u.removeClass("mejs-mute").addClass("mejs-unmute")):(h(i.volume),u.removeClass("mejs-unmute").addClass("mejs-mute")))},!1),s.container.is(":visible")&&(h(t.options.startVolume),t.options.startVolume===0&&i.setMuted(!0),i.pluginType==="native"&&i.setVolume(t.options.startVolume))}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{usePluginFullScreen:!0,newWindowCallback:function(){return""},fullscreenText:mejs.i18n.t("Fullscreen")}),e.extend(MediaElementPlayer.prototype,{isFullScreen:!1,isNativeFullScreen:!1,docStyleOverflow:null,isInIframe:!1,buildfullscreen:function(t,n,r,i){if(!t.isVideo)return;t.isInIframe=window.location!=window.parent.location;if(mejs.MediaFeatures.hasTrueNativeFullScreen){var s=function(e){mejs.MediaFeatures.isFullScreen()?(t.isNativeFullScreen=!0,t.setControlsSize()):(t.isNativeFullScreen=!1,t.exitFullScreen())};mejs.MediaFeatures.hasMozNativeFullScreen?t.globalBind(mejs.MediaFeatures.fullScreenEventName,s):t.container.bind(mejs.MediaFeatures.fullScreenEventName,s)}var o=this,u=0,a=0,f=t.container,l=e('<div class="mejs-button mejs-fullscreen-button"><button type="button" aria-controls="'+o.id+'" title="'+o.options.fullscreenText+'" aria-label="'+o.options.fullscreenText+'"></button>'+"</div>").appendTo(n);if(o.media.pluginType==="native"||!o.options.usePluginFullScreen&&!mejs.MediaFeatures.isFirefox)l.click(function(){var e=mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||t.isFullScreen;e?t.exitFullScreen():t.enterFullScreen()});else{var c=null,h=function(){var e=document.createElement("x"),t=document.documentElement,n=window.getComputedStyle,r;return"pointerEvents"in e.style?(e.style.pointerEvents="auto",e.style.pointerEvents="x",t.appendChild(e),r=n&&n(e,"").pointerEvents==="auto",t.removeChild(e),!!r):!1}();if(h&&!mejs.MediaFeatures.isOpera){var p=!1,d=function(){if(p){for(var e in v)v[e].hide();l.css("pointer-events",""),o.controls.css("pointer-events",""),o.media.removeEventListener("click",o.clickToPlayPauseCallback),p=!1}},v={},m=["top","left","right","bottom"],g,y,b=function(){var e=l.offset().left-o.container.offset().left,t=l.offset().top-o.container.offset().top,n=l.outerWidth(!0),r=l.outerHeight(!0),i=o.container.width(),s=o.container.height();for(g in v)v[g].css({position:"absolute",top:0,left:0});v.top.width(i).height(t),v.left.width(e).height(r).css({top:t}),v.right.width(i-e-n).height(r).css({top:t,left:e+n}),v.bottom.width(i).height(s-r-t).css({top:t+r})};o.globalBind("resize",function(){b()});for(g=0,y=m.length;g<y;g++)v[m[g]]=e('<div class="mejs-fullscreen-hover" />').appendTo(o.container).mouseover(d).hide();l.on("mouseover",function(){if(!o.isFullScreen){var e=l.offset(),n=t.container.offset();i.positionFullscreenButton(e.left-n.left,e.top-n.top,!1),l.css("pointer-events","none"),o.controls.css("pointer-events","none"),o.media.addEventListener("click",o.clickToPlayPauseCallback);for(g in v)v[g].show();b(),p=!0}}),i.addEventListener("fullscreenchange",function(e){o.isFullScreen=!o.isFullScreen,o.isFullScreen?o.media.removeEventListener("click",o.clickToPlayPauseCallback):o.media.addEventListener("click",o.clickToPlayPauseCallback),d()}),o.globalBind("mousemove",function(e){if(p){var t=l.offset();if(e.pageY<t.top||e.pageY>t.top+l.outerHeight(!0)||e.pageX<t.left||e.pageX>t.left+l.outerWidth(!0))l.css("pointer-events",""),o.controls.css("pointer-events",""),p=!1}})}else l.on("mouseover",function(){c!==null&&(clearTimeout(c),delete c);var e=l.offset(),n=t.container.offset();i.positionFullscreenButton(e.left-n.left,e.top-n.top,!0)}).on("mouseout",function(){c!==null&&(clearTimeout(c),delete c),c=setTimeout(function(){i.hideFullscreenButton()},1500)})}t.fullscreenBtn=l,o.globalBind("keydown",function(e){(mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||o.isFullScreen)&&e.keyCode==27&&t.exitFullScreen()})},cleanfullscreen:function(e){e.exitFullScreen()},containerSizeTimeout:null,enterFullScreen:function(){var t=this;if(t.media.pluginType!=="native"&&(mejs.MediaFeatures.isFirefox||t.options.usePluginFullScreen))return;docStyleOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden",normalHeight=t.container.height(),normalWidth=t.container.width();if(t.media.pluginType==="native")if(mejs.MediaFeatures.hasTrueNativeFullScreen)mejs.MediaFeatures.requestFullScreen(t.container[0]),t.isInIframe&&setTimeout(function r(){t.isNativeFullScreen&&(e(window).width()!==screen.width?t.exitFullScreen():setTimeout(r,500))},500);else if(mejs.MediaFeatures.hasSemiNativeFullScreen){t.media.webkitEnterFullscreen();return}if(t.isInIframe){var n=t.options.newWindowCallback(this);if(n!==""){if(!mejs.MediaFeatures.hasTrueNativeFullScreen){t.pause(),window.open(n,t.id,"top=0,left=0,width="+screen.availWidth+",height="+screen.availHeight+",resizable=yes,scrollbars=no,status=no,toolbar=no");return}setTimeout(function(){t.isNativeFullScreen||(t.pause(),window.open(n,t.id,"top=0,left=0,width="+screen.availWidth+",height="+screen.availHeight+",resizable=yes,scrollbars=no,status=no,toolbar=no"))},250)}}t.container.addClass("mejs-container-fullscreen").width("100%").height("100%"),t.containerSizeTimeout=setTimeout(function(){t.container.css({width:"100%",height:"100%"}),t.setControlsSize()},500),t.media.pluginType==="native"?t.$media.width("100%").height("100%"):(t.container.find(".mejs-shim").width("100%").height("100%"),t.media.setVideoSize(e(window).width(),e(window).height())),t.layers.children("div").width("100%").height("100%"),t.fullscreenBtn&&t.fullscreenBtn.removeClass("mejs-fullscreen").addClass("mejs-unfullscreen"),t.setControlsSize(),t.isFullScreen=!0},exitFullScreen:function(){var e=this;clearTimeout(e.containerSizeTimeout);if(e.media.pluginType!=="native"&&mejs.MediaFeatures.isFirefox){e.media.setFullscreen(!1);return}mejs.MediaFeatures.hasTrueNativeFullScreen&&(mejs.MediaFeatures.isFullScreen()||e.isFullScreen)&&mejs.MediaFeatures.cancelFullScreen(),document.documentElement.style.overflow=docStyleOverflow,e.container.removeClass("mejs-container-fullscreen").width(normalWidth).height(normalHeight),e.media.pluginType==="native"?e.$media.width(normalWidth).height(normalHeight):(e.container.find(".mejs-shim").width(normalWidth).height(normalHeight),e.media.setVideoSize(normalWidth,normalHeight)),e.layers.children("div").width(normalWidth).height(normalHeight),e.fullscreenBtn.removeClass("mejs-unfullscreen").addClass("mejs-fullscreen"),e.setControlsSize(),e.isFullScreen=!1}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{startLanguage:"",tracksText:mejs.i18n.t("Captions/Subtitles"),hideCaptionsButtonWhenEmpty:!0,toggleCaptionsButtonWhenOnlyOne:!1,slidesSelector:""}),e.extend(MediaElementPlayer.prototype,{hasChapters:!1,buildtracks:function(t,n,r,i){if(t.tracks.length==0)return;var s=this,o,u="";t.chapters=e('<div class="mejs-chapters mejs-layer"></div>').prependTo(r).hide(),t.captions=e('<div class="mejs-captions-layer mejs-layer"><div class="mejs-captions-position mejs-captions-position-hover"><span class="mejs-captions-text"></span></div></div>').prependTo(r).hide(),t.captionsText=t.captions.find(".mejs-captions-text"),t.captionsButton=e('<div class="mejs-button mejs-captions-button"><button type="button" aria-controls="'+s.id+'" title="'+s.options.tracksText+'" aria-label="'+s.options.tracksText+'"></button>'+'<div class="mejs-captions-selector">'+"<ul>"+"<li>"+'<input type="radio" name="'+t.id+'_captions" id="'+t.id+'_captions_none" value="none" checked="checked" />'+'<label for="'+t.id+'_captions_none">'+mejs.i18n.t("None")+"</label>"+"</li>"+"</ul>"+"</div>"+"</div>").appendTo(n);var a=0;for(o=0;o<t.tracks.length;o++)t.tracks[o].kind=="subtitles"&&a++;s.options.toggleCaptionsButtonWhenOnlyOne&&a==1?t.captionsButton.on("click",function(){if(t.selectedTrack==null)var e=t.tracks[0].srclang;else var e="none";t.setTrack(e)}):t.captionsButton.hover(function(){e(this).find(".mejs-captions-selector").css("visibility","visible")},function(){e(this).find(".mejs-captions-selector").css("visibility","hidden")}).on("click","input[type=radio]",function(){lang=this.value,t.setTrack(lang)}),t.options.alwaysShowControls?t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover"):t.container.bind("controlsshown",function(){t.container.find(".mejs-captions-position").addClass("mejs-captions-position-hover")}).bind("controlshidden",function(){i.paused||t.container.find(".mejs-captions-position").removeClass("mejs-captions-position-hover")}),t.trackToLoad=-1,t.selectedTrack=null,t.isLoadingTrack=!1;for(o=0;o<t.tracks.length;o++)t.tracks[o].kind=="subtitles"&&t.addTrackButton(t.tracks[o].srclang,t.tracks[o].label);t.loadNextTrack(),i.addEventListener("timeupdate",function(e){t.displayCaptions()},!1),t.options.slidesSelector!=""&&(t.slidesContainer=e(t.options.slidesSelector),i.addEventListener("timeupdate",function(e){t.displaySlides()},!1)),i.addEventListener("loadedmetadata",function(e){t.displayChapters()},!1),t.container.hover(function(){t.hasChapters&&(t.chapters.css("visibility","visible"),t.chapters.fadeIn(200).height(t.chapters.find(".mejs-chapter").outerHeight()))},function(){t.hasChapters&&!i.paused&&t.chapters.fadeOut(200,function(){e(this).css("visibility","hidden"),e(this).css("display","block")})}),t.node.getAttribute("autoplay")!==null&&t.chapters.css("visibility","hidden")},setTrack:function(e){var t=this,n;if(e=="none")t.selectedTrack=null,t.captionsButton.removeClass("mejs-captions-enabled");else for(n=0;n<t.tracks.length;n++)if(t.tracks[n].srclang==e){t.selectedTrack==null&&t.captionsButton.addClass("mejs-captions-enabled"),t.selectedTrack=t.tracks[n],t.captions.attr("lang",t.selectedTrack.srclang),t.displayCaptions();break}},loadNextTrack:function(){var e=this;e.trackToLoad++,e.trackToLoad<e.tracks.length?(e.isLoadingTrack=!0,e.loadTrack(e.trackToLoad)):(e.isLoadingTrack=!1,e.checkForTracks())},loadTrack:function(t){var n=this,r=n.tracks[t],i=function(){r.isLoaded=!0,n.enableTrackButton(r.srclang,r.label),n.loadNextTrack()};e.ajax({url:r.src,dataType:"text",success:function(e){typeof e=="string"&&/<tt\s+xml/ig.exec(e)?r.entries=mejs.TrackFormatParser.dfxp.parse(e):r.entries=mejs.TrackFormatParser.webvvt.parse(e),i(),r.kind=="chapters"&&n.media.addEventListener("play",function(e){n.media.duration>0&&n.displayChapters(r)},!1),r.kind=="slides"&&n.setupSlides(r)},error:function(){n.loadNextTrack()}})},enableTrackButton:function(t,n){var r=this;n===""&&(n=mejs.language.codes[t]||t),r.captionsButton.find("input[value="+t+"]").prop("disabled",!1).siblings("label").html(n),r.options.startLanguage==t&&e("#"+r.id+"_captions_"+t).click(),r.adjustLanguageBox()},addTrackButton:function(t,n){var r=this;n===""&&(n=mejs.language.codes[t]||t),r.captionsButton.find("ul").append(e('<li><input type="radio" name="'+r.id+'_captions" id="'+r.id+"_captions_"+t+'" value="'+t+'" disabled="disabled" />'+'<label for="'+r.id+"_captions_"+t+'">'+n+" (loading)"+"</label>"+"</li>")),r.adjustLanguageBox(),r.container.find(".mejs-captions-translations option[value="+t+"]").remove()},adjustLanguageBox:function(){var e=this;e.captionsButton.find(".mejs-captions-selector").height(e.captionsButton.find(".mejs-captions-selector ul").outerHeight(!0)+e.captionsButton.find(".mejs-captions-translations").outerHeight(!0))},checkForTracks:function(){var e=this,t=!1;if(e.options.hideCaptionsButtonWhenEmpty){for(i=0;i<e.tracks.length;i++)if(e.tracks[i].kind=="subtitles"){t=!0;break}t||(e.captionsButton.hide(),e.setControlsSize())}},displayCaptions:function(){if(typeof this.tracks=="undefined")return;var e=this,t,n=e.selectedTrack;if(n!=null&&n.isLoaded){for(t=0;t<n.entries.times.length;t++)if(e.media.currentTime>=n.entries.times[t].start&&e.media.currentTime<=n.entries.times[t].stop){e.captionsText.html(n.entries.text[t]),e.captions.show().height(0);return}e.captions.hide()}else e.captions.hide()},setupSlides:function(e){var t=this;t.slides=e,t.slides.entries.imgs=[t.slides.entries.text.length],t.showSlide(0)},showSlide:function(t){if(typeof this.tracks=="undefined"||typeof this.slidesContainer=="undefined")return;var n=this,r=n.slides.entries.text[t],i=n.slides.entries.imgs[t];typeof i=="undefined"||typeof i.fadeIn=="undefined"?n.slides.entries.imgs[t]=i=e('<img src="'+r+'">').on("load",function(){i.appendTo(n.slidesContainer).hide().fadeIn().siblings(":visible").fadeOut()}):!i.is(":visible")&&!i.is(":animated")&&(console.log("showing existing slide"),i.fadeIn().siblings(":visible").fadeOut())},displaySlides:function(){if(typeof this.slides=="undefined")return;var e=this,t=e.slides,n;for(n=0;n<t.entries.times.length;n++)if(e.media.currentTime>=t.entries.times[n].start&&e.media.currentTime<=t.entries.times[n].stop){e.showSlide(n);return}},displayChapters:function(){var e=this,t;for(t=0;t<e.tracks.length;t++)if(e.tracks[t].kind=="chapters"&&e.tracks[t].isLoaded){e.drawChapters(e.tracks[t]),e.hasChapters=!0;break}},drawChapters:function(t){var n=this,r,i,s=0,o=0;n.chapters.empty();for(r=0;r<t.entries.times.length;r++){i=t.entries.times[r].stop-t.entries.times[r].start,s=Math.floor(i/n.media.duration*100);if(s+o>100||r==t.entries.times.length-1&&s+o<100)s=100-o;n.chapters.append(e('<div class="mejs-chapter" rel="'+t.entries.times[r].start+'" style="left: '+o.toString()+"%;width: "+s.toString()+'%;">'+'<div class="mejs-chapter-block'+(r==t.entries.times.length-1?" mejs-chapter-block-last":"")+'">'+'<span class="ch-title">'+t.entries.text[r]+"</span>"+'<span class="ch-time">'+mejs.Utility.secondsToTimeCode(t.entries.times[r].start)+"&ndash;"+mejs.Utility.secondsToTimeCode(t.entries.times[r].stop)+"</span>"+"</div>"+"</div>")),o+=s}n.chapters.find("div.mejs-chapter").click(function(){n.media.setCurrentTime(parseFloat(e(this).attr("rel"))),n.media.paused&&n.media.play()}),n.chapters.show()}}),mejs.language={codes:{af:"Afrikaans",sq:"Albanian",ar:"Arabic",be:"Belarusian",bg:"Bulgarian",ca:"Catalan",zh:"Chinese","zh-cn":"Chinese Simplified","zh-tw":"Chinese Traditional",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",gl:"Galician",de:"German",el:"Greek",ht:"Haitian Creole",iw:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",ko:"Korean",lv:"Latvian",lt:"Lithuanian",mk:"Macedonian",ms:"Malay",mt:"Maltese",no:"Norwegian",fa:"Persian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sr:"Serbian",sk:"Slovak",sl:"Slovenian",es:"Spanish",sw:"Swahili",sv:"Swedish",tl:"Tagalog",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",cy:"Welsh",yi:"Yiddish"}},mejs.TrackFormatParser={webvvt:{pattern_identifier:/^([a-zA-z]+-)?[0-9]+$/,pattern_timecode:/^([0-9]{2}:[0-9]{2}:[0-9]{2}([,.][0-9]{1,3})?) --\> ([0-9]{2}:[0-9]{2}:[0-9]{2}([,.][0-9]{3})?)(.*)$/,parse:function(t){var n=0,r=mejs.TrackFormatParser.split2(t,/\r?\n/),i={text:[],times:[]},s,o;for(;n<r.length;n++)if(this.pattern_identifier.exec(r[n])){n++,s=this.pattern_timecode.exec(r[n]);if(s&&n<r.length){n++,o=r[n],n++;while(r[n]!==""&&n<r.length)o=o+"\n"+r[n],n++;o=e.trim(o).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>"),i.text.push(o),i.times.push({start:mejs.Utility.convertSMPTEtoSeconds(s[1])==0?.2:mejs.Utility.convertSMPTEtoSeconds(s[1]),stop:mejs.Utility.convertSMPTEtoSeconds(s[3]),settings:s[5]})}}return i}},dfxp:{parse:function(t){t=e(t).filter("tt");var n=0,r=t.children("div").eq(0),i=r.find("p"),s=t.find("#"+r.attr("style")),o,u,a,f,l={text:[],times:[]};if(s.length){var c=s.removeAttr("id").get(0).attributes;if(c.length){o={};for(n=0;n<c.length;n++)o[c[n].name.split(":")[1]]=c[n].value}}for(n=0;n<i.length;n++){var h,p={start:null,stop:null,style:null};i.eq(n).attr("begin")&&(p.start=mejs.Utility.convertSMPTEtoSeconds(i.eq(n).attr("begin"))),!p.start&&i.eq(n-1).attr("end")&&(p.start=mejs.Utility.convertSMPTEtoSeconds(i.eq(n-1).attr("end"))),i.eq(n).attr("end")&&(p.stop=mejs.Utility.convertSMPTEtoSeconds(i.eq(n).attr("end"))),!p.stop&&i.eq(n+1).attr("begin")&&(p.stop=mejs.Utility.convertSMPTEtoSeconds(i.eq(n+1).attr("begin")));if(o){h="";for(var d in o)h+=d+":"+o[d]+";"}h&&(p.style=h),p.start==0&&(p.start=.2),l.times.push(p),f=e.trim(i.eq(n).html()).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank'>$1</a>"),l.text.push(f),l.times.start==0&&(l.times.start=2)}return l}},split2:function(e,t){return e.split(t)}},"x\n\ny".split(/\n/gi).length!=3&&(mejs.TrackFormatParser.split2=function(e,t){var n=[],r="",i;for(i=0;i<e.length;i++)r+=e.substring(i,i+1),t.test(r)&&(n.push(r.replace(t,"")),r="");return n.push(r),n})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{contextMenuItems:[{render:function(e){return typeof e.enterFullScreen=="undefined"?null:e.isFullScreen?mejs.i18n.t("Turn off Fullscreen"):mejs.i18n.t("Go Fullscreen")},click:function(e){e.isFullScreen?e.exitFullScreen():e.enterFullScreen()}},{render:function(e){return e.media.muted?mejs.i18n.t("Unmute"):mejs.i18n.t("Mute")},click:function(e){e.media.muted?e.setMuted(!1):e.setMuted(!0)}},{isSeparator:!0},{render:function(e){return mejs.i18n.t("Download Video")},click:function(e){window.location.href=e.media.currentSrc}}]}),e.extend(MediaElementPlayer.prototype,{buildcontextmenu:function(t,n,r,i){t.contextMenu=e('<div class="mejs-contextmenu"></div>').appendTo(e("body")).hide(),t.container.bind("contextmenu",function(e){if(t.isContextMenuEnabled)return e.preventDefault(),t.renderContextMenu(e.clientX-1,e.clientY-1),!1}),t.container.bind("click",function(){t.contextMenu.hide()}),t.contextMenu.bind("mouseleave",function(){t.startContextMenuTimer()})},cleancontextmenu:function(e){e.contextMenu.remove()},isContextMenuEnabled:!0,enableContextMenu:function(){this.isContextMenuEnabled=!0},disableContextMenu:function(){this.isContextMenuEnabled=!1},contextMenuTimeout:null,startContextMenuTimer:function(){var e=this;e.killContextMenuTimer(),e.contextMenuTimer=setTimeout(function(){e.hideContextMenu(),e.killContextMenuTimer()},750)},killContextMenuTimer:function(){var e=this.contextMenuTimer;e!=null&&(clearTimeout(e),delete e,e=null)},hideContextMenu:function(){this.contextMenu.hide()},renderContextMenu:function(t,n){var r=this,i="",s=r.options.contextMenuItems;for(var o=0,u=s.length;o<u;o++)if(s[o].isSeparator)i+='<div class="mejs-contextmenu-separator"></div>';else{var a=s[o].render(r);a!=null&&(i+='<div class="mejs-contextmenu-item" data-itemindex="'+o+'" id="element-'+Math.random()*1e6+'">'+a+"</div>")}r.contextMenu.empty().append(e(i)).css({top:n,left:t}).show(),r.contextMenu.find(".mejs-contextmenu-item").each(function(){var t=e(this),n=parseInt(t.data("itemindex"),10),i=r.options.contextMenuItems[n];typeof i.show!="undefined"&&i.show(t,r),t.click(function(){typeof i.click!="undefined"&&i.click(r),r.contextMenu.hide()})}),setTimeout(function(){r.killControlsTimer("rev3")},100)}})}(mejs.$),function(e){e.extend(mejs.MepDefaults,{postrollCloseText:mejs.i18n.t("Close")}),e.extend(MediaElementPlayer.prototype,{buildpostroll:function(t,n,r,i){var s=this,o=s.container.find('link[rel="postroll"]').attr("href");typeof o!="undefined"&&(t.postroll=e('<div class="mejs-postroll-layer mejs-layer"><a class="mejs-postroll-close" onclick="$(this).parent().hide();return false;">'+s.options.postrollCloseText+'</a><div class="mejs-postroll-layer-content"></div></div>').prependTo(r).hide(),s.media.addEventListener("ended",function(n){e.ajax({dataType:"html",url:o,success:function(e,t){r.find(".mejs-postroll-layer-content").html(e)}}),t.postroll.show()},!1))}})}(mejs.$),define("MediaElelementPlayer",function(){}),typeof CONTROLLER_PLAYER=="undefined"&&(CONTROLLER_PLAYER={arHTML5Player:{},iNumber:0,initialize:function(){this.arHTML5Player=$(".younet_html5_player.init"),this.mobileHTMLPlayer=$(".younet_html5_player.mobile");var e="big";if(this.arHTML5Player.length==0)if(this.mobileHTMLPlayer.length==0){this.arHTML5Player=$(".younet_html5_player_profile.init"),e="small";if(this.arHTML5Player.length==0)return!1}else{this.arHTML5Player=$(".younet_html5_player.mobile"),e="mobile";if(this.arHTML5Player.length==0)return!1}++this.iNumber,this.buildCol(),this.buildLoop(),this.buildNext(),this.buildPrev(),this.buildClear(),this.buildShuffle(),e=="big"?(this.initBig(),this.buildSelectSong()):e=="mobile"?(this.initMobilePlayer(),this.buildSelectSongMobile(),this.autoplayMobile()):(this.initSmall(),this.buildSelectSong()),this.arHTML5Player.each(function(e){$(this).removeClass("init")})},initMobilePlayer:function(){var e=this;this.arHTML5Player.each(function(n){var r=$(this);r.find("video,audio").mediaelementplayer({success:function(n,i){n.addEventListener("ended",function(n){e.mejsPlayNext(n.target,r)},!1)},features:["prev","playpause","next","clear","current","progress","duration"],keyActions:[],startVolume:.8,pauseOtherPlayers:!0})})},autoplayMobile:function(){this.arHTML5Player.each(function(e){var t=$(this);t.find("audio").each(function(){this.play()})})},buildSelectSong:function(){var e=this;this.arHTML5Player.each(function(n){var r=$(this);r.find(".mejs-list li span.song-title").click(function(){var n=$(this);n.parent().addClass("current").siblings().removeClass("current");var i=1,s=r.find(".html5_player_type");if(s.length>0)switch(s.val()){case"playlist":i=0;break;case"album":i=1;break;default:i=1}var o=n.text(),u=n.parent().children(".link").text(),a=n.parent().children(".song_id").text(),f=r.find(".song-title-head");r.find("audio").each(function(){this.player.pause(),f.html(o),$(this).attr("src",u),this.player.setSrc(u),this.player.play()}),e.onSongChange()})})},buildSelectSongMobile:function(){var e=this;this.arHTML5Player.each(function(n){var r=$(this);r.find(".mejs-list li span.song-title").click(function(){var n=$(this);n.parent().addClass("current").siblings().removeClass("current");var i=1,s=r.find(".html5_player_type");if(s.length>0)switch(s.val()){case"playlist":i=0;break;case"album":i=1;break;default:i=1}var o=n.text(),u=n.parent().children(".link").text(),a=n.parent().children(".song_id").text(),f=r.find(".song-title-head");r.find("audio").each(function(){this.pause(),f.html(o),$(this).attr("src",u),this.setSrc(u),this.play()}),e.onSongChange()})})},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getNextSong:function(e,t){var n=this,r,i=t.find(".song-list"),s=i.children("li").size();return t.find(".mejs-shuffle-on").length>0?r=t.find(".mejs-list li").eq(n.getRandomInt(0,s-1)):t.find(".mejs-loop-on").length>0?s==1?r=$(e):(r=$(e).parent().next(),r.length==0&&(r=t.find(".mejs-list li:first"))):r=$(e).parent().next(),r},nextSong:function(e,t){var n;n=this.getNextSong(e,t);var r=t.find(".song-list"),i=n.children(".link").text(),s=t.find(".song-title-head");return s.length>0&&s.html(n.children(".song-title").text()),n.addClass("current").siblings().removeClass("current"),this.onSongChange(),n},newPlay:function(e,t){var n=null;n=this.getNextSong(e,t);var r=n.next().text();return $(e).next().addClass("current").siblings().removeClass("current"),r},mejsPlayNext:function(e,t){var n="",r="";if(t.find(".mejs-list li.current").length>0)n=t.find(".mejs-list li.current:first span.link"),r=this.nextSong(n,t),strAudioSrc=r.children(".link").text();else{var i=t.find(".song-list"),s=i.children("li").size();if(s==0||s==1){t.find(".mejs-shuffle-on").length>0||t.find(".mejs-loop-on").length>0?e.play():e.pause();return}n=t.find(".mejs-list li:first .link"),r=this.newPlay(n,t),strAudioSrc=r.children(".link").text()}if($(n.parent()).is(":last-child")){var i=t.find(".song-list");if(t.find(".mejs-loop-on").size()>0){var s=i.children("li").size(),o="",u=t.find(".song-title-head");s==1?(strAudioSrc=n.text(),u.size()>0&&(o=n.parent().children(".song-title").text())):(n=t.find(".mejs-list li:first span.link"),t.find(".mejs-list .current").removeClass("current"),t.find(".mejs-list li:first").addClass("current"),strAudioSrc=n.text(),u.length>0&&(o=n.parent().children(".song-title").text())),u.length>0&&(u.innerHTML=o),e.pause(),e.setSrc(strAudioSrc),e.play()}else t.find(".mejs-shuffle-on").size()>0?(n=this.nextSong(n,t),strAudioSrc=n.text(),e.setSrc(strAudioSrc),e.play(),i.scrollTo(n)):t.find(n).removeClass("current")}else e.pause(),e.setSrc(strAudioSrc),e.play();console.log(strAudioSrc)},buildNext:function(){var e=this;MediaElementPlayer.prototype.buildnext=function(n,r,i,s){var o='<div class="mejs-button mejs-next-button '+(n.options.next?"mejs-next-on":"mejs-next-off")+'">'+'<button type="button"></button>'+"</div>",u=$(o).appendTo(r).click(function(i){var s,o="",u="",a=r.parent().parent().parent().parent(),f=a.parent(),l=f.find(".song-list"),c=l.find("li.current"),h=a.find(".song-title-head");if(a.find(".mejs-shuffle-on").size()>0){var p=l,d=p.children("li").size(),v;if(d<=1)v=0;else while((v=e.getRandomInt(0,d-1))==c.index());s=f.find(".mejs-list li").eq(v),c.removeClass("current"),o=s.children(".link").text(),h.size()>0&&(u=s.children(".song-title").text()),s.addClass("current")}else if(c.is(":last-child")){var m=f.find(".mejs-list li:first span.link");o=m.text(),h.size()>0&&(u=m.parent().children(".song-title").text()),c.removeClass("current"),s=f.find(".mejs-list li:first"),s.addClass("current")}else{s=c.next();if(!s.size())return!0;c.removeClass("current"),o=s.children(".link").text(),h.size()>0&&(u=s.children(".song-title").text()),s.addClass("current")}n.pause(),n.setSrc(o),h.size()>0&&h.html(s.children(".song-title").text()),n.play(),e.onSongChange()})}},buildPrev:function(){var e=this;MediaElementPlayer.prototype.buildprev=function(n,r,i,s){var o='<div class="mejs-button mejs-prev-button '+(n.options.prev?"mejs-prev-on":"mejs-prev-off")+'">'+'<button type="button"></button>'+"</div>",u=$(o).appendTo(r).click(function(i){var s="",o="",u="",a=r.parent().parent().parent().parent(),f=a.parent(),l=a.find(".song-title-head"),c=f.find(".song-list"),h=c.find("li.current");if(a.find(".mejs-shuffle-on").size()>0){var p=c,d=p.children("li").size(),v;if(d<=1)v=0;else while((v=e.getRandomInt(0,d-1))==h.index());s=f.find(".mejs-list li").eq(v),h.removeClass("current"),o=s.children(".link").text(),l.size()>0&&(u=s.children(".song-title").text()),s.addClass("current")}else{s=h.prev();if(!s.size())return!0;h.removeClass("current"),o=s.children(".link").text(),l.size()>0&&(u=s.children(".song-title").text()),s.addClass("current")}n.pause(),n.setSrc(o),l.size()>0&&l.html(s.children(".song-title").text()),n.play(),e.onSongChange()})}},buildLoop:function(){MediaElementPlayer.prototype.buildloop=function(e,t,n,r){var i='<div class="mejs-button mejs-loop-button '+(e.options.loop?"mejs-loop-on":"mejs-loop-off")+'">'+'<button type="button"></button>'+"</div>",s=$(i).appendTo(t).click(function(){e.options.loop=!e.options.loop,e.options.loop?(s.removeClass("mejs-loop-off").addClass("mejs-loop-on"),e.options.shuffle=!1,t.find(".mejs-shuffle-button").removeClass("mejs-shuffle-on").addClass("mejs-shuffle-off")):s.removeClass("mejs-loop-on").addClass("mejs-loop-off")})}},buildShuffle:function(){MediaElementPlayer.prototype.buildshuffle=function(e,t,n,r){var i='<div class="mejs-button mejs-shuffle-button '+(e.options.shuffle?"mejs-shuffle-on":"mejs-shuffle-off")+'">'+'<button type="button"></button>'+"</div>",s=$(i).appendTo(t).click(function(){e.options.shuffle=!e.options.shuffle,e.options.shuffle?(s.removeClass("mejs-shuffle-off").addClass("mejs-shuffle-on"),e.options.loop=!1,t.find(".mejs-loop-button").removeClass("mejs-loop-on").addClass("mejs-loop-off")):s.removeClass("mejs-shuffle-on").addClass("mejs-shuffle-off")})}},buildCol:function(){MediaElementPlayer.prototype.buildcol=function(e,t,n,r){var i='<div class="col-vol"><span></span></div>';$(i).appendTo(t)}},buildClear:function(){MediaElementPlayer.prototype.buildclear=function(e,t,n,r){var i='<div class="clear"></div>';$(i).appendTo(t)}},onSongChange:function(e){var t=$(".song-list li.current"),n=$(".mejs-prev-button"),r=t.is(":first-child");n.toggleClass("disabled",r)}}),define("CONTROLLER_PLAYER",["MediaElelementPlayer"],function(e){return function(){var t,n;return t||e.CONTROLLER_PLAYER}}(this)),define("text!music/tpl/playlist-detail.html",[],function(){return'<!-- music/tpl/album-detail.html-->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title" id="page_title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n\n<div class="content with-header content-background swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="music-playlist-detail" class="swiper-list vertical-align">\n			</div>\n			<div id="activity_extra_holder" class="hide">\n                <!-- activity detail -->\n            </div>	\n            <div class="pvl"></div>\n		</div>\n	</div>\n</div>'}),define("text!music/tpl/playlist-detail-update.html",[],function(){return'<div class="pvl"></div>\n<div class="music-playlist-detail-info-wrapper">\n	<div class="music-playlist-detail-info">\n    <div class="item-headline"><%= _t(\'Uploaded by\') %> <a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a></div>\n    <div class="item-subline">\n        <div class="item-stats next">\n            <!--<i class="icon-headphones"></i>&nbsp;<=iTotalPlay%> plays-->\n			<span class="text-info"><%= item.getTrackCount() %></span>\n			<i class="icon icon-music-track"></i>\n        </div>\n        <div class="item-stats next">\n            <!--<i class="icon-calendar"></i>&nbsp;<=sFullTimeStamp%>-->\n			<span class="text-info"><%= item.getPlayCount() %></span>\n			<i class="icon icon-music-listen"></i>\n        </div>\n    </div>\n</div>\n\n<!-- music player -->\n<div class="musicContent miniplayer-content">\n    <div class="music-player music-cover-image">\n    	<div class="music-player-image" style="background-image:url(<%= item.getImageSrc() %>)"></div>\n    </div>\n\n    <div class="younet_html5_player mobile">		\n        <div class="title-info" id="id_player">        	\n            <!--<p class="song-title-head"><=sTitle%></p>-->\n            <!--audio src="http://product-dev.younetco.com/mobile/se460/public/music_song/23/0c/0c17_6c20.mp4?c=d518" width="100%" autoplay="true"></audio-->\n        </div>\n        <div id="listsong">\n            <ul class="mejs-list scroll-pane song-list">\n        	<% songs.each(function(song){ %>\n        		<li class="">\n	        		<!-- song item of song list -->\n					<p class="song-order"><%= song.getOrderNumber() %>.</p>\n					<p class="play-icon"></p>\n					<span class="link"><%= song.getSongPath() %></span>\n					<span class="song-title"><%= song.getTitle() %>\n						<!--span class="song-author">Linkin Park</span-->\n					</span>\n				</li>\n        	<%}) %>\n            </ul>\n        </div>\n    </div>\n</div>\n<div class="actions-justify gray">\n	<div class="action-item <%= item.isRated()?\'rated\':\'\' %>" id="<%= item.getDataId(\'rate\') %>" rel="delegate">\n		<span class="text-info"><%= item.getRateValue() %></span>\n		<i class="icon icon-activity-rate"></i>\n	</div>\n	<div class="action-item <%= item.isLiked()?\' liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">		\n		<i class="icon icon-activity-like"></i>\n		<span class="text-label" data-suffix="true"><%= item.getLikeCountLabel() %></span>\n	</div>\n	<% if(item.canComment()){%>\n	<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate" data-display="focus">		\n		<i class="icon icon-activity-comment"></i>\n		<span class="text-label" data-suffix="true"><%= item.getCommentCountLabel() %></span>		\n	</div>\n	<%} %>\n	<% if(item.canShare()) { %>\n	<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n		<i class="icon icon-activity-share"></i>\n		<span class="text-label" data-suffix="true"><%= item.getShareCountLabel() %></span>\n	</div>\n	<%} %>\n	<%if (!item.isOwner()) {%>\n	<div class="action-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n		<i class="icon icon-activity-report"></i>\n		<span class="text-label"><%=_t(\'Report\')%></span>\n	</div>\n	<%}%>\n</div>\n\n</div>'}),define("music/model/song",[],function(){return Backbone.Model.extend({idAttribute:"iSongId",defaults:{sModelType:"music_song",bCanLike:!0},getSongPath:function(){return this.get("sSongPath")},getOrderNumber:function(){return parseInt(this.get("iOrdering"),10)+1},getAlbumId:function(){return this.get("iAlbumId")},getAlbumUrl:function(){return"#music_album/"+this.getAlbumId()},getAlbumName:function(){return this.get("sAlbumName")},getPlayCount:function(){return this.get("iTotalPlay")||0},getAlbumImageSrc:function(){return this.get("sAlbumImage")},getGenre:function(){return this.get("sGenre")},getTitle:function(){return this.get("sTitle")}})}),define("music/collection/song",["music/model/song"],function(e){return Backbone.Collection.extend({model:e})}),define("text!music/tpl/playlist-topmenu.html",[],function(){return'<div class="setting-list">\n    <%if (!item.isOwner()) {%>\n    <a class="menu-item" id="<%= item.getDataId(\'report\') %>" rel="delegate"><%= _t(\'Report this album\') %></a>\n    <%}%>\n</div>\n'}),define("music/view/playlist-topmenu",["text!music/tpl/playlist-topmenu.html"],function(e){return Backbone.TopMenuView.extend({template:_.template(e),inject:function(){return utils.popup.open(this.$el),this},hide:function(){return utils.popup.close(),this}})}),define("music/view/playlist-detail",["CONTROLLER_PLAYER","text!music/tpl/playlist-detail.html","text!music/tpl/playlist-detail-update.html","music/collection/song","music/view/playlist-topmenu"],function(e,t,n,r,i){var r=require("music/collection/song");return Backbone.DetailView.extend({template:_.template(t),templateUpdate:_.template(n),topMenuView:i,initialize:function(){this.model.songs=new r,Backbone.DetailView.prototype.initialize.apply(this,arguments)},region:{wrapper:"#main",scroller:"#content",activityExtraHolder:"#activity_extra_holder"},events:{"click #top_menu_toggle":"toggleTopMenu"},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model)},render:function(){return this.$el.html(this.template({item:this.model})),this.$activityExtraHolder=this.$el.find(this.region.activityExtraHolder),this.$scroller=this.$el.find(this.region.scroller),this.$topMenuBtn=this.$el.find("#top_menu_toggle"),this.$el.attr({id:this.model.getDataId()}),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(e){var t=this.model.getId(),n=this;this.errMsg1="",this.errMsg2="";var r=utils.api.get("album/detail",{iAlbumId:this.model.getId()},{context:this}).done(function(e){if(e.error_code&&e.error_code>0){n.errMsg1=e.error_message;return}this.model.set(e)}).fail(function(){utils.debug.log(arguments)}),i=utils.api.get("album/list_songs",{iAlbumId:this.model.getId()},{context:this}).done(function(e){if(e.error_code&&e.error_code>0){n.errMsg2=e.error_message;return}this.model.songs.add(e)});$.when(r,i).done(function(){n.updateView()}).fail(function(){})},updateView:function(){if(this.errMsg1!=""){utils.modal.alert(this.errMsg1);return}if(!this.model.canView()){this.$el.find("#page_title").html(_t("Private Page")),this.$scroller.html(utils.helper.permission_deny());return}if(this.errMsg2!=""){utils.modal.alert(this.errMsg1);return}this.model.isOwner()||this.$topMenuBtn.removeClass("hide"),this.$el.find("#page_title").html(this.model.getAlbumName()),this.$el.find("#music-playlist-detail").html(this.templateUpdate({songs:this.model.songs,item:this.model})),utils.helper.addActivityExtraBlock(this.model,this.$activityExtraHolder,this.$scroller),this.$activityExtraHolder.removeClass("hide");if(this.model.songs.length){var t=this.model.songs.at(0);this.$el.find("#id_player").html('<audio src="'+t.getSongPath()+'" width="100%" autoplay="false"></audio>'),this.$el.find("#listsong li").first().addClass("current"),e.initialize(),this.$el.find(".mejs-prev-button").addClass("disabled")}else this.$el.find(".music-player").first().addClass("no-songs")}})}),define("music/controller/playlist-detail",["music/view/playlist-detail","music/model/playlist"],function(e,t){function n(n,r){utils.history.push(),utils.observer.trigger("router:changed"),(new e({model:new t({iAlbumId:n})})).render().inject()}utils.router.route("music_playlist/:id(/:action)",n),utils.router.route("music_album/:id(/:action)",n)}),define("text!music/tpl/song-detail.html",[],function(){return'<!-- music/tpl/album-detail.html-->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-center">\n		<div class="title" id="page_title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n    <div class="header-right">\n        <div class="btn-top btn-more hide" id="top_menu_toggle">\n        </div>\n    </div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div class="content with-header content-background swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="music-song-detail">\n			</div>\n			<div id="activity_extra_holder" class="hide">\n                <!-- activity detail -->\n            </div>\n		</div>\n	</div>\n</div>\n'}),define("text!music/tpl/song-detail-update.html",[],function(){return'<div class="swiper-list padding-base">\n	<div class="music-song-detail-info">\n	    <div class="item-headline"><%= _t(\'Uploaded by\') %> <a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a></div>\n	    <div class="item-subline">\n	        <div class="item-stats next">\n	            <!--<i class="icon-calendar"></i>&nbsp;<=sFullTimeStamp%>-->\n				<span class="text-info"><%= item.getPlayCount() %></span>\n				<i class="icon icon-music-listen"></i>\n	        </div>\n	        <% if (item.getGenre()) { %>\n	        <div class="item-stats next">\n				<i class="icon icon-music-genre"></i>\n				<span class="text-info"><%= item.getGenre() %></span>\n	        </div>\n	        <% } %>\n	    </div>\n	</div>\n\n	<div class="music-song-detail-description">\n        <%= item.getDescription() %>\n	</div>\n	\n	<!-- music player -->\n	<div class="musicContent miniplayer-content">\n		<div class="music-player music-cover-image">\n	    	<div class="music-player-image" style="background-image:url(<%= item.getAlbumImageSrc() %>)"></div>\n	    </div>\n	    <div class="younet_html5_player mobile">		\n	        <div class="title-info" id="id_player">	        	\n	            <!--<p class="song-title-head"><=sTitle%></p>-->\n	            <!--audio src="http://product-dev.younetco.com/mobile/se460/public/music_song/23/0c/0c17_6c20.mp4?c=d518" width="100%" autoplay="true"></audio-->\n	        </div>\n	        <div id="listsong">\n	            <ul class="mejs-list scroll-pane song-list">\n	            </ul>\n	        </div>\n	    </div>\n	</div>\n</div>\n<div id="music-action-bar">\n	<div class="actions-justify gray">\n	<div class="action-item <%= item.isRated()?\'rated\':\'\' %>" id="<%= item.getDataId(\'rate\') %>" rel="delegate">\n		<span class="text-info"><%= item.getRateValue() %></span>\n		<i class="icon icon-activity-rate"></i>\n	</div>\n	<div class="action-item <%= item.isLiked()?\' liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n		<span class="text-info"><%= item.getLikeCount() %></span>\n		<i class="icon icon-activity-like"></i>\n	</div>\n	<% if(item.canComment()){%>\n	<div class="action-item" id="<%= item.getDataId(\'comment\') %>" rel="delegate" data-display="focus">\n		<span class="text-anchor"><%= item.getCommentCount() %></span>\n		<i class="icon icon-activity-comment"></i>\n	</div>\n	<%} %>\n	<% if(item.canShare()) { %>\n	<div class="action-item" id="<%= item.getDataId(\'share\') %>" rel="delegate">\n		<i class="icon icon-activity-share"></i>\n	</div>\n	<%} %>\n</div>\n</div>\n'}),define("text!music/tpl/song-topmenu.html",[],function(){return'<div class="setting-list">\n    <div class="setting-item <%if (this.model.getDislikeCount() < 1) {%>hide<%}%>" id="dislike-list"></div>\n	<%if (item.canDislike()) {%>\n    <div class="setting-item" id="<%=item.getDataId(\'dislike\')%>" rel="delegate">\n        <%= item.isDisliked() ? _t(\'Remove Dislike\') : _t(\'Dislike\')%>\n    </div>\n    <%}%>\n    <%if (!item.isOwner()) {%>\n    <a class="menu-item" id="<%= item.getDataId(\'report\') %>" rel="delegate"><%= _t(\'Report this song\') %></a>\n    <%}%>\n</div>\n\n'}),define("music/view/song-topmenu",["text!music/tpl/song-topmenu.html","dislike/collection/dislike","dislike/view/dislike-detail"],function(e,t,n){return Backbone.TopMenuView.extend({template:_.template(e),render:function(){var e=this;return this.$el.html(this.template({item:this.model})),this.$dislikeHolder=this.$el.find("#dislike-list"),this.$dislikeBtn=this.$el.find("#"+this.model.getDataId("dislike")),this.model.on("change:iTotalDislike change:bIsDisliked",function(){e.updateView()}),this},inject:function(){return this.model.dislikes=new t,this.model.dislikes.add(this.model.getUserDislike()),this.$dislikeHolder.html((new n({model:this.model})).render().el),utils.popup.open(this.$el),this},hide:function(){return utils.popup.close(),this},updateView:function(){var e=this.model.getDislikeCount()<1?!0:!1;this.$dislikeHolder.toggleClass("hide",e);var t=this.model.isDisliked()?_t("Remove Dislike"):_t("Dislike");this.$dislikeBtn.html(t)}})}),define("music/view/song-detail",["CONTROLLER_PLAYER","text!music/tpl/song-detail.html","text!music/tpl/song-detail-update.html","music/collection/song","music/view/song-topmenu"],function(e,t,n){var r=require("music/collection/song"),i=require("music/view/song-topmenu");return Backbone.DetailView.extend({template:_.template(t),templateUpdate:_.template(n),topMenuView:i,initialize:function(){this.model.songs=new r,Backbone.DetailView.prototype.initialize.apply(this,arguments)},events:{"click #top_menu_toggle":"toggleTopMenu"},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model)},region:{wrapper:"#main",scroller:"#content",activityExtraHolder:"#activity_extra_holder"},render:function(){return this.$el.html(this.template({item:this.model})),this.$activityExtraHolder=this.$el.find(this.region.activityExtraHolder),this.$scroller=this.$el.find(this.region.scroller),this.$topMenuBtn=this.$el.find("#top_menu_toggle"),this.$el.attr({id:this.model.getDataId()}),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(e){var t=this.model.getId(),n=this;this.errMsg1="",this.errMsg2="";var r=utils.api.get("song/detail",{iSongId:this.model.getId()},{context:this}).done(function(e){if(e.error_code&&e.error_code>0){n.errMsg1=e.error_message;return}this.model.set(e)}).fail(function(){utils.debug.log(arguments)});$.when(r).done(function(){n.updateView()}).fail(function(){})},updateView:function(){if(this.errMsg1!=""){utils.modal.alert(this.errMsg1);return}if(!this.model.canView()){this.$el.find("#page_title").html(_t("Private Page")),this.$scroller.html(utils.helper.permission_deny());return}if(this.errMsg2!=""){utils.modal.alert(this.errMsg1);return}this.$el.find("#page_title").html(this.model.getTitle()),this.$topMenuBtn.removeClass("hide"),this.$el.find("#music-song-detail").html(this.templateUpdate({item:this.model})),utils.helper.addActivityExtraBlock(this.model,this.$activityExtraHolder,this.$scroller),this.$activityExtraHolder.removeClass("hide"),this.$el.find("#id_player").html('<audio src="'+this.model.getSongPath()+'" width="100%" autoplay="false"></audio>'),e.initialize(),this.$el.find(".mejs-prev-button").addClass("hide"),this.$el.find(".mejs-next-button").addClass("hide")}})}),define("music/controller/song-detail",["music/view/song-detail","music/model/song"],function(e,t){function n(n,r){utils.history.push(),utils.observer.trigger("router:changed"),(new e({model:new t({iSongId:n})})).render().inject()}utils.router.route("music_song/:id(/:action)",n)}),define("text!music/tpl/song-index.html",[],function(){return'<!-- music/tpl/music-index.html-->\n<div class="header">\n	<div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n	</div>\n</div>\n<div id="search_view_holder">\n<!-- Add search box in here -->\n</div>\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvl"></div>\n			<div id="not_found" class="not-found hide">No albums found.</div>\n			<div class="swiper-list vertical-align">\n				<div id="song_list_view_holder">\n				</div>\n				<%= utils.helper.loadmore() %>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n        <a class="menu-item" href="#music_playlists">\n        	<div class=""><%= _t(\'Albums\') %></div>\n        </a>\n        <a class="menu-item <% if(sView == \'all\') print(\'current\') %>" href="#music_songs">\n        	<div class="sibling"><%= _t(\'Songs\') %></div>\n        </a>\n        <a class="menu-item" href="#music_playlists/my">\n        	<div class="sibling"><%= _t(\'My Albums\') %></div>\n        </a>\n        <a class="menu-item <% if(sView == \'my\') print(\'current\') %>" href="#music_songs/my">\n        	<%= _t(\'My songs\') %>\n        </a>\n    </div>\n</div>\n'}),define("text!music/tpl/song-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- Loading Initiator -->\n</div>'}),define("text!music/tpl/song-item.html",[],function(){return'<div class="clearfix item-wrapper">\n	<div class="item-image">\n		<a href="<%= item.getUrl() %>">\n			<span style="background-image: url(\'<%= item.getAlbumImageSrc() %>\');"></span>\n		</a>\n	</div>\n	<div class="item-stats-group prevent">\n		<div class="separator"></div>\n		<div class="item-stats <%= item.isLiked()?\'liked\':\'\' %>" id="<%= item.getDataId(\'like\') %>" rel="delegate">\n			<i class="icon icon-activity-like"></i>\n			<span class="text-info"><%= item.getLikeCount() %></span>			\n		</div>\n        <% if(item.canComment()){%>\n		<div class="item-stats" id="<%= item.getDataId(\'comment\') %>" rel="delegate">\n			<i class="icon icon-activity-comment"></i>\n			<span class="text-info"><%= item.getCommentCount() %></span>			\n		</div>\n		<% } %>\n		<div class="item-stats">\n			<i class="icon icon-music-listen"></i>\n			<span class="text-info"><%= item.getPlayCount() %></span>			\n		</div>\n	</div>\n	<div class="item-group">\n		<div class="item-headline">\n			<a href="<%= item.getUrl() %>"><%= item.getTitle() %></a>\n		</div>\n		<div class="item-subline">\n			<%= _t(\'in\') %> <span class="primary-text"><%= item.getAlbumName() %>\n	            \n	        <% if(sView != \'my\'){%>\n	        </span> <%= _t(\'by\') %> <a href="<%= item.getPosterUrl() %>"><%= item.getPosterTitle() %></a>		\n	        <% } %>\n		</div>\n	</div>\n</div>\n<div class="pvm"></div>\n'}),define("music/view/song-item",["text!music/tpl/song-item.html"],function(e){return Backbone.ItemView.extend({className:"music-song-item",template:_.template(e),events:{},render:function(){var e="all";return document.URL.match(/my/)&&(e="my"),this.$el.html(this.template({item:this.model,sView:e})),this.$el.attr({id:this.model.getDataId(),rel:"link","data-url":this.model.getUrl()}),this},inject:function(e){e(this.$el)}})}),define("music/view/song-list",["text!music/tpl/song-list.html","music/model/song","music/view/song-item"],function(e,t,n){return Backbone.ListView.extend({defaults:{sSearch:"",sView:"all",iMaxId:0,iMinId:0,iLimit:5,iPage:1},followById:!0,api:"song/fetch",phraseNotFound:"No songs found.",phraseNotMore:"No more songs.",className:"music-song-list",template:_.template(e),itemModel:t,itemView:n,init:function(){this.settings.sView&&(this.defaults.sView=this.settings.sView)}})}),define("text!music/tpl/song-search.html",[],function(){return'\n<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\n	<div class="form-search-group">\n		<span id="search_icon" class="icon-search"></span>\n		<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search Songs\') %>" value="">\n	</div>\n</div>\n<div id="adv_search_holder" class="search-advanced hide">\n	<div class="form-search-group inline">\n		<div class="form-group">\n			<select class="control-full" id="search_category">\n				<option value="0" selected="true"><%= _t(\'Genres\') %></option>\n            </select>\n        </div>\n        <div class="form-group">\n			<select class="control-full" id="search_order">\n               <option value="latest" selected="true"><%= _t(\'Latest\') %></option>\n               <option value="most_viewed"><%= _t(\'Most Viewed\') %></option>\n               <option value="most_liked"><%= _t(\'Most Liked\') %></option>\n               <option value="most_discussed"><%= _t(\'Most Discussed\') %></option>\n            </select>\n        </div>\n	</div>\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>">\n	</div>\n</div>\n\n'}),define("music/view/song-search",["text!music/tpl/song-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$categoryInput=this.$el.find("#search_category"),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this.fetchData(),this},fetchData:function(){utils.api.get("song/getgenre",{},{context:this}).done(this.updateView)},updateView:function(e){if(e.error_code)return utils.modal.alert(e.error_message);_.each(e,function(e){this.$categoryInput.append(new Option(e.name,e.genre_id))},this)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",iCategoryId:this.$categoryInput.val()||0,sOrder:this.$orderInput.val()||"creation_date"})}})}),define("music/view/song-index",["text!music/tpl/song-index.html","music/view/song-list","music/view/song-search"],function(e){var t=require("music/view/song-list"),n=require("music/view/song-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),render:function(e){return this.sView=e&&e.sView?e.sView:"all",this.$el.html(this.template({sView:this.sView})),this},inject:function(e){var r=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#song_list_view_holder"),this.$scroller,{loadnew:!1,sView:this.sView}),this.searchView=new n,this.searchView.render().inject(),this.listView.render({}).inject();var i=this;return this.searchView.on("submit",function(e){i.listView.resetQuery(e)}),this}})}),define("music/controller/song-index",["music/view/song-index"],function(e,t){function n(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({}).inject()}function r(){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sView:"my"}).inject()}utils.router.route("music_songs/my",r),utils.router.route("music_songs",n)}),define("music/main",["core","music/plugin/activity","music/plugin/open-more","music/controller/playlist-index","music/controller/playlist-detail","music/controller/song-detail","music/controller/song-index"],function(e){e.sidebar.configs.set("music",{icon:"icon-sidebar-music",label:"Music",url:"#music_playlists"})}),define("music",["music/main"],function(e){return e}),define("text!event/tpl/attachment-event.html",[],function(){return'<div class="att-item-wrapper">\n	<a class="att-item-image" style="background-image: url(<%= attachment.sPhoto_Url %>)" href="<%= attUrl%>"></a>\n	<div class="att-item-info">\n		<div class="att-item-bottom-info">\n			<div class="att-col-cal">\n				<div class="att-item-month"><%= month %></div>\n				<div class="att-item-date"><%= day %></div>\n			</div>\n			<div class="att-col-info">\n			<a class="att-item-title" href="<%= attUrl%>"><%= attachment.sTitle %></a>\n			<div class="att-item-description"><%= time %>\n				<% if(location != \'\'){%> \n				<%= _t(\'at\') %> <%= location %>\n				<%}%>\n			</div>\n		</div>\n	</div>\n</div>'}),define("event/view/attachment-event",["text!event/tpl/attachment-event.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-event",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n=new Date(t.iStartTime*1e3),r=n.getTime()+n.getTimezoneOffset()*6e4,i=new Date(r+36e5*e.getTimezoneOffset()),s=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","DEC","NOV"],o=i.getHours(),u=i.getMinutes();o<10&&(o="0"+o),u<10&&(u="0"+u);var a={item:e,attachment:t,month:s[i.getMonth()],day:i.getDate(),time:o+":"+u,location:t.sLocation,attUrl:"#event-detail/"+t.sModule+"/"+t.iId};return this.$el.html(this.template(a)),this},inject:function(e){e.html(this.el)}})}),define("event/plugin/activity",["event/view/attachment-event"],function(e){utils.headline.add(["event","fevent"],function(e){return _t("created an event")}),utils.attachment.add(["event","fevent"],e)}),define("event/model/event",[],function(){return Backbone.Model.extend({idAttribute:"iEventId",defaults:{sModelType:"event"},getFullTimeEnd:function(){return this.get("sEndFullTime")},getFullTimeStart:function(){return this.get("sStartFullTime")},getPosterImageSrc:function(){return this.get("sUserImageUrl")||""},getShortStartTime:function(){return this.get("sShortStartTime")||"00:OO"},getTimezoneOffset:function(){return parseFloat(this.get("sUserTimezone"))||0},getDate:function(e){var t=e?new Date(this.getEndTime()*1e3):new Date(this.getStartTime()*1e3),n=t.getTime()+t.getTimezoneOffset()*6e4,r=new Date(n+36e5*this.getTimezoneOffset()),i=["January","February","March","April","May","June","July","August","September","October","November","December"],s=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","DEC","NOV"],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Dec","Nov"],u=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,a=r.getDate()<10?"0"+r.getDate():r.getDate(),f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=r.getHours(),h=r.getHours()<10?"0"+r.getHours():r.getHours(),p=c>12?c-12:c==0?12:c,d=r.getMinutes(),v=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),m=c>11?"pm":"am",g=c>11?"PM":"AM";c<10&&(c="0"+c),d<10&&(d="0"+d);var y={fullYear:r.getFullYear(),fullMonth:i[r.getMonth()],month:s[r.getMonth()],M:o[r.getMonth()],m:u,d:a,date:r.getDate(),weekDay:f[r.getDay()],D:l[r.getDay()],time:this.get("getShortStartTime"),hour:c,H:h,h:p,minute:d,i:v,a:m,A:g};return y},getStartTime:function(){return this.get("iStartTime")},getTextStartTime:function(){var e=this.getDate();return e.weekDay+", "+e.fullMonth+" "+e.date+", "+e.fullYear+" at "+e.h+":"+e.minute+" "+e.a},getTextShortStartTime:function(){var e=this.getDate();return e.h+":"+e.minute+" "+e.A},hasDescription:function(){return this.get("sDescription")!=""},hasHost:function(){return this.get("sHost")!=""},hasLocation:function(){return this.get("sLocation")!=""},hasCategory:function(){return this.get("sCategory")!=""},getLink:function(){return'<a href="'+this.getUrl()+'">'+this.getName()+"</a>"},getMultualFriendCount:function(){return this.get("iMutualFriends")},isFriend:function(){return this.get("isFriend")},getLocation:function(){return this.get("sLocation")},getImageSrc:function(){return this.get("sEventImageUrl")},getBigImageSrc:function(){return this.get("sEventBigImageUrl")},canInvite:function(){return this.get("bCanInvite")},getHost:function(){return this.get("sHost")},getTimestamp:function(){return this.get("iTimeStamp")},getTotalMember:function(){return this.get("iNumOfMember")},getTextTotalMember:function(){var e=this.getTotalMember();return e+(e==1?" guest":" guests")},getTotalGuest:function(){return this.get("aGuestStatistic").iNumAll},getTotalGoing:function(){return this.get("aGuestStatistic").iNumGoing},getTotalMaybe:function(){return this.get("aGuestStatistic").iNumMaybe},getTotalNotAttend:function(){return this.get("aGuestStatistic").iNumNotAttending},getGoingList:function(){return this.get("aGuestList").going},getMaybeList:function(){return this.get("aGuestList").maybe},getNotAttendList:function(){return this.get("aGuestList").notAttend},isMember:function(){return this.get("bIsMember")},isResourceApproval:function(){return this.get("bIsResourceApproval")},isOnRequest:function(){return this.get("bOnRequest")},canView:function(){return this.get("bCanView")},getRSVP:function(){return this.get("iRsvp")},getEndTime:function(){return this.get("iEndTime")},getTextEndTime:function(){var e=this.getDate(!0);return e.weekDay+", "+e.fullMonth+" "+e.date+", "+e.fullYear+" at "+e.h+":"+e.minute+" "+e.a},getCategory:function(){return this.get("sCategory")},getCategoryId:function(){return this.get("iCategory")},getCategoryOptions:function(){return this.get("category_options")},getViewOptions:function(){return this.get("view_options")},getCommentOptions:function(){return this.get("comment_options")},getViewPrivacy:function(){return this.get("sViewPrivacy")},getCommentPrivacy:function(){return this.get("sCommentPrivacy")},getUrl:function(){return"#event-detail/"+this.getType()+"/"+this.getId()}})}),define("text!event/tpl/event-add.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="save_btn"><%= _t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Create Event\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="event-add">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}),define("text!event/tpl/event-add-update.html",[],function(){return'<div class="form-general">\n	<!-- form content -->\n	<div class="form-group">\n		<input type="text" class="control-full" id="event_form_name" placeholder="<%= _t(\'Event Name\') %>" value=""/>\n	</div>\n\n	<div class="form-group">\n		<textarea id="event_form_description" class="control-full textarea" placeholder="<%= _t(\'Description\') %>"></textarea>\n\n	</div>\n	<!-- Start Date -->\n	<div class="form-title">\n		<%= _t(\'Start Time\') %>\n	</div>\n	<div class="form-group form-group-inline clearfix">\n		<input type="date" id="event_form_start_date" />\n		<input type="time" id="event_form_start_time" />\n	</div>\n	<!-- End date -->\n	<div class="form-title">\n		<%= _t(\'End Time\') %>\n	</div>\n	<div class="form-group form-group-inline clearfix">\n		<input type="date" id="event_form_end_date" />\n		<input type="time" id="event_form_end_time" />\n	</div>\n\n	<div class="form-group group-no-margin">\n		<input type="text" class="control-full" id="event_form_host" placeholder="<%= _t(\'Host\') %>" />\n	</div>\n\n	<div class="form-group">\n		<input type="text" class="control-full" id="event_form_location" placeholder="<%= _t(\'Location\') %>" />\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_category">\n			<option value=""><%= _t(\'Categories\') %></option>\n			<%_.each(data.category_options, function (category) {%>\n			<option value="<%=category.iCategoryId%>"><%=category.sName%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_privacy">\n			<option value=""><%= _t(\'Privacy\') %></option>\n			<%_.each(data.view_options, function (option) {%>\n			<option value="<%=option.sValue%>"><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_privacy_comment">\n			<option value=""><%= _t(\'Comment Privacy\') %></option>\n			<%_.each(data.comment_options, function (option) {%>\n			<option value="<%=option.sValue%>"><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-title">\n		<%= _t(\'Main Photo\') %>\n	</div>\n	<div class="form-group">\n		<div id="event_form_photo_holder">\n			<!-- event photo will be add here -->\n			<!--<div class="event-photo-item">\n				<span class="event-image" id="event_form_photo" style="background-image: url(\'https://fbcdn-dragon-a.akamaihd.net/hphotos-ak-ash3/t39.1997/p128x128/851575_551710664864065_1268894699_n.png\');" />\n				<div id="event_form_photo_remove" class="close_button"></div>\n			</div>-->\n		</div>\n		<div id="event_form_photo_browse" class="event-form-photo-browse"></div>\n	</div>\n</div>\n'}),define("event/view/event-add-update",["text!event/tpl/event-add-update.html"],function(e){return Backbone.View.extend({region:{main:"#event-add",content:"#content"},className:"event-add-form",template:_.template(e),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this},inject:function(){var e=$(this.region.main);e.html(this.el);var t=$(this.region.content);t.trigger("refresh")}})}),define("text!event/tpl/event-attachment-photo.html",[],function(){return'<div class="event-photo-item">\n	<span class="event-image" id="event_form_photo" data-src="<%=imageURI%>">\n        <img src="<%=imageURI%>" />\n    </span>\n	<div id="event_form_photo_remove" class="close_button"></div>\n</div>'}),define("event/ipad/view/event-add",["text!event/tpl/event-attachment-photo.html"],function(e){return{browsePhoto:function(t){function r(t){var r=$("#event_form_photo_browse");r.addClass("hide");var i=$("#event_form_photo_holder"),s=_.template(e,{imageURI:t});i.html(s);var o=$(n.region.content);o.trigger("refresh")}function i(e){}var n=this;navigator.camera.getPicture(r,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},removePhoto:function(){var e=$("#event_form_photo_holder");e.empty();var t=$("#event_form_photo_browse");t.removeClass("hide");var n=$(this.region.content);n.trigger("refresh")}}}),define("event/view/event-add",["event/model/event","text!event/tpl/event-add.html","event/view/event-add-update","text!event/tpl/event-attachment-photo.html","event/ipad/view/event-add"],function(e,t,n,r){return Backbone.PolyplatformView.extend({moduleId:"event/view/event-add",region:{holder:"#main",scroller:"#content"},template:_.template(t),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this.$footer=this.$el.find("#footer"),this},inject:function(){var e=this;return this.$holder=$(this.region.holder),this.$holder.html(this.$el),this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),utils.api.get("event/formadd").done(function(t){if(null!=t.error_code&&0!=t.error_code){utils.modal.alert(t.error_message),window.history.back();return}(new n).render({data:t}).inject(),e.$footer.removeClass("hide")}).fail(function(){utils.debug.log(arguments)}),this},events:{"click #event_form_camera_btn":"capturePhoto","click #event_form_gallery_btn":"browsePhoto","click #event_form_photo_remove":"removePhoto","click #save_btn":"saveData","click #event_form_start_date":"handleDates","click #event_form_end_date":"handleDates","click #event_form_start_time":"handleTime","click #event_form_end_time":"handleTime"},capturePhoto:function(e){function n(e){var n=e[0].fullPath;t.addPhoto(n)}function r(e){utils.debug.log(e)}var t=this;navigator.device.capture.captureImage(n,r,{limit:1})},browsePhoto:function(e){function n(e){t.addPhoto(e)}function r(e){utils.debug.log(e)}var t=this;navigator.camera.getPicture(n,r,{quality:10,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},addPhoto:function(e){var t=$("#event_form_photo_holder"),n=_.template(r,{imageURI:e});t.html(n),this.$footer.addClass("hide"),this.$scroller.removeClass("with-header-footer").addClass("with-header")},removePhoto:function(){$("#event_form_photo_holder").empty(),this.$footer.removeClass("hide"),this.$scroller.removeClass("with-header").addClass("with-header-footer")},saveData:function(e){if($("#save_btn").hasClass("processing"))return;var t=$("#event_form_name").val(),n=$("#event_form_description").val(),r=$("#event_form_start_date").val(),i=$("#event_form_start_time").val(),s=$("#event_form_end_date").val(),o=$("#event_form_end_time").val(),u=$("#event_form_location").val(),a=$("#event_form_category").val(),f=$("#event_form_privacy").val()||"everyone",l=$("#event_form_privacy_comment").val()||"everyone";if(!t){utils.modal.alert("Event Name is required.");return}var c=/(\d{4}-\d{2}-\d{2})$/,h=/(\d{2}:\d{2}:\d{2})$/;if(!c.test(r)){utils.modal.alert("Please select start date.");return}if(!h.test(i)){utils.modal.alert("Please select start time.");return}if(!c.test(s)){utils.modal.alert("Please select end date.");return}if(!h.test(o)){utils.modal.alert("Please select end time.");return}if(!u){utils.modal.alert("Location is required.");return}var p=new Date((r+" "+i).replace(/-/g,"/")),d=new Date((s+" "+o).replace(/-/g,"/"));if(p.getTime()>=d.getTime()){utils.modal.alert("Start time must be before end time.");return}var v={title:t,description:n,location:u,start_date:r,start_time:i,end_date:s,end_time:o,category_id:a,auth_view:f,auth_comment:l},m={beforeSend:this.beforeSave,complete:this.saveComplete},g=$("#event_form_photo");if(g.length>0){var y=g.data("src");this.saveEventWithPhoto(v,m,y)}else this.saveEvent(v,m)},saveEvent:function(e,t){utils.api.post("event/create",e,t).done(this.saveDone)},saveEventWithPhoto:function(e,t,n){utils.api.uploadImage("event/create",n,e).done(this.saveDone)},beforeSave:function(){$("#save_btn").addClass("processing")},saveComplete:function(){$("#save_btn").removeClass("processing")},saveDone:function(e){if(null!=e.error_code&&0!=e.error_code){utils.modal.alert(e.error_message);return}utils.modal.toast("Event has been created successfully."),window.location.href="#event-detail/"+e.sModelType+"/"+e.iEventId},handleDates:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n)),datePicker.show({date:n,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},handleTime:function(e){var t=$(e.currentTarget),n=t.val(),r=new Date;/(\d{2}:\d{2}:\d{2})$/.test(n)&&(r.setHours(n.substr(0,2)),r.setMinutes(n.substr(3,2))),datePicker.show({date:r,mode:"time"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);t.val(utils.moment(n.getTime()).format("HH:mm:00"))}t.blur()})}})}),define("event/controller/event-add",["event/model/event","event/view/event-add"],function(e,t){function n(){utils.observer.trigger("router:changed"),(new t({model:new e({})})).render().inject()}utils.router.route("events/add",n)}),define("text!event/tpl/event-index.html",[],function(){return'<!-- event/tpl/event-index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n	<div class="header-right">\n		<a class="btn-top btn-add" href="#events/add"></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div id="page_title" class="title">\n			<%= _t(\'Events\') %>\n		</div>\n	</div>\n</div>\n<div id="search_view_holder">\n	<!-- search view here	 -->\n</div>\n\n<div class="content content-background with-header-footer with-search swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="pvl"></div>\n			<div class="swiper-list vertical-align" id="event_list_view_holder"></div>\n			<%= utils.helper.loadmore() %>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item <%= sView == \'upcomming\'?\'current\':\'\' %>" href="#events">\n        	<div class=""><%= _t(\'All Events\') %></div>\n        </a>\n        <a class="menu-item <%= sView == \'my\'?\'current\':\'\' %>" href="#events/my">\n        	<div class="sibling"><%= _t(\'My Events\') %></div>\n        </a>\n    </div>\n</div>\n'}),define("text!event/tpl/event-item.html",[],function(){return'<!-- event/tpl/event-item.html -->\n<div class="item-wrapper event-item">\n	<div class="item-content-top">\n		<div class="item-image" style="background-image: url(<%= item.getBigImageSrc() %>)">\n		</div>\n		<%if (item.isOwner()) {%><span class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate"></span><%}%>\n	</div>\n	<div class="item-event-content">\n		<div class="item-event-content-top">\n			<div id="rsvp_btn" class="item-rvsp prevent">\n				<div class="icon icon-rvsp"></div>\n			</div>\n			<div class="item-headline">\n				<a href="<%=item.getUrl()%>" class="item-title"><%= item.getTitle() %></a>\n			</div>\n			<div class="item-poster-link">\n				<%=_t(\'by\')%> <a href="<%= item.getPosterUrl() %>" class="item-profile-link">\n					<%= item.getPosterTitle() %>\n				</a>\n			</div>\n			<div class="item-top-separator"></div>\n			<div class="item-description">\n				<%= utils.str.shorten(item.getDescription(), 120, false)%>\n			</div>\n		</div>\n		<div class="item-bottom-separator"></div>\n		<div class="item-content-bottom">\n			<div class="item-stats">\n				<span class="icon icon-user"></span>\n				<span class="num-total-member"><%=item.getTotalMember()%></span>\n			</div>\n			<div class="item-stats next">\n				<span class="icon icon-time"></span>\n				<%=date.date + \' \' + date.fullMonth + \' \' + _t(\'at\') + \' \' + date.h + \':\' + date.minute + date.A%>\n			</div>\n			<% if(item.hasLocation()){ %>\n			<div class="item-stats next">\n				<span class="icon icon-location"></span>\n				<%= item.getLocation() %>\n			</div>\n			<% } %>\n		</div>		\n	</div>\n</div>\n<div class="event-rsvp-dropdown-wrapper hide"></div>\n<div class="pvl"></div>'}),define("text!event/tpl/event-setting.html",[],function(){return'<div class="setting-list">\n    <a class="setting-item" href="#events/edit/<%=item.getId()%>">\n    	<%= _t(\'Edit\') %>\n    </a>\n    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>">\n    	<%= _t(\'Delete\') %>\n    </a>\n</div>'}),define("event/view/event-setting",["text!event/tpl/event-setting.html"],function(e){return Backbone.PopupView.extend({template:_.template(e)})}),define("text!event/tpl/event-rsvp.html",[],function(){return'<div class="rsvp-dropdown-content prevent">\n    <div rel="delegate" id="<%= item.getDataId(\'attendingEvent\') %>" class="rsvp-dropdown-item <%if (item.getRSVP() == "1") {%>active<%}%>">\n        <i class="icon event-icon-join"></i>\n        <span><%= _t(\'Attend\') %></span>\n    </div>\n    <div rel="delegate" id="<%= item.getDataId(\'maybeEvent\') %>" class="rsvp-dropdown-item <%if (item.getRSVP() == "2") {%>active<%}%>">\n            <i class="icon event-icon-maybe"></i>\n            <span><%= _t(\'Maybe\') %></span>\n        </div>\n    <div rel="delegate" id="<%= item.getDataId(\'declineEvent\') %>" class="rsvp-dropdown-item <%if (item.getRSVP() == "3") {%>active<%}%>">\n        <i class="icon event-icon-decline"></i>\n        <span><%= _t(\'Decline\') %></span>\n    </div>\n</div>'}),define("event/view/event-rsvp",["text!event/tpl/event-rsvp.html"],function(e){return Backbone.InlineView.extend({template:_.template(e),className:"rsvp-dropdown-stage"})}),define("text!event/tpl/event-guest.html",[],function(){return'<!-- event/tpl/event-guest.html -->\n<div class="popup-header">\n	<div class="popup-title">\n		<%=_t(\'Guest List\')%>\n	</div>\n</div>\n\n<div class="popup-content swiper-container native-vscroll event-guest-list-popup" id="popup-content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'No guests found.\') %></div>\n			<div id="event-guest-list">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("text!event/tpl/event-guest-item.html",[],function(){return'<div data-url="<%=item.getUrl()%>" rel="link">\n	<div class="item-image" style="background-image:url(\'<%=item.getImageSrc() %>\')"></div>\n	<div class="item-headline"><%= item.getTitle() %></div>\n</div>'}),define("event/view/event-guest-item",["text!event/tpl/event-guest-item.html"],function(e){return Backbone.View.extend({region:{},className:"event-guest-item",template:_.template(e),render:function(e){return this.$el.html(this.template({item:e})),this},inject:function(e){e(this.el)}})}),define("event/view/event-guest-list",["event/view/event-guest-item"],function(e){return Backbone.View.extend({region:{content:"#popup-content",list:"#event-guest-list"},template:null,render:function(e){return this.context=$.extend({},e),this},inject:function(){var t=$(this.region.content),n=$(this.region.list);t.find(".loading-initiator").remove();if(this.context.items.length>0){function r(e){n.append(e)}_.each(this.context.items,function(t){(new e).render(t).inject(r)})}else $("#not_found").removeClass("hide");t.trigger("refresh")}})}),define("event/view/event-guest",["text!event/tpl/event-guest.html","event/view/event-guest-list","user/model/user"],function(e,t,n){return Backbone.View.extend({region:{main:"#simple-popup",content:"#popup-content"},template:_.template(e),render:function(e){return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this},inject:function(){var e=$(this.region.main);e.html(this.el);var t=$(this.region.content);return t.vscroll(),this.appendList(),utils.popup.open(this.$el),this},appendList:function(){var e=this,r={iEventId:this.context.iEventId,iRSVP:this.context.iRSVP,iAmountOfMember:9999};utils.api.get("event/viewguestlist",r).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));var r=e.map(function(e){return new n(e)});(new t).render({items:r}).inject()})}})}),define("event/view/event-item",["text!event/tpl/event-item.html","event/view/event-setting","event/view/event-rsvp","event/view/event-guest"],function(e,t,n,r){return Backbone.ItemView.extend({moduleId:"event/view/event-item",region:{main:"#main",content:"#content"},className:"event-item",template:_.template(e),settingView:t,events:{"click #top_menu_toggle":"toggleTopMenu","click #rsvp_btn":"onRSVPClick",attendingEvent:"attendingEvent",maybeEvent:"maybeEvent",declineEvent:"declineEvent","click .guest-count":"showMemberList"},initialize:function(){var e=this;this.model.on("change",function(){e.updateNumberOfMemberCount()}),Backbone.ItemView.prototype.initialize.apply(this,arguments)},render:function(){return this.$el.html(this.template({item:this.model,date:this.model.getDate()})),this.$el.attr({id:this.model.getDataId(),rel:"link","data-url":this.model.getUrl()}),this.$rsvpBtn=this.$el.find("#rsvp_btn"),this.$rsvpHolder=this.$el.find(".event-rsvp-dropdown-wrapper"),this},inject:function(e){return e(this.$el),this},onRSVPClick:function(){if(this.$rsvpBtn.isProcessing())return!1;this.$rsvpBtn.hasClass("active")?(this.$rsvpBtn.removeClass("active"),this.$rsvpHolder.addClass("hide")):(this.$rsvpBtn.addClass("active"),(new n({model:this.model},this.$rsvpHolder)).render().inject())},attendingEvent:function(e){var t={iEventId:this.model.getId(),iRsvp:1},n={iRsvp:1};this.postRSVP(e,"event/addrsvp",t,n,"You have successfully RSVPed to this event.")},maybeEvent:function(e){var t={iEventId:this.model.getId(),iRsvp:2},n={iRsvp:2};this.postRSVP(e,"event/addrsvp",t,n,"You have successfully RSVPed to this event.")},declineEvent:function(e){var t={iEventId:this.model.getId(),iRsvp:3},n={iRsvp:3};this.postRSVP(e,"event/addrsvp",t,n,"You have successfully RSVPed to this event.")},postRSVP:function(e,t,n,r,i){this.$rsvpHolder.addClass("hide"),this.$rsvpBtn.removeClass("active"),utils.popup.close(),this.$rsvpBtn.addClass("processing"),utils.api.post(t,n,{context:this}).done(this.postRSVPComplete).fail(this.postRSVPFail)},postRSVPComplete:function(e){this.$rsvpBtn.isProcessing(!1);if(null!=e.error_code&&0!=e.error_code){utils.modal.alert(e.error_message);return}utils.modal.toast(e.message),e.event_data&&this.model.set(e.event_data)},postRSVPFail:function(){this.$rsvpBtn.isProcessing(!1)},updateNumberOfMemberCount:function(e){this.$el.find(".text-total-member").text(this.model.getTextTotalMember())},doDeleteConfirm:function(){var e=this;utils.modal.confirm("Do you want to delete this event?",function(t){t==1&&(utils.observer.trigger("blockui"),utils.api.post("event/delete",{iEventId:e.model.getId()}).always(function(){utils.observer.trigger("releaseui"),utils.popup.close()}).done(function(t){if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));e.deleteSuccess(t)}))},_t("Confirm"),[_t("Ok"),_t("Cancel")])},deleteSuccess:function(e){utils.modal.toast(e.message),this.$el.remove();var t=$(this.region.content);t.trigger("refresh")},showMemberList:function(e){(new r).render({iEventId:this.model.getId(),iRSVP:$(e.currentTarget).data("rsvp")}).inject()}})}),define("text!event/tpl/event-list.html",[],function(){return'<div id="event-list">\r\n	<div class="loading-initiator">\r\n		<!-- loading ... -->\r\n	</div>\r\n</div>'}),define("event/view/event-list",["event/model/event","event/view/event-item","text!event/tpl/event-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{sView:"all",iPage:1,sSearch:"",iCatSearch:"all_cate",iAmountOfevent:5},followById:!1,api:"event/get",phraseNotFound:"No events found.",phraseNotMore:"No more events.",className:"event-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!event/tpl/event-search.html",[],function(){return'<div class="search-simple">\n	<div id="adv_search_toggle_btn" class="btn-advance-search"></div>\n</div>\n\n<div id="adv_search_holder" class="search-advanced hide">\n\n	<div class="form-search-group include-btn-search">\n		<div class="form-group">\n			<span id="search_icon" class="icon-search"></span>\n			<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search events\') %>" value="" />\n		</div>\n	</div>\n\n	<%if (sView != \'my\') {%>\n	<div class="form-search-group form-group">\n		<select class="control-full" id="search_category">\n                <option value="all_cate"><%= _t(\'All Categories\') %></option>\n                <option value="attending"><%= _t(\'I\\\'m Attending\') %></option>\n                <option value="may_attend"><%= _t(\'I May Attend\') %></option>\n                <option value="not_attending"><%= _t(\'I\\\'m Not Attending\') %></option>\n                <option value="invites"><%= _t(\'Event Invites\') %></option>\n        </select>\n    </div>\n\n    <div class="form-search-group form-group">\n		<select class="control-full" id="search_order">\n                <option value="latest"><%= _t(\'Latest\') %></option>\n                <option value="most_view"><%= _t(\'Most Viewed\') %></option>\n                <option value="most_liked"><%= _t(\'Most Liked\') %></option>\n                <option value="most_disscussed"><%= _t(\'Most Discussed\') %></option>\n        </select>\n    </div>\n	<%}%>\n\n	<div class="form-search-submit">\n		<input type="button" class="btn btn-primary btn-small-fluid" id="search_btn" value="<%= _t(\'Search\') %>" />\n	</div>\n</div>\n'}),define("event/view/event-search",["text!event/tpl/event-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(e){return this.$el.html(this.template($.extend({sView:"upcoming"},e))),this.$categoryInput=this.$el.find("#search_category"),this.$orderInput=this.$el.find("#search_order"),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this.fetchData(),this},fetchData:function(){utils.api.get("event/listcategories",{},{context:this}).done(this.updateView)},updateView:function(e){if(e.error_code)return utils.modal.alert(e.error_message);_.each(e,function(e){this.$categoryInput.append(new Option(e.sName,e.iCategoryId))},this)},events:{"click #adv_search_toggle_btn":"toggleAdvSearch","click #search_icon":"submitSearch","click #search_btn":"submitSearch"},toggleAdvSearch:function(e){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.$advSearchHolder.addClass("hide"),this.trigger("submit",{sSearch:this.$keywordInput.val()||"",iCatSearch:this.$categoryInput.val()||"all_cate",sOrder:this.$orderInput.val()||"creation_date"})}})}),define("event/view/event-index",["text!event/tpl/event-index.html","event/view/event-list","event/view/event-search"],function(e){var t=require("event/view/event-list"),n=require("event/view/event-search");return Backbone.View.extend({region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(e){return this.query=$.extend({sView:"upcoming"},e),this.$el.html(this.template(this.query)),this},inject:function(){var e=$(this.region.holder).html(this.$el);this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$el.find("#event_list_view_holder"),this.$scroller),this.searchView=new n,this.searchView.render({sView:this.query.sView}).inject(),this.listView.render(this.query).inject();var r=this;return this.searchView.on("submit",function(e){r.listView.resetQuery($.extend({},r.query,e))}),this}})}),define("event/controller/event-index",["event/view/event-index"],function(e){function t(t){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render({sView:"upcomming"}).inject()}function n(){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sView:"past"}).inject()}function r(){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({sView:"my"}).inject()}utils.router.route("events",t),utils.router.route("events/my",r),utils.router.route("events/past",n)}),define("text!event/tpl/event-invite.html",[],function(){return'<!-- event/tpl/event-invite.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="invite_btn"><%= _t(\'Invite\') %></div>\n	</div>\n	<div class="header-center">\n		<div id="page_title" class="title">\n			<%= _t(\'Invite Friends\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'You have no friends you can invite.\') %></div>\n			<div id="event-invite-list">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 fobos">\n        <a id="markall_btn" class="menu-item" href="javascript:void(0)">\n        	<div class=""><%= _t(\'Mark All\') %></div>\n        </a>\n        <a id="unmarkall_btn" class="menu-item" href="javascript:void(0)">\n        	<div class="sibling"><%= _t(\'Unmark All\') %></div>\n        </a>\n    </div>\n</div>'}),define("text!event/tpl/event-invite-item.html",[],function(){return'<div class="item-image" style="background-image:url(\'<%=item.getImageSrc()%>\')"></div>\n<div class="item-title"><%=item.getTitle()%></div>\n<div class="item-mark"><input type="checkbox" class="item-checkbox" data-id="<%=item.getId()%>" /></div>'}),define("event/view/event-invite-item",["text!event/tpl/event-invite-item.html"],function(e){return Backbone.View.extend({region:{},className:"event-invite-item",template:_.template(e),render:function(){return this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!event/tpl/event-invite-list.html",[],function(){return'<div class="loading-initiator"></div>'}),define("event/view/event-invite-list",["user/model/user","event/view/event-invite-item","text!event/tpl/event-invite-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iEventId:0,sAction:"all",amountOfFriend:"9999",LastFriendIdViewed:"0"},followById:!1,api:"event/getinvitepeople",phraseNotFound:"No friends found.",phraseNotMore:"No more friends.",className:"friend-list",template:_.template(n),itemModel:e,itemView:t})}),define("user/collection/user",["user/model/user"],function(e){return Backbone.Collection.extend({model:e})}),define("event/view/event-invite",["text!event/tpl/event-invite.html","event/view/event-invite-list","user/collection/user"],function(e,t,n){return Backbone.View.extend({region:{wrapper:"#main",scroller:"#content",listViewHolder:"#event-invite-list"},initialize:function(){this.invitePeople=new n},template:_.template(e),render:function(){return this.$el.html(this.template()),this.$scroller=this.$el.find(this.region.scroller),this.$listViewHolder=this.$el.find(this.region.listViewHolder),this.$inviteBtn=this.$el.find("#invite_btn"),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.listView=new t({},this.$listViewHolder,this.$scroller,{loadmore:!1,loadnew:!1}),this.listView.render({iEventId:this.model.getId()}).inject(),this},events:{"click .event-invite-item":"clickItem","click #markall_btn":"markAll","click #unmarkall_btn":"unmarkAll","click #invite_btn":"invite"},clickItem:function(e){if(!$(e.target).is(":checkbox")){var t=$(e.currentTarget).find(":checkbox");t.is(":checked")?t.prop("checked",!1):t.prop("checked",!0)}},markAll:function(e){$(":checkbox").prop("checked",!0)},unmarkAll:function(e){$(":checkbox").prop("checked",!1)},invite:function(e){if(this.$inviteBtn.isProcessing())return!1;var t=new Array;$(":checkbox:checked").each(function(){t.push($(this).data("id"))});if(t.length==0)return utils.modal.alert(_t("Please select friend to invite.")),!1;var n={iEventId:this.model.getId(),sUserId:t.join(",")},r={context:this};this.$inviteBtn.isProcessing(!0),utils.api.post("event/invite",n,r).always(function(){this.$inviteBtn.isProcessing(!1),utils.modal.toast("Invited member(s) successfully!"),utils.history.back()})},doInviteComplete:function(e){e.error_code&&e.error_code>0?utils.modal.alert(e.error_message):(utils.modal.toast("Invited member(s) successfully!"),utils.history.back()),this.$inviteBtn.isProcessing(!1)},doInviteFail:function(){var e=_t("Could not send invite");utils.modal.alert(e),this.$inviteBtn.isProcessing(!1)}})}),define("event/controller/event-invite",["event/model/event","event/view/event-invite"],function(e,t){function n(n){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iEventId:n})})).render().inject()}utils.router.route("events/invite/:id",n)}),define("text!event/tpl/event-edit.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top" id="save_btn"><%= _t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Edit Event\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="event-edit">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}),define("text!event/tpl/event-edit-update.html",[],function(){return'<div class="form-general">\n	<!-- form content -->\n	<div class="form-group">\n		<input type="text" class="control-full" placeholder="Event Name"  id="event_form_name" value="<%=item.getTitle()%>" />\n	</div>\n\n	<div class="form-group">\n		<textarea id="event_form_description" class="control-full textarea" placeholder="Description"><%=item.getDescription()%></textarea>\n\n	</div>\n	<!-- Start Date -->\n	<div class="form-title">\n		<%= _t(\'Start Time\') %>\n	</div>\n	<div class="form-group form-group-inline clearfix">\n		<input type="date" id="event_form_start_date" value="<%=date.fullYear%>-<%=date.m%>-<%=date.d%>" />\n		<input type="time" id="event_form_start_time" value="<%=date.H%>:<%=date.i%>:00" />\n	</div>\n	<!-- End date -->\n	<div class="form-title">\n		<%= _t(\'End Time\') %>\n	</div>\n	<div class="form-group form-group-inline clearfix">\n		<input type="date" id="event_form_end_date" value="<%=end_date.fullYear%>-<%=end_date.m%>-<%=end_date.d%>" />\n		<input type="time" id="event_form_end_time" value="<%=end_date.H%>:<%=end_date.i%>:00" />\n	</div>\n\n	<div class="form-group">\n		<input type="text" class="control-full" placeholder="Host" id="event_form_host" value="<%=item.getHost()%>" />\n	</div>\n\n	<div class="form-group">\n		<input type="text" class="control-full" placeholder="Location" id="event_form_location" value="<%=item.getLocation()%>" />\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_category">\n			<option value=""><%= _t(\'Categories\') %></option>\n			<%_.each(item.getCategoryOptions(), function (category) {%>\n			<option value="<%=category.iCategoryId%>" <%if (category.iCategoryId == item.getCategoryId()) {%>selected="selected"<%}%>><%=category.sName%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_privacy">\n			<option value=""><%= _t(\'Privacy\') %></option>\n			<%_.each(item.getViewOptions(), function (option) {%>\n			<option value="<%=option.sValue%>" <%if (option.sValue == item.getViewPrivacy()) {%>selected="selected"<%}%>><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-group">\n		<select class="control-full" id="event_form_privacy_comment">\n			<option value=""><%= _t(\'Comment Privacy\') %></option>\n			<%_.each(item.getCommentOptions(), function (option) {%>\n			<option value="<%=option.sValue%>" <%if (option.sValue == item.getCommentPrivacy()) {%>selected="selected"<%}%>><%=option.sPhrase%></option>\n			<%}, this);%>\n		</select>\n	</div>\n\n	<div class="form-title">\n		<%= _t(\'Main Photo\') %>\n	</div>\n	<div class="form-group">\n		<div id="event_form_photo_holder">\n			<!-- event photo will be add here -->\n			<!-- <div class="event-photo-item">\n				<span class="event-image" id="event_form_photo" style="background-image: url(\'https://fbcdn-dragon-a.akamaihd.net/hphotos-ak-ash3/t39.1997/p128x128/851575_551710664864065_1268894699_n.png\');" />\n				<div id="event_form_photo_remove" class="close_button"></div>\n			</div> -->\n		</div>\n		<div id="event_form_photo_browse" class="event-form-photo-browse"></div>\n	</div>\n</div>'}),define("event/ipad/view/event-edit",["text!event/tpl/event-attachment-photo.html"],function(e){return{browsePhoto:function(t){function r(t){var r=$("#event_form_photo_browse");r.addClass("hide");var i=$("#event_form_photo_holder"),s=_.template(e,{imageURI:t});i.html(s),n.$scroller.trigger("refresh")}function i(e){}var n=this;navigator.camera.getPicture(r,i,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!1})},removePhoto:function(){var e=$("#event_form_photo_holder");e.empty();var t=$("#event_form_photo_browse");t.removeClass("hide"),this.$scroller.trigger("refresh")}}}),define("event/view/event-edit",["text!event/tpl/event-edit.html","text!event/tpl/event-edit-update.html","text!event/tpl/event-attachment-photo.html","event/ipad/view/event-edit"],function(e,t,n){return Backbone.PolyplatformView.extend({moduleId:"event/view/event-edit",region:{wrapper:"#main",scroller:"#content",formHolder:"#event-edit"},template:_.template(e),formTemplate:_.template(t),render:function(e){return this.$el.attr({id:this.model.getId()}),this.$el.html(this.template(this.context)),this.$scroller=this.$el.find(this.region.scroller),this.$formHolder=this.$el.find(this.region.formHolder),this.$footer=this.$el.find("#footer"),this},inject:function(){return $(this.region.wrapper).html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},fetchData:function(){var e={iEventId:this.model.getId()},t={context:this};utils.api.get("event/formedit",e,t).done(this.fetchDataComplete).fail(this.fetchDataFail)},fetchDataComplete:function(e){if(null!=e.error_code&&0!=e.error_code){utils.modal.alert(e.error_message),window.history.back();return}this.model.set(e),this.updateView()},updateView:function(e){return this.$formHolder.html(this.formTemplate({item:this.model,date:this.model.getDate(),end_date:this.model.getDate(!0)})),this.$footer.removeClass("hide"),this.$scroller.trigger("refresh"),this},fetchDataFail:function(){utils.debug.log(arguments)},events:{"click #event_form_camera_btn":"capturePhoto","click #event_form_gallery_btn":"browsePhoto","click #event_form_photo_remove":"removePhoto","click #save_btn":"saveData","click #event_form_start_date":"handleDates","click #event_form_end_date":"handleDates","click #event_form_start_time":"handleTime","click #event_form_end_time":"handleTime"},capturePhoto:function(e){function n(e){var n=e[0].fullPath;t.addPhoto(n)}function r(e){utils.debug.log(e)}var t=this;navigator.device.capture.captureImage(n,r,{limit:1})},browsePhoto:function(e){function n(e){t.addPhoto(e)}function r(e){utils.debug.log(e)}var t=this;navigator.camera.getPicture(n,r,{quality:10,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},addPhoto:function(e){var t=$("#event_form_photo_holder"),r=_.template(n,{imageURI:e});t.html(r),this.$footer.addClass("hide"),this.$scroller.removeClass("with-header-footer").addClass("with-header")},removePhoto:function(){$("#event_form_photo_holder").empty(),this.$footer.removeClass("hide"),this.$scroller.removeClass("with-header").addClass("with-header-footer")},saveData:function(e){if($("#save_btn").hasClass("processing"))return;var t=$("#event_form_name").val(),n=$("#event_form_description").val(),r=$("#event_form_start_date").val(),i=$("#event_form_start_time").val(),s=$("#event_form_end_date").val(),o=$("#event_form_end_time").val(),u=$("#event_form_location").val(),a=$("#event_form_category").val(),f=$("#event_form_privacy").val()||"everyone",l=$("#event_form_privacy_comment").val()||"everyone";if(!t){utils.modal.alert("Event Name is required.");return}var c=/(\d{4}-\d{2}-\d{2})$/,h=/(\d{2}:\d{2}:\d{2})$/;if(!c.test(r)){utils.modal.alert("Please select start date.");return}if(!h.test(i)){utils.modal.alert("Please select start time.");return}if(!c.test(s)){utils.modal.alert("Please select end date.");return}if(!h.test(o)){utils.modal.alert("Please select end time.");return}if(!u){utils.modal.alert("Location is required.");return}var p=new Date((r+" "+i).replace(/-/g,"/")),d=new Date((s+" "+o).replace(/-/g,"/"));if(p.getTime()>=d.getTime()){utils.modal.alert("Start time must be before end time.");return}var v={iEventId:this.model.getId(),title:t,description:n,location:u,start_date:r,start_time:i,end_date:s,end_time:o,category_id:a,auth_view:f,auth_comment:l},m={beforeSend:this.beforeSave,complete:this.saveComplete},g=$("#event_form_photo");if(g.length>0){var y=g.data("src");this.saveEventWithPhoto(v,m,y)}else this.saveEvent(v,m)},saveEvent:function(e,t){utils.api.post("event/edit",e,t).done(this.saveDone)},saveEventWithPhoto:function(e,t,n){utils.api.uploadImage("event/edit",n,e).done(this.saveDone)},beforeSave:function(){$("#save_btn").addClass("processing")},saveComplete:function(){$("#save_btn").removeClass("processing")},saveDone:function(e){if(null!=e.error_code&&0!=e.error_code){utils.modal.alert(e.error_message);return}utils.modal.toast("Event has been updated successfully."),window.location.href="#event-detail/"+e.sModelType+"/"+e.iEventId},handleDates:function(e){var t=$(e.currentTarget),n=Date.parse(t.val().replace(/-/g,"/"))||new Date;typeof n=="number"&&(n=new Date(n)),datePicker.show({date:n,mode:"date"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);t.val(utils.moment(n.getTime()).format("YYYY-MM-DD"))}t.blur()})},handleTime:function(e){var t=$(e.currentTarget),n=t.val(),r=new Date;/(\d{2}:\d{2}:\d{2})$/.test(n)&&(r.setHours(n.substr(0,2)),r.setMinutes(n.substr(3,2))),datePicker.show({date:r,mode:"time"},function(e){if(e!==""&&e!="Invalid Date"){var n=new Date(e);t.val(utils.moment(n.getTime()).format("HH:mm:00"))}t.blur()})}})}),define("event/controller/event-edit",["event/model/event","event/view/event-edit"],function(e,t){function n(n){utils.observer.trigger("router:changed"),(new t({model:new e({iEventId:n})})).render().inject()}utils.router.route("events/edit/:id",n)}),define("text!event/tpl/event-detail-info.html",[],function(){return'<!-- event/tpl/event-detail-info.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top btn-more hide" id="top_menu_toggle">\n		</div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div id="page_title" class="title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div class="content content-background with-header-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="event-detail-info" class="swiper-list vertical">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n			<div class="pvl"></div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item current" href="<%=item.getUrl()%>">\n        	<div class=""><%= _t(\'Information\') %></div>\n        </a>\n        <a id="event_menu_actvity" class="menu-item hide" href="<%=item.getUrl()%>/activity">\n        	<div class="sibling"><%= _t(\'Activity\') %></div>\n        </a>\n    </div>\n</div>'}),define("text!event/tpl/event-detail-info-update.html",[],function(){return'<!-- event/tpl/event-item.html -->\n<div class="pvl"></div>\n<div class="event-detail-info">\n	<div class="item-content-top">\n		<div class="item-image" style="background-image: url(<%= item.getBigImageSrc() %>)"></div>\n	</div>\n        \n	<div class="item-event-content">\n		<div class="item-cal">\n			<div class="item-month"><%= date.month %></div>\n			<div class="item-date"><%= date.date %></div>\n		</div>\n		<div class="box-justify item-event-content-detail">\n			<div class="item-livetime">\n				<i class="icon icon-time"></i>\n				<span class="livetime" data-livetime="<%= item.getTimestamp() %>"><%= item.getLivetime() %></span>\n			</div>\n			<div class="item-host">\n				<%if (item.hasHost()) {%>\n					<%= _t(\'hosted by\') %> <span class="text-link"><%= item.getHost() %></span>\n				<%}%> &nbsp;\n			</div>\n			<div class="item-stats-group">\n				<div class="item-stats">\n					<span class="icon icon-user"></span>\n					<span class="num-total-member"><%=item.getTotalGuest()%></span>\n				</div>\n				<div class="item-stats next">\n					<span class="icon icon-time"></span>\n					<%=date.D + \', \' + date.M + \' \' + date.date + \' \' + _t(\'at\') + \' \' + date.h + \':\' + date.minute + date.A%>\n					- <%=end_date.D + \', \' + end_date.M + \' \' + end_date.date + \' \' + _t(\'at\') + \' \' + end_date.h + \':\' + end_date.minute + end_date.A%>\n				</div>\n			</div>\n			<div class="item-stats-group">\n				<%if (item.hasCategory()) {%>\n				<div class="item-stats">\n					<i class="icon icon-category"></i>\n					<span><%= item.getCategory() %></span>\n				</div>\n				<%}%>\n				<% if(item.hasLocation()){ %>\n				<div class="item-stats next">\n					<span class="icon icon-location"></span>\n					<%= item.getLocation() %>\n				</div>\n				<% } %>\n			</div>\n		</div>\n		<div id="rsvp_btn" class="box-justify item-rvsp">\n		</div>\n	</div>\n	<div class="event-rsvp-dropdown-wrapper hide"></div>\n	<%if (item.hasDescription()) {%>\n	<div class="item-description"><%= utils.str.shorten(item.getDescription(), 500, true) %></div>\n	<%}%>\n</div>\n<div class="pvl"></div>\n\n<%if (item.canView()) {%>\n<div class="event-detail-info-extra">\n	<div class="item-stats guest-count" data-rsvp="2"><span class="stats-number"><%=item.getTotalGoing()%></span><i class="icon icon-user"></i></div>\n	<div class="item-label"><%= _t(\'Going\') %></div>	\n	<div class="clearfix people-list">\n		<%_.each(item.getGoingList(), function (guest) {%>\n		<a href="#user/<%=guest.iUserId%>">\n			<img src="<%=guest.sUserImage%>" />\n		</a>\n		<%}, this);%>\n	</div>\n	<div class="separator-line"></div>\n	<div class="item-stats guest-count" data-rsvp="1"><span class="stats-number"><%=item.getTotalMaybe()%></span><i class="icon icon-user"></i></div>\n	<div class="item-label"><%= _t(\'Maybe\') %></div>	\n	<div class="clearfix people-list">\n		<%_.each(item.getMaybeList(), function (guest) {%>\n		<a href="#user/<%=guest.iUserId%>">\n			<img src="<%=guest.sUserImage%>" />\n		</a>\n		<%}, this);%>\n	</div>\n	<div class="separator-line"></div>\n	<div class="item-stats guest-count" data-rsvp="0"><span class="stats-number"><%=item.getTotalNotAttend()%></span><i class="icon icon-user"></i></div>\n	<div class="item-label"><%= _t(\'Maybe\') %></div>	\n	<div class="clearfix people-list">\n		<%_.each(item.getMaybeList(), function (guest) {%>\n		<a href="#user/<%=guest.iUserId%>">\n			<img src="<%=guest.sUserImage%>" height="48">\n		</a>\n		<%}, this);%>\n	</div>\n</div>\n<%}%>'}),define("text!event/tpl/event-topmenu.html",[],function(){return'<div class="setting-list">\n	<%if (item.isOwner()) {%>\n	<a class="setting-item" href="#events/edit/<%=item.getId()%>"><%= _t(\'Edit\') %></a>\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'delete\') %>"><%= _t(\'Delete\') %></a>\n	<%}%>\n	<%if (item.canInvite()) {%>\n	<a class="setting-item" href="#events/invite/<%=item.getId()%>"><%= _t(\'Invite\') %></a>\n	<%}%>\n	<a class="setting-item" rel="delegate" id="<%= item.getDataId(\'share\') %>"><%= _t(\'Share\') %></a>\n</div>\n'}),define("event/view/event-topmenu",["text!event/tpl/event-topmenu.html"],function(e){return Backbone.TopMenuView.extend({moduleId:"event/view/event-topmenu",template:_.template(e),inject:function(){return utils.popup.open(this.$el),this},hide:function(){return utils.popup.close(),this}})}),define("event/view/event-detail-info",["text!event/tpl/event-detail-info.html","text!event/tpl/event-detail-info-update.html","event/view/event-item","event/view/event-topmenu"],function(){var e=require("text!event/tpl/event-detail-info.html"),t=require("event/view/event-item"),n=require("text!event/tpl/event-detail-info-update.html"),r=require("event/view/event-rsvp");return t.extend({moduleId:"event/view/event-detail-info",region:{holder:"#main",scroller:"#content"},className:"event-detail-page",template:_.template(e),topMenuView:require("event/view/event-topmenu"),templateInfoUpdate:_.template(n),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this.$holder=$(this.region.holder),this.$scroller=this.$el.find("#content"),this.$titleLabel=this.$el.find("#page_title"),this.$eventDetailInfoHolder=this.$el.find("#event-detail-info"),this.$topMenuBtn=this.$el.find("#top_menu_toggle"),this},inject:function(){var e=this;return this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll(),this.fetchData(),this},updateNumberOfMemberCount:function(e){this.updateView()},fetchData:function(){var e={iEventId:this.model.getId()},t={context:this};utils.api.get("event/detail",e,t).done(this.fetchDataComplete).fail(this.fetchDataFail)},fetchDataComplete:function(e){e.error_code&&e.error_code>0?(utils.modal.alert(e.error_message),utils.history.back()):(this.model.set(e),this.updateView())},fetchDataFail:function(){},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model),this.topMenuIsShown(!1)},updateView:function(){if(!this.model.canView()){this.$titleLabel.html(_t("Private Page")),this.$eventDetailInfoHolder.html(utils.helper.permission_deny());return}this.$topMenuBtn.removeClass("hide"),$("#event_menu_actvity").removeClass("hide"),$("#event_menu_photo").removeClass("hide"),this.$titleLabel.html(this.model.getTitle()),this.$eventDetailInfoHolder.html(this.templateInfoUpdate({item:this.model,date:this.model.getDate(),end_date:this.model.getDate(!0)})),this.$rsvpBtn=this.$el.find("#rsvp_btn"),this.$rsvpHolder=this.$el.find(".event-rsvp-dropdown-wrapper"),this.$scroller.trigger("refresh")},deleteSuccess:function(e){utils.modal.toast(e.message),window.location.href="#events/my"}})}),define("text!event/tpl/event-detail-activity.html",[],function(){return'<!-- activity/tpl/activity-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top btn-more hide" id="top_menu_toggle">\n		</div>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div class="title">\n			<%= _t(\'Event Activity\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div id="activity_minibar_holder" class="clearfix">\n</div>\n\n<div class="content content-background with-footer swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<%= utils.helper.loadnew() %>\n		<div class="swiper-slide">\n			<div class="pvl"></div>\n			<div id="activity-list" class="swiper-list vertical-align"></div>\n			</div>\n			<%= utils.helper.loadmore() %>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item" href="<%=item.getUrl()%>">\n        	<div class=""><%= _t(\'Information\') %></div>\n        </a>\n        <a class="menu-item current" href="<%=item.getUrl()%>/activity">\n        	<div class="sibling"><%= _t(\'Activity\') %></div>\n        </a>\n    </div>\n</div>'}),define("event/view/event-detail-activity",["event/view/event-item","text!event/tpl/event-detail-activity.html","event/view/event-topmenu","activity/view/activity-list","activity/view/activity-minibar"],function(e,t,n,r,i){return e.extend({region:{main:"#main",content:"#content"},template:_.template(t),className:"newsfeed-page",topMenuView:n,render:function(){return this.$el.html(this.template({item:this.model})),this.$el.attr({id:this.model.getDataId()}),this.$topMenuBtn=this.$el.find("#top_menu_toggle"),this},inject:function(){var e=this;return $(this.region.main).html(this.$el),this.$scroller=this.$el.find("#content"),this.$scroller.ensureVerticalScroll(),utils.api.get("event/view",{iEventId:this.model.getId()},{context:this}).done(function(e){e.error_code&&e.error_code>0?(utils.modal.alert(e.error_message),utils.history.back()):(this.model.set(e),this.updateView())}),(new r({},this.$el.find("#activity-list"),this.$scroller,{loadnew:!0})).render({sItemType:"event",sParentId:"event",iItemId:this.model.getId()}).inject(),this},events:{"click #top_menu_toggle":"toggleTopMenu"},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model),this.topMenuIsShown(!1)},deleteSuccess:function(e){utils.modal.toast(e.message),window.location.href="#events/my"},updateView:function(){this.$topMenuBtn.removeClass("hide"),this.model.canComment()&&(this.$scroller.addClass("with-topbar"),(new i).render({sItemType:this.model.getType(),iItemId:this.model.getId(),exclude:["checkin"]}).inject())}})}),define("event/controller/event-detail",["event/model/event","event/view/event-detail-info","event/view/event-detail-activity"],function(e,t,n){function r(t,r){utils.history.push(),utils.observer.trigger("router:changed"),(new n({model:new e({iEventId:r,sModelType:t})})).render().inject()}function i(n,r){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iEventId:r,sModelType:n})})).render().inject()}utils.router.route("event-detail/:type/:id",i),utils.router.route("event-detail/:type/:id/activity",r)}),define("event/main",["core","event/plugin/activity","event/controller/event-add","event/controller/event-index","event/controller/event-invite","event/controller/event-edit","event/controller/event-detail"],function(e){e.sidebar.configs.set("event",{icon:"icon-sidebar-event",label:"Events",url:"#events"})}),define("event",["event/main"],function(e){return e}),define("chat/model/message",["core"],function(e){var t=Backbone.Model.extend({idAttribute:"iMessageId",defaults:{sModelType:"message"}});return t.prototype.getMessages=function(){return this.get("aMessages")||(this.get("sMessage")?[[this.get("sMessage")]]:[])},t.prototype.getSMessage=function(){return this.get("sMessage")||""},t.prototype.getSenderImgSrc=function(){return this.get("sSenderImage")||""},t.prototype.getSenderId=function(){return this.get("iSenderId")||""},t.prototype.getRecentUpdatedTimestamp=function(){return this.get("iRecentUpdatedTimestamp")||this.getTimestamp()||""},t.prototype.getSendStatusClass=function(){var e="";return this.get("sSendStatusType")=="error"&&(e="message-status-error"),e},t.prototype.getTimeString=function(){return this.getTimestamp()?utils.moment(this.getTimestamp()*1e3).format("MM/DD/YY h:mmA"):""},t.prototype.getSendStatus=function(){return this.get("sSendStatus")?this.get("sSendStatus")=="done"?"":this.get("sSendStatus"):""},t}),define("chat/collection/message",["chat/model/message"],function(){var e=require("chat/model/message"),t=Backbone.Collection.extend({model:e,comparator:"iMessageId"});return t}),define("chat/model/chat",["core","chat/collection/message"],function(e){var t=require("chat/collection/message"),n=Backbone.Model.extend({defaults:{messages:null,sModelType:"chat",iUnreadMessage:0},initialize:function(){this.set("messages",new t),this.set("iUnreadMessage",this.getFromLocalStorage("iUnreadMessage")),this.set("iLastMessageTimestamp",this.getFromLocalStorage("iLastMessageTimestamp")),this.on("add-new-unread-message",this.handleNewMessageAdded,this),this.on("change:iUnreadMessage",this.saveUnreadToLocalStorage,this),this.on("change:bIsCurrent",this.handleCurrentChange,this)},handleCurrentChange:function(e,t){t===!0&&this.set("iUnreadMessage",0)},idAttribute:"iItemId",handleNewMessageAdded:function(e){var t=this.get("iUnreadMessage");this.saveToLocalStorage("iLastMessageTimestamp",e.getTimestamp()),this.set("iUnreadMessage",t?t+1:1)},saveUnreadToLocalStorage:function(e,t){t===0?this.removeLocalStorage():this.saveToLocalStorage("iUnreadMessage",t),utils.observer.trigger("chat:update-notification",this.collection)},removeLocalStorage:function(){localStorage.removeItem(this.getKey())},saveToLocalStorage:function(e,t){var n=this.getItemFromLocalStorage();n[e]=t,localStorage.setItem(this.getKey(),JSON.stringify(n))},getKey:function(){return"chat-"+this.getType()+"-"+this.getId()},getItemFromLocalStorage:function(){return JSON.parse(localStorage.getItem(this.getKey()))||{}},getFromLocalStorage:function(e){var t=this.getItemFromLocalStorage();return t?t[e]:null},setCurrent:function(){_.each(this.collection.models,function(e){e.set("bIsCurrent",!1)},this),this.set("bIsCurrent",!0)}});return n.prototype.getId=function(){return this.get("id")||this.get("iItemId")},n.prototype.isSelf=function(){return e.viewer.getId()==this.getId()},n.prototype.getName=function(){return this.get("sFullName")},n.prototype.getUrl=function(){return"#user/"+this.getId()},n.prototype.getLink=function(){return'<a href="'+this.getUrl()+'">'+this.getName()+"</a>"},n.prototype.getImgSrc=function(){return this.get("sImage")},n.prototype.isSentRequestBy=function(){return this.get("bSentRequestBy")},n.prototype.isSentRequest=function(){return this.get("bSentRequest")},n.prototype.getStatus=function(){return this.get("sStatus")||""},n.prototype.hasNewMessage=function(){return parseInt(this.get("iUnreadMessage"),10)>0?!0:!1},n.prototype.getMessages=function(){return this.get("messages")},n.prototype.getLastTimestamp=function(){return this.get("iLastTimestamp")||0},n.prototype.getDetailUrl=function(){return""},n.prototype.getUniqueHtmlIdForChatDetail=function(){return["chat",this.getId()].join("-")},n.prototype.getNumberUnreadMesssages=function(){return this.get("iUnreadMessage")||0},n.prototype.isCurrent=function(){return this.get("bIsCurrent")||!1},n.prototype.getLastMessageTimestamp=function(){return this.get("iLastMessageTimestamp")||0},n}),define("chat/collection/chat",["chat/model/chat"],function(){var e=require("chat/model/chat"),t=Backbone.Collection.extend({model:e,comparator:function(e,t){var n;return n=this.compareLastTimestamp(e,t),n!==0?n:(n=this.compareStatus(e,t),n!==0?n:(n=this.compareName(e,t),n!==0?n:0))},compareLastTimestamp:function(e,t){return e.getLastMessageTimestamp()>t.getLastMessageTimestamp()?-1:e.getLastMessageTimestamp()==t.getLastMessageTimestamp()?0:1},compareStatus:function(e,t){if(e.getStatus()!==t.getStatus()){if(e.getStatus()=="online")return-1;if(t.getStatus()=="online")return 1}return 0},compareName:function(e,t){return e.getName()>t.getName()?1:-1},isStillUpdate:!1});return t}),define("chat/plugin/notification",["core","chat/collection/chat"],function(){var e=require("core"),t=$("#popup-chat"),n=require("chat/collection/chat");utils.observer.on("chat:turn-on-notification",function(t,n){e.viewer.set("bIsMuteChatNotification",!1),$("#popup-chat").show()}),utils.observer.on("chat:turn-off-notification",function(t,n){e.viewer.set("bIsMuteChatNotification",!0),$("#popup-chat").hide()}),utils.observer.on("chat:update-notification",function(e){var t=0;_.each(e.models,function(e){e.getNumberUnreadMesssages()>0&&(t+=1)},this),$("#popup-chat").find("span").html(t)});var r=function(){e.viewer.isMuteChatNotification()||$("#popup-chat").show()};t.on("click",function(){window.location.href="#chat",setTimeout(function(){utils.observer.trigger("chat:show-latest-conversation")},200)}),utils.observer.on("user:logout",function(){utils.observer.trigger("chat:turn-off-notification")}),utils.observer.on("user:login",function(){r()}),r()}),define("text!chat/tpl/chat-index.html",[],function(){return'<!-- photo/tpl/album-index.html-->\n<div class="header">\n	<div clickable="true" data-click="sidebar:toggle" class="header-left">\n		<i class="icon icon-sidebar"></i>\n	</div>\n\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div id="page_title" class="title">\n			<%= _t(\'Conversation\') %>\n		</div>\n	</div>\n\n    <div class="header-right">\n		<div class="btn-top btn-more" id="menu_toggle"></div>\n	</div>\n</div>\n\n<div class="content with-header">\n	<div class="left-content content-background" id="left_content">\n		<div id="search_view_holder" class="form-search-list-chat">\n			<!-- search holder -->\n		</div>\n		<div class="swiper-container chat-left-content" id="content">\n			<div class="swiper-wrapper">\n				<div class="swiper-slide">\n					<div class="not-found hide" id="not_found"><%= _t(\'No contacts found.\') %></div>\n					<div class="swiper-list vertical-align friend-list-view-holder"  id="friend-list-view-holder">\n						\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class="right-content" id="chat-detail-view-holder">\n	</div>\n</div>\n'}),define("text!chat/tpl/chat-item.html",[],function(){return'<!-- friend/tpl/friend-item-chat -->\n<div class="clearfix item-wrapper" rel="delegate" id="<%= item.getDataId(\'detail\') %>" data-display="page">\n	<div class="item-image">\n		<a href="<%= item.getUrl() %>">\n			<img src="<%= item.getImgSrc() %>">	\n		</a>\n	</div>\n	<div class="item-headline"><%= item.getLink() %></div>\n    <div class="item-status <%= item.getStatus() %>"><%= item.getStatus() %></div>\n</div>\n\n'}),define("text!chat/tpl/chat-detail.html",[],function(){return'<div class="swiper-container chat-right-content"  id="right_content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="swiper-list" id="message-list-view-holder">\n				\n			</div>\n		</div>\n	</div>\n</div>\n<div class="footer footer-chat chat-detail-view-holder" id="message-post-holder">\n</div>\n'}),define("text!chat/tpl/message-item.html",[],function(){return'<div class="clearfix item-wrapper <% if(item.isOwner()) { %>item-owner<% } %>">\n	<div class="item-image">\n        <img src="<%= item.getSenderImgSrc() %>">	\n	</div>\n    <div class="item-message">\n        <div class="item-message-time"><%= item.getTimeString() %></div>\n        <div class="item-message-status <%= item.getSendStatusClass() %>"><%= item.getSendStatus() %></div>\n        <% _.each(item.getMessages(), function(sMessage) { %>\n            <% if( (sMessage instanceof Array) && (sMessage.length > 1 ) ) { %>\n                <div class="item-message-desc group-message"> \n                    <% _.each(sMessage, function(subMessage) { %>\n                        <span><%= subMessage %></span>                            \n                    <% }) %>\n                    <span class="arrow"></span>\n                </div>\n            <% } else { %>\n                <div class="item-message-desc"> \n                    <span><%= sMessage %></span>\n                    <span class="arrow"></span>\n                </div>\n            <% } %>\n        <% }) %>\n    </div>\n</div>\n\n'}),define("chat/view/message-item",["text!chat/tpl/message-item.html"],function(e){return Backbone.View.extend({region:{},className:"message-item",template:_.template(e),events:{},initialize:function(){this.model.on("change",function(){this.render()},this)},render:function(){return this.$el.html(this.template({item:this.model})),this.$el.attr({id:this.model.getDataId()}),this},inject:function(e){e(this.el)}})}),define("text!chat/tpl/message-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- loading friend -->\n</div>\n'}),define("chat/view/message-list",["chat/model/message","chat/view/message-item","text!chat/tpl/message-list.html","chat/collection/message"],function(e,t,n){var r=require("chat/collection/message");return Backbone.ListViewCollection.extend({defaults:{iMessageAmount:10},followById:!0,api:"chat/getmessages",phraseNotFound:"No message.",phraseNotMore:"No more message.",className:"chat-message-list",template:_.template(n),itemModel:e,itemView:t,nearMessagePeriod:3,Collection:r,init:function(){this.constructor.__super__.init.apply(this,arguments),this.collection.on("new-message-appended-success",function(e){var t=this.collection.indexOf(e),n=this.collection.at(t-1);if(!n)return;if(n.getSenderId()==e.getSenderId()){$("#"+e.getDataId()).hide();var r=n.getMessages();e.getTimestamp()-n.getRecentUpdatedTimestamp()<this.nearMessagePeriod*60?_.last(r).push(e.getSMessage()):r.push([e.getSMessage()]),n.set({aMessages:r,iRecentUpdatedTimestamp:e.getTimestamp()}),n.trigger("change"),this.collection.remove(e)}},this)},loadNew:function(){this.isFirst=!1,this.loadMore()},updateQuery:function(){this.collection.length>0?this.query.iMaxId=this.collection.first().getId():this.query.iMaxId=99999999},parseData:function(e){var t=[],n=-1,r={},i=0,s=[];return _.each(e,function(e){n==e.iSenderId?(Math.abs(i-e.iTimestamp)<=this.nearMessagePeriod*60?_.last(s).push(e.sMessage):s.push([e.sMessage]),r.iRecentUpdatedTimestamp=e.iTimestamp):(s=[[e.sMessage]],r=e,r.aMessages=s,t.push(r)),n=e.iSenderId,i=e.iTimestamp},this),t}})}),define("text!chat/tpl/message-post.html",[],function(){return'<div class="message-post-holder">\n	<div class="btn-message">\n		<input type="submit" id="send_btn" value="<%= _t(\'Send\') %>" class="btn btn-small-fluid btn-primary disabled">	\n	</div>\n	<div class="input-message">\n		<input class="control-full" placeholder="<%= _t(\'Your message\') %>" type="text" id="message" />\n	</div>\n</div>\n'}),define("chat/view/message-post",["text!chat/tpl/message-post.html","chat/model/message","core"],function(){var e=require("text!chat/tpl/message-post.html"),t=require("chat/model/message"),n=require("core"),r=Backbone.View.extend({template:_.template(e),region:{main:"#message-post-holder"},events:{"click #send_btn":"sendMessage","keyup #message":"handleMessageChange"},render:function(){return this.$el.html(this.template()),this.$postBtn=$("#send_btn",this.$el),this.$message=$("#message",this.$el),this},inject:function(){var e=$(this.region.main);return e.html(this.el),this},handleMessageChange:function(){this.$message.val().trim()==""?this.$postBtn.addClass("disabled"):this.$postBtn.removeClass("disabled")},isValidate:function(){return this.$message.val().trim()===""?(utils.modal.alert(_t("Message cannot be empty")),!1):!0},sendMessage:function(){if(!this.isValidate())return;if(this.$postBtn.isProcessing())return;var e={sMessage:this.$message.val(),iItemId:this.model.getId(),sItemType:this.model.getType()},r={context:this,beforeSend:this.beforeSend},i=$.extend({iSenderId:n.viewer.getId(),sSendStatus:"sending",bNeedToScroll:!0},e);this.newMessage=new t(i),this.model.getMessages().add(this.newMessage),this.$message.val(""),this.$postBtn.addClass("disabled"),utils.api.post("chat/sendmessage",e,r).done(this.postDone).always(this.postComplete).fail(this.postFail)},postComplete:function(){this.$postBtn.isProcessing(!1)},beforeSend:function(){this.$postBtn.isProcessing(!0)},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||_t("Post URL failed!")),this.postFail(),!1;this.postSuccess(e)},postSuccess:function(e){e.sSendStatus="done",this.newMessage.set(e).collection.trigger("new-message-appended-success",this.newMessage)},postFail:function(){this.newMessage.set({sSendStatus:"Message was not delivered",sSendStatusType:"error"})}});return r}),define("chat/ipad/view/chat-detail",["chat/view/message-list","chat/view/message-post"],function(){var e=require("chat/view/message-list"),t=require("chat/view/message-post");return{region:{main:"#chat-detail-view-holder",content:"#right_content",scroller:"#right_content"},inject:function(){return this.$holder.html(this.$el),(new e({},this.$el.find("#message-list-view-holder"),this.$scroller,{loadmore:!1,loadnew:!0,collection:this.model.getMessages()})).render(this.query).inject(),(new t({model:this.model})).render().inject(),this.$scroller.ensureVerticalScroll(),this.$el.find("#message").focus(),this}}}),define("chat/view/chat-detail",["text!chat/tpl/chat-detail.html","chat/view/message-list","chat/view/message-post","chat/ipad/view/chat-detail"],function(){var e=require("text!chat/tpl/chat-detail.html"),t=require("chat/view/message-list"),n=require("chat/view/message-post"),r=Backbone.PolyplatformView.extend({template:_.template(e),moduleId:"chat/view/chat-detail",region:{main:"#main-bottom",content:"#content-bottom"},initialize:function(){this.skipUpdater=!1,this.model.setCurrent()},render:function(e){return this.query=$.extend({iItemId:this.model.getId(),sItemType:this.model.getType()},e),this.$holder=$(this.region.main),this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.content),this},events:{"click #btn_back":"closeDetailPage"},inject:function(){return this.$holder.html(this.$el),(new t({},this.$el.find("#message-list-view-holder"),this.$scroller,{loadmore:!1,loadnew:!0,collection:this.model.getMessages()})).render(this.query).inject(),(new n({model:this.model})).render().inject(),this.$scroller.ensureVerticalScroll(),utils.observer.trigger("bottom:open"),this.$el.find("#message").focus(),this},closeDetailPage:function(){utils.observer.trigger("bottom:close"),this.model.set("bIsCurrent",!1)}});return r}),define("chat/view/chat-item",["text!chat/tpl/chat-item.html","chat/view/chat-detail"],function(e){var t=require("chat/view/chat-detail");return Backbone.ItemView.extend({className:"friend-item",detailView:t,template:_.template(e),initialize:function(){this.constructor.__super__.initialize.apply(this,arguments),this.model.on("change",this.render,this)},render:function(){return this.context={item:this.model},this.$el.html(this.template(this.context)),this.model.hasNewMessage()?this.$el.addClass("has-new-message"):this.$el.removeClass("has-new-message"),this.model.isCurrent()?this.$el.addClass("active"):this.$el.removeClass("active"),this.$el.attr({id:this.model.getDataId()}),this},inject:function(e){return e(this.el),this}})}),define("text!chat/tpl/chat-list.html",[],function(){return'<div class="loading-initiator">\n	<!-- loading friend -->\n</div>\n'}),define("chat/view/chat-list",["chat/model/chat","chat/view/chat-item","text!chat/tpl/chat-list.html","chat/collection/chat","core"],function(e,t,n){var r=require("chat/collection/chat"),i="chat-last-ping-timestamp",s=require("core");return Backbone.ListViewCollection.extend({defaults:{sAction:"all"},followById:!1,api:"chat/getchatlist",phraseNotFound:"No friends availabe for chatting.",phraseNotMore:"No more friends.",className:"chat-friend-list",template:_.template(n),itemModel:e,itemView:t,pingStack:[],iLastTimestamp:localStorage.getItem(i),iGetNewMessages:1,Collection:r,handleCollectionReset:function(e,t){_.each(t.previousModels,function(e){var t=this.collection.get(e.getId());t.set("messages",e.getMessages()),t.set("bIsCurrent",e.isCurrent())},this),this.rerenderView()},init:function(){this.constructor.__super__.init.apply(this,arguments),this.collection.on("all",function(){utils.observer.trigger("chat:update-notification",this.collection)},this)},startChatlistUpdater:function(){return this.setupUpdater(),this},setupUpdater:function(){var e=this;return setTimeout(function(){e.update()},3e4),this},update:function(){this.isFirst=!0,this.loadMore(),this.isStillInChatListView()?this.setupUpdater():this.$ajaxMore.abort()},isStillInChatListView:function(){return $(".chat-friend-list").length==0?!1:!0},startPing:function(){if(this.collection.isStillUpdate)return;return this.setupPing(),this.isStillUpdate=!0,this},setupPing:function(){var e=this,t;return e.pingStack.push(e.ping),t=setInterval(function(){if(!e.isStillInChatListView()&&s.viewer.isMuteChatNotification()){window.clearInterval(t),e.collection.isStillUpdate=!1;return}var n=e.pingStack.pop();n&&n.apply(e)},5e3),this},ping:function(){var e={iGetNewMessages:this.iGetNewMessages},t={context:this,beforeSend:this.beforeSend};this.iLastTimestamp&&(e.iLastTimeStamp=this.iLastTimestamp),utils.api.post("chat/ping",e,t).done(this.postDone).always(this.postComplete)},postComplete:function(){this.pingStack.push(this.ping)},beforeSend:function(){},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){this.iLastTimestamp=e.iLastTimeStamp,localStorage.setItem(i,e.iLastTimeStamp),e.aNewMessages&&_.each(e.aNewMessages,function(e){e.bNeedToScroll=!0;var t=this.collection.findWhere({iItemId:e.iSenderId});if(t){var n=t.getMessages().add(e);t.getMessages().trigger("new-message-appended-success",n),t.isCurrent()||t.trigger("add-new-unread-message",n)}},this)}})}),define("text!chat/tpl/chat-search.html",[],function(){return'<div class="form-search-group include-btn-search">\n	<div class="form-group">\n		<span class="icon-search" id="search-button"></span>\n		<input type="text" class="input-search control-full" id="search_keywords" placeholder="<%= _t(\'Search friend\') %>" />\n	</div>\n</div>\n'}),define("chat/view/chat-search",["text!chat/tpl/chat-search.html"],function(e){return Backbone.View.extend({region:{holder:"#search_view_holder"},className:"search-area",template:_.template(e),render:function(){return this.$el.html(this.template()),this.$keywordInput=this.$el.find("#search_keywords"),this.$advSearchHolder=this.$el.find("#adv_search_holder"),this},inject:function(){return $(this.region.holder).html(this.$el),this},events:{"click #search_icon":"submitSearch","click #adv_search_toggle_btn":"toggleSearch"},toggleSearch:function(){this.$advSearchHolder.toggleClass("hide")},submitSearch:function(){this.trigger("submit",{sSearch:this.$keywordInput.val()||""})}})}),define("text!chat/tpl/chat-topmenu.html",[],function(){return'<div class="setting-list">\n	<% if(item.isOnline()) { %>\n	    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'toOffline\') %>"><%= _t(\'Offline\') %></a>\n	<% } else { %>\n	    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'toOnline\') %>"><%= _t(\'Online\') %></a>\n	<% } %>\n\n	<% if(item.isMuteChatNotification()) { %>\n	    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'unmute\') %>"><%= _t(\'Unmute Notification\') %></a>\n	<% } else { %>\n	    <a class="setting-item" rel="delegate" id="<%= item.getDataId(\'mute\') %>"><%= _t(\'Mute Notification\') %></a>\n	<% } %>\n</div>'}),define("chat/view/chat-topmenu",["text!chat/tpl/chat-topmenu.html","core"],function(e){var t=require("core");return Backbone.TopMenuView.extend({template:_.template(e),events:{mute:"muteNotification",unmute:"unmuteNotification",toOnline:"changeToOnline",toOffline:"changeToOffline"},initialize:function(){this.model.on("change",this.render,this)},muteNotification:function(){utils.observer.trigger("chat:turn-off-notification")},changeToOnline:function(){this.changeStatus("online")},changeToOffline:function(){this.changeStatus("offline")},changeStatus:function(e){if(this.isProcessingStatus)return;var t={sStatus:e},n={context:this,beforeSend:this.beforeSend};utils.api.post("chat/changestatus",t,n).done(this.postDone).always(this.postComplete)},postComplete:function(){this.isProcessingStatus=!1},beforeSend:function(){this.isProcessingStatus=!0},postDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postSuccess(e)},postSuccess:function(e){this.model.set("sChatStatus",e.sStatus),utils.modal.toast("Changed Status Successfully")},unmuteNotification:function(){utils.observer.trigger("chat:turn-on-notification")},inject:function(){return this.$el.attr({id:this.model.getDataId()}),this.constructor.__super__.inject.apply(this,arguments)}})}),define("chat/view/chat-index",["text!chat/tpl/chat-index.html","chat/view/chat-list","chat/view/chat-search","chat/view/chat-topmenu","core","chat/collection/chat","chat/view/chat-detail"],function(){var e=require("text!chat/tpl/chat-index.html"),t=require("chat/view/chat-list"),n=require("chat/view/chat-search"),r=require("core"),i=require("chat/collection/chat"),s=require("chat/view/chat-detail"),o=Backbone.View.extend({template:_.template(e),region:{holder:"#main",scroller:"#content"},initialize:function(){constants.chatCollection?this.collection=constants.chatCollection:(this.collection=new i,constants.chatCollection=this.collection),utils.observer.on("chat:show-latest-conversation",function(){this.showLatestConversation()},this)},topMenuView:require("chat/view/chat-topmenu"),render:function(e){return this.$el.html(this.template()),this},inject:function(){var e=$(this.region.holder).html(this.$el);return this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.listView=(new t({},this.$el.find("#friend-list-view-holder"),this.$scroller,{loadmore:!1,loadnew:!1,collection:this.collection})).render().inject().startChatlistUpdater().startPing(),this.listView.on("view:rerender",this.searchFriend,this),(new n).render().inject(),this.updateViewerChatStatus(),this},showLatestConversation:function(){var e=this;this.collection.length>0?this.displayLatest():this.collection.listenToOnce(this.listView,"view:load-complete",function(){e.displayLatest()})},displayLatest:function(){var e=this.collection.max(function(e){return e.hasNewMessage()?e.getLastMessageTimestamp():0});if(!e.hasNewMessage())return;e&&(new s({model:e})).render().inject()},events:{"keyup #search_keywords":"searchFriend","click #menu_toggle":"toggleMenu"},toggleMenu:function(){utils.topMenu.toggle(this,r.viewer)},searchFriend:function(){if($(".friend-item").length==0)return;$("#not_found").addClass("hide");var e=0,t=$.trim($("#search_keywords").val()).replace(/ +/g," ").toLowerCase();$(".friend-item").each(function(){$(this).removeClass("hide");var n=$(this).find(".item-headline").text().replace(/ +/g," ").toLowerCase();~n.indexOf(t)?e++:$(this).addClass("hide")}),e==0&&$("#not_found").removeClass("hide")},updateViewerChatStatus:function(){var e={},t={context:this,beforeSend:this.beforeSendUpdate};utils.api.post("chat/getstatus",e,t).done(this.postUpdateDone).always(this.postUpdateComplete)},postUpdateComplete:function(){},beforeSendUpdate:function(){},postUpdateDone:function(e,t,n){if(e.error_code>0)return utils.modal.alert(e.error_message||"Post URL failed!"),!1;this.postUpdateSuccess(e)},postUpdateSuccess:function(e){r.viewer.set("sChatStatus",e.sStatus)}});return o}),define("chat/controller/chat-index",["chat/view/chat-index"],function(){var e=require("chat/view/chat-index"),t,n=function(){utils.history.push(),utils.observer.trigger("router:changed"),t=(new e).render({}).inject()};utils.router.route("chat",n)}),define("chat/main",["chat/plugin/notification","chat/controller/chat-index"],function(){return{enable:!0}}),define("chat",["chat/main"],function(e){return e}),define("text!forum/tpl/attachment-forum-topic.html",[],function(){return'<div class="att-item-wrapper">\n	<div class="att-col-info">\n		<div class="att-item-title"><a href="<%=attUrl%>"><%= attachment.sTitle %></a></div>\n		<div class="att-item-description"><%= utils.str.shorten(attachment.sDescription,100)%></div>\n	</div>\n</div>'}),define("forum/view/attachment-forum-topic",["text!forum/tpl/attachment-forum-topic.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-forum-topic",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n={item:e,attachment:t,attUrl:"#forum/topic/"+t.iId};return this.$el.html(this.template(n)),this},inject:function(e){e.html(this.el)}})}),define("text!forum/tpl/attachment-forum-post.html",[],function(){return'<div class="att-item-wrapper">\n	<div class="att-col-info">\n		<div class="att-item-description"><%= utils.str.shorten(attachment.sDescription,100)%></div>\n	</div>\n</div>'}),define("forum/view/attachment-forum-post",["text!forum/tpl/attachment-forum-post.html"],function(e){return Backbone.View.extend({region:{},className:"attachment-forum-post",template:_.template(e),render:function(){var e=this.model,t=e.getAttachments()[0],n={item:e,attachment:t};return this.$el.html(this.template(n)),this},inject:function(e){e.html(this.el)}})}),define("forum/plugin/activity",["forum/view/attachment-forum-topic","forum/view/attachment-forum-post"],function(e,t){utils.headline.add(["forum_topic_create","ynforum_topic_create"],function(e){var t='<a href="'+e.getItemUrl()+'">topic</a>';return _t("%s posted a %s in the forum %s",e.getPosterLink(),t,e.getParentLink())}),utils.headline.add(["forum_topic_reply","ynforum_topic_reply"],function(e){var t='<a href="'+e.getItemUrl()+'">topic</a>';return _t("%s replied to a %s in the forum %s",e.getPosterLink(),t,e.getParentLink())}),utils.attachment.add(["forum_topic","ynforum_topic"],e),utils.attachment.add(["forum_post","ynforum_post"],t)}),define("text!forum/tpl/forum-detail.html",[],function(){return'<div class="right-content with-header swiper-container" id="right_content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'No topics found.\') %></div>\n			<div class="swiper-list vertical-align forum-topic-list-holder" id="forum_topic_list_holder">\n				\n			</div>\n		</div>\n	</div>\n</div>'}),define("forum/model/topic",[],function(){return Backbone.Model.extend({idAttribute:"iTopicId",defaults:{sModelType:"forum_topic"},getUrl:function(){return"#forum/topic/"+this.getId()},getTitle:function(){return this.get("sTitle")||this.get("sTopicTitle")||""},getViewCount:function(){return parseInt(this.get("iViewCount"))||0},getReplyCount:function(){return parseInt(this.get("iReplyCount"))||0},getLastUserLink:function(){return'<a href="#user/'+this.get("iLastUserId")+'">'+this.get("sLastUserName")+"</a>"},getLastPostedDate:function(){return this.get("sLastPostedDate")||""},isWatching:function(){return this.get("bIsWatching")||!1},canPost:function(){return this.get("bCanPost")||!1},isSticky:function(){return parseInt(this.get("bSticky"))||0}})}),define("text!forum/tpl/forum-topic-item.html",[],function(){return'<!-- forum/tpl/forum-topic-item -->\n<div class="clearfix item-wrapper <%if (item.isSticky()) {%>forum-topic-sticky<%}%>">\n	<div class="item-image">\n		<i class="icon icon-bullhorn"></i>\n	</div>\n	<div class="item-stats">\n		<span><i class="icon icon-comments"></i> <%=item.getReplyCount()%></span>\n		<span><i class="icon icon-eye-open"></i> <%=item.getViewCount()%></span>\n	</div>\n	<div class="item-forum-content">\n		<div class="item-title">\n			<a href="<%=item.getUrl()%>"><%=item.getTitle()%></a>\n		</div>\n		\n		<div class="item-description">\n			<div><a href="<%=item.getUrl()%>"><%=_t(\'Last post\')%></a> <%=_t(\'by\')%> <%=item.getLastUserLink()%></div>\n			<div><%=item.getLastPostedDate()%></div>\n		</div>\n	</div>\n	<span class="sticky"></span>\n</div>\n'}),define("forum/view/forum-topic-item",["text!forum/tpl/forum-topic-item.html"],function(e){return Backbone.View.extend({className:"forum-topic-item",template:_.template(e),render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el)}})}),define("text!forum/tpl/forum-topic-list.html",[],function(){return'<!-- forum/tpl/forum-topic-list.html-->\n<div class="loading-initiator">\n	<!-- loading topics -->\n</div>'}),define("forum/view/forum-topic-list",["forum/model/topic","forum/view/forum-topic-item","text!forum/tpl/forum-topic-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iAmountOfTopic:10,sSearch:""},followById:!1,api:"forum/view_forum",phraseNotFound:"No topics found.",phraseNotMore:"No more topics.",className:"forum-topic-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!forum/tpl/forum-index.html",[],function(){return'<!-- forum/tpl/forum-index.html-->\n<div class="header">\n    <div href="#" clickable="true" data-click="sidebar:toggle" class="header-left">\n        <i class="icon icon-sidebar"></i>\n    </div>\n    <div class="header-right">\n		<a class="btn-top btn-add hide" href="javascript:void(0)" id="create_topic_btn"></a>\n	</div>\n	<div class="header-center">\n		<%= utils.helper.updater() %>\n		<div id="page_title" class="title">\n			<%= _t(\'Forum\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header">\n	<div class="left-content content-background swiper-container" id="left_content">\n		<div class="swiper-wrapper">\n			<div class="swiper-slide">\n				<div class="not-found hide" id="forums_not_found"><%= _t(\'No forums found.\') %></div>\n				<div class="swiper-list vertical-align forum-category-list-holder" id="forum_category_list_holder">\n					\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div class="right-content swiper-container" id="right_content">\n		<div class="swiper-wrapper">\n			<div class="swiper-slide">\n				<div class="not-found hide" id="topics_not_found"><%= _t(\'No topics found.\') %></div>\n				<div class="swiper-list vertical-align forum-topic-list-holder" id="forum_topic_list_holder">\n					\n				</div>\n			</div>\n		</div>\n	</div>\n</div>'}),define("forum/model/category",[],function(){return Backbone.Model.extend({idAttribute:"iCategoryId",defaults:{sModelType:"forum_category"},getForumCount:function(){return this.get("iForumCount")||0},getForums:function(){return this.get("aForums")}})}),define("text!forum/tpl/forum-category-item.html",[],function(){return'<!-- forum/tpl/forum-category-item.html -->\n<div class="clearfix category-item-wrapper">\n	<div class="category-header">\n		<i class="icon icon-category-item"></i>		\n		<i class="icon toggle-list-icon icon-chevron-up"></i>\n		<div class="category-header-content">\n			<span class="category-title"><%=item.getTitle()%></span>\n			<span class="forum-count">(<%=item.getForumCount()%>)</span>\n		</div>\n	</div>\n	<div class="forum-list">\n		<div class="not-found hide"><%=_t(\'No forums found.\')%></div>\n	</div>\n</div>\n'}),define("forum/model/forum",[],function(){return Backbone.Model.extend({idAttribute:"iForumId",defaults:{sModelType:"forum"},getTitle:function(){return this.get("sForumTitle")||""},getDescription:function(){return this.get("sDescription")||""},getTopicCount:function(){return this.get("iTopicCount")||0},getTextTopicCount:function(){var e=this.getTopicCount();return e+" "+_t(e==1?"topic":"topics")},getPostCount:function(){return this.get("iPostCount")||0},getTextPostCount:function(){var e=this.getPostCount();return e+" "+_t(e==1?"post":"posts")}})}),define("text!forum/tpl/forum-item.html",[],function(){return'<!-- forum/tpl/forum-item -->\n<div class="clearfix item-wrapper">\n	<div class="item-content">\n		<div class="item-image">\n			<i class="icon icon-comments"></i>\n		</div>\n		<div class="item-stats">\n			<span><%=item.getTextTopicCount()%></span> / <span><%=item.getTextPostCount()%></span>\n		</div>\n		<div class="item-title">\n			<a href="javascript:void(0);"><%=item.getTitle()%></a>\n		</div>		\n	</div>\n	<div class="item-description">\n		<span><%=item.getDescription()%></span>\n	</div>\n</div>\n'}),define("forum/view/forum-item",["text!forum/tpl/forum-item.html"],function(e){return Backbone.View.extend({className:"forum-item",template:_.template(e),render:function(e){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),e.iForumId&&e.iForumId==this.model.getId()&&this.$el.addClass("active"),this},inject:function(e){e(this.el)}})}),define("forum/view/forum-category-item",["text!forum/tpl/forum-category-item.html","forum/model/forum","forum/view/forum-item"],function(e,t,n){return Backbone.View.extend({className:"forum-category-item",template:_.template(e),render:function(e){return this.query=$.extend({},e),this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},inject:function(e){e(this.el),this.appendForums()},appendForums:function(){var e=this,n=this.$el,r=$(".forum-list",n),i=this.model.getForums();if(i.length==0){$(".not-found",n).removeClass("hide");return}var s=function(e){r.append(e)},o=this.mapModel(i,t);_.each(o,function(t){e.handleInjectItem(t,s)})},mapModel:function(e,t){return e.map(function(e){return new t(e)})},handleInjectItem:function(e,t){(new n({model:e})).render(this.query).inject(t)},events:{"click .toggle-list-icon":"toggleForumList"},toggleForumList:function(e){$(e.currentTarget).toggleClass("icon-chevron-up icon-chevron-down"),$(".forum-list",this.$el).toggleClass("hide")}})}),define("text!forum/tpl/forum-category-list.html",[],function(){return'<!-- forum/tpl/forum-category-list.html-->\n<div class="loading-initiator">\n	<!-- loading forums -->\n</div>'}),define("forum/view/forum-category-list",["forum/model/category","forum/view/forum-category-item","text!forum/tpl/forum-category-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iAmountOfCategory:5},followById:!1,api:"forum/get",phraseNotFound:"No forums found.",phraseNotMore:"No more forums.",className:"forum-category-list",template:_.template(n),itemModel:e,itemView:t})}),define("forum/ipad/view/forum-index",["forum/view/forum-category-list","forum/view/forum-topic-list"],function(e,t){return{region:{holder:"#main",scrollerLeft:"#left_content",scrollerRight:"#right_content"},events:{"click .forum-item":"onForumItemClick"},render:function(e){return this.query=$.extend({},e),this.$el.html(this.template(this.query)),this},inject:function(){return this.$holder=$(this.region.holder),this.$holder.html(this.$el),this.$create_topic_btn=$("#create_topic_btn",this.$el),this.$scrollerLeft=$(this.region.scrollerLeft),this.$scrollerLeft.ensureVerticalScroll(),this.$scrollerRight=$(this.region.scrollerRight),this.$scrollerRight.ensureVerticalScroll(),this.CategoryListView=new e({},this.$el.find("#forum_category_list_holder"),this.$scrollerLeft),this.TopicListView=new t({},this.$el.find("#forum_topic_list_holder"),this.$scrollerRight),this.appendCategories(),this.query.iForumId&&this.appendTopics(this.query),this},appendCategories:function(){this.CategoryListView.render(this.query).inject()},appendTopics:function(e){this.TopicListView.render(e).inject()},onForumItemClick:function(e){this.$create_topic_btn.addClass("hide");var t=$(e.currentTarget);$(".forum-item").removeClass("active"),t.addClass("active");var n=t.attr("id");if(!n||!n.match(/\d+$/))return;var r=n.match(/\d+$/)[0];this.$create_topic_btn.attr("href","#forum/"+r+"/topics/create"),this.$create_topic_btn.removeClass("hide"),this.appendTopics({iForumId:r})}}}),define("forum/view/forum-index",["text!forum/tpl/forum-index.html","forum/view/forum-category-list","forum/ipad/view/forum-index"],function(e,t){return Backbone.PolyplatformView.extend({moduleId:"forum/view/forum-index",region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(e){return this.query=$.extend({},e),this.$el.html(this.template(this.query)),this},inject:function(){return this.$holder=$(this.region.holder),this.$holder.html(this.$el),this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.CategoryListView=new t({},this.$el.find("#forum_category_list_holder"),this.$scroller),this.CategoryListView.render(this.query).inject(),this}})}),define("forum/ipad/view/forum-detail",["forum/view/forum-index"],function(e){return{render:function(e){return this.query=$.extend({},e),this},inject:function(){(new e).render(this.query).inject()}}}),define("forum/view/forum-detail",["text!forum/tpl/forum-detail.html","forum/view/forum-topic-list","forum/ipad/view/forum-detail"],function(e,t){return Backbone.PolyplatformView.extend({moduleId:"forum/view/forum-detail",region:{holder:"#main",scroller:"#content"},template:_.template(e),initialize:function(){},render:function(e){return this.query=$.extend({},e),this.$el.html(this.template(this.query)),this},inject:function(){return this.appendInfo(),this.appendTopics(),this},appendInfo:function(){utils.api.get("forum/info",{iForumId:this.query.iForumId}).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));$("#page_title").html(e.sForumTitle||_t("Forum"))})},appendTopics:function(){this.$holder=$(this.region.holder),this.$holder.html(this.$el),this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.TopicListView=new t({},this.$el.find("#forum_topic_list_holder"),this.$scroller),this.TopicListView.render(this.query).inject()}})}),define("forum/controller/forum-detail",["forum/view/forum-detail"],function(e){function t(t){utils.history.push(),utils.observer.trigger("router:changed"),(new e).render({iForumId:t}).inject()}utils.router.route("forum/:id",t)}),define("forum/controller/forum-index",["forum/view/forum-index"],function(e){function t(){utils.history.push(!0),utils.observer.trigger("router:changed"),(new e).render().inject()}utils.router.route("forums",t)}),define("forum/model/post",[],function(){return Backbone.Model.extend({idAttribute:"iPostId",defaults:{sModelType:"forum_post"},isOwner:function(){return Backbone.iUserId==this.getPosterId()},getPosterImageSrc:function(){return this.get("sUserPhoto")},getCreationDate:function(){return this.get("sCreationDate")||""},getBody:function(){return this.get("sBody")||""},getPhotoUrl:function(){return this.get("sPhotoUrl")||""},canEdit:function(){return this.get("bCanEditPost")||!1},canDelete:function(){return this.get("bCanDeletePost")||!1},canPost:function(){return this.get("bCanPost")||!1},getTopicId:function(){return this.get("iTopicId")}})}),define("text!forum/tpl/forum-post-edit.html",[],function(){return'<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="save_btn"><%= _t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Edit Post\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="forum-post-edit" class="forum-post-edit-form">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer hide" id="footer">\n	<div class="clearfix menu-justify grid-2 gray">\n		<div class="menu-item" id="camera_btn" >\n			<div class="">\n				<i class="icon icon-attachment-camera"></i>\n			</div>\n		</div>\n		\n		<div class="menu-item" id="gallery_btn">\n			<div class="sibling">\n				<i class="icon icon-attachment-gallery"></i>\n			</div>\n		</div>\n	</div>\n</div>'}),define("text!forum/tpl/forum-attachment-photo.html",[],function(){return'<div class="attachment-photo-item">\n	<div class="attachment-photo-image" id="attachment_photo" data-src="<%=imageURI%>" style="background-image: url(\'<%=imageURI%>\');" ></div>\n	<div id="attachment_photo_remove" class="close_button"></div>\n</div>'}),define("text!forum/tpl/forum-post-edit-update.html",[],function(){return'<div class="form-general">\n	<!-- form content -->\n	<!-- <textarea class="fluid-no-border" id="input_content" placeholder="<%= _t(\'Content\') %>"><%=item.getBody()%></textarea> -->\n	<div id="input_content" contenteditable="true" class="form-edit-forum needsclick">\n		<%=item.getBody()%>\n	</div>\n	<div class="form-group group-checkbox hide" id="photo_delete_holder">\n		<input type="checkbox" id="photo_delete">\n		<label for="photo_delete"><%=_t(\'This post has a photo attached. Do you want to delete it?\')%></label>\n	</div>\n	<div class="form-group hide" id="attachment_holder">\n		<!--<div class="attachment-photo-item">\n			<div id="attachment_photo" data-src="" style="background-image: url(\'\');" ></div>\n			<div id="attachment_photo_remove" class="close_button"></div>\n		</div>-->\n	</div>\n</div>'}),define("forum/view/forum-post-edit",["text!forum/tpl/forum-post-edit.html","text!forum/tpl/forum-attachment-photo.html","text!forum/tpl/forum-post-edit-update.html"],function(e,t,n){return Backbone.View.extend({region:{main:"#main",content:"#content",form:"#forum-post-edit"},template:_.template(e),templateUpdate:_.template(n),render:function(){return this.$holder=$(this.region.main),this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.content),this.$editHolder=this.$el.find(this.region.form),this},inject:function(){this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll();var e={iPostId:this.model.getId()},t={context:this};return utils.api.get("forum/post_info",e,{context:this}).done(this.fetchDone).fail(this.fetchFail),this},fetchFail:function(){},fetchDone:function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));this.model.set(e),this.fetchSuccess()},fetchSuccess:function(){var e=this;this.$editHolder.html(this.templateUpdate({item:this.model})),""!=this.model.getPhotoUrl()?$("#photo_delete_holder").removeClass("hide"):($("#footer").removeClass("hide"),$("#attachment_holder").removeClass("hide"),$("#content").addClass("with-header-footer")),this.$save_btn=$("#save_btn"),this.$input_content=$("#input_content"),this.toggleBtn(),this.$input_content.bind("input propertychange",function(){e.toggleBtn()}),this.$scroller.trigger("refresh")},toggleBtn:function(){var e=this.$input_content.html().replace(/(<([^>]+)>)/ig,"").length==0;this.$save_btn.toggleClass("disabled",e)},events:{"change #photo_delete":"changePhotoDelete","click #camera_btn":"captureImage","click #gallery_btn":"getPicture","click #attachment_photo_remove":"removePhoto","click #save_btn":"savePost"},changePhotoDelete:function(e){var t=$(e.currentTarget),n=$(this.region.content),r=$("#footer"),i=$("#attachment_holder");t.is(":checked")?(n.addClass("with-header-footer"),i.removeClass("hide"),r.removeClass("hide")):(r.addClass("hide"),i.addClass("hide"),n.removeClass("with-header-footer"))},captureImage:function(e){function n(e){var n=e[0].fullPath;t.attachPhoto(n)}function r(e){}var t=this;navigator.device.capture.captureImage(n,r,{limit:1})},getPicture:function(e){function n(e){t.attachPhoto(e)}function r(e){}var t=this;navigator.camera.getPicture(n,r,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},attachPhoto:function(e){var n=$("#attachment_holder"),r=_.template(t,{imageURI:e});n.html(r);var i=$(this.region.content);i.trigger("refresh")},removePhoto:function(e){var t=$("#attachment_holder");t.empty();var n=$(this.region.content);n.trigger("refresh")},savePost:function(e){var t=this,n=$(this.region.content);if(n.find(".loading-initiator").length>0)return;if(this.$save_btn.hasClass("processing"))return;var r=this.$input_content.html();if(r.replace(/(<([^>]+)>)/ig,"").length==0)return utils.modal.alert(_t("Content cannot be empty"));var i=$("#watch_checkbox").is(":checked")?1:0,s=$("#photo_delete").is(":checked")?1:0,o={iPostId:this.model.getId(),sBody:r,iDeletePhoto:s},u={beforeSend:this.beforeSave,complete:this.saveComplete,context:this},a=$("#attachment_photo");if(a.length>0&&(!$("#photo_delete_holder").is(":visible")||s)){var f=a.data("src");utils.api.uploadImage("forum/post_edit",f,o).done(this.saveDone)}else utils.api.post("forum/post_edit",o,u).done(this.saveDone)},beforeSave:function(){this.$save_btn.addClass("processing")},saveComplete:function(){this.$save_btn.removeClass("processing")},saveDone:function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));utils.history.back()}})}),define("forum/controller/forum-post-edit",["forum/model/post","forum/view/forum-post-edit"],function(e,t){function n(n){utils.observer.trigger("router:changed"),(new t({model:new e({iPostId:n})})).render().inject()}utils.router.route("forum/topic/post/:id/edit",n)}),define("text!forum/tpl/forum-topic-create.html",[],function(){return'<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="save_btn"><%= _t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Post Topic\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="forum-topic-create">\n				<div class="form-general">\n					<!-- form content -->\n					<div class="form-group group-no-margin">\n						<input type="text" class="control-full" id="input_title" placeholder="<%= _t(\'Title\') %>" value=""/>\n					</div>\n					<div class="form-group">\n						<textarea class="control-full textarea" id="input_content" placeholder="<%= _t(\'Content\') %>"></textarea>\n					</div>\n					<div class="form-group group-checkbox">\n	                    <input type="checkbox" id="watch_checkbox" checked="checked" />\n	                    <label for="watch_checkbox"><%= _t(\'Send me notifications when other members reply to this topic\') %></label>\n					</div>\n					<div class="form-group" id="attachment_holder">\n						<!-- <div class="attachment-photo-item">\n							<div class="attachment-photo-image" id="attachment_photo" data-src="" style="background-image: url(\'http://m.f29.img.vnecdn.net/2014/03/13/hr-5171-peanut-star-8729-1394675591.jpg\');" ></div>\n							<div id="attachment_photo_remove" class="close_button"></div>\n						</div> -->\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer">\n	<div class="clearfix menu-justify grid-2 gray">\n		<div class="menu-item" id="camera_btn" >\n			<div class="">\n				<i class="icon icon-attachment-camera"></i>\n			</div>\n		</div>\n		\n		<div class="menu-item" id="gallery_btn">\n			<div class="sibling">\n				<i class="icon icon-attachment-gallery"></i>\n			</div>\n		</div>\n	</div>\n</div>'}),define("forum/view/forum-topic-create",["text!forum/tpl/forum-topic-create.html","text!forum/tpl/forum-attachment-photo.html"],function(e,t){return Backbone.View.extend({region:{main:"#main",content:"#content"},template:_.template(e),render:function(e){var t=this;return this.context=$.extend({},e),this.$el.html(this.template(this.context)),this.$save_btn=$("#save_btn",this.$el),this.$input_title=$("#input_title",this.$el),this.$input_content=$("#input_content",this.$el),this.$input_title.bind("input propertychange",function(){t.toggleBtn()}),this.$input_content.bind("input propertychange",function(){t.toggleBtn()}),this},inject:function(){var e=$(this.region.main);e.html(this.el);var t=$(this.region.content);return t.vscroll(),this},toggleBtn:function(){this.$input_title.val()&&this.$input_content.val()?this.$save_btn.removeClass("disabled"):this.$save_btn.addClass("disabled")},events:{"click #camera_btn":"captureImage","click #gallery_btn":"getPicture","click #attachment_photo_remove":"removePhoto","click #save_btn":"createTopic"},captureImage:function(e){function n(e){var n=e[0].fullPath;t.attachPhoto(n)}function r(e){}var t=this;navigator.device.capture.captureImage(n,r,{limit:1})},getPicture:function(e){function n(e){t.attachPhoto(e)}function r(e){}var t=this;navigator.camera.getPicture(n,r,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},attachPhoto:function(e){var n=$("#attachment_holder"),r=_.template(t,{imageURI:e});n.html(r);var i=$(this.region.content);i.trigger("refresh")},removePhoto:function(e){var t=$("#attachment_holder");t.empty();var n=$(this.region.content);n.trigger("refresh")},createTopic:function(e){var t=this;if(this.$save_btn.hasClass("processing"))return;var n=this.$input_title.val(),r=this.$input_content.val();if(!n)return utils.modal.alert(_t("Title cannot be empty"));if(n.length>64)return utils.modal.alert(_t("Please enter Title no more than 64 characters"));if(!r)return utils.modal.alert(_t("Content cannot be empty"));var i=$("#watch_checkbox").is(":checked")?1:0,s={iForumId:this.context.iForumId,sTitle:n,sBody:r,iWatch:i},o={beforeSend:this.beforeSave,complete:this.saveComplete,context:this},u=$("#attachment_photo");if(u.length>0){var a=u.data("src");utils.api.uploadImage("forum/topic_create",a,s).done(this.saveDone)}else utils.api.post("forum/topic_create",s,o).done(this.saveDone)},beforeSave:function(){this.$save_btn.addClass("processing")},saveComplete:function(){this.$save_btn.removeClass("processing")},saveDone:function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));e.iTopicId?window.location.href="#forum/topic/"+e.iTopicId:window.location.href="#forum/"+self.context.iForumId}})}),define("forum/controller/forum-topic-create",["forum/view/forum-topic-create"],function(e){function t(t){utils.observer.trigger("router:changed"),(new e).render({iForumId:t}).inject()}utils.router.route("forum/:id/topics/create",t)}),define("text!forum/tpl/forum-topic-detail.html",[],function(){return'<!-- forum/tpl/forum-topic-detail.html -->\n<div class="header">\n	<div class="header-left">\n		<div class="btn-top btn-back" rel="back">\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top btn-more hide" id="top_menu_toggle">\n		</div>\n	</div>\n	<div class="header-center">\n		<div id="page_title" class="title">\n			<%= _t(\'Loading...\') %>\n		</div>\n	</div>\n</div>\n\n<div id="top_menu_holder" class="top-menu hide"></div>\n\n<div class="content content-background with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div class="not-found hide" id="not_found"><%= _t(\'No posts found.\') %></div>\n			<div class="swiper-list vertical-align" id="forum_post_list_holder">\n				\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer hide" id="footer">\n	<div class="clearfix menu-justify grid-3 fobos">\n        <a class="menu-item current" href="#forum/topic/<%=item.getId()%>/reply">\n        	<div class=""><%= _t(\'Reply\') %></div>\n        </a>\n    </div>\n</div>'}),define("text!forum/tpl/forum-post-item.html",[],function(){return'<!-- forum/tpl/forum-post-item -->\n<div class="item-wrapper">\n	<div class="item-forum-top clearfix">\n		<a class="item-image" href="<%=item.getPosterUrl()%>">\n			<img src="<%=item.getPosterImageSrc()%>" />\n		</a>\n		<div class="item-setting" id="<%= item.getDataId(\'setting\') %>" rel="delegate">\n			<i class="icon icon-setting"></i>\n		</div>\n		<div class="item-headline">\n			<a href="<%=item.getPosterUrl()%>"><%=item.getPosterTitle()%></a>\n		</div>\n		<div class="item-subline">\n			<%=item.getCreationDate()%>\n		</div>\n	</div>\n	<div class="item-forum-content">\n		<div class="clear item-story">\n			<%=item.getBody()%>\n		</div>\n		<%if ("" != item.getPhotoUrl()) {%>\n		<div class="clear item-attachment">\n			<div class="photo-attachment">\n				<img src="<%=item.getPhotoUrl()%>" />\n			</div>\n		</div>\n		<%}%>\n	</div>	\n</div>'}),define("text!forum/tpl/forum-post-setting.html",[],function(){return'<div class="setting-list">\n	<%if (item.canEdit()) {%>\n		<a class="setting-item" href="#forum/topic/post/<%=item.getId()%>/edit">\n			<%= _t(\'Edit post\') %>\n		</a>\n	<%}%>\n	<%if (item.canDelete()) {%>\n		<a class="setting-item" id="<%=item.getDataId(\'delete\')%>" rel="delegate">\n			<%= _t(\'Delete post\') %>\n		</a>\n	<%}%>\n	<%if (item.canPost()) {%>\n		<a class="setting-item" href="#forum/topic/<%=item.getTopicId()%>/reply/<%=item.getId()%>">\n			<%= _t(\'Quote post\') %>\n		</a>\n	<%}%>\n	<%if (!item.isOwner()) {%>\n		<a class="setting-item" id="<%= item.getDataId(\'report\') %>" rel="delegate">\n			<%= _t(\'Report this post\') %>\n		</a>\n	<%}%>\n</div>'}),define("forum/view/forum-post-setting",["text!forum/tpl/forum-post-setting.html"],function(e){return Backbone.PopupView.extend({template:_.template(e)})}),define("forum/view/forum-post-item",["text!forum/tpl/forum-post-item.html","forum/view/forum-post-setting"],function(e,t){return Backbone.ItemView.extend({className:"forum-post-item",template:_.template(e),settingView:t,render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this.prepareExternalLink(),this},prepareExternalLink:function(){this.$el.find(".item-story a").each(function(){var e=$(this).attr("href");e.substr(0,4)=="http"&&$(this).attr("onclick","window.open('"+e+"', '_blank', 'location=yes')"),$(this).attr("href","javascript:void(0)")})},inject:function(e){e(this.el)},doDeleteConfirm:function(){var e=this;utils.modal.confirm("Do you want to delete this post?",function(t){t==1&&(utils.observer.trigger("blockui"),utils.api.post("forum/post_delete",{iPostId:e.model.getId()}).done(function(t){if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));e.deleteSuccess(t)}).always(function(){utils.observer.trigger("releaseui"),utils.popup.close()}))},_t("Confirm"),[_t("Ok"),_t("Cancel")])},deleteSuccess:function(e){utils.modal.toast(e.message),this.$el.remove();var t=$(this.region.content);t.trigger("refresh")}})}),define("text!forum/tpl/forum-post-list.html",[],function(){return'<!-- forum/tpl/forum-post-list.html-->\n<div class="loading-initiator">\n	<!-- loading posts -->\n</div>'}),define("forum/view/forum-post-list",["forum/model/post","forum/view/forum-post-item","text!forum/tpl/forum-post-list.html"],function(e,t,n){return Backbone.ListView.extend({defaults:{iPage:1,iAmountOfPost:10},followById:!1,api:"forum/view_topic",phraseNotFound:"No posts found.",phraseNotMore:"No more posts.",className:"forum-post-list",template:_.template(n),itemModel:e,itemView:t})}),define("text!forum/tpl/forum-topic-topmenu.html",[],function(){return'<div class="setting-list">\n	<%if (item.isWatching()) {%>\n	<div class="menu-item" rel="delegate" id="<%=item.getDataId(\'stopwatch\')%>"><%=_t(\'Stop Watching\')%></div>\n	<%} else {%>\n	<div class="menu-item" rel="delegate" id="<%=item.getDataId(\'watch\')%>"><%=_t(\'Watch Topic\')%></div>\n	<%}%>\n</div>'}),define("forum/view/forum-topic-topmenu",["text!forum/tpl/forum-topic-topmenu.html"],function(e){return Backbone.TopMenuView.extend({moduleId:"forum/view/forum-topic-topmenu",template:_.template(e)})}),define("forum/ipad/view/forum-topic-detail",[],function(){return{topicWatchSuccess:function(e,t){this.model.set("bIsWatching",t),utils.popup.close(),utils.modal.toast(e.message)}}}),define("forum/view/forum-topic-detail",["text!forum/tpl/forum-topic-detail.html","forum/view/forum-post-list","forum/view/forum-topic-topmenu","forum/ipad/view/forum-topic-detail"],function(e,t,n){return Backbone.PolyplatformView.extend({moduleId:"forum/view/forum-topic-detail",region:{holder:"#main",scroller:"#content"},template:_.template(e),topMenuView:n,initialize:function(){},render:function(){return this.$el.attr("id",this.model.getDataId()),this.$el.html(this.template({item:this.model})),this},inject:function(){return this.appendInfo(),this.appendTopics(),this},appendInfo:function(){var e=this;utils.api.get("forum/topic_info",{iTopicId:this.model.getId()}).done(function(t){if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));e.model.set(t),e.updateView()})},updateView:function(){$("#page_title").html(this.model.getTitle()),$("#top_menu_toggle").removeClass("hide"),this.model.canPost()&&($("#content").addClass("with-header-footer"),$("#footer").removeClass("hide"))},appendTopics:function(){this.$holder=$(this.region.holder),this.$holder.html(this.$el),this.$scroller=$(this.region.scroller),this.$scroller.ensureVerticalScroll(),this.PostListView=new t({},this.$el.find("#forum_post_list_holder"),this.$scroller),this.PostListView.render({iTopicId:this.model.getId()}).inject()},events:{"click #top_menu_toggle":"toggleTopMenu",watch:"onWatchClick",stopwatch:"onStopWatchClick"},toggleTopMenu:function(){utils.topMenu.toggle(this,this.model)},onWatchClick:function(e){this.topicWatch(e,1)},onStopWatchClick:function(e){this.topicWatch(e,0)},topicWatch:function(e,t){var n=$(e.currentTarget);if(n.hasClass("processing"))return;n.addClass("processing");var r={iTopicId:this.model.getId(),iWatch:t};utils.api.post("forum/topic_watch",r,{context:this}).done(function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));this.topicWatchSuccess(e,t)}).always(function(){n.removeClass("processing")})},topicWatchSuccess:function(e,t){this.model.set("bIsWatching",t),this.toggleTopMenu(),utils.modal.toast(e.message)}})}),define("forum/controller/forum-topic-detail",["forum/model/topic","forum/view/forum-topic-detail"],function(e,t){function n(n){utils.history.push(),utils.observer.trigger("router:changed"),(new t({model:new e({iTopicId:n})})).render().inject()}utils.router.route("forum/topic/:id",n),utils.router.route("forum_topic/:id",n)}),define("text!forum/tpl/forum-topic-reply.html",[],function(){return'<div class="header">\n	<div class="header-left">\n		<div class="btn-top" rel="back">\n			<%= _t(\'Cancel\') %>\n		</div>\n	</div>\n	<div class="header-right">\n		<div class="btn-top disabled" id="save_btn"><%= _t(\'Save\') %></div>\n	</div>\n	<div class="header-center">\n		<div class="title">\n			<%= _t(\'Reply\') %>\n		</div>\n	</div>\n</div>\n\n<div class="content with-header swiper-container" id="content">\n	<div class="swiper-wrapper">\n		<div class="swiper-slide">\n			<div id="forum-topic-reply" class="forum-topic-reply-form">\n				<div class="loading-initiator">\n					<!-- Loading				 -->\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="footer hide" id="footer">\n	<div class="clearfix menu-justify grid-2 gray">\n		<div class="menu-item" id="camera_btn" >\n			<div class="">\n				<i class="icon icon-attachment-camera"></i>\n			</div>\n		</div>\n		\n		<div class="menu-item" id="gallery_btn">\n			<div class="sibling">\n				<i class="icon icon-attachment-gallery"></i>\n			</div>\n		</div>\n	</div>\n</div>'}),define("text!forum/tpl/forum-topic-reply-update.html",[],function(){return'<div class="form-general">\n	<!-- form content -->\n	<textarea class="fluid-no-border" id="input_content" placeholder="<%= _t(\'Post reply\') %>"></textarea>\n	<div class="form-group" id="quote_holder">\n	</div>\n	<div class="form-group group-checkbox">\n        <input type="checkbox" id="watch_checkbox" <%if (item.isWatching()) {%>checked="checked"<%}%> />\n        <label for="watch_checkbox"><%= _t(\'Send me notifications when other members reply to this topic\') %></label>\n	</div>\n	<div class="form-group" id="attachment_holder">\n		<!--<div class="attachment-photo-item">\n			<div id="attachment_photo" data-src="" style="background-image: url(\'\');" ></div>\n			<div id="attachment_photo_remove" class="close_button"></div>\n		</div>-->\n	</div>\n</div>'}),define("text!forum/tpl/forum-post-quote.html",[],function(){return'<div class="group-quote-line"></div>\n<div class="group-quote-holder">\n	<div class="quote-header">\n		<a href="<%=postItem.getPosterUrl()%>"><%=postItem.getPosterTitle()%></a> <%=_t(\'said\')%>:\n	</div>\n	<div class="quote-content">\n		<%=postItem.getBody()%>\n	</div>\n</div>'}),define("forum/view/forum-topic-reply",["text!forum/tpl/forum-topic-reply.html","text!forum/tpl/forum-attachment-photo.html","text!forum/tpl/forum-topic-reply-update.html","text!forum/tpl/forum-post-quote.html","forum/model/post"],function(e,t,n,r,i){return Backbone.View.extend({region:{main:"#main",content:"#content",form:"#forum-topic-reply"},template:_.template(e),templateUpdate:_.template(n),render:function(e){return this.postModel=e.iPostId?new i({iPostId:e.iPostId}):null,this.$holder=$(this.region.main),this.$el.html(this.template({item:this.model})),this.$scroller=this.$el.find(this.region.content),this.$formHolder=this.$el.find(this.region.form),this},inject:function(){var e=this;this.$holder.html(this.$el),this.$scroller.ensureVerticalScroll();var t=utils.api.get("forum/topic_info",{iTopicId:this.model.getId()}).done(function(t){if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));e.model.set(t)});if(this.postModel){var n=utils.api.get("forum/post_info",{iPostId:this.postModel.getId()}).done(function(t){if(t.error_code&&t.error_code>0)return utils.modal.alert(t.error_message||_t("Can not load data from server"));e.postModel=new i(t)});$.when(t,n).done(function(){e.updateView()})}else $.when(t).done(function(){e.updateView()});return this},updateView:function(){var e=this;this.$formHolder.html(this.templateUpdate({item:this.model}));if(this.postModel){var t=_.template(r,{postItem:this.postModel});$("#quote_holder").html(t)}this.$save_btn=$("#save_btn"),this.$input_content=$("#input_content"),this.$input_content.bind("input propertychange",function(){e.toggleBtn()}),$("#content").addClass("with-header-footer"),$("#footer").removeClass("hide")},toggleBtn:function(){var e=!this.$input_content.val();this.$save_btn.toggleClass("disabled",e)},events:{"click #camera_btn":"captureImage","click #gallery_btn":"getPicture","click #attachment_photo_remove":"removePhoto","click #save_btn":"postReply"},captureImage:function(e){function n(e){var n=e[0].fullPath;t.attachPhoto(n)}function r(e){}var t=this;navigator.device.capture.captureImage(n,r,{limit:1})},getPicture:function(e){function n(e){t.attachPhoto(e)}function r(e){}var t=this;navigator.camera.getPicture(n,r,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0})},attachPhoto:function(e){var n=$("#attachment_holder"),r=_.template(t,{imageURI:e});n.html(r);var i=$(this.region.content);i.trigger("refresh")},removePhoto:function(e){var t=$("#attachment_holder");t.empty();var n=$(this.region.content);n.trigger("refresh")},postReply:function(e){var t=this,n=$(this.region.content);if(n.find(".loading-initiator").length>0)return;if($("#save_btn").hasClass("processing"))return;var r=$("#input_content").val();if(!r)return utils.modal.alert(_t("Content cannot be empty"));var i=$("#watch_checkbox").is(":checked")?1:0,s={iTopicId:this.model.getId(),sBody:r,iWatch:i};this.postModel&&(s.iQuoteId=this.postModel.getId());var o={beforeSend:this.beforeSave,complete:this.saveComplete},u=$("#attachment_photo");if(u.length>0){var a=u.data("src");utils.api.uploadImage("forum/post_reply",a,s).done(this.saveDone)}else utils.api.post("forum/post_reply",s,o).done(this.saveDone)},beforeSave:function(){$("#save_btn").addClass("processing")},saveComplete:function(){$("#save_btn").removeClass("processing")},saveDone:function(e){if(e.error_code&&e.error_code>0)return utils.modal.alert(e.error_message||_t("Can not load data from server"));utils.history.back()}})}),define("forum/controller/forum-topic-reply",["forum/model/topic","forum/view/forum-topic-reply"],function(e,t){function n(n,r){utils.observer.trigger("router:changed"),(new t({model:new e({iTopicId:n})})).render({iPostId:r}).inject()}utils.router.route("forum/topic/:id/reply(/:postId)",n)}),define("forum/main",["core","forum/plugin/activity","forum/controller/forum-detail","forum/controller/forum-index","forum/controller/forum-post-edit","forum/controller/forum-topic-create","forum/controller/forum-topic-detail","forum/controller/forum-topic-reply"],function(e){e.sidebar.configs.set("forum",{label:"Forums",url:"#forums",icon:"icon-sidebar-forum"})}),define("forum",["forum/main"],function(e){return e}),require.config({baseUrl:"./",packages:[{name:"language",location:"./app/language"},{name:"utils",location:"./app/module/utils"},{name:"core",location:"./app/module/core"},{name:"like",location:"./app/module/like"},{name:"dislike",location:"./app/module/dislike"},{name:"comment",location:"./app/module/comment"},{name:"search",location:"./app/module/search"},{name:"share",location:"./app/module/share"},{name:"rate",location:"./app/module/rate"},{name:"report",location:"./app/module/report"},{name:"activity",location:"./app/module/activity"},{name:"request",location:"./app/module/request"},{name:"message",location:"./app/module/message"},{name:"notification",location:"./app/module/notification"},{name:"activity",location:"./app/module/activity"},{name:"link",location:"./app/module/link"},{name:"user",location:"./app/module/user"},{name:"friend",location:"./app/module/friend"},{name:"photo",location:"./app/module/photo"},{name:"video",location:"./app/module/video"},{name:"music",location:"./app/module/music"},{name:"template",location:"./app/template"},{name:"event",location:"./app/module/event"},{name:"forum",location:"./app/module/forum"},{name:"chat",location:"./app/module/chat"}],paths:{backbone:"./app/vendor/backbone/backbone",text:"./app/vendor/requirejs-text/text",json:"./app/vendor/requirejs-json/json",jquery:"./app/vendor/jquery/dist/jquery.js",underscore:"./app/vendor/underscore/underscore",fastclick:"./app/vendor/fastclick/lib/fastclick",bpopup:"./app/vendor/bpopup/jquery.bpopup",swiper:"./app/vendor/swiper/dist/idangerous.swiper",SocialConnect:"./app/vendor/socialconnect/socialconnect",beeber_box:"./app/vendor/jquery.plugin/jquery.beeber_box",CONTROLLER_PLAYER:"./app/vendor/htmlplayer/controller_player",MediaElelementPlayer:"./app/vendor/htmlplayer/mediaelement-and-player",jcrop:"./app/vendor/jcrop/js/jquery.Jcrop",jcolor:"./app/vendor/jcrop/js/jquery.color","jquery.i18n":"./app/vendor/jquery-i18n/jquery.i18n",moment:"./app/vendor/momentjs/moment",numeral:"./app/vendor/numeral/numeral","underscore.string":"./app/vendor/underscore.string/underscore.string",cutstring:"./app/vendor/htmlcut/cutstring",iScroll:"./app/vendor/iscroll/iscroll"},config:{text:{template:"ipad"}},waitSeconds:10,map:{},shim:{fastclick:{exports:"Fastclick"},beeber_box:{},CONTROLLER_PLAYER:{deps:["MediaElelementPlayer"],exports:"CONTROLLER_PLAYER"},jcrop:{exports:"jcrop"},jcolor:{exports:"jcolor"},SocialConnect:{exports:"SocialConnect"}}}),require(["utils","core","like","dislike","comment","share","rate","report","user","activity","request","friend","message","link","notification","video","photo","music","event","chat","forum"],function(){utils.observer.trigger("app:init"),Backbone.history.start(),utils.observer.trigger("app:run")}),define("app",function(){});